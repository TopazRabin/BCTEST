OBJECT Codeunit 50043 Invoice Notification Handling
{
  OBJECT-PROPERTIES
  {
    Date=09/16/20;
    Time=[ 3:22:59 AM];
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    TableNo=472;
    OnRun=BEGIN
            TPZ_SendNotifications("Parameter String");
          END;

  }
  CODE
  {
    VAR
      SalesSetup@1000000000 : Record 311;
      Codeunit82EventSubscriber@1170000000 : Codeunit 51877;

    LOCAL PROCEDURE TPZ_SendNotifications@1000000012(InvoiceNo@1000000000 : Code[20]);
    VAR
      EMailMgt@1000000001 : Codeunit 14000903;
      FaxMgmt@1000000005 : Codeunit 50010;
      SalesPostPrint@1000000006 : Codeunit 82;
      EmailInvoice@1000000007 : Boolean;
      PrintInvoice@1000000008 : Boolean;
      FaxInvoice@1000000009 : Boolean;
      EmailCredit@1000000010 : Boolean;
      EmailShipment@1000000011 : Boolean;
      JobQueueCat@1000000012 : Record 471;
      JobQueueEntry@1000000013 : Record 472;
      PostDescription@1000000014 : Text;
      SalesInvHeader@1000000002 : Record 112;
    BEGIN
      //<TPZ2242>
      SalesSetup.GET;
      SalesInvHeader.GET(InvoiceNo);
      WITH SalesInvHeader DO BEGIN
        IF SalesSetup."Enable E-Mail" AND NOT "EDI Invoice" THEN
              EMailMgt.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);

          IF SalesSetup."Enable Fax" AND Fax AND NOT "EDI Invoice" THEN
              FaxMgmt.SalesInvoice(SalesInvHeader);

          IF SalesSetup."Enable Mail" AND Mail AND NOT "EDI Invoice" THEN
            Codeunit82EventSubscriber.CU82_GetInvoiceReport(SalesInvHeader);//<TPZ2829> Event Subscription
                    //SalesPostPrint.GetInvoiceReport(SalesInvHeader);
      END;
       {
      SalesSetup.GET;
      SalesInvHeader.GET(InvoiceNo);
      WITH SalesInvHeader DO BEGIN
        IF SalesSetup."Enable E-Mail" AND NOT "EDI Invoice" THEN
              EMailMgt.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);

          IF SalesSetup."Enable Fax" AND Fax THEN
              FaxMgmt.SalesInvoice(SalesInvHeader);

          IF SalesSetup."Enable Mail" AND Mail THEN
                    SalesPostPrint.GetInvoiceReport(SalesInvHeader);
      END;
      //</TPZ2242>
      }
    END;

    PROCEDURE GlobalTPZ_SendNotifications@1000000000(InvoiceNo@1000000000 : Code[20]);
    VAR
      EMailMgt@1000000001 : Codeunit 14000903;
      FaxMgmt@1000000005 : Codeunit 50010;
      SalesPostPrint@1000000006 : Codeunit 82;
      EmailInvoice@1000000007 : Boolean;
      PrintInvoice@1000000008 : Boolean;
      FaxInvoice@1000000009 : Boolean;
      EmailCredit@1000000010 : Boolean;
      EmailShipment@1000000011 : Boolean;
      JobQueueCat@1000000012 : Record 471;
      JobQueueEntry@1000000013 : Record 472;
      PostDescription@1000000014 : Text;
      SalesInvHeader@1000000002 : Record 112;
    BEGIN
      //<TPZ2242>
      SalesSetup.GET;
      SalesInvHeader.GET(InvoiceNo);
      WITH SalesInvHeader DO BEGIN
        IF SalesSetup."Enable E-Mail" AND NOT "EDI Invoice" THEN
              EMailMgt.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);

          IF SalesSetup."Enable Fax" AND Fax AND NOT "EDI Invoice" THEN
              FaxMgmt.SalesInvoice(SalesInvHeader);

          IF SalesSetup."Enable Mail" AND Mail AND NOT "EDI Invoice" THEN
            Codeunit82EventSubscriber.CU82_GetInvoiceReport(SalesInvHeader);//<TPZ2829> Event Subscription
                    //SalesPostPrint.GetInvoiceReport(SalesInvHeader);
      END;
       {
      SalesSetup.GET;
      SalesInvHeader.GET(InvoiceNo);
      WITH SalesInvHeader DO BEGIN
        IF SalesSetup."Enable E-Mail" AND NOT "EDI Invoice" THEN
              EMailMgt.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);

          IF SalesSetup."Enable Fax" AND Fax THEN
              FaxMgmt.SalesInvoice(SalesInvHeader);

          IF SalesSetup."Enable Mail" AND Mail THEN
                    SalesPostPrint.GetInvoiceReport(SalesInvHeader);
      END;
      //</TPZ2242>
      }
    END;

    BEGIN
    {
      2018-02-13 TPZ2214 EBAGIM
        Handle invoice Notifications Via Job Queue
      2018-03-12 TPZ2242 DKUMAR
        EDI Invoice Email code block.
      2018-03-15
        Do not email invoice if it's EDI invoice due to IMARK requirement.
        All IMARK invoice invoices are EDI and should not send to end customer
    }
    END.
  }
}

