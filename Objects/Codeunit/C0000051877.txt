OBJECT Codeunit 51877 Codeunit82EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=09/17/20;
    Time=[ 4:51:21 AM];
    Modified=Yes;
    Version List=NAVEVENT,TPZ2829;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      Selection@1000000007 : Integer;
      SendReportAsEmail@1000000006 : Boolean;
      ReportSelection@1000000005 : Record 77;
      SalesInvHeaderDef@1170000000 : RecordRef;
      SalesInvHeader@1000000000 : Record 112;
      SalesHeader@1000000004 : Record 36;
      SalesShptHeader@1000000003 : Record 110;
      SalesCrMemoHeader@1000000002 : Record 114;
      ReturnRcptHeader@1000000001 : Record 6660;

    PROCEDURE CU82_GetInvoiceReport@1000000000(VAR tmpInvoiceHeader@1000 : Record 112);
    VAR
      tmpLocation@1000000000 : Record 14;
      ReportSelection@1000000003 : Record 77;
    BEGIN
      //TPZ2214

        SalesInvHeader."No." := tmpInvoiceHeader."No.";
        SalesInvHeader.SETRECFILTER;
        SalesInvHeaderDef.GETTABLE(SalesInvHeader);//EB
        tmpLocation.GET(tmpInvoiceHeader."Location Code");
        IF tmpLocation."Shipping Location" THEN
          CU82_PrintReportCustom(ReportSelection.Usage::"S.Invoice")
          ELSE
          CU82_PrintReport(ReportSelection.Usage::"S.Invoice");

        //<TPZ2181>
        CU82_UpdateMailNoticeHandled(SalesInvHeader."No.");

      // </TPZ162>
    END;

    PROCEDURE CU82_UpdateMailNoticeHandled@1000000001(DocNo@1000000000 : Code[20]);
    VAR
      SalesInvHeader@1000000002 : Record 112;
      ShipmentHeaderEdit@1000000001 : Codeunit 391;
    BEGIN
      // <TPZ162>
      SalesInvHeader.GET(DocNo);
      SalesInvHeader."Mail Invoice Notice Handled" := TRUE;

      ShipmentHeaderEdit.SalesInvoiceHeaderEdit(SalesInvHeader);
      COMMIT;
      // </TPZ162>
    END;

    LOCAL PROCEDURE CU82_PrintReport@1000000002(ReportUsage@1000 : Integer);
    BEGIN
      ReportSelection.RESET;
      ReportSelection.SETRANGE(Usage,ReportUsage);
      ReportSelection.FINDSET;
      REPEAT
        ReportSelection.TESTFIELD("Report ID");
        CASE ReportUsage OF
          ReportSelection.Usage::"SM.Invoice":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesInvHeader);
          ReportSelection.Usage::"SM.Credit Memo":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesCrMemoHeader);
          ReportSelection.Usage::"S.Invoice":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesInvHeader);
          ReportSelection.Usage::"S.Cr.Memo":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesCrMemoHeader);
          ReportSelection.Usage::"S.Shipment":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesShptHeader);
          ReportSelection.Usage::"S.Ret.Rcpt.":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,ReturnRcptHeader);
        END;
      UNTIL ReportSelection.NEXT = 0;
    END;

    LOCAL PROCEDURE CU82_PrintReportCustom@1000000003(ReportUsage@1000 : Integer);
    VAR
      Parameters@1000000000 : Text;
      Sales_ReceivablesSetup@1000000001 : Record 311;
      ReportSelection@1000000006 : Record 77;
    BEGIN
      Sales_ReceivablesSetup.GET; //<TPZ2181>

      ReportSelection.RESET;
      ReportSelection.SETRANGE(Usage,ReportUsage);
      ReportSelection.FINDSET;
      REPEAT
        ReportSelection.TESTFIELD("Report ID");
        CASE ReportUsage OF
          ReportSelection.Usage::"SM.Invoice":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesInvHeader);
          ReportSelection.Usage::"SM.Credit Memo":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesCrMemoHeader);
          ReportSelection.Usage::"S.Invoice":
            REPORT.PRINT(ReportSelection."Report ID",'',Sales_ReceivablesSetup."Printer Name For Invoice Post",SalesInvHeaderDef); //<TPZ2181>
          //REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesInvHeader);
          ReportSelection.Usage::"S.Cr.Memo":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesCrMemoHeader);
          ReportSelection.Usage::"S.Shipment":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,SalesShptHeader);
          ReportSelection.Usage::"S.Ret.Rcpt.":
            REPORT.RUN(ReportSelection."Report ID",FALSE,FALSE,ReturnRcptHeader);
        END;
      UNTIL ReportSelection.NEXT = 0;
    END;

    BEGIN
    END.
  }
}

