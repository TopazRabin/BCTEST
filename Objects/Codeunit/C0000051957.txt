OBJECT Codeunit 51957 Price Book Exp - Cont Job Queu
{
  OBJECT-PROPERTIES
  {
    Date=06/28/21;
    Time=[ 7:42:38 AM];
    Modified=Yes;
    Version List=TPZ2990;
  }
  PROPERTIES
  {
    TableNo=472;
    OnRun=BEGIN
            CASE "Parameter String" OF
              'CustomerPRCBook':
                CustomerPRCBookJobQueue;
              END
            //CustomerPRCBookJobQueue;
          END;

  }
  CODE
  {
    VAR
      JobQueueEntry@1000000000 : Record 472;
      PostDescription@1000000001 : TextConst '@@@="%1 = document type, %2 = document number. Example: Post Sales Order 1234.";ENU="Email Price Book for %1 ";ESM=Registrar ventas %1 %2.;FRC=Reportez les ventes %1 %2.;ENC=Post Sales %1 %2.';

    PROCEDURE CustomerPRCBookJobQueue@1000000000();
    VAR
      SalesSetup@1000000003 : Record 311;
      JobQueueCat@1000000001 : Record 471;
      RecRef@1000000000 : RecordRef;
      CustomerDivision@1000000004 : Record 50007;
      tmpCustomer@1000000002 : Record 18;
      tmpcounter@1000000005 : Integer;
      Strtdate@1000000006 : Date;
      Contact@1000000007 : Record 5050;
    BEGIN
        tmpcounter := 0;
        Strtdate:=CALCDATE('-2Y',WORKDATE);
        CustomerDivision.RESET;
        CLEAR(CustomerDivision);
        //CustomerDivision.SETFILTER("Customer No.",'%1|%2|%3|%4|%5|%6|%7|%8','00805','00758','90394','90325','90275','55030','54733','53422');//00805|00758|90394|90325|90275|55030|54733|53422
       CustomerDivision.SETFILTER("Customer No.",'56868');
      // CustomerDivision.SETFILTER("Customer No.",'<>%1&<>%2','54826','51363');//Helpdesk 36756 Utk
       CustomerDivision.SETFILTER("Shortcut Dimension 5 Code",'E');
       IF CustomerDivision.FINDSET THEN BEGIN
         REPEAT
          tmpCustomer.RESET;
          tmpCustomer.SETRANGE("No.",CustomerDivision."Customer No.");
          tmpCustomer.SETFILTER(Blocked,'<>%1',tmpCustomer.Blocked::All);
          tmpCustomer.SETRANGE("Date Filter",Strtdate,WORKDATE);
          tmpCustomer.SETFILTER("Sales (LCY)",'<>%1',0);
          tmpCustomer.SETFILTER("Customer Price Group",'<>%1','BORDER');//Helpdesk 36756 Utk
          IF tmpCustomer.FINDFIRST THEN BEGIN
            Contact.RESET;
            Contact.CALCFIELDS("Customer No.","Job Responsibility");
            Contact.SETRANGE("Customer No.",tmpCustomer."No.");
            Contact.SETFILTER("E-Mail",'<>%1','');
            Contact.SETFILTER("Job Responsibility",'1|2|3|4|5|6|7|8|9|10|11|12|13|14|15|16|17|39');
            Contact.SETRANGE("Shortcut Dimension 5 Code",'E');//Need to ask this is required or not
            IF Contact.FINDFIRST THEN BEGIN
                tmpcounter += 8000;
                JobQueueEntry.INIT();
                SalesSetup.GET;
                JobQueueEntry."Object Type to Run" := JobQueueEntry."Object Type to Run"::Codeunit;
                JobQueueEntry."Object ID to Run" := CODEUNIT::"Cust price Book - Auto job";
                JobQueueEntry."Parameter String":=CustomerDivision."Customer No.";
                JobQueueEntry.ID:=CREATEGUID;
                JobQueueCat.GET('EMAILSTATE');
                JobQueueEntry."Job Queue Category Code" := JobQueueCat.Code;
                JobQueueEntry."Timeout (sec.)" := 5000;
              //IF SalesSetup."Post from Statem. Start Time" <> 0T THEN
                  JobQueueEntry."Earliest Start Date/Time" := CURRENTDATETIME + tmpcounter;
                  JobQueueEntry.Priority := SalesSetup."Job Q. Prio. for P. from Whse.";
                  JobQueueEntry.Description :=
                  COPYSTR(STRSUBSTNO(PostDescription,CustomerDivision."Customer No."),1,MAXSTRLEN(JobQueueEntry.Description));
                    JobQueueEntry.INSERT;
                  CODEUNIT.RUN(CODEUNIT::"Job Queue - Enqueue",JobQueueEntry);
              END;
          END;
         UNTIL CustomerDivision.NEXT=0;
       END;
    END;

    BEGIN
    {
      04092021 UTK Helpdesk 36756 http://helpdesk.topazusa.net:8080/WorkOrder.do?woMode=viewWO&woID=36756&&fromListView=true Exclude customer as per Kristen request.
    }
    END.
  }
}

