OBJECT Codeunit 51951 Codeunit5063EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=NAVEVENT,TPZ2829;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    PROCEDURE CU5063_ArchiveTransferDocument@1000000009(VAR TransferHeader@1004 : Record 5740);
    BEGIN
      {
      IF CONFIRM(
           Text007,TRUE,
           TransferHeader."No.")
      THEN BEGIN
      }
        CU5063_StoreTransferDocument(TransferHeader,FALSE);
        //MESSAGE(Text001,TransferHeader."No.");
      //END;
    END;

    PROCEDURE CU5063_StoreTransferDocument@1000000008(VAR TransferHeader@1000 : Record 5740;InteractionExist@1005 : Boolean);
    VAR
      TransferLine@1002 : Record 5741;
      TransferHeaderArchive@1004 : Record 50014;
      TransferLineArchive@1001 : Record 50022;
      RecordLinkManagement@1003 : Codeunit 447;
    BEGIN
      TransferHeaderArchive.INIT;
      TransferHeaderArchive.TRANSFERFIELDS(TransferHeader);
      TransferHeaderArchive."Archived By" := USERID;
      TransferHeaderArchive."Date Archived" := WORKDATE;
      TransferHeaderArchive."Time Archived" := TIME;
      TransferHeaderArchive."Version No." := CU5063_GetNextTransferVersionNo(
          DATABASE::"Transfer Header",TransferHeader."No.",TransferHeader."Doc. No. Occurrence");
      TransferHeaderArchive."Interaction Exist" := InteractionExist;
      RecordLinkManagement.CopyLinks(TransferHeader,TransferHeaderArchive);
      TransferHeaderArchive.INSERT;
      {
      StoreSalesDocumentComments(
        SalesHeader."Document Type",SalesHeader."No.",
        SalesHeader."Doc. No. Occurrence",SalesHeaderArchive."Version No.");
      }
      TransferLine.SETRANGE("Document No.",TransferHeader."No.");
      TransferLine.SETRANGE("Transfer-from Code",TransferHeader."Transfer-from Code");
      IF TransferLine.FINDSET THEN
        REPEAT
          WITH TransferLineArchive DO BEGIN
            INIT;
            TRANSFERFIELDS(TransferLine);
            "Doc. No. Occurrence" := TransferHeader."Doc. No. Occurrence";
            "Version No." := TransferHeaderArchive."Version No.";
            RecordLinkManagement.CopyLinks(TransferLine,TransferLineArchive);
            INSERT;
          END;
          {
          IF transferline."Deferral Code" <> '' THEN
            StoreDeferrals(DeferralUtilities.GetSalesDeferralDocType,SalesLine."Document Type",
              SalesLine."Document No.",SalesLine."Line No.",SalesHeader."Doc. No. Occurrence",SalesHeaderArchive."Version No.");
          }
        UNTIL TransferLine.NEXT = 0;
    END;

    PROCEDURE CU5063_GetNextTransferVersionNo@1000000007(TableId@1004 : Integer;DocNo@1001 : Code[20];DocNoOccurrence@1003 : Integer) : Integer;
    VAR
      TransferHeaderArchive@1002 : Record 50014;
    BEGIN
      CASE TableId OF
        DATABASE::"Transfer Header":
          BEGIN
            TransferHeaderArchive.LOCKTABLE;
            TransferHeaderArchive.SETRANGE("No.",DocNo);
            TransferHeaderArchive.SETRANGE("Doc. No. Occurrence",DocNoOccurrence);
            IF TransferHeaderArchive.FINDLAST THEN
              EXIT(TransferHeaderArchive."Version No." + 1);

            EXIT(1);
          END;
        END;
    END;

    BEGIN
    END.
  }
}

