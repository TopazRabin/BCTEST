OBJECT Codeunit 14000716 PDF Management
{
  OBJECT-PROPERTIES
  {
    Date=06/28/17;
    Time=12:00:00 PM;
    Version List=SE0.60.03;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            CASE FunctionID OF
              1: GetPDFReader;
            END;
          END;

  }
  CODE
  {
    VAR
      WSHSHell@1240020001 : Automation "{F935DC20-1CF0-11D0-ADB9-00C04FD58A0B} 1.0:{72C24DD5-D70A-438B-8A42-98424B88AFB8}:'Windows Script Host Object Model'.WshShell";
      FunctionID@1240020000 : Integer;
      PDFReader@1240020002 : Text[250];
      PDFFilename@1240020003 : Text[250];
      Parameters@1240020004 : ARRAY [10] OF Text[250];

    PROCEDURE PrintPDFFile@1240030004(BufferFileName@1240030008 : Text[250]);
    VAR
      Text001@1240030001 : TextConst 'ENU=File name is blank.';
      Text002@1240020000 : TextConst 'ENU=The "Lanham PDF Print Interface" external component needs to be installed on this computer. Or contact your Lanham Partner.';
      PDFManagement@1240020004 : Codeunit 14000716;
      Text003@1240020001 : TextConst 'ENU=Adobe Reader needs to be installed on this computer. Or contact your Lanham Partner.';
      FileSystemObject@1240020002 : Automation "{420B2830-E718-11CF-893D-00A0C9054228} 1.0:{0D43FE01-F093-11CF-8940-00A0C9054228}:'Microsoft Scripting Runtime'.FileSystemObject";
      FileInStream@1240020005 : InStream;
      TempFile@1240020003 : File;
      ClientFileName@1240020006 : Text[1024];
    BEGIN
      IF BufferFileName = '' THEN
        ERROR(Text001);

      IF ISSERVICETIER THEN BEGIN
        CLEAR(FileSystemObject);
        IF CREATE(FileSystemObject,FALSE,TRUE) THEN;
        IF FileSystemObject.FolderExists(FileSystemObject.GetParentFolderName(BufferFileName)) THEN BEGIN
          TempFile.OPEN(BufferFileName);
          TempFile.CREATEINSTREAM(FileInStream);
          DOWNLOADFROMSTREAM(FileInStream,'','<TEMP>','',ClientFileName);
          FileSystemObject.CopyFile(ClientFileName,BufferFileName);
        END;
      END;
      COMMIT;
      PDFManagement.SetParameter(1,BufferFileName);
      PDFManagement.SetFunctionID(1);
      IF NOT PDFManagement.RUN THEN
        MESSAGE(Text003);
    END;

    PROCEDURE SetFunctionID@1240020001(ID@1240020000 : Integer);
    BEGIN
      FunctionID := ID;
    END;

    PROCEDURE SetParameter@1240020002(Index@1240020000 : Integer;Parameter@1240020001 : Text[250]);
    BEGIN
      Parameters[Index] := Parameter;
    END;

    PROCEDURE GetPDFReader@1240020000();
    BEGIN
      CLEAR(WSHSHell);
      IF CREATE(WSHSHell,FALSE,TRUE) THEN BEGIN
          PDFReader := WSHSHell.RegRead('HKCR\.pdf\');
          PDFReader := WSHSHell.RegRead('HKCR\' + PDFReader + '\shell\open\command\');
          PDFReader := STRSUBSTNO(PDFReader, ' /p/h "' + ' "' +  Parameters[1]);
          WSHSHell.Exec(PDFReader);
      END;
    END;

    BEGIN
    END.
  }
}

