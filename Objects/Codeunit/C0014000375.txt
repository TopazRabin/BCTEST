OBJECT Codeunit 14000375 Create E.D.I. Alert
{
  OBJECT-PROPERTIES
  {
    Date=04/05/12;
    Time=12:00:00 PM;
    Version List=SE0.55.08;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      EDIAlert@1240030001 : Record 14000380;

    PROCEDURE CreateAlertForecastRelease@1240030007(InternalDocNo@1240030000 : Code[10];CurrOrderLine@1240030001 : Record 37;CurrQuoteLine@1240030002 : Record 37;AlertNo@1240030006 : Integer;ProcessAction@1240030013 : ' ,Request Cancelled,Order Created') : Boolean;
    VAR
      CurrOrderHdr@1240030003 : Record 36;
      EDIRecDocHdr@1240030008 : Record 14002358;
      CurrQuoteHdr@1240020002 : Record 36;
      CurrBlanketHdr@1240020003 : Record 36;
      LineNo@1240030005 : Integer;
      Text001@1240030004 : TextConst 'ENU=Release quantity of %1 on %2 %3 line no. %4 is less than the quantity shipped of %5 on %6 %7 line no. %8.';
      Text002@1240030007 : TextConst 'ENU=Release quantity of %1 is greater than outstanding quantity of %2 on %3 %4  line no.%5. No action performed.';
      Text003@1240030009 : TextConst 'ENU=Close order request to zero quantity for %1 %2 line no. %3 could not be performed.  Quantity shipped <> 0.';
      Text004@1240030010 : TextConst 'ENU="Close order request to delete %1 %2 could not be performed.  Shipped not invoiced must = 0 for all lines."';
      Text005@1240030011 : TextConst 'ENU=Release quantity of %1 is greater than outstanding quantity of %2 on %3 %4  line no.%5. Sales Order created with release quantity.';
      Text006@1240030012 : TextConst 'ENU=Release quantity of %1 is greater than outstanding quantity of %2 on %3 %4  line no.%5. Sales Order created for outstanding quantity.';
      Text007@1240020000 : TextConst 'ENU=Close order request to delete %1 %2 could not be performed.  Order was released prior to update.';
      Text008@1240020001 : TextConst 'ENU=Close order request to delete %1 %2 could not be performed.  Packages exist.';
    BEGIN
      CurrOrderHdr.GET(CurrOrderLine."Document Type",CurrOrderLine."Document No.");
      CurrQuoteHdr.GET(CurrQuoteLine."Document Type",CurrQuoteLine."Document No.");
      CurrBlanketHdr.GET(
        CurrBlanketHdr."Document Type"::"Blanket Order",CurrOrderLine."Blanket Order No.");

      EDIRecDocHdr.GET(InternalDocNo);

      EDIAlert.RESET;
      IF EDIAlert.FIND('+') THEN
        LineNo := EDIAlert."Line No." + 1
      ELSE
        LineNo := 1;

      EDIAlert.RESET;
      EDIAlert."Line No." := LineNo;
      EDIAlert."Internal Doc. No." := EDIRecDocHdr."Internal Doc. No.";
      EDIAlert."Alert Date" := EDIRecDocHdr."Date Received";
      EDIAlert."Trade Partner No." := CurrOrderHdr."EDI Trade Partner";
      EDIAlert."Document Type" := EDIAlert."Document Type"::Order;
      EDIAlert."Document No." := CurrOrderLine."Document No.";
      EDIAlert."Sales Line No." := CurrOrderLine."Line No.";
      EDIAlert."Document Internal Doc. No." := CurrOrderHdr."EDI Internal Doc. No.";
      EDIAlert."Associated Document Type" := EDIAlert."Document Type"::"Blanket Order";
      EDIAlert."Associated Document No." := CurrOrderLine."Blanket Order No.";
      EDIAlert."Associated Document Line No." := CurrOrderLine."Blanket Order Line No.";
      EDIAlert."Assoc. Doc. Internal Doc. No." := CurrBlanketHdr."EDI Internal Doc. No.";
      EDIAlert."Associated Document Type 2" := EDIAlert."Document Type"::Quote;
      EDIAlert."Associated Document No. 2" := CurrQuoteLine."Document No.";
      EDIAlert."Associated Document Line No. 2" := CurrQuoteLine."Line No.";
      EDIAlert."Assoc. Doc.2 Internal Doc. No." := CurrQuoteHdr."EDI Internal Doc. No.";
      EDIAlert.Type := EDIAlert.Type::"Forecast & Release";
      EDIAlert."Sales Line Quantity" := CurrOrderLine.Quantity;
      EDIAlert."Sales Line Quantity Shipped" := CurrOrderLine."Quantity Shipped";
      EDIAlert."Sales Line Quantity (Base)" := CurrOrderLine."Quantity (Base)";
      EDIAlert."Sales Line Qty. Shipped (Base)" := CurrOrderLine."Qty. Shipped (Base)";
      EDIAlert."Release Quantity" := CurrQuoteLine.Quantity;
      EDIAlert."Process Action" := ProcessAction;
      EDIAlert."Review Alert" := TRUE;
      EDIAlert.INSERT(TRUE);

      CASE AlertNo OF
        1:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text001,CurrQuoteLine.Quantity,CurrQuoteLine."Document Type",CurrQuoteLine."Document No.",
            CurrQuoteLine."Line No.",CurrOrderLine."Quantity Shipped",CurrOrderLine."Document Type",
            CurrOrderLine."Document No.",CurrOrderLine."Line No.");
        2:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text002,CurrQuoteLine.Quantity,CurrOrderLine."Outstanding Quantity",
            CurrOrderHdr."Document Type",CurrOrderHdr."No.",CurrOrderLine."Line No.");
        3:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text003,CurrOrderLine."Document Type",CurrOrderLine."Document No.",
            CurrOrderLine."Line No.");
        4:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text004,CurrOrderLine."Document Type",CurrOrderLine."Document No.");
        5:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text005,CurrQuoteLine.Quantity,CurrOrderLine."Outstanding Quantity",
            CurrOrderHdr."Document Type",CurrOrderHdr."No.",CurrOrderLine."Line No.");
        6:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text006,CurrQuoteLine.Quantity,CurrOrderLine."Outstanding Quantity",
            CurrOrderHdr."Document Type",CurrOrderHdr."No.",CurrOrderLine."Line No.");
        7:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text007,CurrOrderLine."Document Type",CurrOrderLine."Document No.");
        8:
          EDIAlert."Alert Message" := STRSUBSTNO(
            Text008,CurrOrderLine."Document Type",CurrOrderLine."Document No.");
      END;

      EDIAlert.MODIFY;
    END;

    PROCEDURE CreateAlertGenericDoc@1240020002(InternalDocNo@1240020003 : Code[10];AlertNo@1240030006 : Integer) : Boolean;
    VAR
      Text001@1240030004 : TextConst 'ENU=%1 %2 generic document  received.';
      EDIRecDocHdr@1240020002 : Record 14002358;
      LineNo@1240020004 : Integer;
    BEGIN
      EDIRecDocHdr.GET(InternalDocNo);

      EDIAlert.RESET;
      IF EDIAlert.FIND('+') THEN
        LineNo := EDIAlert."Line No." + 1
      ELSE
        LineNo := 1;

      EDIAlert.INIT;
      EDIAlert.RESET;
      EDIAlert."Line No." := LineNo;
      EDIAlert."Internal Doc. No." := EDIRecDocHdr."Internal Doc. No.";
      EDIAlert."Alert Date" := EDIRecDocHdr."Date Received";
      EDIAlert."Trade Partner No." := EDIRecDocHdr."Trade Partner No.";
      EDIAlert.Type := EDIAlert.Type::General;
      EDIAlert."Review Alert" := TRUE;
      EDIAlert.INSERT(TRUE);

      CASE AlertNo OF
        1:
          EDIAlert."Alert Message" :=
            STRSUBSTNO(Text001,EDIRecDocHdr."Trade Partner No.",EDIRecDocHdr."EDI Document No.");
      END;
      EDIAlert.MODIFY;
    END;

    PROCEDURE CreateManualAlert@1240020000(CurrentEDIRecDocHdr@1240020009 : Record 14002358;AlertType@1240020000 : ' ,GenericDoc';AlertNo@1240020006 : Integer);
    VAR
      EDIRecDocHdr@1240020003 : Record 14002358;
      Text001@1240020004 : TextConst 'ENU=%1 %2 generic document received.';
      EDIDocument@1240020007 : Record 14002353;
      LineNo@1240020005 : Integer;
    BEGIN
      CASE AlertType OF
        AlertType::GenericDoc:
          BEGIN
            EDIDocument.RESET;
            EDIDocument.SETRANGE("Trade Partner No.",CurrentEDIRecDocHdr."Trade Partner No.");
            EDIDocument.SETRANGE("Navision Document",CurrentEDIRecDocHdr."Navision Document");
            EDIDocument.SETRANGE("EDI Document No.",CurrentEDIRecDocHdr."EDI Document No.");
            EDIDocument.SETRANGE(Version,CurrentEDIRecDocHdr."EDI Version");
            EDIDocument.SETRANGE(Type,EDIDocument.Type::Import);
            EDIDocument.SETFILTER(Status,'<>%1',EDIDocument.Status::Inactive);
            IF EDIDocument.FIND('-') THEN
              IF EDIDocument."Generic Document Received" THEN BEGIN
                EDIAlert.RESET;
                EDIAlert.SETCURRENTKEY("Internal Doc. No.");
                EDIAlert.SETRANGE("Internal Doc. No.",CurrentEDIRecDocHdr."Internal Doc. No.");
                IF NOT EDIAlert.FIND('-') THEN BEGIN
                  EDIAlert.RESET;
                  IF EDIAlert.FIND('+') THEN
                    LineNo := EDIAlert."Line No." + 1
                  ELSE
                    LineNo := 1;

                  EDIAlert.INIT;
                  EDIAlert.RESET;
                  EDIAlert."Line No." := LineNo;
                  EDIAlert."Internal Doc. No." := CurrentEDIRecDocHdr."Internal Doc. No.";
                  EDIAlert."Alert Date" := CurrentEDIRecDocHdr."Date Received";
                  EDIAlert."Trade Partner No." := CurrentEDIRecDocHdr."Trade Partner No.";
                  EDIAlert.Type := EDIAlert.Type::General;
                  EDIAlert."Manual Alert" := TRUE;
                  EDIAlert."Review Alert" := TRUE;
                  EDIAlert.INSERT(TRUE);

                  CASE AlertNo OF
                    1:
                      EDIAlert."Alert Message" :=
                        STRSUBSTNO(
                          Text001,CurrentEDIRecDocHdr."Trade Partner No.",
                          CurrentEDIRecDocHdr."EDI Document No.");
                  END;
                  EDIAlert.MODIFY;
                END;
              END;
          END;
      END;
    END;

    PROCEDURE CreateAlertRecDocError@1240020004(InternalDocNo@1240020002 : Code[10];AlertNo@1240020001 : Integer;Manual@1240020005 : Boolean);
    VAR
      Text001@1240020000 : TextConst 'ENU=%1 %2 did not process, process Receive Document to review error detail.';
      EDIRecDocHdr@1240020004 : Record 14002358;
      LineNo@1240020003 : Integer;
      AlertCreated@1240020006 : Boolean;
    BEGIN
      AlertCreated := FALSE;
      EDIRecDocHdr.GET(InternalDocNo);

      IF Manual THEN BEGIN
        EDIAlert.RESET;
        EDIAlert.SETCURRENTKEY("Internal Doc. No.");
        EDIAlert.SETRANGE("Internal Doc. No.",EDIRecDocHdr."Internal Doc. No.");
        IF NOT EDIAlert.FIND('-') THEN BEGIN
          EDIAlert.RESET;
          IF EDIAlert.FIND('+') THEN
            LineNo := EDIAlert."Line No." + 1
          ELSE
            LineNo := 1;
          EDIAlert.INIT;
          EDIAlert.RESET;
          EDIAlert."Line No." := LineNo;
          EDIAlert."Internal Doc. No." := EDIRecDocHdr."Internal Doc. No.";
          EDIAlert."Alert Date" := EDIRecDocHdr."Date Received";
          EDIAlert."Trade Partner No." := EDIRecDocHdr."Trade Partner No.";
          EDIAlert.Type := EDIAlert.Type::"Data Error";
          EDIAlert."Review Alert" := TRUE;
          EDIAlert."Data Error" := TRUE;
          EDIAlert.INSERT(TRUE);
          AlertCreated := TRUE;
        END;
      END ELSE BEGIN
        EDIAlert.RESET;
        IF EDIAlert.FIND('+') THEN
          LineNo := EDIAlert."Line No." + 1
        ELSE
          LineNo := 1;
        EDIAlert.INIT;
        EDIAlert.RESET;
        EDIAlert."Line No." := LineNo;
        EDIAlert."Internal Doc. No." := EDIRecDocHdr."Internal Doc. No.";
        EDIAlert."Alert Date" := EDIRecDocHdr."Date Received";
        EDIAlert."Trade Partner No." := EDIRecDocHdr."Trade Partner No.";
        EDIAlert.Type := EDIAlert.Type::"Data Error";
        EDIAlert."Review Alert" := TRUE;
        EDIAlert."Data Error" := TRUE;
        EDIAlert.INSERT(TRUE);
        AlertCreated := TRUE;
      END;

      IF AlertCreated THEN BEGIN
        CASE AlertNo OF
          1:
            EDIAlert."Alert Message" :=
              STRSUBSTNO(Text001,EDIRecDocHdr."Trade Partner No.",EDIRecDocHdr."EDI Document No.");
        END;
        EDIAlert.MODIFY;
      END;
    END;

    PROCEDURE CreateAlertSendDocError@1240020003(SendDocNo@1240020002 : Code[10];AlertNo@1240020001 : Integer;Manual@1240020005 : Boolean);
    VAR
      Text001@1240020000 : TextConst 'ENU=%1 %2 Send Document has data error(s), review Send Document to view error detail.';
      EDISendDocHdr@1240020004 : Record 14002369;
      LineNo@1240020003 : Integer;
      AlertCreated@1240020006 : Boolean;
    BEGIN
      AlertCreated := FALSE;
      EDISendDocHdr.GET(SendDocNo);

      IF Manual THEN BEGIN
        EDIAlert.RESET;
        EDIAlert.SETCURRENTKEY("Send Document No.");
        EDIAlert.SETRANGE("Send Document No.",EDISendDocHdr."No.");
        IF NOT EDIAlert.FIND('-') THEN BEGIN
          EDIAlert.RESET;
          IF EDIAlert.FIND('+') THEN
            LineNo := EDIAlert."Line No." + 1
          ELSE
            LineNo := 1;

          EDIAlert.INIT;
          EDIAlert.RESET;
          EDIAlert."Line No." := LineNo;
          EDIAlert."Send Document No." := EDISendDocHdr."No.";
          EDIAlert."Alert Date" := EDISendDocHdr."Created Date";
          EDIAlert."Trade Partner No." := EDISendDocHdr."Trade Partner No.";
          EDIAlert.Type := EDIAlert.Type::"Data Error";
          EDIAlert."Review Alert" := TRUE;
          EDIAlert."Data Error" := TRUE;
          EDIAlert.INSERT(TRUE);
          AlertCreated := TRUE;
        END;
      END ELSE BEGIN
        EDIAlert.RESET;
        IF EDIAlert.FIND('+') THEN
          LineNo := EDIAlert."Line No." + 1
        ELSE
          LineNo := 1;

        EDIAlert.INIT;
        EDIAlert.RESET;
        EDIAlert."Line No." := LineNo;
        EDIAlert."Send Document No." := EDISendDocHdr."No.";
        EDIAlert."Alert Date" := EDISendDocHdr."Created Date";
        EDIAlert."Trade Partner No." := EDISendDocHdr."Trade Partner No.";
        EDIAlert.Type := EDIAlert.Type::"Data Error";
        EDIAlert."Review Alert" := TRUE;
        EDIAlert."Data Error" := TRUE;
        EDIAlert.INSERT(TRUE);
        AlertCreated := TRUE;
      END;

      IF AlertCreated THEN BEGIN
        CASE AlertNo OF
          1:
            EDIAlert."Alert Message" :=
              STRSUBSTNO(Text001,EDISendDocHdr."Trade Partner No.",EDISendDocHdr."EDI Document No.");
        END;
        EDIAlert.MODIFY;
      END;
    END;

    PROCEDURE CheckAlertStatusReceiveDoc@1240020001(EDIRecDocHdr@1240020000 : Record 14002358;AlertType@1240020001 : ' ,Forecast & Release,General,Data Error');
    BEGIN
      EDIAlert.RESET;
      EDIAlert.SETCURRENTKEY("Internal Doc. No.");
      EDIAlert.SETRANGE("Internal Doc. No.",EDIRecDocHdr."Internal Doc. No.");
      CASE AlertType OF
        AlertType::General:
          BEGIN
            CASE EDIRecDocHdr."Navision Document" OF
              'I_SLSGEN':
                BEGIN
                  EDIAlert.SETRANGE(Printed,FALSE);
                    IF EDIAlert.FIND('-') THEN BEGIN
                      EDIAlert.Printed := TRUE;
                      EDIAlert."Review Alert" := FALSE;
                      EDIAlert.MODIFY;
                    END;
                END;
            END;
          END;
        AlertType::"Data Error":
          BEGIN
            EDIAlert.SETRANGE("Data Error",TRUE);
            IF EDIAlert.FIND('-') THEN BEGIN
              EDIAlert."Data Error" := FALSE;
              EDIAlert."Review Alert" := FALSE;
              EDIAlert.MODIFY;
            END;
          END;
      END;
    END;

    PROCEDURE CheckAlertStatusSendDoc@1240020005(EDISendDocHdr@1240020000 : Record 14002369;AlertType@1240020001 : ' ,Forecast & Release,General,Data Error');
    BEGIN
      EDIAlert.RESET;
      EDIAlert.SETCURRENTKEY("Send Document No.");
      EDIAlert.SETRANGE("Send Document No.",EDISendDocHdr."No.");
      CASE AlertType OF
        AlertType::General:
          BEGIN
          END;
        AlertType::"Data Error":
          BEGIN
            EDIAlert.SETRANGE("Data Error",TRUE);
            IF EDIAlert.FIND('-') THEN BEGIN
              EDIAlert."Data Error" := FALSE;
              EDIAlert."Review Alert" := FALSE;
              EDIAlert.MODIFY;
            END;
          END;
      END;
    END;

    PROCEDURE UpdateAlertStatus@1240020006(EDIRecDocHdr@1240020003 : Record 14002358);
    VAR
      EDIAlert@1240020001 : Record 14000380;
      EDIDocument@1240020000 : Record 14002353;
      EDISetup@1240020002 : Record 14002367;
    BEGIN
      EDISetup.GET;

      WITH EDIRecDocHdr DO BEGIN
        EDIDocument.RESET;
        EDIDocument.SETRANGE("Trade Partner No.","Trade Partner No.");
        EDIDocument.SETFILTER(Status,'%1|%2',EDIDocument.Status::Test,EDIDocument.Status::Production);
        EDIDocument.SETRANGE("Navision Document","Navision Document");
        EDIDocument.SETRANGE("EDI Document No.","EDI Document No.");
        EDIDocument.SETRANGE(Version,"EDI Version");
        EDIDocument.SETRANGE(Type,EDIDocument.Type::Import);
        EDIDocument.FIND('-');

        IF NOT "Data Error" THEN
          CASE "Navision Document" OF
            'I_SLSGEN':
              BEGIN
                IF EDIDocument."Generic Document Received" THEN BEGIN
                  EDIAlert.RESET;
                  EDIAlert.SETCURRENTKEY("Internal Doc. No.");
                  EDIAlert.SETRANGE("Internal Doc. No.",EDIRecDocHdr."Internal Doc. No.");
                  EDIAlert.SETRANGE(Printed,TRUE);
                  IF EDIAlert.FIND('-') THEN BEGIN
                    EDIAlert.Printed := TRUE;
                    EDIAlert."Review Alert" := FALSE;
                    EDIAlert.MODIFY;
                  END;
                END;
              END;
            ELSE BEGIN
              IF (EDISetup."Receive Document Error") AND ("Data Error" = FALSE) THEN BEGIN
                EDIAlert.RESET;
                EDIAlert.SETCURRENTKEY("Internal Doc. No.");
                EDIAlert.SETRANGE("Internal Doc. No.",EDIRecDocHdr."Internal Doc. No.");
                EDIAlert.SETRANGE("Data Error",TRUE);
                IF EDIAlert.FIND('-') THEN BEGIN
                  EDIAlert."Data Error" := FALSE;
                  EDIAlert."Review Alert" := FALSE;
                  EDIAlert.MODIFY;
                END;
              END;
            END;
          END;
        END;
    END;

    BEGIN
    END.
  }
}

