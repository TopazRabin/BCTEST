OBJECT Codeunit 14002604 Export Collaborative Forecast
{
  OBJECT-PROPERTIES
  {
    Date=12/15/17;
    Time=12:00:00 PM;
    Version List=UBP2.97;
  }
  PROPERTIES
  {
    OnRun=VAR
            ForecastCustomer@1240030000 : Record 14002601;
          BEGIN
          END;

  }
  CODE
  {
    VAR
      ExcelCreate@1240030001 : Codeunit 14000587;

    PROCEDURE ByCustomer@1240030000(CurrForecastCustomer@1240030000 : Record 14002601);
    VAR
      ColForecastLine@1240030001 : Record 14002605;
      ColForecastSetup@1240030018 : Record 14002607;
      Customer@1240030004 : Record 18;
      ForecastEntry@1240030022 : Record 14002603;
      InvMgtSetup@1240030019 : Record 14000551;
      Item@1240030020 : Record 27;
      ItemUsage@1240030015 : Record 14000557;
      LocInvPeriod@1240030014 : Record 14000553;
      ForInvPeriod@1240030023 : Record 14000552;
      UsageLedgerEntry@1240030024 : Record 14000556;
      ProgressWindow@1240030012 : Dialog;
      Text000@1240030002 : TextConst 'ENU=Period';
      Text001@1240030005 : TextConst 'ENU=Formula Forecast';
      Text002@1240030006 : TextConst 'ENU=New Forecast';
      Text003@1240030007 : TextConst 'ENU=Exporting Customer Forecast';
      Text004@1240030008 : TextConst 'ENU=Customer';
      Text005@1240030009 : TextConst 'ENU=Items';
      TotalLines@1240030010 : Decimal;
      Lines@1240030011 : Decimal;
      Text006@1240030013 : TextConst 'ENU=Last Year';
      PeriodCount@1240030016 : Integer;
      PeriodUsage@1240030017 : ARRAY [52] OF Decimal;
      Periods@1240030021 : Integer;
      FirstStartDate@1240030003 : Date;
      PriorYearStartDate@1240030025 : Date;
    BEGIN
      ProgressWindow.OPEN(
        Text003 + '\' +
        PADSTR(Text004,12) + '#1##################\' +
        PADSTR(Text005,12) + '@2@@@@@@@@@@@@@@@@@@@@@@@');

      Customer.GET(CurrForecastCustomer."Customer No.");

      ColForecastSetup.GET;
      InvMgtSetup.GET;

      ProgressWindow.UPDATE(1,CurrForecastCustomer."Customer No.");

      ColForecastLine.RESET;
      ColForecastLine.SETRANGE("Customer No.",CurrForecastCustomer."Customer No.");
      ColForecastLine.SETFILTER(Type,'%1|%2',ColForecastLine.Type::Title,ColForecastLine.Type::Forecast);
      TotalLines := ColForecastLine.COUNT;
      Lines := 0;
      IF ColForecastLine.FINDSET THEN BEGIN
        ExcelCreate.CreateBook;
        ExcelCreate.AddNewSheet(Customer."No.");

        ExcelCreate.EnterIntoNextColumn('Customer',TRUE,TRUE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn(CurrForecastCustomer."Customer No.",FALSE,FALSE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn('',FALSE,FALSE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn('',FALSE,FALSE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn(Customer.Name,FALSE,FALSE,TRUE,0);

        ExcelCreate.EnterIntoNextRow('',TRUE,FALSE,TRUE,0);
        REPEAT
          CASE ColForecastLine.Type OF
            ColForecastLine.Type::Title:
              BEGIN
                IF FirstStartDate = 0D THEN
                EVALUATE(FirstStartDate,ColForecastLine."Period 1");
                // Period Title
                ExcelCreate.EnterIntoNextRow(Text000,TRUE,FALSE,TRUE,15);
                ExcelCreate.EnterIntoNextColumn('Location',FALSE,FALSE,TRUE,0);
                ExcelCreate.EnterIntoNextColumn('Item',FALSE,FALSE,TRUE,0);
                ExcelCreate.EnterIntoNextColumn('Variant',FALSE,FALSE,TRUE,0);
                ExcelCreate.EnterIntoNextColumn('Description',FALSE,FALSE,TRUE,0);

                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 1",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 2",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 3",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 4",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 5",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 6",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 7",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 8",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 9",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 10",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 11",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 12",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 13",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 14",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 15",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 16",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 17",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 18",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 19",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 20",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 21",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 22",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 23",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 24",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 25",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 26",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 27",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 28",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 29",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 30",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 31",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 32",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 33",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 34",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 35",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 36",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 37",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 38",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 39",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 40",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 41",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 42",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 43",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 44",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 45",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 46",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 47",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 48",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 49",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 50",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 51",FALSE,FALSE,TRUE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 52",FALSE,FALSE,TRUE,10);
              END;
            ColForecastLine.Type::Forecast:
              BEGIN
                // Last Year
                ExcelCreate.EnterIntoNextRow(Text006,TRUE,FALSE,TRUE,15);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Location Code",FALSE,FALSE,FALSE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Item No.",FALSE,FALSE,FALSE,20);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine.Variant,FALSE,FALSE,FALSE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine.Description,FALSE,FALSE,FALSE,30);

                PeriodCount := 0;
                CLEAR(PeriodUsage);
                UsageLedgerEntry.RESET;
                UsageLedgerEntry.SETCURRENTKEY(
                  "Item No.","Location Code","Variant Code","Entry Type",
                  "Source No.","Usage Date","Exclude from Usage");
                ForInvPeriod.RESET;
                ForInvPeriod.SETRANGE(Type,ForInvPeriod.Type::Calculate);
                PriorYearStartDate := CALCDATE('<-1Y>',FirstStartDate);
                ForInvPeriod.SETFILTER("Starting Date",'%1..',PriorYearStartDate);
                IF ForInvPeriod.FIND('-') THEN
                  REPEAT
                    PeriodCount := PeriodCount + 1;
                    UsageLedgerEntry.SETRANGE("Item No.",ColForecastLine."Item No.");
                    UsageLedgerEntry.SETRANGE("Location Code",ColForecastLine."Location Code");
                    UsageLedgerEntry.SETRANGE("Variant Code",ColForecastLine.Variant);
                    UsageLedgerEntry.SETRANGE("Entry Type",UsageLedgerEntry."Entry Type"::Sale);
                    UsageLedgerEntry.SETRANGE("Source No.",ColForecastLine."Customer No.");
                    UsageLedgerEntry.SETFILTER(
                      "Usage Date",'%1..%2',ForInvPeriod."Starting Date",ForInvPeriod."Ending Date");
                    UsageLedgerEntry.SETRANGE("Exclude from Usage",FALSE);
                    UsageLedgerEntry.CALCSUMS(Quantity);
                    ExcelCreate.EnterIntoNextColumn(FORMAT(- UsageLedgerEntry.Quantity),FALSE,FALSE,FALSE,0);
                    PeriodUsage[PeriodCount] := - UsageLedgerEntry.Quantity;
                    ForInvPeriod.NEXT;
                  UNTIL PeriodCount = ColForecastSetup."Forecast Periods";
                Periods := 0;

                // Forecast
                ExcelCreate.EnterIntoNextRow(Text001,TRUE,FALSE,TRUE,15);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Location Code",FALSE,FALSE,FALSE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Item No.",FALSE,FALSE,FALSE,20);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine.Variant,FALSE,FALSE,FALSE,10);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine.Description,FALSE,FALSE,FALSE,30);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 1",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 2",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 3",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 4",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 5",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 6",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 7",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 8",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 9",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 10",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 11",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 12",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 13",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 14",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 15",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 16",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 17",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 18",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 19",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 20",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 21",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 22",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 23",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 24",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 25",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 26",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 27",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 28",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 29",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 30",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 31",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 32",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 33",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 34",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 35",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 36",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 37",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 38",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 39",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 40",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 41",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 42",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 43",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 44",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 45",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 46",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 47",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 48",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 49",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 50",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 51",FALSE,FALSE,FALSE,0);
                ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 52",FALSE,FALSE,FALSE,0);

                // New Forecast
                CASE ColForecastSetup."Populate New Forecast" OF
                  ColForecastSetup."Populate New Forecast"::"Formula Forecast":
                    BEGIN
                      ExcelCreate.EnterIntoNextRow(Text002,TRUE,FALSE,TRUE,15);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Location Code",FALSE,FALSE,FALSE,10);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Item No.",FALSE,FALSE,FALSE,20);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine.Variant,FALSE,FALSE,FALSE,10);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine.Description,FALSE,FALSE,FALSE,30);
                      Item.GET(ColForecastLine."Item No.");
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 1",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 2",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 3",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 4",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 5",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 6",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 7",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 8",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 9",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 10",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 11",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 12",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 13",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 14",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 15",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 16",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 17",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 18",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 19",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 20",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 21",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 22",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 23",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 24",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 25",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 26",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 27",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 28",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 29",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 30",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 31",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 32",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 33",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 34",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 35",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 36",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 37",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 38",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 39",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 40",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 41",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 42",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 43",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 44",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 45",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 46",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 47",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 48",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 49",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 50",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 51",FALSE,FALSE,FALSE,0);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Period 52",FALSE,FALSE,FALSE,0);
                    END;
                  ColForecastSetup."Populate New Forecast"::"Current Cust. Forecast":
                    BEGIN
                      ExcelCreate.EnterIntoNextRow(Text002,TRUE,FALSE,TRUE,15);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Location Code",FALSE,FALSE,FALSE,10);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine."Item No.",FALSE,FALSE,FALSE,20);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine.Variant,FALSE,FALSE,FALSE,10);
                      ExcelCreate.EnterIntoNextColumn(ColForecastLine.Description,FALSE,FALSE,FALSE,30);
                      Item.GET(ColForecastLine."Item No.");
                      PeriodCount := 0;
                      CLEAR(PeriodUsage);
                      ForInvPeriod.RESET;
                      ForInvPeriod.SETRANGE(Type,ForInvPeriod.Type::Calculate);
                      ForInvPeriod.SETFILTER("Starting Date",'%1..',FirstStartDate);
                      IF ForInvPeriod.FIND('-') THEN
                        REPEAT
                          PeriodCount := PeriodCount + 1;
                          ForecastEntry.RESET;
                          ForecastEntry.SETCURRENTKEY(
                            "Customer No.","Location Code","Item No.","Variant Code","Starting Date");
                          ForecastEntry.SETRANGE("Customer No.",ColForecastLine."Customer No.");
                          ForecastEntry.SETRANGE("Location Code",ColForecastLine."Location Code");
                          ForecastEntry.SETRANGE("Item No.",ColForecastLine."Item No.");
                          ForecastEntry.SETRANGE("Variant Code",ColForecastLine.Variant);
                          ForecastEntry.SETFILTER(
                            "Starting Date",'%1..%2',ForInvPeriod."Starting Date",ForInvPeriod."Ending Date");
                          ForecastEntry.CALCSUMS(Quantity);
                          ExcelCreate.EnterIntoNextColumn(FORMAT(ForecastEntry.Quantity),FALSE,FALSE,FALSE,0);
                          ForInvPeriod.NEXT;
                        UNTIL PeriodCount = ColForecastSetup."Forecast Periods";
                    END;
                END;
                Lines := Lines + 1;
                ProgressWindow.UPDATE(2,ROUND(10000 * (Lines / TotalLines),1));
                ExcelCreate.EnterIntoNextRow('',TRUE,FALSE,FALSE,0);
              END;
          END;
        UNTIL ColForecastLine.NEXT = 0;
        ExcelCreate.Complete(Customer."No.");
      END;

      ProgressWindow.CLOSE;
    END;

    BEGIN
    END.
  }
}

