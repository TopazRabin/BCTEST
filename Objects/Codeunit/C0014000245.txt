OBJECT Codeunit 14000245 EShip Posting Sub functions
{
  OBJECT-PROPERTIES
  {
    Date=02/02/21;
    Time=11:40:14 AM;
    Modified=Yes;
    Version List=SE0.62;
  }
  PROPERTIES
  {
    Permissions=TableData 36=m,
                TableData 37=imd,
                TableData 38=m,
                TableData 39=imd,
                TableData 49=imd,
                TableData 93=imd,
                TableData 94=imd,
                TableData 110=imd,
                TableData 111=imd,
                TableData 112=imd,
                TableData 113=imd,
                TableData 114=imd,
                TableData 115=imd,
                TableData 120=imd,
                TableData 121=imd,
                TableData 122=imd,
                TableData 123=imd,
                TableData 124=imd,
                TableData 125=imd,
                TableData 223=imd,
                TableData 252=imd,
                TableData 914=i,
                TableData 6507=ri,
                TableData 6508=rid,
                TableData 6650=imd,
                TableData 6651=imd,
                TableData 6660=imd,
                TableData 6661=imd;
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      Shipping@1240020000 : Codeunit 14000701;
      Receiving@1240020001 : Codeunit 14000601;
      EShipValidation@1240020002 : Codeunit 14000240;
      EMailMgt@1240020003 : Codeunit 14000903;

    [EventSubscriber(Codeunit,80,EShipPublishSegment1)]
    LOCAL PROCEDURE "SalesPost-Segment1"@1240020001(VAR Rec@1240020000 : Record 36;SalesSetup@1240020001 : Record 311;VAR SalesHeader@1240020002 : Record 36;VAR SalesShptHeader@1240020003 : Record 110;VAR SalesInvHeader@1240020004 : Record 112);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment1 in Codeunit 80 Sales-Post

      WITH Rec DO BEGIN
        IF ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
           Invoice AND SalesSetup."Enable Shipping" THEN
          Shipping.CheckShipmentInvoicing(SalesHeader,SalesShptHeader,SalesInvHeader,TRUE);
      END;
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment2)]
    LOCAL PROCEDURE "SalesPost-Segment2"@1240020002(VAR Rec@1240020000 : Record 36;SalesSetup@1240020001 : Record 311;VAR SalesHeader@1240020002 : Record 36;VAR SalesShptHeader@1240020003 : Record 110);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment2 in Codeunit 80 Sales-Post

      WITH Rec DO BEGIN
        IF Ship AND SalesSetup."Enable Shipping" AND
           (SalesSetup."E-Ship Locking Optimization" =
            SalesSetup."E-Ship Locking Optimization"::Packing)
        THEN BEGIN
          Shipping.CheckSalesHeader(SalesHeader);

          IF ("Document Type" = "Document Type"::Order) OR
             (("Document Type" = "Document Type"::Invoice) AND SalesSetup."Shipment on Invoice")
          THEN
            Shipping.PostPackageSalesShipment(SalesHeader,SalesShptHeader);
        END;
      END;
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment3)]
    LOCAL PROCEDURE "SalesPost-Segment3"@1240020003(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;EverythingInvoiced@1240020002 : Boolean);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment3 in Codeunit 80 Sales-Post

      IF SalesSetup."Enable Shipping" THEN
        Shipping.BlankBillOFLadingNoSalesHeader(SalesHeader,EverythingInvoiced);
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment4)]
    LOCAL PROCEDURE "SalesPost-Segment4"@1240020004(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment4 in Codeunit 80 Sales-Post

      IF SalesSetup."Enable Receive" THEN
        Receiving.CheckSalesHeader(SalesHeader);
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment5)]
    LOCAL PROCEDURE "SalesPost-Segment5"@1240020005(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;VAR SalesShptHeader@1240020002 : Record 110;VAR SalesInvHeader@1240020003 : Record 112);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment5 in Codeunit 80 Sales-Post

      WITH SalesHeader DO BEGIN
        IF Ship AND SalesSetup."Enable Shipping" AND
           (SalesSetup."E-Ship Locking Optimization" =
            SalesSetup."E-Ship Locking Optimization"::Base)
        THEN
          Shipping.CheckSalesHeader(SalesHeader);
        IF ("Document Type" = "Document Type"::Order) AND Invoice AND SalesSetup."Enable Shipping" THEN
          Shipping.CheckShipmentInvoicing(SalesHeader,SalesShptHeader,SalesInvHeader,FALSE);
      END;
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment6)]
    LOCAL PROCEDURE "SalesPost-Segment6"@1240020006(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;VAR SalesCrMemoHeader@1240020002 : Record 114);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment6 in Codeunit 80 Sales-Post

      WITH SalesHeader DO BEGIN
        IF ("Document Type" IN ["Document Type"::"Credit Memo"]) AND
          NOT SalesSetup."Return Receipt on Credit Memo" AND
          SalesSetup."Enable Receive"
        THEN
          Receiving.PostReceiveSalesCrMemo(SalesHeader,SalesCrMemoHeader);
      END;
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment7)]
    LOCAL PROCEDURE "SalesPost-Segment7"@1240020007(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;EverythingInvoiced@1240020002 : Boolean);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment7 in Codeunit 80 Sales-Post

      WITH SalesHeader DO BEGIN
        EShipValidation."SalesHeader-DeleteShippingAgentOptionPage"(SalesHeader);

        IF ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
           SalesSetup."Enable Shipping"
        THEN
          Shipping.BlankBillOFLadingNoSalesHeader(SalesHeader,EverythingInvoiced);
      END;
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment8)]
    LOCAL PROCEDURE "SalesPost-Segment8"@1240020008(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;VAR SalesShptHeader@1240020002 : Record 110;VAR SalesInvHeader@1240020003 : Record 112);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment8 in Codeunit 80 Sales-Post

      WITH SalesHeader DO BEGIN
        IF Ship AND SalesSetup."Enable Shipping" THEN
          IF "Document Type" IN ["Document Type"::Order,"Document Type"::Invoice] THEN BEGIN
            Shipping.CreateBOLPostSalesShipment(SalesShptHeader);
            Shipping.SetBillofLadingNo(SalesHeader,SalesShptHeader,SalesInvHeader);
        END;
      {
        IF Ship AND SalesSetup."Enable E-Mail" THEN
          EMailMgt.SendSalesShipmentNotice(SalesShptHeader,FALSE,FALSE);

        IF Invoice AND SalesSetup."Enable E-Mail" THEN
          EMailMgt.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);}//Comment out to use TPZ_SendNotifications()
      END;
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment9)]
    LOCAL PROCEDURE "SalesPost-Segment9"@1240020009(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;VAR SalesShptHeader@1240020002 : Record 110);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment9 in Codeunit 80 Sales-Post

      WITH SalesHeader DO BEGIN
        IF ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
           SalesSetup."Enable Shipping" AND
           (SalesSetup."E-Ship Locking Optimization" =
              SalesSetup."E-Ship Locking Optimization"::Base)
        THEN
          Shipping.PostPackageSalesShipment(SalesHeader,SalesShptHeader);
      END;
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment10)]
    LOCAL PROCEDURE "SalesPost-Segment10"@1240020010(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;VAR ReturnRcptHeader@1240020002 : Record 6660);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment10 in Codeunit 80 Sales-Post

      IF SalesSetup."Enable Receive" THEN
        Receiving.PostReceiveSalesReturnOrder(SalesHeader,ReturnRcptHeader);
    END;

    [EventSubscriber(Codeunit,80,EShipPublishSegment11)]
    LOCAL PROCEDURE "SalesPost-Segment11"@1240020011(SalesSetup@1240020000 : Record 311;VAR SalesHeader@1240020001 : Record 36;VAR SalesShptHeader@1240020002 : Record 110);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment11 in Codeunit 80 Sales-Post

      WITH SalesHeader DO BEGIN
        IF ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
           Invoice AND SalesSetup."Enable Shipping" AND ("Invoice for Shipment No." <> '')
        THEN
          SalesShptHeader.LOCKTABLE;
      END;
    END;

    LOCAL PROCEDURE "SalesPost-Segment12"@1240020020(VAR SalesLine@1240020000 : Record 37);
    BEGIN
      // <C80> Subscribes to EShipPublishSegment12 in Codeunit 80 Sales-Post
      IF NOT SalesLine."Shipping Charge" THEN
        SalesLine.TESTFIELD("Line Amount");
    END;

    BEGIN
    END.
  }
}

