OBJECT Codeunit 51743 Page22EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=10/06/20;
    Time=[ 8:41:36 AM];
    Modified=Yes;
    Version List=NAVEVT1.0.0;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    [EventSubscriber(Codeunit,51731,PG22_OnOpenPage)]
    LOCAL PROCEDURE PG22_OnOpenPage@1000000005(VAR Sender@1000000000 : Codeunit 51731;VAR CustomerRec@1000000001 : Record 18);
    BEGIN
      SetPageData(CustomerRec);
    END;

    [EventSubscriber(Page,22,OnAfterActionEvent,"Un-Posted Sales History")]
    PROCEDURE "PG22_Un-PostedSalesHistory_OnAction"@1000000001(VAR Rec@1000000000 : Record 18);
    VAR
      UnpostedSalesHist@1000000001 : Page 50025;
    BEGIN
      //TOP220 KT ABCSI Customer Sales History 03312015
      CLEAR(UnpostedSalesHist);
      UnpostedSalesHist.SetCustomer(Rec."No.");
      UnpostedSalesHist.FilterSubPages;
      UnpostedSalesHist.ACTIVATE;
      UnpostedSalesHist.RUN;
      //TOP220 KT ABCSI Customer Sales History 03312015
    END;

    [EventSubscriber(Page,22,OnAfterActionEvent,"Posted Sales History")]
    PROCEDURE PG22_PostedSalesHistory_OnAction@1000000004(VAR Rec@1000000000 : Record 18);
    VAR
      PostedSalesHist@1000000001 : Page 50026;
    BEGIN
      //TOP220 KT ABCSI Customer Sales History 03312015
      CLEAR(PostedSalesHist);
      PostedSalesHist.SetCustomer(Rec."No.");
      PostedSalesHist.FilterSubPages;
      PostedSalesHist.ACTIVATE;
      PostedSalesHist.RUN;
      //TOP220 KT ABCSI Customer Sales History 03312015
    END;

    [EventSubscriber(Page,22,OnAfterActionEvent,"Archived Sales History")]
    PROCEDURE PG22_ArchiveSalesHistory_OnAction@1000000006(VAR Rec@1000000000 : Record 18);
    VAR
      ArchSalesHist@1000000001 : Page 50027;
    BEGIN
      //TOP220 KT ABCSI Customer Sales History 03312015
      CLEAR(ArchSalesHist);
      ArchSalesHist.SetCustomer(Rec."No.");
      ArchSalesHist.FilterSubPages;
      ArchSalesHist.ACTIVATE;
      ArchSalesHist.RUN;
      //TOP220 KT ABCSI Customer Sales History 03312015
    END;

    [EventSubscriber(Page,22,OnAfterActionEvent,Action1000000060)]
    PROCEDURE PG22_ChangeLogEntry_OnAction@1000000008(VAR Rec@1000000000 : Record 18);
    VAR
      ChangeLogEntry@1000000002 : Record 405;
      ChangeLogMgt@1000000001 : Codeunit 423;
      CUSubscriber@1000000003 : Codeunit 51876;
    BEGIN
      //<TPZ1728>
      //ChangeLogMgt.OpenSSRSReport(DATABASE::Customer, Rec."No.", '', '');//<TPZ2829> Event Conversion
      CUSubscriber.CU423_OpenSSRSReport(DATABASE::Customer, Rec."No.", '', '');//<TPZ2829> Event Conversion
      //EXIT;
      //</TPZ1728>
      {
      // <TPZ129>
      ChangeLogEntry.RESET;
      ChangeLogEntry.SETRANGE("Table No.",DATABASE::Customer);
      ChangeLogEntry.SETRANGE("Primary Key Field 1 Value",Rec."No.");
      PAGE.RUNMODAL(PAGE::"Change Log Entries",ChangeLogEntry);
      // </TPZ129>
      }
    END;

    [EventSubscriber(Page,22,OnAfterActionEvent,"Item. Avail. & Price")]
    PROCEDURE PG22_ItemAvailPrice_OnAction@1000000013(VAR Rec@1000000000 : Record 18);
    VAR
      ItemCustAvailPage@1000000001 : Page 50048;
      ItemRec@1000000003 : Record 27;
    BEGIN
      //TOP100B KT ABCSI Item Cust. Avail. & Price 03192015
      CLEAR(ItemCustAvailPage);
      ItemCustAvailPage.SetRecords(ItemRec,Rec,TRUE);
      ItemCustAvailPage.UpdateQuantities;
      ItemCustAvailPage.ACTIVATE;
      ItemCustAvailPage.RUN;
      //TOP100B KT ABCSI Item Cust. Avail. & Price 03192015
    END;

    [EventSubscriber(Page,22,OnAfterActionEvent,Action1000000070)]
    PROCEDURE PG22_CustomerPriceBook_OnAction@1000000016(VAR Rec@1000000000 : Record 18);
    VAR
      CustPriceBook@1000000001 : Report 51014;
    BEGIN
      // <TPZ614>
      CustPriceBook.SetParameters(Rec."No.");
      CustPriceBook.RUN;
      // </TPZ614>
    END;

    [EventSubscriber(Page,22,OnBeforeActionEvent,"Stock Status Worksheet")]
    LOCAL PROCEDURE PG22_StockStatusWorksheet_OnAction@1000000000(VAR Rec@1000000000 : Record 18);
    VAR
      StockStatusWkshMgt@1000000001 : Codeunit 50000;
    BEGIN
      CLEAR(StockStatusWkshMgt);
      StockStatusWkshMgt.SetFromCustPage(TRUE,Rec);
      StockStatusWkshMgt.RUN;
    END;

    LOCAL PROCEDURE SetPageData@1000000003(VAR CustomerRec@1000000003 : Record 18);
    VAR
      UserSetup@1000000000 : Record 91;
      CustomerDivision@1000000002 : Record 50007;
      Cust@1000000001 : Record 18;
    BEGIN
      UserSetup.GET(USERID);
      IF (STRPOS(UPPERCASE(UserSetup."Shortcut Dimension 5 Filter"), 'E') <> 0) THEN BEGIN
        //********** ELECTRIC ***************
        CustomerDivision.RESET;
        CustomerDivision.SETRANGE("Shortcut Dimension 5 Code", 'E');
        IF UserSetup."Mfr. Rep. Filter" <> '' THEN
          CustomerDivision.SETFILTER("Mfr. Rep. Code", UserSetup."Mfr. Rep. Filter");
        IF CustomerDivision.FINDSET THEN BEGIN
        REPEAT
           AddToCustomerTemp(CustomerDivision."Customer No.",CustomerRec);
        UNTIL CustomerDivision.NEXT=0;
        END;
      END;

      IF (STRPOS(UPPERCASE(UserSetup."Shortcut Dimension 5 Filter"), 'L') <> 0) THEN BEGIN
        //********** Lighting ***************
        CustomerDivision.RESET;
        CustomerDivision.SETRANGE("Shortcut Dimension 5 Code", 'L');
        IF UserSetup."Mfr. Rep. Filter" <> '' THEN
          CustomerDivision.SETFILTER("Mfr. Rep. Code", UserSetup."Mfr. Rep. Filter");
        IF CustomerDivision.FINDSET THEN BEGIN
        REPEAT
           AddToCustomerTemp(CustomerDivision."Customer No.",CustomerRec);
        UNTIL CustomerDivision.NEXT=0;
        END;
      END;

      IF (STRPOS(UPPERCASE(UserSetup."Shortcut Dimension 5 Filter"), 'P') <> 0) THEN BEGIN
         //********** CONDUIT ***************
        CustomerDivision.RESET;
        CustomerDivision.SETRANGE("Shortcut Dimension 5 Code", 'P');
        IF UserSetup."Mfr. Rep. Filter" <> '' THEN
          CustomerDivision.SETFILTER("Mfr. Rep. Code", UserSetup."Mfr. Rep. Filter");

        IF CustomerDivision.FINDSET THEN BEGIN
        REPEAT
           AddToCustomerTemp(CustomerDivision."Customer No.",CustomerRec);
        UNTIL CustomerDivision.NEXT=0;
        END;
      END;

      IF UserSetup."Shortcut Dimension 5 Filter" = '' THEN BEGIN
      //All Customers
        Cust.RESET;
        IF Cust.FINDSET THEN BEGIN
          REPEAT
            AddToCustomerTemp(Cust."No.",CustomerRec);
        UNTIL Cust.NEXT=0;
        END;
      END;
    END;

    LOCAL PROCEDURE AddToCustomerTemp@1000000002(CustNo@1000000000 : Code[20];VAR CustomerRec@1000000002 : Record 18);
    VAR
      ActualCustomer@1000000001 : Record 18;
    BEGIN
      IF NOT CustomerRec.GET(CustNo) THEN BEGIN
        IF ActualCustomer.GET(CustNo) THEN BEGIN
          CustomerRec.INIT;
          CustomerRec.TRANSFERFIELDS(ActualCustomer);
          CustomerRec.INSERT;
        END;

      END;
    END;

    BEGIN
    {
      2020-05-15 TPZ2830  PSHUKLA
    }
    END.
  }
}

