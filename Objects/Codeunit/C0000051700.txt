OBJECT Codeunit 51700 Comm. Jnl.-Check Line
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    TableNo=51705;
    Permissions=TableData 252=rimd;
    OnRun=BEGIN
            RunCheck(Rec);
          END;

  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=can only be a closing date for G/L entries;ESM=s¢lo puede ser una fecha £ltima para movs. de cuentas;FRC=ne peut ˆtre qu''une date limite pour une ‚criture du GL;ENC=can only be a closing date for G/L entries';
      Text001@1001 : TextConst 'ENU=is not within your range of allowed posting dates;ESM=no est  dentro del periodo de fechas de registro permitidas;FRC=n''est pas dans l''intervalle de dates de report permis;ENC=is not within your range of allowed posting dates';
      Text002@1002 : TextConst 'ENU=%1 or %2 must be G/L Account or Bank Account.;ESM=%1 o %2 deben ser de tipo Cuenta o Banco.;FRC=%1 ou %2 doit ˆtre un compte GL ou bancaire.;ENC=%1 or %2 must be G/L Account or Bank Account.';
      Text003@1003 : TextConst 'ENU=must have the same sign as %1;ESM=debe tener el mismo signo que %1.;FRC=doit ˆtre du mˆme signe que %1;ENC=must have the same sign as %1';
      Text004@1004 : TextConst 'ENU=You must not specify %1 when %2 is %3.;ESM=No se debe especificar %1 cuando %2 es %3.;FRC=Vous ne devez pas sp‚cifier %1 lorsque %2 est %3.;ENC=You must not specify %1 when %2 is %3.';
      Text005@1005 : TextConst 'ENU=%1 + %2 must be %3.;ESM=%1 + %2 debe ser %3.;FRC=%1 + %2 doit ˆtre %3.;ENC=%1 + %2 must be %3.';
      Text006@1006 : TextConst 'ENU=%1 + %2 must be -%3.;ESM=%1 + %2 debe ser -%3.;FRC=%1 + %2 doit ˆtre -%3.;ENC=%1 + %2 must be -%3.';
      Text007@1007 : TextConst 'ENU=must be positive;ESM=debe ser positivo;FRC=doit ˆtre positif;ENC=must be positive';
      Text008@1008 : TextConst 'ENU=must be negative;ESM=debe ser negativo;FRC=doit ˆtre n‚gatif;ENC=must be negative';
      Text009@1009 : TextConst 'ENU=must have a different sign than %1;ESM=debe ser de signo diferente a %1;FRC=doit avoir une signe diff‚rent de %1;ENC=must have a different sign than %1';
      Text010@1010 : TextConst 'ENU=%1 %2 and %3 %4 is not allowed.;ESM=%1 %2  y %3 %4 no est  permit.;FRC=%1 %2 et %3 %4 ne sont pas autoris‚s.;ENC=%1 %2 and %3 %4 is not allowed.';
      Text011@1011 : TextConst 'ENU=The combination of dimensions used in %1 %2, %3, %4 is blocked. %5;ESM=La combin. de dimensiones utilizada en %1 %2, %3, %4 est  bloq. %5;FRC=La combinaison de dimensions utilis‚e dans %1 %2, %3, %4 est bloqu‚e. %5;ENC=The combination of dimensions used in %1 %2, %3, %4 is blocked. %5';
      Text012@1012 : TextConst 'ENU=A dimension used in %1 %2, %3, %4 has caused an error. %5;ESM=La dimensi¢n util. en %1 %2, %3, %4 ha causado error. %5;FRC=Une erreur a ‚t‚ caus‚e par une dimension utilis‚e dans %1 %2, %3, %4. %5;ENC=A dimension used in %1 %2, %3, %4 has caused an error. %5';
      GLSetup@1000000000 : Record 98;
      UserSetup@1015 : Record 91;
      CommJnlTemplate@1020 : Record 51703;
      AllowPostingFrom@1018 : Date;
      AllowPostingTo@1019 : Date;
      CommJnlTemplateFound@1021 : Boolean;
      OverrideDimErr@1022 : Boolean;
      SalesDocAlreadyExistsErr@1026 : TextConst '@@@="%1 = Document Type; %2 = Document No.";ENU=Sales %1 %2 already exists.;ESM=El documento de venta  %1 %2 ya existe.;FRC=La vente %1 %2 existe d‚j….;ENC=Sales %1 %2 already exists.';
      PurchDocAlreadyExistsErr@1025 : TextConst '@@@="%1 = Document Type; %2 = Document No.";ENU=Purchase %1 %2 already exists.;ESM=Ya existe la compra %1 %2.;FRC=L''achat %1 %2 existe d‚j….;ENC=Purchase %1 %2 already exists.';

    PROCEDURE RunCheck@4(VAR CommJnlLine@1000 : Record 51705);
    VAR
      TableID@1002 : ARRAY [10] OF Integer;
      No@1003 : ARRAY [10] OF Code[20];
    BEGIN
      WITH CommJnlLine DO BEGIN
        IF EmptyLine THEN
          EXIT;
        IF NOT CommJnlTemplateFound THEN BEGIN
          IF CommJnlTemplate.GET("Journal Template Name") THEN;
          CommJnlTemplateFound := TRUE;
        END;

        TESTFIELD("Posting Date");
        IF "Posting Date" <> NORMALDATE("Posting Date") THEN
            FIELDERROR("Posting Date",Text000);

        IF DateNotAllowed("Posting Date") THEN
          FIELDERROR("Posting Date",Text001);

        TESTFIELD("Document No.");
        //TESTFIELD("Account Type");
        TESTFIELD("Account No.");
        TESTFIELD(Amount);
      END;
    END;

    PROCEDURE DateNotAllowed@1(PostingDate@1000 : Date) : Boolean;
    BEGIN
      IF (AllowPostingFrom = 0D) AND (AllowPostingTo = 0D) THEN BEGIN
        IF USERID <> '' THEN
          IF UserSetup.GET(USERID) THEN BEGIN
            AllowPostingFrom := UserSetup."Allow Posting From";
            AllowPostingTo := UserSetup."Allow Posting To";
          END;
        IF (AllowPostingFrom = 0D) AND (AllowPostingTo = 0D) THEN BEGIN
          GLSetup.GET;
          AllowPostingFrom := GLSetup."Allow Posting From";
          AllowPostingTo := GLSetup."Allow Posting To";
        END;
        IF AllowPostingTo = 0D THEN
          AllowPostingTo := 12319999D;
      END;
      EXIT((PostingDate < AllowPostingFrom) OR (PostingDate > AllowPostingTo));
    END;

    PROCEDURE ErrorIfPositiveAmt@2(CommJnlLine@1000 : Record 51705);
    BEGIN
      IF CommJnlLine.Amount > 0 THEN
        CommJnlLine.FIELDERROR(Amount,Text008);
    END;

    PROCEDURE ErrorIfNegativeAmt@3(CommJnlLine@1000 : Record 51705);
    BEGIN
      IF CommJnlLine.Amount < 0 THEN
        CommJnlLine.FIELDERROR(Amount,Text007);
    END;

    LOCAL PROCEDURE CheckAmount@117(CommJnlLine@1000 : Record 51705);
    BEGIN
      WITH CommJnlLine DO
        CASE "Document Type" OF
          "Document Type"::Payment:
            ErrorIfNegativeAmt(CommJnlLine);
          "Document Type"::Deduction:
            ErrorIfPositiveAmt(CommJnlLine);
        END;
    END;

    BEGIN
    {
      2015-05-11 TPZ92 TAKHMETO
        Codeunit has been created
    }
    END.
  }
}

