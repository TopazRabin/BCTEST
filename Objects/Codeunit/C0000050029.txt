OBJECT Codeunit 50029 WMDM Extension Template1
{
  OBJECT-PROPERTIES
  {
    Date=03/01/21;
    Time=[ 4:43:41 AM];
    Modified=Yes;
    Version List=WHI2.4.7684.0;
  }
  PROPERTIES
  {
    TableNo=23044511;
    OnRun=BEGIN
            //////////////////////////////////////////////
            //<Summary>
            // The entry point for WMDM extensibility.
            // Basic function use stubbed out for various usage scenarios.
            // For more complete information on the WMDM Extensibility options
            // see the appropriate WMDM documentation guides.
            //</Summary>
            //<Author>R.Trudeau</Author>
            //<Date>05/26/2016</Date>
            //<Issue></Issue>
            //<Version>IW16.05</Version>
            //////////////////////////////////////////////

            trecEventParams.COPY(Rec, TRUE);  //make Rec data global

            //
            // The Event ID being called
            // The event is either set in the WMDM menu configuration or pre-defined
            // for the WMDM normal operation.
            // For pre-defined values consult the WMDM documentation.
            //liEventID := Rec.getEvent();


            //
            // Events that can be triggered by the WMDM.
            // OnPrint -
            // OnBeforeProcessEvent
            // OnAfterProcessEvent
            // OnAssignLP
            // OnBeforeModify
            // OnChangeTracking
            // OnSetup
            // OnRemoveUsage
            // OnReportRun

            CASE getExtensibilityEvent OF
              "Extensibility Event"::OnPrint: onPrint;
              "Extensibility Event"::OnBeforeProcessEvent: onBeforeProcessEvent;
              "Extensibility Event"::OnAfterProcessEvent:  onAfterProcessEvent;
            END; // case

            COPY(trecEventParams, TRUE);
          END;

  }
  CODE
  {
    VAR
      trecEventParams@1000000000 : TEMPORARY Record 23044511;
      cuWMDMCommon@1000000001 : Codeunit 23044501;

    LOCAL PROCEDURE onPrint@1000000001();
    BEGIN
      //
      // Use this function to override or extend existing print requests
      //

      CASE trecEventParams.getEvent OF
        9999999: sampleExtensionFunction;
      END;
    END;

    LOCAL PROCEDURE onBeforeProcessEvent@1000000002();
    BEGIN
      //
      // Use this function to override or extend existing events or when creating new
      // requests.
      //

      CASE trecEventParams.getEvent OF
        123: samplePrintFunction;
        9999999: sampleExtensionFunction;
      END;
    END;

    LOCAL PROCEDURE onAfterProcessEvent@1000000003();
    BEGIN
      //
      // Use this function to add additional functionality to existing events after they
      // have completed.
      //

      CASE trecEventParams.getEvent OF
        9999999: sampleExtensionFunction;
      END;
    END;

    LOCAL PROCEDURE sendSuccessResult@1000000014(psResultMessage@1000000001 : Text;pbOverrideEvent@1000000002 : Boolean);
    VAR
      lcuWMDMCommon@1000000003 : Codeunit 23044501;
      lbtTemp@1000000004 : BigText;
      losTemp@1000000005 : OutStream;
    BEGIN
      //
      // Wrapper function to abstract some of the boiler plate code required by the WMDM
      // when using the extensibility framework.
      //
      lcuWMDMCommon.generateSuccessReturnWithMsg(1, psResultMessage,lbtTemp);
      trecEventParams."Extensibility Blob".CREATEOUTSTREAM( losTemp );
      trecEventParams.setExtensibilityOverride(pbOverrideEvent);
      lbtTemp.WRITE( losTemp );
      trecEventParams.MODIFY();
    END;

    LOCAL PROCEDURE sendStandardResult@1000000009(pbtResult@1000000001 : BigText;pbOverrideEvent@1000000000 : Boolean);
    VAR
      losTemp@1000000003 : OutStream;
    BEGIN
      //
      // Wrapper function to abstract some of the boiler plate code required by the WMDM
      // when using the extensibility framework.
      //
      trecEventParams."Extensibility Blob".CREATEOUTSTREAM( losTemp );
      trecEventParams.setExtensibilityOverride(pbOverrideEvent);
      pbtResult.WRITE( losTemp );
      trecEventParams.MODIFY();
    END;

    LOCAL PROCEDURE runReport@1000000005(piCodeunit@1000000000 : Integer);
    VAR
      liSessionID@1000000002 : Integer;
      lrecPDAConfig@1000000001 : Record 23044504;
    BEGIN
      cuWMDMCommon.getDeviceConfig(lrecPDAConfig,trecEventParams);
      //cuWMDMCommon.checkPrinters(lrecPDAConfig);

      STARTSESSION(liSessionID,piCodeunit,COMPANYNAME,trecEventParams);
    END;

    LOCAL PROCEDURE sampleExtensionFunction@1000000007();
    VAR
      lsInputTextResult@1000000001 : Text;
      lbBoolParam@1000000002 : Boolean;
      ldDecimalParam@1000000003 : Decimal;
      liIntParam@1000000010 : Integer;
      lcodDocNumber@1000000004 : Code[20];
      liLineNumber@1000000005 : Integer;
      lcodItemNumber@1000000006 : Code[20];
      lcodVariantCode@1000000007 : Code[20];
      lcodLotNumber@1000000008 : Code[20];
      lcodSerialNumber@1000000009 : Code[20];
      lbsOutput@1000000000 : BigText;
    BEGIN
      //
      // Misc. code implementation to show some basic features/concepts.
      //

      // get the parameters of interest from the event.
      // The params are stored as key/value pairs.  WMDM supplies some common wrappers
      // around some values but for specific details consult the WMDM documentation.


      // the result of a custom input type text menu
      lsInputTextResult := trecEventParams.getValue('action_result');

      // a boolean value
      lbBoolParam := trecEventParams.getValueAsBool('Boolean_Field');

      // a decimal value
      ldDecimalParam := trecEventParams.getValueAsDecimal('Quantity');

      // an integer or option value
      liIntParam := trecEventParams.getValueAsInt('document_type');

      // standard document/line routines
      lcodDocNumber := trecEventParams.getDocumentNo();
      liLineNumber := trecEventParams.getLineNo();
      lcodItemNumber := trecEventParams.getItemNo();
      lcodVariantCode := trecEventParams.getVariant();
      lcodLotNumber := trecEventParams.getLotNo();
      lcodSerialNumber := trecEventParams.getSerialNo();

      //
      // do whatever processing is required
      //


      // Errors can be generated back to the client by calling the ERROR routine
      // E.g. ERROR('Quantity must be greater than 0');


      // When the processing is complete choose whether the event should be
      // overridden (e.g. normal WMDM implementation ignored) or left to continue.
      // This would not be required typically when extending existing functions
      // like before and after processing since the base wmdm functionality would likely
      // already be returning a message/result back to the client.
      sendSuccessResult(
        'Put your return message to the user here.',
        TRUE  // true if the event is to be considered handled, false if not (custom events must set to TRUE)
      );

      //
      // to return base nav type dataset type structures or existing functions that use the 'big text' result
      // Call:
      //   sendStandardResult(
      //     lbsOutput,
      //     TRUE  // true if the event is to be considered handled, false if not (custom events must set to TRUE)
      //   );


      // to skip this event for whatever reason (e.g. only want to handle picks but event is fired for put-aways as well)
      // Call:
      //   trecEventParams.setExtensibilityOverrideWMDM(FALSE);
      //   EXIT;
    END;

    LOCAL PROCEDURE samplePrintFunction@1000000000();
    VAR
      lcodDocNumber@1000000001 : Code[20];
    BEGIN
      //
      // get whatever variables are require to perform validation
      //
      lcodDocNumber := trecEventParams.getDocumentNo();

      // send back a success message (though printing may actually fail, we cannot determine that)
      sendSuccessResult(
        'The document has printed.',
        TRUE
        );

      // call the printing in another session
      runReport(CODEUNIT::"WHI Print Ext. Template");
    END;

    BEGIN
    {
      ************************
      Copyright Notice
      This objects content is copyright of Insight Works 2011.  All rights reserved.
      Any redistribution or reproduction of part or all of the contents in any form is prohibited.
      ************************


      <IW>
        <REVISION author="R.Trudeau" date="05/12/2016" version="IW16.05" issue="">
          Extensibility codeunit template.
          Provides a standard simplified entry point for extending the WMDM.
          WMDM Setup/Configs should reference this codeunit in the 'Extensibility Codeunit'.
          This template does not include all possible usage scenarios and is open to revision
          as time permits.
        </REVISION>
      </IW>
    }
    END.
  }
}

