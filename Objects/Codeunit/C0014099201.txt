OBJECT Codeunit 14099201 ASN Import Mgt.
{
  OBJECT-PROPERTIES
  {
    Date=01/20/17;
    Time=12:00:00 PM;
    Version List=IBA1.11;
  }
  PROPERTIES
  {
    OnRun=VAR
            VersionInt@1240020000 : Integer;
          BEGIN
            VersionInt := GetVersion;
            CASE TRUE OF
              VersionInt <=5:
                RunVersion5;
              VersionInt = 6:
                RunVersion2009;
              VersionInt >= 7:
                RunVersion2013;
              ELSE
                ERROR(Text001);
            END;
          END;

  }
  CODE
  {
    VAR
      Text001@1240020000 : TextConst 'ENU=Cannot find the correct import for this version of NAV!';
      Text002@1240020001 : TextConst 'ENU=Cannot run an import from the RTC client in NAV 2009.  Please use the Classic client import or a later version of the RTC!';
      Text003@1240020002 : TextConst 'ENU=File upload failed before the import could be ran!';
      Text004@1240020003 : TextConst 'ENU=Select the import file.';
      Text005@1240020004 : TextConst 'ENU=TAB delimited File (*.txt)|*.txt';

    PROCEDURE RunVersion5@1240020003();
    BEGIN
      RunDataPortImport;
    END;

    PROCEDURE RunVersion2009@1240020004();
    BEGIN
      IF ISSERVICETIER THEN
        RunXMLPortImport2009
      ELSE
        RunDataPortImport;
    END;

    PROCEDURE RunVersion2013@1240020005();
    BEGIN
      RunXMLPortImport;
    END;

    LOCAL PROCEDURE RunXMLPortImport@1240020000();
    VAR
      ImportASN@1240020000 : XMLport 14099200;
    BEGIN
      XMLPORT.RUN(14099200, TRUE);
    END;

    PROCEDURE RunXMLPortImport2009@1240020006();
    VAR
      ClientFileName@1240020000 : Text[1024];
      TestStream@1240020001 : InStream;
    BEGIN
      IF UPLOADINTOSTREAM(
                      Text004,
                      '',
                      Text005,
                       ClientFileName,
                       TestStream)
      THEN
        XMLPORT.IMPORT(14099200, TestStream)
      ELSE
        ERROR(Text003);
    END;

    PROCEDURE RunDataPortImport@1240020002();
    BEGIN
      //DATAPORT.RUNMODAL(14099200, TRUE);
    END;

    PROCEDURE GetVersion@1240020001() : Integer;
    VAR
      AppMgt@1240020000 : Codeunit 1;
      Pos@1240020001 : Integer;
      EndPos@1240020004 : Integer;
      VersionText@1240020002 : Text[250];
      VersionInt@1240020003 : Integer;
    BEGIN
      VersionInt := 0;
      VersionText := AppMgt.ApplicationVersion;
      Pos := STRPOS(VersionText, '.');
      IF Pos = 0 THEN
        EXIT(VersionInt);

      EndPos := Pos - 1;
      REPEAT
        Pos := Pos - 1;
      UNTIL (VersionText[Pos] = ' ');
      Pos := Pos+1;

      VersionText := COPYSTR(VersionText, Pos, (EndPos-Pos)+1);
      IF NOT EVALUATE(VersionInt, VersionText) THEN
        VersionInt := 0;
      EXIT(VersionInt);
    END;

    BEGIN
    END.
  }
}

