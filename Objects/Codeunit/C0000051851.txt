OBJECT Codeunit 51851 Page132EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=05/28/21;
    Time=[ 6:58:19 AM];
    Modified=Yes;
    Version List=NAVEVT1.0.0;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    [EventSubscriber(Codeunit,51852,Pg132_OnOpenPage)]
    PROCEDURE Pg132_OnOpenPage@1000000004(VAR Sender@1000000000 : Codeunit 51852;VAR Rec@1000000001 : Record 112;VAR CommHdlgVisible@1000000002 : Boolean);
    VAR
      UserMgt@1000000003 : Codeunit 5700;
    BEGIN
      // <TPZ858>
      CommHdlgVisible := UserMgt.GetCommHdlgAdmin(USERID);//TPZ2384
      // </TPZ858>
    END;

    [EventSubscriber(Page,132,OnBeforeActionEvent,Action1000000019)]
    PROCEDURE Pg132_ChangeLogEntries_OnAction@1000000008(VAR Rec@1000000000 : Record 112);
    VAR
      ChangeLogEntry@1000000002 : Record 405;
      ChangeLogMgt@1000000001 : Codeunit 423;
      CUSubscriber@1000000003 : Codeunit 51876;
    BEGIN
      WITH Rec DO BEGIN
        //<TPZ1728>
        //ChangeLogMgt.OpenSSRSReport(DATABASE::"Sales Header", '1', "Order No.",'');//<TPZ2829> Event Conversion
        CUSubscriber.CU423_OpenSSRSReport(DATABASE::"Sales Header", '1', "Order No.",'');//<TPZ2829> Event Conversion
        EXIT;
        //</TPZ1728>

        // <TPZ129>
        ChangeLogEntry.RESET;
        ChangeLogEntry.SETRANGE("Table No.",DATABASE::"Sales Header");
        ChangeLogEntry.SETRANGE("Primary Key Field 1 Value",'1');
        ChangeLogEntry.SETRANGE("Primary Key Field 2 Value","Order No.");
        PAGE.RUNMODAL(PAGE::"Change Log Entries",ChangeLogEntry);
        // </TPZ129>
      END;
    END;

    [EventSubscriber(Page,132,OnBeforeActionEvent,Action1000000022)]
    PROCEDURE Pg132_Fax_OnAction@1000000011(VAR Rec@1000000000 : Record 112);
    VAR
      FaxMgmt@1000000001 : Codeunit 50010;
    BEGIN
      // <TPZ162>
      Rec.TESTFIELD("Fax Invoice Notice Handled",FALSE);

      FaxMgmt.SalesInvoice(Rec);
    END;

    [EventSubscriber(Page,132,OnBeforeActionEvent,Action1000000061)]
    PROCEDURE Pg132_DSHIPLicensePlate_OnAction@1000000014(VAR Rec@1000000000 : Record 112);
    VAR
      LicensePlateHeader@1000000001 : Record 23044505;
    BEGIN
      ShowDSHIPLpList(Rec,TRUE);//VAH 3199

      //<vaseem>
      LicensePlateHeader.RESET;
      LicensePlateHeader.SETRANGE("Package Tracking Number",Rec."Package Tracking No.");
      IF LicensePlateHeader.FINDSET THEN
        LicensePlateHeader.SETRECFILTER;
      PAGE.RUN(PAGE::"DSHIP License Plate List",LicensePlateHeader);
      //</vaseem>
    END;

    LOCAL PROCEDURE ShowDSHIPLpList@1000000002(VAR SalesInvHeader@1000000000 : Record 112;ShowPostedLP@1000000005 : Boolean);
    VAR
      IWXLicensePlateHeader@1000000004 : Record 23044505;
      WarehouseShipmentLine@1000000003 : Record 7321;
      PostedWhseShipLine@1000000002 : Record 7323;
      TempIWXLicensePlateHeader@1000000001 : TEMPORARY Record 23044505;
      DSHIPLPList@1000000006 : Page 23044646;
      RegisteredWhseActivityLine@1000000007 : Record 5773;
      RegisteredWhseActivityHdr@1000000008 : Record 5772;
    BEGIN
      //>>Check Unposted LPs
      TempIWXLicensePlateHeader.DELETEALL;
      CLEAR(TempIWXLicensePlateHeader);
      IF NOT ShowPostedLP THEN BEGIN
        WarehouseShipmentLine.RESET;
        WarehouseShipmentLine.SETRANGE("Source No.",SalesInvHeader."Order No.");
        IF WarehouseShipmentLine.FINDSET THEN BEGIN
          REPEAT
            IWXLicensePlateHeader.RESET;
            IWXLicensePlateHeader.SETAUTOCALCFIELDS("Source No.");
            IWXLicensePlateHeader.SETRANGE("Source No.",WarehouseShipmentLine."No.");
            IF IWXLicensePlateHeader.FINDFIRST THEN BEGIN
              REPEAT
                IF NOT TempIWXLicensePlateHeader.GET(IWXLicensePlateHeader."No.") THEN BEGIN
                  TempIWXLicensePlateHeader.INIT;
                  TempIWXLicensePlateHeader.TRANSFERFIELDS(IWXLicensePlateHeader);
                  TempIWXLicensePlateHeader.INSERT;
                END;
              UNTIL IWXLicensePlateHeader.NEXT=0;
            END;
          UNTIL WarehouseShipmentLine.NEXT = 0;
        END;
        IWXLicensePlateHeader.RESET;
        IWXLicensePlateHeader.SETRANGE("Source No.",SalesInvHeader."Order No.");
        IF IWXLicensePlateHeader.FINDFIRST THEN BEGIN
          REPEAT
            IF NOT TempIWXLicensePlateHeader.GET(IWXLicensePlateHeader."No.") THEN BEGIN
              TempIWXLicensePlateHeader.INIT;
              TempIWXLicensePlateHeader.TRANSFERFIELDS(IWXLicensePlateHeader);
              TempIWXLicensePlateHeader.INSERT;
            END;
          UNTIL IWXLicensePlateHeader.NEXT = 0;
        END;
      END;
      //<<

      //Check Posted Lps
      //>>
      IF ShowPostedLP THEN BEGIN
        PostedWhseShipLine.RESET;
        PostedWhseShipLine.SETRANGE("Source No.",SalesInvHeader."Order No.");
        IF PostedWhseShipLine.FINDSET THEN BEGIN
          REPEAT
            IWXLicensePlateHeader.RESET;
            IWXLicensePlateHeader.SETRANGE("Shipped Source No.",PostedWhseShipLine."Whse. Shipment No.");
            IF IWXLicensePlateHeader.FINDFIRST THEN BEGIN
              REPEAT
                IF NOT TempIWXLicensePlateHeader.GET(IWXLicensePlateHeader."No.") THEN BEGIN
                  TempIWXLicensePlateHeader.INIT;
                  TempIWXLicensePlateHeader.TRANSFERFIELDS(IWXLicensePlateHeader);
                  TempIWXLicensePlateHeader.INSERT;
                END;
              UNTIL IWXLicensePlateHeader.NEXT=0;
            END;
          UNTIL PostedWhseShipLine.NEXT = 0;
        END;
        IWXLicensePlateHeader.RESET;
        IWXLicensePlateHeader.SETRANGE("Shipped Source No.",SalesInvHeader."Order No.");
        IF IWXLicensePlateHeader.FINDFIRST THEN BEGIN
          REPEAT
            IF NOT TempIWXLicensePlateHeader.GET(IWXLicensePlateHeader."No.") THEN BEGIN
              TempIWXLicensePlateHeader.INIT;
              TempIWXLicensePlateHeader.TRANSFERFIELDS(IWXLicensePlateHeader);
              TempIWXLicensePlateHeader.INSERT;
            END;
          UNTIL IWXLicensePlateHeader.NEXT = 0;
        END;

      //Check WPI No.
        RegisteredWhseActivityLine.RESET;
        RegisteredWhseActivityLine.SETRANGE("Source No.",SalesInvHeader."Order No.");
        RegisteredWhseActivityLine.SETRANGE("Activity Type",RegisteredWhseActivityLine."Activity Type"::Pick);
        IF RegisteredWhseActivityLine.FINDFIRST THEN
          REPEAT
            RegisteredWhseActivityHdr.GET(RegisteredWhseActivityLine."Activity Type",RegisteredWhseActivityLine."No.");
            IWXLicensePlateHeader.RESET;
            IWXLicensePlateHeader.SETAUTOCALCFIELDS("Source No.");
            IWXLicensePlateHeader.SETRANGE("Source No.",RegisteredWhseActivityHdr."Whse. Activity No.");
            IF IWXLicensePlateHeader.FINDFIRST THEN BEGIN
              REPEAT
                IF NOT TempIWXLicensePlateHeader.GET(IWXLicensePlateHeader."No.") THEN BEGIN
                  TempIWXLicensePlateHeader.INIT;
                  TempIWXLicensePlateHeader.TRANSFERFIELDS(IWXLicensePlateHeader);
                  TempIWXLicensePlateHeader.INSERT;
                END;
              UNTIL IWXLicensePlateHeader.NEXT = 0;
            END;
          UNTIL RegisteredWhseActivityLine.NEXT = 0;
      END;
      //<<
      TempIWXLicensePlateHeader.FINDSET;
      PAGE.RUN(PAGE::"DSHIP License Plate List",TempIWXLicensePlateHeader);
    END;

    BEGIN
    {
      002 VAH 05282021 TPZ3199
    }
    END.
  }
}

