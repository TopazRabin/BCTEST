OBJECT Codeunit 51864 Page160EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=03/15/21;
    Time=12:00:00 PM;
    Modified=Yes;
    Version List=NAVEVENT,TPZ2829,001,3125;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    [EventSubscriber(Codeunit,51865,Pg160_OnAfterGetRecord)]
    PROCEDURE Pg160_OnAfterGetRecord@1000000022(VAR Sender@1000000000 : Codeunit 51865;VAR Rec@1000000001 : Record 36;VAR TotalSalesLineLCY@1000000002 : Record 37;VAR EstFutureTotalLandedCost@1000000004 : Decimal;VAR EstFutureProfit@1000000005 : Decimal;VAR EstFutureProfitPct@1000000006 : Decimal;VAR AvgProfitLCY@1000000008 : Decimal;VAR AvgAdjProfitLCY@1000000009 : Decimal;VAR AvgProfitPct@1000000010 : Decimal;VAR AvgAdjProfitPct@1000000011 : Decimal;VAR RepCostProfitLCY@1000000012 : Decimal;VAR RepCostAdjProfitLCY@1000000013 : Decimal;VAR RepCostProfitPct@1000000014 : Decimal;VAR RepCostAdjProfitPct@1000000015 : Decimal);
    VAR
      ItemCostMgmt@1000000003 : Codeunit 5804;
      Codeunit5804EventSubscriber@1000000007 : Codeunit 51913;
    BEGIN
      // <TPZ1175>
      CLEAR(ItemCostMgmt);
      //ItemCostMgmt.SumSalesLine(Rec,EstFutureTotalLandedCost);//<TPZ2829> Event Conversion
      Codeunit5804EventSubscriber.SumSalesLine(Rec,EstFutureTotalLandedCost);//<TPZ2829> Event Conversion

      IF EstFutureTotalLandedCost <> 0 THEN BEGIN
        EstFutureProfit := TotalSalesLineLCY.Amount - EstFutureTotalLandedCost;

        IF TotalSalesLineLCY.Amount <> 0 THEN
          EstFutureProfitPct := ROUND((EstFutureProfit * 100) / TotalSalesLineLCY.Amount,0.01);
      END;
      // <TPZ1175>
      //>>TPZ2881
      AvgProfitLCY    := TotalSalesLineLCY.Amount - TotalSalesLineLCY."Average Unit Cost";
      AvgAdjProfitLCY := TotalSalesLineLCY.Amount - TotalSalesLineLCY."Average Unit Cost";
      IF TotalSalesLineLCY.Amount  = 0 THEN BEGIN
        AvgProfitPct    := 0;
        AvgAdjProfitPct := 0;
      END ELSE BEGIN
        AvgProfitPct    := ROUND(AvgProfitLCY / TotalSalesLineLCY.Amount*100,0.1);
        AvgAdjProfitPct := ROUND(AvgAdjProfitLCY / TotalSalesLineLCY.Amount*100,0.1);
      END;
      //<<
      //>>TPZ3125
      RepCostProfitLCY    := TotalSalesLineLCY.Amount - TotalSalesLineLCY."Replacement Cost";
      RepCostAdjProfitLCY := TotalSalesLineLCY.Amount - TotalSalesLineLCY."Replacement Cost";
      IF TotalSalesLineLCY.Amount  = 0 THEN BEGIN
        RepCostProfitPct    := 0;
        RepCostAdjProfitPct := 0;
      END ELSE BEGIN
        RepCostProfitPct    := ROUND(RepCostProfitLCY / TotalSalesLineLCY.Amount*100,0.1);
        RepCostAdjProfitPct := ROUND(RepCostAdjProfitLCY / TotalSalesLineLCY.Amount*100,0.1);
      END;
      //<<
    END;

    BEGIN
    {
      001  TPZ2881  PKS  07212020  Added parameter for Avg Cost
      002  TPZ3125  PKS  03152021  Added parameters and code for replacement cost
    }
    END.
  }
}

