OBJECT Codeunit 51980 Codeunit1303EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    LOCAL PROCEDURE "//vaseem"@1000000000();
    BEGIN
    END;

    PROCEDURE CreateReturnOrderCopyDocument@1000000001(VAR SalesInvoiceHeader@1000 : Record 112;VAR SalesHeader@1001 : Record 36);
    BEGIN
      //<TPZ2757>
      TestNoFixedAssetInSalesInvoice(SalesInvoiceHeader);
      CreateCopyDocumentReturn(SalesInvoiceHeader,SalesHeader,SalesHeader."Document Type"::"Return Order",FALSE);
      //</TPZ2757>
    END;

    LOCAL PROCEDURE CreateCopyDocumentReturn@1000000002(VAR SalesInvoiceHeader@1000 : Record 112;VAR SalesHeader@1001 : Record 36;DocumentType@1002 : Option;SkipCopyFromDescription@1004 : Boolean);
    VAR
      CopyDocMgt@1003 : Codeunit 6620;
      WrongDocumentTypeForCopyDocumentErr@1000000000 : TextConst 'ENU=You cannot correct or cancel this type of document.;ESM=No puede corregir ni cancelar este tipo de documento.;FRC=Vous ne pouvez pas corriger ou annuler ce type de document.;ENC=You cannot correct or cancel this type of document.';
    BEGIN
      CLEAR(SalesHeader);
      SalesHeader."No." := '';
      SalesHeader."Document Type" := DocumentType;
      SalesHeader.SetAllowSelectNoSeries;
      SalesHeader.INSERT(TRUE);

      CASE DocumentType OF
        SalesHeader."Document Type"::"Credit Memo":
          CopyDocMgt.SetPropertiesForCreditMemoCorrection;
        SalesHeader."Document Type"::Invoice:
          CopyDocMgt.SetPropertiesForInvoiceCorrection(SkipCopyFromDescription);
        //<TPZ2757>
          SalesHeader."Document Type"::"Return Order":
          CopyDocMgt.SetPropertiesForCreditMemoCorrection;
        //</TPZ2757>
        ELSE
          ERROR(WrongDocumentTypeForCopyDocumentErr);
      END;

      CopyDocMgt.CopySalesDocForInvoiceCancelling(SalesInvoiceHeader."No.",SalesHeader);
    END;

    LOCAL PROCEDURE TestNoFixedAssetInSalesInvoice@34(SalesInvoiceHeader@1001 : Record 112);
    VAR
      SalesInvoiceLine@1000 : Record 113;
    BEGIN
      SalesInvoiceLine.SETRANGE("Document No.",SalesInvoiceHeader."No.");
      TestNoFixedAssetInSalesLines(SalesInvoiceLine);
    END;

    LOCAL PROCEDURE TestNoFixedAssetInSalesLines@33(VAR SalesInvoiceLine@1000 : Record 113);
    VAR
      SalesInvLine@1001 : Record 113;
      FixedAssetNotPossibleToCreateCreditMemoErr@1000000000 : TextConst 'ENU=You cannot cancel this posted sales invoice because it contains lines of type Fixed Asset.\\Use the Cancel Entries function in the FA Ledger Entries window instead.;ESM=No puede cancelar esta factura de venta registrada porque contiene l�neas de tipo Activo fijo.\\Use la funci�n Cancelar movs. en la ventana de movimientos de activos fijos.;FRC=Vous ne pouvez pas annuler cette facture vente report�e, car elle contient des lignes de type Immobilisation.\\Utilisez plut�t la fonction Annuler �critures dans la fen�tre �critures immobilisation.;ENC=You cannot cancel this posted sales invoice because it contains lines of type Fixed Asset.\\Use the Cancel Entries function in the FA Ledger Entries window instead.';
    BEGIN
      SalesInvLine.COPY(SalesInvoiceLine);
      SalesInvLine.SETRANGE(Type,SalesInvLine.Type::"Fixed Asset");
      IF NOT SalesInvLine.ISEMPTY THEN
        ERROR(FixedAssetNotPossibleToCreateCreditMemoErr);
    END;

    BEGIN
    END.
  }
}

