OBJECT Codeunit 14000373 E.D.I. Get Reverse Cross Ref.
{
  OBJECT-PROPERTIES
  {
    Date=01/07/16;
    Time=12:00:00 PM;
    Version List=SE0.60.10;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      EDIGeneralCrossRef@1240020000 : Record 14000377;
      SalesHdr@1240020002 : Record 36;
      SalesInvoiceHdr@1240020001 : Record 112;
      SalesShipmentHdr@1240020005 : Record 110;
      PurchaseHdr@1240020004 : Record 38;
      BillOfLading@1240020003 : Record 14000822;
      TransferHeader@1240020008 : Record 5740;
      AssocCrossRef@1240020006 : Boolean;
      AssociatedCode@1240020007 : Boolean;
      NAVValue2@1240020009 : Code[250];

    PROCEDURE GetReverseCrossRef@1240020000(EDIElement@1240020002 : Record 14002355;EDISendDocHdr@1240020004 : Record 14002369;NAVValue@1240020000 : Code[250]) CrossRefValue : Code[40];
    VAR
      CrossReference@1240020001 : Integer;
    BEGIN
      CrossReference :=  EDIElement."General Cross Reference No.";
      CrossRefValue := '';
      AssociatedCode := FALSE;

      IF (CrossReference = 1) OR
         (CrossReference = 6) OR
         (CrossReference = 11) OR
         (CrossReference = 21) OR
         (CrossReference = 29) OR
         (CrossReference = 30)
      THEN
        AssocCrossRef := TRUE
      ELSE
        AssocCrossRef := FALSE;

      IF AssocCrossRef THEN BEGIN
        CASE CrossReference OF
          1,29:
            BEGIN
              CASE EDIElement."NAV Table No." OF
                DATABASE::"Sales Header":
                  BEGIN
                    SalesHdr.GET(SalesHdr."Document Type"::Order,EDISendDocHdr."Document No.");
                    NAVValue := SalesHdr."Shipping Agent Code";
                    IF CrossReference = 1 THEN
                      NAVValue2 := SalesHdr."E-Ship Agent Service"
                    ELSE
                      NAVValue2 := SalesHdr."Shipping Agent Service Code";
                    CASE EDIElement."NAV Field No." OF
                      SalesHdr.FIELDNO("Shipping Agent Code"):
                        AssociatedCode := FALSE
                      ELSE
                        AssociatedCode := TRUE;
                    END;
                  END;
                DATABASE::"Sales Invoice Header":
                  BEGIN
                    SalesInvoiceHdr.GET(EDISendDocHdr."Document No.");
                    NAVValue := SalesInvoiceHdr."Shipping Agent Code";
                    IF CrossReference = 1 THEN
                      NAVValue2 := SalesInvoiceHdr."E-Ship Agent Service";
                    CASE EDIElement."NAV Field No." OF
                      SalesInvoiceHdr.FIELDNO("Shipping Agent Code"):
                        AssociatedCode := FALSE
                      ELSE
                        AssociatedCode := TRUE;
                    END;
                  END;
                DATABASE::"Sales Shipment Header":
                  BEGIN
                    SalesShipmentHdr.GET(EDISendDocHdr."Document No.");
                    NAVValue := SalesShipmentHdr."Shipping Agent Code";
                    IF CrossReference = 1 THEN
                      NAVValue2 := SalesShipmentHdr."E-Ship Agent Service"
                    ELSE
                      NAVValue2 := SalesShipmentHdr."Shipping Agent Service Code";
                    CASE EDIElement."NAV Field No." OF
                      SalesShipmentHdr.FIELDNO("Shipping Agent Code"):
                        AssociatedCode := FALSE
                      ELSE
                        AssociatedCode := TRUE;
                    END;
                  END;
              END;
            END;
          6:
            CASE EDIElement."NAV Table No." OF
              DATABASE::"Purchase Header":
                BEGIN
                  PurchaseHdr.GET(PurchaseHdr."Document Type"::Order,EDISendDocHdr."Document No.");
                  NAVValue := PurchaseHdr."E-Ship Agent Code";
                  NAVValue2 := PurchaseHdr."E-Ship Agent Service";
                  CASE EDIElement."NAV Field No." OF
                    PurchaseHdr.FIELDNO("E-Ship Agent Code"):
                      AssociatedCode := FALSE
                    ELSE
                      AssociatedCode := TRUE;
                    END;
                  END;
            END;
          11:
            CASE EDIElement."NAV Table No." OF
              DATABASE::"Bill of Lading":
                BEGIN
                  IF EDIElement."Navision Document" = 'E_SLSINV' THEN BEGIN
                    SalesInvoiceHdr.GET(EDISendDocHdr."Document No.");
                    BillOfLading.GET(SalesInvoiceHdr."Invoice for Bill of Lading No.");
                  END ELSE
                    BillOfLading.GET(EDISendDocHdr."Document No.");
                  NAVValue := BillOfLading."Shipping Agent Code";
                  NAVValue2 := BillOfLading."Shipping Agent Service";
                  CASE EDIElement."NAV Field No." OF
                    BillOfLading.FIELDNO("Shipping Agent Code"):
                      AssociatedCode := FALSE
                    ELSE
                      AssociatedCode := TRUE;
                  END;
                END;
            END;
          21,30:
            CASE EDIElement."NAV Table No." OF
              DATABASE::"Transfer Header":
                BEGIN
                  TransferHeader.GET(EDISendDocHdr."Document No.");
                  NAVValue := TransferHeader."Shipping Agent Code";
                  IF CrossReference = 21 THEN
                    NAVValue2 := TransferHeader."E-Ship Agent Service"
                  ELSE
                    NAVValue2 := TransferHeader."Shipping Agent Service Code";
                  CASE EDIElement."NAV Field No." OF
                    TransferHeader.FIELDNO("Shipping Agent Code"):
                      AssociatedCode := FALSE
                    ELSE
                      AssociatedCode := TRUE;
                  END;
                END;
            END;
        END;
      END;

      EDIGeneralCrossRef.RESET;
      EDIGeneralCrossRef.SETCURRENTKEY("Trade Partner","Cross Reference");
      EDIGeneralCrossRef.SETRANGE("Trade Partner",EDIElement."Trade Partner No.");
      EDIGeneralCrossRef.SETRANGE("Cross Reference",CrossReference);
      EDIGeneralCrossRef.SETRANGE("NAV Value",NAVValue);
      IF AssocCrossRef THEN
        EDIGeneralCrossRef.SETRANGE("NAV Value 2",NAVValue2);
      EDIGeneralCrossRef.SETRANGE("Generic ID",FALSE);
      IF EDIGeneralCrossRef.FIND('-') THEN BEGIN
        IF AssociatedCode THEN
          CrossRefValue := EDIGeneralCrossRef."EDI Value 2"
        ELSE
          CrossRefValue := EDIGeneralCrossRef."EDI Value";
        EXIT(CrossRefValue);
      END ELSE BEGIN
        EDIGeneralCrossRef.RESET;
        EDIGeneralCrossRef.SETCURRENTKEY("Trade Partner","Cross Reference");
        EDIGeneralCrossRef.SETRANGE("Trade Partner",' ');
        EDIGeneralCrossRef.SETRANGE("Cross Reference",CrossReference);
        EDIGeneralCrossRef.SETRANGE("NAV Value",NAVValue);
        IF AssocCrossRef THEN
          EDIGeneralCrossRef.SETRANGE("NAV Value 2",NAVValue2);
        EDIGeneralCrossRef.SETRANGE("Generic ID",FALSE);
        IF EDIGeneralCrossRef.FIND('-') THEN BEGIN
          IF AssociatedCode THEN
            CrossRefValue := EDIGeneralCrossRef."EDI Value 2"
          ELSE
            CrossRefValue := EDIGeneralCrossRef."EDI Value";
          EXIT(CrossRefValue);
        END;
      END;

      EXIT(CrossRefValue);
    END;

    PROCEDURE FormatOutput@1240020001(EDISendDocHdr@1240020000 : Record 14002369;EDIElement@1240020012 : Record 14002355;VAR OutError@1240020013 : Boolean;VAR CrossRefArray@1240020001 : ARRAY [100] OF Text[40];VAR BypassSegment@1240020003 : Boolean;j@1240020014 : Integer);
    VAR
      EDITemplate@1240020007 : Record 14002350;
      EDIFormat@1240020008 : Codeunit 14002351;
      OutFldArray@1240020009 : ARRAY [100] OF Text[250];
      OutErrorArray@1240020010 : ARRAY [100] OF Boolean;
      BooleanVariable@1240020002 : Boolean;
      DateVariable@1240020004 : Date;
      DecimalVariable@1240020005 : Decimal;
      IntegerVariable@1240020006 : Integer;
      i@1240020011 : Integer;
      TimeVariable@1240020015 : Time;
      DateTimeVariable@1240020016 : DateTime;
    BEGIN
      i := 1;

      CLEAR(OutFldArray);
      CLEAR(OutErrorArray);

      OutFldArray[i] := CrossRefArray[j];

      EDITemplate.GET(EDISendDocHdr."EDI Template Name");

      EDIFormat.FormatOutput(
        EDITemplate,EDIElement,OutFldArray,OutErrorArray,i,BypassSegment,
        BooleanVariable,DateVariable,DecimalVariable,IntegerVariable,TimeVariable,
        DateTimeVariable);

      OutError := OutErrorArray[i];
      CrossRefArray[j] := OutFldArray[i];
    END;

    BEGIN
    END.
  }
}

