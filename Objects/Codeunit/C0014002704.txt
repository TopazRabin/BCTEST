OBJECT Codeunit 14002704 Export Forecast Review
{
  OBJECT-PROPERTIES
  {
    Date=11/01/20;
    Time=12:00:00 PM;
    Version List=UBP3.03;
  }
  PROPERTIES
  {
    OnRun=VAR
            ItemUsageReviewBatch@1240030000 : Record 14097469;
          BEGIN
            ItemUsageReviewBatch.SETRANGE("Batch Type", 'FORECAST');
            IF ItemUsageReviewBatch.FINDSET THEN BEGIN
              REPEAT
                ExportByBatch(ItemUsageReviewBatch);
              UNTIL ItemUsageReviewBatch.NEXT = 0;
            END;
          END;

  }
  CODE
  {
    VAR
      ExcelCreate@1240030001 : Codeunit 14000587;

    PROCEDURE ExportByBatch@1240030000(CurrItemForecastReviewBatch@1240030000 : Record 14097469);
    VAR
      InvMgtSetup@1240030019 : Record 14000551;
      ProgressWindow@1240030012 : Dialog;
      Text000@1240030002 : TextConst 'ENU=Period';
      Text001@1240030005 : TextConst 'ENU=Formula Forecast';
      Text002@1240030006 : TextConst 'ENU=New Forecast';
      Text003@1240030007 : TextConst 'ENU=Exporting Forecast';
      Text004@1240030008 : TextConst 'ENU=Customer';
      Text005@1240030009 : TextConst 'ENU=Items';
      TotalLines@1240030010 : Decimal;
      Lines@1240030011 : Decimal;
      Text006@1240030013 : TextConst 'ENU=Last Year';
      ItemUsageReviewLine@1240020000 : Record 14097467;
    BEGIN
      ProgressWindow.OPEN(
        Text003 + '\' +
        PADSTR(Text004,12) + '#1##################\' +
        PADSTR(Text005,12) + '@2@@@@@@@@@@@@@@@@@@@@@@@');

      InvMgtSetup.GET;

      ProgressWindow.UPDATE(1, CurrItemForecastReviewBatch."Batch Name");

      ItemUsageReviewLine.SETRANGE("Batch Type", CurrItemForecastReviewBatch."Batch Type");
      ItemUsageReviewLine.SETRANGE("Batch Name", CurrItemForecastReviewBatch."Batch Name");
      IF ItemUsageReviewLine.FINDSET THEN BEGIN
        TotalLines := ItemUsageReviewLine.COUNT;
        Lines := 0;
        ExcelCreate.CreateBook;
        ExcelCreate.AddNewSheet(CurrItemForecastReviewBatch."Batch Name");

        // value, first column, first row, bold, width
        //ExcelCreate.EnterIntoNextColumn(UPPERCASE(CurrItemForecastReviewBatch."Batch Type"),TRUE,TRUE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn(CurrItemForecastReviewBatch."Batch Type",TRUE,TRUE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn(CurrItemForecastReviewBatch."Batch Name",FALSE,FALSE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn(FORMAT(ItemUsageReviewLine."Starting Date"), FALSE, FALSE, TRUE, 0);
        ExcelCreate.EnterIntoNextColumn('',FALSE,FALSE,TRUE,0);
        ExcelCreate.EnterIntoNextColumn(USERID,FALSE,FALSE,TRUE,0);
        ExcelCreate.EnterIntoNextRow('',TRUE,FALSE,FALSE,0);

        WriteTitleLine(ItemUsageReviewLine);
        REPEAT
          Lines := Lines + 1;
          // progress bar
          WriteDataLine(ItemUsageReviewLine);
        UNTIL ItemUsageReviewLine.NEXT = 0;

        ExcelCreate.Complete(CurrItemForecastReviewBatch."Batch Name");
      END;

      ProgressWindow.CLOSE;
    END;

    LOCAL PROCEDURE WriteDataLine@1240020000(VAR CurrItemUsageReviewLine@1240020000 : Record 14097467);
    VAR
      Period@1240020001 : Integer;
    BEGIN
      ExcelCreate.EnterIntoNextRow(CurrItemUsageReviewLine."Location Code",TRUE,FALSE,FALSE,10);
      ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine."Item No.",FALSE,FALSE,FALSE,20);
      ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine."Variant Code",FALSE,FALSE,FALSE,10);
      ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine."Item Description",FALSE,FALSE,FALSE,30);
      FOR Period := 1 TO CurrItemUsageReviewLine."Forecast Periods" DO BEGIN
        ExcelCreate.EnterIntoNextColumn(FORMAT(GetPeriodField(Period, CurrItemUsageReviewLine)),FALSE,FALSE,FALSE,0);
        ExcelCreate.EnterIntoNextColumn(FORMAT(GetPeriodComparisonField(Period, CurrItemUsageReviewLine)),FALSE,FALSE,FALSE,0);
      END;
    END;

    LOCAL PROCEDURE WriteTitleLine@1240020019(VAR CurrItemUsageReviewLine@1240020000 : Record 14097467);
    VAR
      Period@1240020001 : Integer;
    BEGIN
      ExcelCreate.EnterIntoNextRow(CurrItemUsageReviewLine.FIELDCAPTION("Location Code"),TRUE,FALSE,FALSE,10);
      ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine.FIELDCAPTION("Item No."),FALSE,FALSE,FALSE,20);
      ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine.FIELDCAPTION("Variant Code"),FALSE,FALSE,FALSE,10);
      ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine.FIELDCAPTION("Item Description"),FALSE,FALSE,FALSE,30);
      FOR Period := 1 TO CurrItemUsageReviewLine."Forecast Periods" DO BEGIN
        ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine.GetCaption(Period),FALSE,FALSE,FALSE,30);
        ExcelCreate.EnterIntoNextColumn(CurrItemUsageReviewLine.GetComparisonCaption(Period),FALSE,FALSE,FALSE,30);
      END;
    END;

    LOCAL PROCEDURE GetPeriodField@1240020001(VAR CurrPeriod@1240020000 : Integer;VAR CurrItemUsageReviewLine@1240020001 : Record 14097467) : Decimal;
    BEGIN
      CASE CurrPeriod OF
        1: EXIT(CurrItemUsageReviewLine."Period 1");
        2: EXIT(CurrItemUsageReviewLine."Period 2");
        3: EXIT(CurrItemUsageReviewLine."Period 3");
        4: EXIT(CurrItemUsageReviewLine."Period 4");
        5: EXIT(CurrItemUsageReviewLine."Period 5");
        6: EXIT(CurrItemUsageReviewLine."Period 6");
        7: EXIT(CurrItemUsageReviewLine."Period 7");
        8: EXIT(CurrItemUsageReviewLine."Period 8");
        9: EXIT(CurrItemUsageReviewLine."Period 9");
        10: EXIT(CurrItemUsageReviewLine."Period 10");
        11: EXIT(CurrItemUsageReviewLine."Period 11");
        12: EXIT(CurrItemUsageReviewLine."Period 12");
        13: EXIT(CurrItemUsageReviewLine."Period 13");
        14: EXIT(CurrItemUsageReviewLine."Period 14");
        15: EXIT(CurrItemUsageReviewLine."Period 15");
        16: EXIT(CurrItemUsageReviewLine."Period 16");
        17: EXIT(CurrItemUsageReviewLine."Period 17");
        18: EXIT(CurrItemUsageReviewLine."Period 18");
        19: EXIT(CurrItemUsageReviewLine."Period 19");
        20: EXIT(CurrItemUsageReviewLine."Period 20");
        21: EXIT(CurrItemUsageReviewLine."Period 21");
        22: EXIT(CurrItemUsageReviewLine."Period 22");
        23: EXIT(CurrItemUsageReviewLine."Period 23");
        24: EXIT(CurrItemUsageReviewLine."Period 24");
        25: EXIT(CurrItemUsageReviewLine."Period 25");
        26: EXIT(CurrItemUsageReviewLine."Period 26");
        27: EXIT(CurrItemUsageReviewLine."Period 27");
        28: EXIT(CurrItemUsageReviewLine."Period 28");
        29: EXIT(CurrItemUsageReviewLine."Period 29");
        30: EXIT(CurrItemUsageReviewLine."Period 30");
        31: EXIT(CurrItemUsageReviewLine."Period 31");
        32: EXIT(CurrItemUsageReviewLine."Period 32");
        33: EXIT(CurrItemUsageReviewLine."Period 33");
        34: EXIT(CurrItemUsageReviewLine."Period 34");
        35: EXIT(CurrItemUsageReviewLine."Period 35");
        36: EXIT(CurrItemUsageReviewLine."Period 36");
        37: EXIT(CurrItemUsageReviewLine."Period 37");
        38: EXIT(CurrItemUsageReviewLine."Period 38");
        39: EXIT(CurrItemUsageReviewLine."Period 39");
        40: EXIT(CurrItemUsageReviewLine."Period 40");
        41: EXIT(CurrItemUsageReviewLine."Period 41");
        42: EXIT(CurrItemUsageReviewLine."Period 42");
        43: EXIT(CurrItemUsageReviewLine."Period 43");
        44: EXIT(CurrItemUsageReviewLine."Period 44");
        45: EXIT(CurrItemUsageReviewLine."Period 45");
        46: EXIT(CurrItemUsageReviewLine."Period 46");
        47: EXIT(CurrItemUsageReviewLine."Period 47");
        48: EXIT(CurrItemUsageReviewLine."Period 48");
        49: EXIT(CurrItemUsageReviewLine."Period 49");
        50: EXIT(CurrItemUsageReviewLine."Period 50");
        51: EXIT(CurrItemUsageReviewLine."Period 51");
        52: EXIT(CurrItemUsageReviewLine."Period 52");
      END;
    END;

    LOCAL PROCEDURE GetPeriodComparisonField@1240020004(VAR CurrPeriod@1240020000 : Integer;VAR CurrItemUsageReviewLine@1240020001 : Record 14097467) : Decimal;
    BEGIN
      CASE CurrPeriod OF
        1: EXIT(CurrItemUsageReviewLine."Period 1 C");
        2: EXIT(CurrItemUsageReviewLine."Period 2 C");
        3: EXIT(CurrItemUsageReviewLine."Period 3 C");
        4: EXIT(CurrItemUsageReviewLine."Period 4 C");
        5: EXIT(CurrItemUsageReviewLine."Period 5 C");
        6: EXIT(CurrItemUsageReviewLine."Period 6 C");
        7: EXIT(CurrItemUsageReviewLine."Period 7 C");
        8: EXIT(CurrItemUsageReviewLine."Period 8 C");
        9: EXIT(CurrItemUsageReviewLine."Period 9 C");
        10: EXIT(CurrItemUsageReviewLine."Period 10 C");
        11: EXIT(CurrItemUsageReviewLine."Period 11 C");
        12: EXIT(CurrItemUsageReviewLine."Period 12 C");
        13: EXIT(CurrItemUsageReviewLine."Period 13 C");
        14: EXIT(CurrItemUsageReviewLine."Period 14 C");
        15: EXIT(CurrItemUsageReviewLine."Period 15 C");
        16: EXIT(CurrItemUsageReviewLine."Period 16 C");
        17: EXIT(CurrItemUsageReviewLine."Period 17 C");
        18: EXIT(CurrItemUsageReviewLine."Period 18 C");
        19: EXIT(CurrItemUsageReviewLine."Period 19 C");
        20: EXIT(CurrItemUsageReviewLine."Period 20 C");
        21: EXIT(CurrItemUsageReviewLine."Period 21 C");
        22: EXIT(CurrItemUsageReviewLine."Period 22 C");
        23: EXIT(CurrItemUsageReviewLine."Period 23 C");
        24: EXIT(CurrItemUsageReviewLine."Period 24 C");
        25: EXIT(CurrItemUsageReviewLine."Period 25 C");
        26: EXIT(CurrItemUsageReviewLine."Period 26 C");
        27: EXIT(CurrItemUsageReviewLine."Period 27 C");
        28: EXIT(CurrItemUsageReviewLine."Period 28 C");
        29: EXIT(CurrItemUsageReviewLine."Period 29 C");
        30: EXIT(CurrItemUsageReviewLine."Period 30 C");
        31: EXIT(CurrItemUsageReviewLine."Period 31 C");
        32: EXIT(CurrItemUsageReviewLine."Period 32 C");
        33: EXIT(CurrItemUsageReviewLine."Period 33 C");
        34: EXIT(CurrItemUsageReviewLine."Period 34 C");
        35: EXIT(CurrItemUsageReviewLine."Period 35 C");
        36: EXIT(CurrItemUsageReviewLine."Period 36 C");
        37: EXIT(CurrItemUsageReviewLine."Period 37 C");
        38: EXIT(CurrItemUsageReviewLine."Period 38 C");
        39: EXIT(CurrItemUsageReviewLine."Period 39 C");
        40: EXIT(CurrItemUsageReviewLine."Period 40 C");
        41: EXIT(CurrItemUsageReviewLine."Period 41 C");
        42: EXIT(CurrItemUsageReviewLine."Period 42 C");
        43: EXIT(CurrItemUsageReviewLine."Period 43 C");
        44: EXIT(CurrItemUsageReviewLine."Period 44 C");
        45: EXIT(CurrItemUsageReviewLine."Period 45 C");
        46: EXIT(CurrItemUsageReviewLine."Period 46 C");
        47: EXIT(CurrItemUsageReviewLine."Period 47 C");
        48: EXIT(CurrItemUsageReviewLine."Period 48 C");
        49: EXIT(CurrItemUsageReviewLine."Period 49 C");
        50: EXIT(CurrItemUsageReviewLine."Period 50 C");
        51: EXIT(CurrItemUsageReviewLine."Period 51 C");
        52: EXIT(CurrItemUsageReviewLine."Period 52 C");
      END;
    END;

    BEGIN
    END.
  }
}

