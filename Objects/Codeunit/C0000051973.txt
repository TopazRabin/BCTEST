OBJECT Codeunit 51973 Codeunit7307EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=06/14/21;
    Time=[ 5:06:19 AM];
    Modified=Yes;
    Version List=NAVEVENT,001;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    [EventSubscriber(Codeunit,51972,CU7307_OnBeforeUpdateWhseDocHeader)]
    LOCAL PROCEDURE CU7307_UpdateWhseDocHeader@1000000020(VAR Sender@1000000000 : Codeunit 51972;WhseActivLine@1000000001 : Record 5767);
    VAR
      WhseRequest@1000000003 : Record 5765;
      OutWhseReqMgt@1000000002 : Codeunit 14002863;
    BEGIN
      IF WhseActivLine."Activity Type" = WhseActivLine."Activity Type"::Pick THEN BEGIN
        WhseRequest.SETCURRENTKEY("Source Type","Source Subtype","Source No.");
        WhseRequest.SETRANGE("Location Code", WhseActivLine."Location Code");
        WhseRequest.SETRANGE("Source Subtype", WhseActivLine."Source Subtype");
        WhseRequest.SETRANGE("Source Type", WhseActivLine."Source Type");
        WhseRequest.SETRANGE("Source No.", WhseActivLine."Source No.");
        IF WhseRequest.FINDFIRST THEN BEGIN
          OutWhseReqMgt.SetWhseActivStatusToPickRegistered(WhseRequest);
          WhseRequest.MODIFY;
        END;
      END;
    END;

    [EventSubscriber(Codeunit,7307,OnAfterCreateRegActivLine)]
    LOCAL PROCEDURE CU7307_Code@1000000025(VAR WarehouseActivityLine@1000000000 : Record 5767);
    BEGIN
      BlockNPIBinContent(WarehouseActivityLine);
    END;

    LOCAL PROCEDURE BlockNPIBinContent@1000000018(WhseActivLine@1000000000 : Record 5767);
    VAR
      DefaultDimension@1000000002 : Record 352;
      BinContent@1000000001 : Record 7302;
    BEGIN
      //<TPZ2532>
      IF (WhseActivLine."Activity Type" = WhseActivLine."Activity Type" :: "Put-away") AND (WhseActivLine."Action Type" = WhseActivLine."Action Type" :: Place) THEN BEGIN
        DefaultDimension.RESET;
        IF DefaultDimension.GET(27,WhseActivLine."Item No.",'PRODLIFECYCLE')THEN BEGIN
         IF DefaultDimension."Dimension Value Code" = 'INTRO' THEN  BEGIN
           BinContent.RESET;
           BinContent.SETRANGE("Location Code",WhseActivLine."Location Code");
           BinContent.SETRANGE("Bin Code",WhseActivLine."Bin Code");
           BinContent.SETRANGE("Item No.",WhseActivLine."Item No.");
           IF WhseActivLine."Variant Code" <>'' THEN
            BinContent.SETRANGE("Variant Code",WhseActivLine."Variant Code");
           IF BinContent."Unit of Measure Code" <>'' THEN
            BinContent.SETRANGE("Unit of Measure Code",WhseActivLine."Unit of Measure Code");
              IF BinContent.FINDFIRST THEN BEGIN
                //BinContent."Reason Code" := 'NPI'//<TPZ3203>
                BinContent."Reason Code" := 'QACK';//<TPZ3203>

                BinContent."Block Movement":=BinContent."Block Movement" :: All;
                BinContent.MODIFY;
              END;
         END;
         //<TPZ2586>
         IF DefaultDimension."Dimension Value Code" = 'QUAR' THEN  BEGIN
           BinContent.RESET;
           BinContent.SETRANGE("Location Code",WhseActivLine."Location Code");
           BinContent.SETRANGE("Bin Code",WhseActivLine."Bin Code");
           BinContent.SETRANGE("Item No.",WhseActivLine."Item No.");
           IF WhseActivLine."Variant Code" <>'' THEN
            BinContent.SETRANGE("Variant Code",WhseActivLine."Variant Code");
           IF BinContent."Unit of Measure Code" <>'' THEN
            BinContent.SETRANGE("Unit of Measure Code",WhseActivLine."Unit of Measure Code");
              IF BinContent.FINDFIRST THEN BEGIN
                BinContent."Reason Code" := 'QUAR';
                BinContent."Block Movement":=BinContent."Block Movement" :: All;
                BinContent.MODIFY;
              END;
         END;
        END; //</TPZ2586>
      END;
      //</TPZ2532>
    END;

    BEGIN
    {
      001 UTK TPZ3203 06142021 Added code to change Bin content reason code from NPI to QACK.
    }
    END.
  }
}

