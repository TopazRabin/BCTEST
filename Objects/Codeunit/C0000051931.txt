OBJECT Codeunit 51931 Codeunit5771EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=07/02/21;
    Time=11:22:35 AM;
    Modified=Yes;
    Version List=NAVEVENT,TPZ2992;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    [EventSubscriber(Codeunit,5771,OnBeforeCreateWhseRequest)]
    PROCEDURE CU5771_CreateWhseRequest@1000000000(VAR WhseRqst@1000000000 : Record 5765;SalesHeader@1000000001 : Record 36;SalesLine@1000000002 : Record 37);
    VAR
      OldWhseRqst@1000000003 : Record 5765;
      SalesLineLoc@1000000004 : Record 37;
      ChangeLogEntry@1000000005 : Record 405;
    BEGIN
      //TM BEG 061215
      OldWhseRqst.SETCURRENTKEY("Source Type","Source Subtype","Source No.");
      OldWhseRqst.SETRANGE("Source Type",DATABASE::"Sales Line");
      OldWhseRqst.SETRANGE("Source Subtype",SalesLine."Document Type");
      OldWhseRqst.SETRANGE("Source No.",SalesLine."Document No.");
      OldWhseRqst.SETRANGE("Location Code", SalesLine."Location Code");
      IF OldWhseRqst.FINDFIRST THEN BEGIN
        WhseRqst."Activity Status" := OldWhseRqst."Activity Status";
        WhseRqst."Order Changed" := OldWhseRqst."Order Changed";
        WhseRqst."Override SOM" := OldWhseRqst."Override SOM";//TPZ2992
      END;
      //TM END 061215
      //TM BEG 061115
      WhseRqst."E-Ship Agent Service" := SalesHeader."E-Ship Agent Service";
      WhseRqst."Sell-to/Transfer-to No." := SalesHeader."Sell-to Customer No.";
      WhseRqst."Sell-to/Transfer-to Name" := SalesHeader."Sell-to Customer Name";
      WhseRqst."Ship-to Name" := SalesHeader."Ship-to Name";
      WhseRqst."Division Code" := SalesHeader."Shortcut Dimension 5 Code";
      WhseRqst."Requested Delivery Date" := SalesHeader."Requested Delivery Date";
      WhseRqst."Ship-to Code" := SalesHeader."Ship-to Code";
      //TM END 061115

      //<TPZ1333>
      IF (WhseRqst."Activity Status" = WhseRqst."Activity Status"::Shipped) AND
          (SalesHeader."Shipment Date" <> WhseRqst."Shipment Date") THEN
        WhseRqst."Activity Status" := WhseRqst."Activity Status"::" ";
      //</TPZ1333>
      //>>TPZ2781 PSHUKLA
      SalesLineLoc.SETCURRENTKEY("Document Type","Document No.","Location Code");
      SalesLineLoc.SETRANGE("Document Type",SalesHeader."Document Type");
      SalesLineLoc.SETRANGE("Document No.",SalesHeader."No.");
      SalesLineLoc.SETRANGE(Type,SalesLineLoc.Type::Item);
      SalesLineLoc.SETRANGE("Drop Shipment",FALSE);
      SalesLineLoc.SETRANGE("Job No.",'');
      IF SalesLineLoc.FINDSET THEN
        WhseRqst."Number of Lines" := SalesLineLoc.COUNT;
      WhseRqst."Shipping Method" := SalesHeader."Shipping Agent Code";
      WhseRqst."Pick Type" := WhseRqst."Pick Type"::SO;
      //<<TPZ2781
      //-->TPZ3014
      //IF NOT SalesHeader."Back Order" THEN
        WhseRqst."Order Date" := SalesHeader."Order Date";
      {ELSE BEGIN
        ChangeLogEntry.RESET;
        ChangeLogEntry.SETCURRENTKEY("Entry No.");
        ChangeLogEntry.SETRANGE("Table No.",36);
        ChangeLogEntry.SETRANGE("Primary Key Field 2 Value",SalesHeader."No.");
        ChangeLogEntry.SETRANGE("Field No.",120);
        ChangeLogEntry.SETRANGE("New Value",FORMAT(0));
        IF ChangeLogEntry.FINDLAST THEN
          WhseRqst."Order Date" := DT2DATE(ChangeLogEntry."Date and Time");
      END;
      }
      //<--
      // WhseRqst."Delivery Date" := SalesHeader."Delivery Date";//TPZ3263
    END;

    BEGIN
    {
      001 TPZ2830 PKS 07232020 New object created to convert event
      TPZ3014  PKS  12222020 Added code to flow order date to warehouse request
    }
    END.
  }
}

