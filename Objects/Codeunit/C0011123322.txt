OBJECT Codeunit 11123322 SC - Log
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=SCW18.3.1;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      Text11123302@11123302 : TextConst 'ENU=Directory %1 does not exist. Check SC logging options';
      Text11123303@11123303 : TextConst 'ENU=Request';
      Text11123304@11123304 : TextConst 'ENU=Response';

    PROCEDURE SaveRequest@11123302(VAR XMLDoc@11123302 : DotNet "'System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlDocument");
    BEGIN
      SaveLog(XMLDoc,Text11123303);
    END;

    PROCEDURE SaveResponse@11123303(VAR XMLDoc@11123302 : DotNet "'System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlDocument");
    BEGIN
      SaveLog(XMLDoc,Text11123304);
    END;

    PROCEDURE GetLogOutputDir@11123304() : Text[251];
    VAR
      Options@11123302 : Record 11123305;
      OutputFolder@11123303 : Text[251];
      DirPath@11123304 : Text[1024];
    BEGIN
      Options.GET;
      Options.TESTFIELD("Logging Output Directory");

      OutputFolder := CompleteDirPath(Options."Logging Output Directory");

      IF NOT ISSERVICETIER THEN BEGIN
        DirPath := OutputFolder + 'nul';
        IF NOT EXISTS(DirPath) THEN
          ERROR(Text11123302,OutputFolder);
      END;

      EXIT(OutputFolder);
    END;

    PROCEDURE CompleteDirPath@11123305(DirectoryPath@11123302 : Text[250]) : Text[251];
    VAR
      OutputFolder@11123304 : Text[251];
    BEGIN
      IF COPYSTR(OutputFolder,STRLEN(DirectoryPath),1) <> '\' THEN
        EXIT(DirectoryPath + '\');
      EXIT(DirectoryPath);
    END;

    PROCEDURE SaveLog@11123306(VAR XMLDoc@11123302 : DotNet "'System.Xml, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Xml.XmlDocument";LogType@11123303 : Text[30]);
    VAR
      Context@1000 : Codeunit 11123305;
      FileName@11123305 : Text[384];
      OutputFolder@11123304 : Text[251];
    BEGIN
      OutputFolder := GetLogOutputDir;
      FileName :=
        OutputFolder +
        FORMAT(CURRENTDATETIME,0,'<Day,2>-<Month,2>-<Year>_<Hours24>.<Minutes,2>.<Seconds,2><Second dec>') + '_' +
        LogType + '_' +
        Context.GetCurrentOperationName +
        '.xml';

      XMLDoc.Save(FileName);
    END;

    BEGIN
    END.
  }
}

