OBJECT Codeunit 52007 Global Traz Json
{
  OBJECT-PROPERTIES
  {
    Date=09/09/21;
    Time=[ 7:38:54 AM];
    Modified=Yes;
    Version List=3311;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            JsonRequest;
          END;

  }
  CODE
  {
    VAR
      HttpWebRequest@1000000001 : DotNet "'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Net.HttpWebRequest";
      HttpWebResponse@1000000000 : DotNet "'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Net.HttpWebResponse";
      JSONManagement@1000000002 : Codeunit 5459;
      JObject@1000000003 : DotNet "'Newtonsoft.Json'.Newtonsoft.Json.Linq.JObject";
      OriginObject@1000000004 : DotNet "'Newtonsoft.Json'.Newtonsoft.Json.Linq.JObject";
      DestinationObject@1000000005 : DotNet "'Newtonsoft.Json'.Newtonsoft.Json.Linq.JObject";
      ItemsArray@1000000006 : DotNet "'Newtonsoft.Json'.Newtonsoft.Json.Linq.JArray";
      ItemsObject@1000000007 : DotNet "'Newtonsoft.Json'.Newtonsoft.Json.Linq.JObject";
      HttpWebRequestMgt@1000000008 : Codeunit 1297;
      AuthString@1000000009 : Text;
      TypeHelper@1000000010 : Codeunit 10;
      TempBlob@1000000011 : TEMPORARY Record 99008535;
      ResponseInStrm@1000000012 : InStream;
      ResponseText@1000000013 : Text;
      HttpStatusCode@1000000014 : DotNet "'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Net.HttpStatusCode";
      ResponseHeaders@1000000015 : DotNet "'System, Version=2.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.Specialized.NameValueCollection";

    LOCAL PROCEDURE JsonRequest@1000000000();
    BEGIN

      JSONManagement.InitializeEmptyObject;
      JSONManagement.GetJSONObject(JObject);
      JSONManagement.InitializeEmptyObject;
      JSONManagement.GetJSONObject(OriginObject);
      JSONManagement.InitializeEmptyObject;
      JSONManagement.GetJSONObject(DestinationObject);
      JSONManagement.InitializeEmptyCollection;
      JSONManagement.GetJsonArray(ItemsArray);
      JSONManagement.AddJPropertyToJObject(JObject,'CustomerId','22');
      JSONManagement.AddJPropertyToJObject(JObject,'GuaranteedRates','false');
      JSONManagement.AddJPropertyToJObject(JObject,'PickupDate','06/25/2021');
      JSONManagement.AddJPropertyToJObject(JObject,'ExtremeLength',12);
      JSONManagement.AddJPropertyToJObject(JObject,'ExtremeLengthBundleCount',2);
      JSONManagement.AddJPropertyToJObject(JObject,'Stackable',FALSE);
      JSONManagement.AddJPropertyToJObject(JObject,'TerminalPickup',FALSE);
      JSONManagement.AddJPropertyToJObject(JObject,'ContactName','John Doe');
      JSONManagement.AddJPropertyToJObject(JObject,'ValueOfGoods',1234.5);
      JSONManagement.AddJPropertyToJObject(JObject,'ShipmentNew',FALSE);
        JSONManagement.AddJPropertyToJObject(OriginObject,'Street','321 xyz street');
        JSONManagement.AddJPropertyToJObject(OriginObject,'City','MIAMI');
        JSONManagement.AddJPropertyToJObject(OriginObject,'State','FL');
        JSONManagement.AddJPropertyToJObject(OriginObject,'Zip','33147');
        JSONManagement.AddJPropertyToJObject(OriginObject,'Country','USA');
        JSONManagement.AddJObjectToJObject(JObject,'Origin',OriginObject);

        JSONManagement.AddJPropertyToJObject(DestinationObject,'Street','321 xyz street');
        JSONManagement.AddJPropertyToJObject(DestinationObject,'City','MIAMI');
        JSONManagement.AddJPropertyToJObject(DestinationObject,'State','FL');
        JSONManagement.AddJPropertyToJObject(DestinationObject,'Zip','33147');
        JSONManagement.AddJPropertyToJObject(DestinationObject,'Country','USA');
        JSONManagement.AddJObjectToJObject(JObject,'Destination',DestinationObject);
            JSONManagement.InitializeEmptyObject;
            JSONManagement.GetJSONObject(ItemsObject);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'PieceCount',1);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'PalletCount',1);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'Length',40);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'Width',40);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'Height',0);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'Weight',1000);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'WeightType',1);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'ProductClass',50);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'LinearFeet',12);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'NmfcNumber','Test1234');
            JSONManagement.AddJPropertyToJObject(ItemsObject,'Description','Rubber');
            JSONManagement.AddJPropertyToJObject(ItemsObject,'PackageType',0);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'Hazmat',FALSE);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'HazmatClass',10);
            JSONManagement.AddJPropertyToJObject(ItemsObject,'PackingGroupNumber','');
            JSONManagement.AddJPropertyToJObject(ItemsObject,'UnPoNumber','');
            JSONManagement.AddJPropertyToJObject(ItemsObject,'Stackable',FALSE);
            JSONManagement.AddJObjectToJArray(ItemsArray,ItemsObject);
            JSONManagement.AddJArrayToJObject(JObject,'Items',ItemsArray);

      MESSAGE(JObject.ToString);
      //EXIT;

      CLEAR(HttpWebRequestMgt);
      //HttpWebRequestMgt.Initialize('https://api.gtzintegrate.com/docs/?identifier=r9-DxSKqWSCif78eFQLGvQ==jtBEpoLZ-VQIFKrMetluaTw6k6ZmGVNBe6fL3AmA7eO--f9JFPWUdQLLQu4xPRksl-J3s6YFTWZHZ87RB8HaQxTVr0p_93_piyTJcGrSspk');
      HttpWebRequestMgt.Initialize('https://dev.gtzintegrate.com/rate/ltl/v2?subscription-key=bcc0ec4997814c74a854f9a738a58cbd');
      HttpWebRequestMgt.DisableUI;
      HttpWebRequestMgt.SetMethod('POST');
      HttpWebRequestMgt.SetReturnType('application/json');
      HttpWebRequestMgt.SetContentType('application/json');
      HttpWebRequestMgt.AddHeader('subscription-key','bcc0ec4997814c74a854f9a738a58cbd');
      AuthString := STRSUBSTNO('%1:%2','apitesting','Agent%9999');
      AuthString := TypeHelper.ConvertValueToBase64(AuthString);
      AuthString := STRSUBSTNO('Basic %1',AuthString);
      HttpWebRequestMgt.AddHeader('Authorization',AuthString);
      HttpWebRequestMgt.AddBodyAsText(JObject.ToString);
      TempBlob.INIT;
      TempBlob.Blob.CREATEINSTREAM(ResponseInStrm);
      IF HttpWebRequestMgt.GetResponse(ResponseInStrm,HttpStatusCode,ResponseHeaders) THEN BEGIN
          ResponseInStrm.READ(ResponseText);
          MESSAGE('Response\%1',ResponseText);
      END;
    END;

    EVENT JObject@1000000003::PropertyChanged@117(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangedEventArgs");
    BEGIN
    END;

    EVENT JObject@1000000003::PropertyChanging@118(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangingEventArgs");
    BEGIN
    END;

    EVENT JObject@1000000003::ListChanged@119(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.ListChangedEventArgs");
    BEGIN
    END;

    EVENT JObject@1000000003::AddingNew@120(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.AddingNewEventArgs");
    BEGIN
    END;

    EVENT JObject@1000000003::CollectionChanged@121(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.Specialized.NotifyCollectionChangedEventArgs");
    BEGIN
    END;

    EVENT OriginObject@1000000004::PropertyChanged@117(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangedEventArgs");
    BEGIN
    END;

    EVENT OriginObject@1000000004::PropertyChanging@118(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangingEventArgs");
    BEGIN
    END;

    EVENT OriginObject@1000000004::ListChanged@119(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.ListChangedEventArgs");
    BEGIN
    END;

    EVENT OriginObject@1000000004::AddingNew@120(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.AddingNewEventArgs");
    BEGIN
    END;

    EVENT OriginObject@1000000004::CollectionChanged@121(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.Specialized.NotifyCollectionChangedEventArgs");
    BEGIN
    END;

    EVENT DestinationObject@1000000005::PropertyChanged@117(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangedEventArgs");
    BEGIN
    END;

    EVENT DestinationObject@1000000005::PropertyChanging@118(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangingEventArgs");
    BEGIN
    END;

    EVENT DestinationObject@1000000005::ListChanged@119(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.ListChangedEventArgs");
    BEGIN
    END;

    EVENT DestinationObject@1000000005::AddingNew@120(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.AddingNewEventArgs");
    BEGIN
    END;

    EVENT DestinationObject@1000000005::CollectionChanged@121(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.Specialized.NotifyCollectionChangedEventArgs");
    BEGIN
    END;

    EVENT ItemsArray@1000000006::ListChanged@117(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.ListChangedEventArgs");
    BEGIN
    END;

    EVENT ItemsArray@1000000006::AddingNew@118(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.AddingNewEventArgs");
    BEGIN
    END;

    EVENT ItemsArray@1000000006::CollectionChanged@119(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.Specialized.NotifyCollectionChangedEventArgs");
    BEGIN
    END;

    EVENT ItemsObject@1000000007::PropertyChanged@117(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangedEventArgs");
    BEGIN
    END;

    EVENT ItemsObject@1000000007::PropertyChanging@118(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.PropertyChangingEventArgs");
    BEGIN
    END;

    EVENT ItemsObject@1000000007::ListChanged@119(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.ListChangedEventArgs");
    BEGIN
    END;

    EVENT ItemsObject@1000000007::AddingNew@120(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.ComponentModel.AddingNewEventArgs");
    BEGIN
    END;

    EVENT ItemsObject@1000000007::CollectionChanged@121(sender@1000000001 : Variant;e@1000000000 : DotNet "'System, Version=4.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089'.System.Collections.Specialized.NotifyCollectionChangedEventArgs");
    BEGIN
    END;

    BEGIN
    END.
  }
}

