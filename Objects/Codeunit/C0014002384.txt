OBJECT Codeunit 14002384 E.D.I. Increment Sequence
{
  OBJECT-PROPERTIES
  {
    Date=04/05/12;
    Time=12:00:00 PM;
    Version List=SE0.55.08;
  }
  PROPERTIES
  {
    Permissions=TableData 14002353=rimd;
    OnRun=BEGIN
          END;

  }
  CODE
  {

    PROCEDURE IncrementInvoiceDiscSequence@1240020001(VAR EDIDocument@1240020000 : Record 14002353;VAR CustInvoiceDisc@1240020001 : Record 19;TotalDiscountPercent@1240020002 : Decimal);
    VAR
      CustInvoiceDisc2@1240020003 : Record 19;
      CustInvoiceDiscCode@1240020004 : Code[20];
      NAVDiscountCode@1240020006 : Code[20];
      ValidCode@1240020005 : Boolean;
    BEGIN
      ValidCode := TRUE;
      CustInvoiceDisc.LOCKTABLE;

      IF CustInvoiceDisc."Discount %" = 0 THEN BEGIN
        CustInvoiceDisc.VALIDATE("Discount %",TotalDiscountPercent);
        CustInvoiceDisc.MODIFY;
      END ELSE BEGIN
        EDIDocument.LOCKTABLE;
        IF EDIDocument."NAV Invoice Discount Sequence" <> '' THEN
          EDIDocument."NAV Invoice Discount Sequence" :=
            INCSTR(EDIDocument."NAV Invoice Discount Sequence")
        ELSE
          EDIDocument."NAV Invoice Discount Sequence" := '01';
        CustInvoiceDiscCode :=
          EDIDocument."NAV Invoice Discount Code" + EDIDocument."NAV Invoice Discount Sequence";
        NAVDiscountCode :=  ''''+ EDIDocument."NAV Invoice Discount Code" + '*' +'''';
        CustInvoiceDisc2.RESET;
        CustInvoiceDisc2.SETFILTER(Code,NAVDiscountCode);
        IF CustInvoiceDisc2.FIND('-') THEN
          REPEAT
            IF CustInvoiceDisc2.Code = CustInvoiceDiscCode THEN BEGIN
              EDIDocument."NAV Invoice Discount Sequence" :=
                INCSTR(EDIDocument."NAV Invoice Discount Sequence");
              CustInvoiceDiscCode :=
                EDIDocument."NAV Invoice Discount Code" + EDIDocument."NAV Invoice Discount Sequence";
            END;
          UNTIL CustInvoiceDisc2.NEXT = 0;
        EDIDocument.MODIFY;

        CustInvoiceDisc2.RESET;
        CustInvoiceDisc2.SETRANGE(Code,EDIDocument."NAV Invoice Discount Code");
        IF CustInvoiceDisc2.FIND('-') THEN BEGIN
          CustInvoiceDisc.INIT;
          CustInvoiceDisc.RESET;
          CustInvoiceDisc.TRANSFERFIELDS(CustInvoiceDisc2);
          CustInvoiceDisc.Code :=
            EDIDocument."NAV Invoice Discount Code" + EDIDocument."NAV Invoice Discount Sequence";
          CustInvoiceDisc.VALIDATE("Discount %",TotalDiscountPercent);
          CustInvoiceDisc.INSERT;
        END;
      END;

      COMMIT;
    END;

    BEGIN
    END.
  }
}

