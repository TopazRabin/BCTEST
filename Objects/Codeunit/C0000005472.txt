OBJECT Codeunit 5472 Graph Mgt - Vendor
{
  OBJECT-PROPERTIES
  {
    Date=11/22/17;
    Time=12:00:00 PM;
    Version List=NAVW111.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    PROCEDURE ProcessComplexTypes@8(VAR Vendor@1000 : Record 23;PaymentTermsJSON@1003 : Text;PaymentMethodJSON@1001 : Text;PostalAddressJSON@1002 : Text);
    BEGIN
      UpdatePaymentTerms(PaymentTermsJSON,Vendor);
      UpdatePaymentMethod(PaymentMethodJSON,Vendor);
      UpdatePostalAddress(PostalAddressJSON,Vendor);
    END;

    PROCEDURE PaymentTermsToJSON@1(PaymentTermsCode@1000 : Code[10]) JSON : Text;
    VAR
      PaymentTerms@1001 : Record 3;
      GraphMgtComplexTypes@1002 : Codeunit 5468;
    BEGIN
      IF PaymentTerms.GET(PaymentTermsCode) THEN
        GraphMgtComplexTypes.GetCodeAndDescriptionJSON(PaymentTerms.Code,PaymentTerms.Description,JSON);
    END;

    PROCEDURE PaymentMethodToJSON@9(PaymentMethodCode@1000 : Code[10]) JSON : Text;
    VAR
      PaymentMethod@1001 : Record 289;
      GraphMgtComplexTypes@1002 : Codeunit 5468;
    BEGIN
      IF PaymentMethod.GET(PaymentMethodCode) THEN
        GraphMgtComplexTypes.GetCodeAndDescriptionJSON(PaymentMethod.Code,PaymentMethod.Description,JSON);
    END;

    PROCEDURE PostalAddressToJSON@5(Vendor@1000 : Record 23) JSON : Text;
    VAR
      GraphMgtComplexTypes@1001 : Codeunit 5468;
    BEGIN
      WITH Vendor DO
        GraphMgtComplexTypes.GetPostalAddressJSON(Address,"Address 2",City,County,"Country/Region Code","Post Code",JSON);
    END;

    PROCEDURE UpdateIntegrationRecords@11(OnlyVendorsWithoutId@1000 : Boolean);
    VAR
      DummyVendor@1002 : Record 23;
      GraphMgtGeneralTools@1001 : Codeunit 5465;
      VendorRecordRef@1019 : RecordRef;
    BEGIN
      VendorRecordRef.OPEN(DATABASE::Vendor);
      GraphMgtGeneralTools.UpdateIntegrationRecords(VendorRecordRef,DummyVendor.FIELDNO(Id),OnlyVendorsWithoutId);
    END;

    PROCEDURE UpdatePaymentTerms@13(PaymentTermsJSON@1000 : Text;VAR Vendor@1001 : Record 23);
    VAR
      GraphMgtComplexTypes@1002 : Codeunit 5468;
      PreviousCode@1004 : Code[10];
      PreviousJSONString@1005 : Text;
      NewCode@1007 : Code[10];
      NewDescription@1008 : Text[50];
    BEGIN
      IF PaymentTermsJSON = '' THEN
        EXIT;

      PreviousCode := Vendor."Payment Terms Code";
      PreviousJSONString := PaymentTermsToJSON(PreviousCode);

      IF PaymentTermsJSON <> PreviousJSONString THEN BEGIN
        GraphMgtComplexTypes.GetCodeAndDescriptionFromJSON(PaymentTermsJSON,NewCode,NewDescription);
        Vendor.VALIDATE("Payment Terms Code",NewCode);
      END;
    END;

    PROCEDURE UpdatePaymentMethod@15(PaymentMethodJSON@1000 : Text;VAR Vendor@1001 : Record 23);
    VAR
      GraphMgtComplexTypes@1006 : Codeunit 5468;
      PreviousCode@1005 : Code[10];
      PreviousJSONString@1004 : Text;
      NewCode@1003 : Code[10];
      NewDescription@1002 : Text[50];
    BEGIN
      IF PaymentMethodJSON = '' THEN
        EXIT;

      PreviousCode := Vendor."Payment Method Code";
      PreviousJSONString := PaymentMethodToJSON(PreviousCode);

      IF PaymentMethodJSON <> PreviousJSONString THEN BEGIN
        GraphMgtComplexTypes.GetCodeAndDescriptionFromJSON(PaymentMethodJSON,NewCode,NewDescription);
        Vendor.VALIDATE("Payment Method Code",NewCode);
      END;
    END;

    LOCAL PROCEDURE UpdatePostalAddress@4(PostalAddressJSON@1000 : Text;VAR Vendor@1001 : Record 23);
    VAR
      GraphMgtComplexTypes@1002 : Codeunit 5468;
      RecRef@1004 : RecordRef;
    BEGIN
      IF PostalAddressJSON = '' THEN
        EXIT;

      WITH Vendor DO BEGIN
        RecRef.GETTABLE(Vendor);
        GraphMgtComplexTypes.ApplyPostalAddressFromJSON(PostalAddressJSON,RecRef,
          FIELDNO(Address),FIELDNO("Address 2"),FIELDNO(City),FIELDNO(County),FIELDNO("Country/Region Code"),FIELDNO("Post Code"));
        RecRef.SETTABLE(Vendor);
      END;
    END;

    [EventSubscriber(Codeunit,5150,OnUpdateReferencedIdField)]
    LOCAL PROCEDURE HandleUpdateReferencedIdFieldOnItem@19(VAR RecRef@1000 : RecordRef;NewId@1001 : GUID;VAR Handled@1002 : Boolean);
    VAR
      DummyVendor@1004 : Record 23;
      GraphMgtGeneralTools@1006 : Codeunit 5465;
    BEGIN
      GraphMgtGeneralTools.HandleUpdateReferencedIdFieldOnItem(RecRef,NewId,Handled,DATABASE::Vendor,DummyVendor.FIELDNO(Id));
    END;

    [EventSubscriber(Codeunit,5150,OnGetPredefinedIdValue)]
    LOCAL PROCEDURE HandleGetPredefinedIdValue@21(VAR Id@1000 : GUID;VAR RecRef@1001 : RecordRef;VAR Handled@1002 : Boolean);
    VAR
      DummyVendor@1004 : Record 23;
      GraphMgtGeneralTools@1007 : Codeunit 5465;
    BEGIN
      GraphMgtGeneralTools.HandleGetPredefinedIdValue(Id,RecRef,Handled,DATABASE::Vendor,DummyVendor.FIELDNO(Id));
    END;

    [EventSubscriber(Codeunit,5465,ApiSetup)]
    LOCAL PROCEDURE HandleApiSetup@16();
    BEGIN
      UpdateIntegrationRecords(FALSE);
      UpdateIds;
    END;

    PROCEDURE UpdateIds@6();
    VAR
      Vendor@1000 : Record 23;
    BEGIN
      WITH Vendor DO BEGIN
        IF FINDSET THEN
          REPEAT
            UpdateCurrencyId;
            UpdatePaymentTermsId;
            UpdatePaymentMethodId;
            MODIFY(FALSE);
          UNTIL NEXT = 0;
      END;
    END;

    BEGIN
    END.
  }
}

