OBJECT Codeunit 14000554 Day End (Yes/No)
{
  OBJECT-PROPERTIES
  {
    Date=12/15/17;
    Time=12:00:00 PM;
    Version List=UBP2.97;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            CreateUsage;

            CLEAR(GlobalUsageRedirect);
            GlobalUsageRedirect.Update;

            Location.RESET;
            Location.SETRANGE("Auto Process Day End",TRUE);
            Process;
          END;

  }
  CODE
  {
    VAR
      Text000@14000504 : TextConst 'ENU=Do you wish to process day end through %1 for the selected locations?';
      Location@1240030000 : Record 14;
      UsageLedCreate@1240030001 : Codeunit 14000552;
      GlobalUsageRedirect@1240430003 : Codeunit 14000573;

    PROCEDURE ProcDayEnd@4();
    BEGIN
      IF NOT CONFIRM(Text000,FALSE,CALCDATE('<-1D>',WORKDATE)) THEN
        EXIT;

      CreateUsage;

      CLEAR(GlobalUsageRedirect);
      GlobalUsageRedirect.Update;

      Location.RESET;
      Location.SETRANGE("Select Day End Processing",USERID);

      Process;
    END;

    PROCEDURE Process@1240030000();
    VAR
      DayEndCalc@1240030002 : Codeunit 14000555;
      VendPerfCalc@1240030000 : Codeunit 14000551;
    BEGIN
      IF Location.FIND('-') THEN
        REPEAT

          CLEAR(VendPerfCalc);
          VendPerfCalc.RUN(Location);
          COMMIT;

          CLEAR(DayEndCalc);
          DayEndCalc.RUN(Location);
          COMMIT;

        UNTIL Location.NEXT = 0;
    END;

    PROCEDURE CreateUsage@1240030003();
    BEGIN
      CLEAR(UsageLedCreate);
      UsageLedCreate.RUN;
    END;

    BEGIN
    END.
  }
}

