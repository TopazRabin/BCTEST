OBJECT Codeunit 51961 Codeunit1252EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    PROCEDURE Cu1252_MatchMulti_ExtDoc@1000000010(BankAccReconciliation@1003 : Record 273;DateRange@1008 : Integer);
    VAR
      TempBankStatementMatchingBuffer@1000 : TEMPORARY Record 1250;
      BankRecMatchCandidates@1001 : Query 1252;
      Window@1004 : Dialog;
      Score@1002 : Integer;
      PostedDeposit@1000000000 : Record 10143;
      BankAccRecLine@1000000001 : Record 274;
      BankAccountLedgerEntry@1000000002 : Record 271;
      BankAccLE@1000000003 : Record 271;
      BankAccEntrySetReconNo@1000000004 : Codeunit 375;
      PostedDepLine@1000000005 : Record 10144;
      ProgressBarMsg@1000000006 : TextConst 'ENU=Please wait while the operation is being completed.;ESM=Espere mientras se completa la operaci�n.;FRC=Veuillez patienter lors de l''ex�cution de l''op�ration.;ENC=Please wait while the operation is being completed.';
      Relation@1000000007 : 'One-to-One,One-to-Many';
      MatchBankRecLines@1000000008 : Codeunit 1252;
    BEGIN

      //<TPZ2249>
      Window.OPEN(ProgressBarMsg);
      BankAccRecLine.SETRANGE("Bank Account No.",BankAccReconciliation."Bank Account No.");
      BankAccRecLine.SETRANGE("Statement Type",BankAccReconciliation."Statement Type");
      BankAccRecLine.SETRANGE("Statement No.",BankAccReconciliation."Statement No.");
      BankAccRecLine.SETRANGE(Type,BankAccRecLine.Type::"Bank Account Ledger Entry");


      BankAccountLedgerEntry.SETRANGE("Bank Account No.",BankAccReconciliation."Bank Account No.");
      //BankAccountLedgerEntry.SETRANGE(Open,TRUE);
      BankAccountLedgerEntry.SETFILTER("External Document No.",'<>%1','');
      BankAccountLedgerEntry.SETRANGE("Statement Status",BankAccountLedgerEntry."Statement Status"::Open);
      IF BankAccountLedgerEntry.FINDSET THEN
         REPEAT
           PostedDeposit.RESET;
           PostedDeposit.SETRANGE("No.",COPYSTR(BankAccountLedgerEntry."External Document No.",1,20));
           IF PostedDeposit.FINDFIRST THEN
            BEGIN
              PostedDepLine.RESET;
              PostedDepLine.SETRANGE("Deposit No.",PostedDeposit."No.");
              IF PostedDepLine.FINDSET THEN
                  REPEAT

                    BankAccRecLine.SETFILTER("Statement Amount",FORMAT(PostedDeposit."Total Deposit Amount"));
                    IF BankAccRecLine.FINDFIRST THEN
                       BEGIN
                         BankAccLE.RESET;
                         BankAccLE.SETRANGE("Entry No.",PostedDepLine."Bank Account Ledger Entry No.");
                         BankAccLE.SETRANGE("Statement Status",BankAccLE."Statement Status"::Open);
                         IF BankAccLE.FINDFIRST THEN
                            BEGIN
                              BankAccEntrySetReconNo.ApplyEntries(BankAccRecLine,BankAccLE,Relation::"One-to-Many");
                            END;
                       END;
                 UNTIL PostedDepLine.NEXT =0;
              END;
        UNTIL BankAccountLedgerEntry.NEXT =0;


      Window.CLOSE;
      MatchBankRecLines.ShowMatchSummary(BankAccReconciliation); //NAVEVENT
      //</TPZ2249>
    END;

    BEGIN
    END.
  }
}

