OBJECT Codeunit 50005 E.D.I. Reports
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    TableNo=472;
    SingleInstance=Yes;
    OnRun=BEGIN
            CASE "Parameter String" OF
              'Outbound':
                EDIOutBoundErr;
              'InboundErr':
                EDIInBoundErr;
              'InboundConf_Puch':
                EDIInBoundConf_Purch;
              'InboundConf_Sales':
                EDIInBoundConf_Sales;
              'InboundConf_Sales_StkRep':
                EDIInBoundConf_SalesStkRep;

            END;
          END;

  }
  CODE
  {
    VAR
      Text0001@1000000004 : TextConst 'ENU=E.D.I. Administrator / Topaz IT';
      Text0002@1000000003 : TextConst 'ENU=Please find the Report attached in MS Excel Format.';
      Text0003@1000000002 : TextConst 'ENU=please find the PDF file Attached.';
      Text0004@1000000005 : TextConst 'ENU=Daily E.D.I. Exception Report';
      Text0005@1000000006 : TextConst 'ENU=Process ran successfully. No Errors to Report.';
      Text0006@1000000008 : TextConst 'ENU=An error has occured in processing. Please contact your EDI Admin. / IT';
      Excel@1000000001 : TextConst 'ENU=.xlsx';
      PDF@1000000000 : TextConst 'ENU=.pdf';
      ExcelFileRec@1000000007 : Record 2000000022;

    PROCEDURE EDIOutBoundErr@1000000003();
    VAR
      EDI_OB_ErrLogRep@1000000005 : Report 50031;
      MailVar@1000000004 : Codeunit 400;
      SMTP_Setup@1000000003 : Record 409;
      ReportUser@1000000002 : Record 50015;
    BEGIN
      //<TPZ1460>
      CLEAR(EDI_OB_ErrLogRep);
      SMTP_Setup.GET('');
      ReportUser.GET(FORMAT(COPYSTR(EDI_OB_ErrLogRep.OBJECTID(FALSE),8,15)));
      IF EDI_OB_ErrLogRep.SAVEASEXCEL(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel) THEN BEGIN
        ExcelFileRec.RESET;
        ExcelFileRec.SETRANGE(ExcelFileRec.Path,ReportUser."File Path");
        ExcelFileRec.SETRANGE(ExcelFileRec.Name,FORMAT(WORKDATE,0,5)+Excel);
        ExcelFileRec.SETRANGE("Is a file",TRUE);
        IF ExcelFileRec.FIND('-') THEN BEGIN
          MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDI_OB_ErrLogRep.OBJECTID(TRUE)),
                              FORMAT(Text0002),TRUE);

          MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel,
          //kvb VSO2064 11/16/17  ->
            FORMAT(WORKDATE,0,5)+Excel);
          //kvb VSO2064 11/16/17  <-
        END ELSE
          MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDI_OB_ErrLogRep.OBJECTID(TRUE)),
                              FORMAT(Text0005),TRUE);


      END ELSE BEGIN
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDI_OB_ErrLogRep.OBJECTID(TRUE)),
                              FORMAT(Text0006),TRUE);

      END;
      MailVar.Send;
      CLEAR(EDI_OB_ErrLogRep);
      //<TPZ1460>
    END;

    PROCEDURE EDIInBoundErr@1000000000();
    VAR
      EDI_IB_ErrLogRep@1000000003 : Report 50033;
      MailVar@1000000002 : Codeunit 400;
      SMTP_Setup@1000000001 : Record 409;
      ReportUser@1000000000 : Record 50015;
    BEGIN
      //<TPZ1460>

      CLEAR(EDI_IB_ErrLogRep);
      SMTP_Setup.GET('');
      ReportUser.GET(FORMAT(COPYSTR(EDI_IB_ErrLogRep.OBJECTID(FALSE),8,15)));
      IF EDI_IB_ErrLogRep.SAVEASEXCEL(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel) THEN BEGIN
        ExcelFileRec.RESET;
        ExcelFileRec.SETRANGE(ExcelFileRec.Path,ReportUser."File Path");
        ExcelFileRec.SETRANGE(ExcelFileRec.Name,FORMAT(WORKDATE,0,5)+Excel);
        ExcelFileRec.SETRANGE("Is a file",TRUE);
        IF ExcelFileRec.FIND('-') THEN BEGIN

          MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                                FORMAT(Text0004 + ':' + EDI_IB_ErrLogRep.OBJECTID(TRUE)),
                                FORMAT(Text0002),TRUE);
          MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel,
          //kvb VSO2064 11/16/17  ->
            FORMAT(WORKDATE,0,5)+Excel);
          //kvb VSO2064 11/16/17  <-
        END ELSE
          MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                                FORMAT(Text0004 + ':' + EDI_IB_ErrLogRep.OBJECTID(TRUE)),
                                FORMAT(Text0005),TRUE);

      END ELSE BEGIN
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDI_IB_ErrLogRep.OBJECTID(TRUE)),
                              FORMAT(Text0006),TRUE);

      END;
      MailVar.Send;
      CLEAR(EDI_IB_ErrLogRep);
      //<TPZ1460>
    END;

    PROCEDURE EDIInBoundConf_Purch@1000000001();
    VAR
      EDIRecDocHdr@1000000000 : Record 14002358;
      EDIInBoundConf_Rep@1000000001 : Report 50057;
      MailVar@1000000007 : Codeunit 400;
      SMTP_Setup@1000000006 : Record 409;
      ReportUser@1000000005 : Record 50015;
    BEGIN
      //<TPZ1460>
      CLEAR(EDIInBoundConf_Rep);
      SMTP_Setup.GET('');
      ReportUser.GET(FORMAT(COPYSTR(EDIInBoundConf_Rep.OBJECTID(FALSE),8,15)));
      EDIRecDocHdr.SETFILTER(EDIRecDocHdr."Vendor No.",'<>%1', '');
      IF EDIInBoundConf_Rep.SAVEASEXCEL(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel) THEN BEGIN
        CLEAR(EDIInBoundConf_Rep);
        //EDI_OB_ErrLogRep.SAVEASPDF(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+PDF);
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDIInBoundConf_Rep.OBJECTID(TRUE)),
                              FORMAT(Text0002),TRUE);
        MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel,
          //kvb VSO2064 11/16/17  ->
            FORMAT(WORKDATE,0,5)+Excel);
          //kvb VSO2064 11/16/17  <-
        //MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+PDF);
        MailVar.Send;
      END ELSE BEGIN
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDIInBoundConf_Rep.OBJECTID(TRUE)),
                              FORMAT(Text0005),TRUE);

      END;
      CLEAR(EDIInBoundConf_Rep);
      //<TPZ1460>
    END;

    PROCEDURE EDIInBoundConf_Sales@1000000006();
    VAR
      EDIRecDocHdr@1000000000 : Record 14002358;
      EDIInBoundConf_Rep@1000000001 : Report 50057;
      MailVar@1000000004 : Codeunit 400;
      SMTP_Setup@1000000003 : Record 409;
      ReportUser@1000000002 : Record 50015;
    BEGIN
      {//<TPZ1460>
      CLEAR(EDIInBoundConf_Rep);
      SMTP_Setup.GET('');
      ReportUser.GET(FORMAT(COPYSTR(EDIInBoundConf_Rep.OBJECTID(FALSE),8,15)));
      IF EDIInBoundConf_Rep.SAVEASEXCEL(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel) THEN BEGIN
        CLEAR(EDIInBoundConf_Rep);
        //EDI_OB_ErrLogRep.SAVEASPDF(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+PDF);
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDIInBoundConf_Rep.OBJECTID(TRUE)),
                              FORMAT(Text0002),TRUE);
        MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel);
        //MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+PDF);
        MailVar.Send;
      END ELSE BEGIN
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDIInBoundConf_Rep.OBJECTID(TRUE)),
                              FORMAT(Text0005),TRUE);

      END;
      CLEAR(EDI_IB_ErrLogRep);
      //<TPZ1460> }
    END;

    PROCEDURE EDIInBoundConf_SalesStkRep@1000000007();
    VAR
      EDIRecDocHdr@1000000000 : Record 14002358;
      EDIInBoundConf_Rep@1000000001 : Report 50057;
      MailVar@1000000004 : Codeunit 400;
      SMTP_Setup@1000000003 : Record 409;
      ReportUser@1000000002 : Record 50015;
    BEGIN
      {//<TPZ1460>
      CLEAR(EDIInBoundConf_Rep);
      SMTP_Setup.GET('');
      ReportUser.GET(FORMAT(COPYSTR(EDIInBoundConf_Rep.OBJECTID(FALSE),8,15)));
      IF EDIInBoundConf_Rep.SAVEASEXCEL(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel) THEN BEGIN
        CLEAR(EDIInBoundConf_Rep);
        //EDI_OB_ErrLogRep.SAVEASPDF(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+PDF);
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDIInBoundConf_Rep.OBJECTID(TRUE)),
                              FORMAT(Text0002),TRUE);
        MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+Excel);
        //MailVar.AddAttachment(ReportUser."File Path"+FORMAT(WORKDATE,0,5)+PDF);
        MailVar.Send;
      END ELSE BEGIN
        MailVar.CreateMessage(Text0001,SMTP_Setup."From Address",ReportUser."User Email",
                              FORMAT(Text0004 + ':' + EDIInBoundConf_Rep.OBJECTID(TRUE)),
                              FORMAT(Text0005),TRUE);

      END;
      CLEAR(EDI_IB_ErrLogRep);
      //<TPZ1460>}
    END;

    BEGIN
    {
      2016-03-22 SDESAI
       Codeunit has been created
      2016-03-23 TPZ1460 SDESAI
       - E.D.I. Outbound Error Log Reporting. Report delivered via E-mail in MS Excel Format
         to users ref. in the Report User Table
      2017-11-16  kvb VSO2064
        One more parameter was added to the MailVar.AddAttachment function
    }
    END.
  }
}

