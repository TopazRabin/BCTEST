OBJECT Codeunit 50072 Cubiscan Upload
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            FileRec.RESET;
            FileRec.SETRANGE(Path,'\\NYSVDC3\Public\CUBI\Cubi_NY');
            FileRec.SETRANGE(FileRec."Is a file", TRUE);
            IF FileRec.FINDSET THEN REPEAT
              FileVar.OPEN(FileRec.Path+'\'+FileRec.Name);
              FileVar.CREATEINSTREAM(XMLInstream);
              XMLPORT.IMPORT(XMLPORT::"Cubi Scan Upload",XMLInstream);
              FileVar.CLOSE;
              FILE.COPY(FileRec.Path+'\'+FileRec.Name,FileRec.Path+'\Archive\'+FileRec.Name);
              FILE.ERASE(FileRec.Path+'\'+FileRec.Name);
              CreateOutputFile(FileRec.Path,FileRec.Name);
            UNTIL FileRec.NEXT=0;

             FileRec.RESET;
             FileRec.SETRANGE(Path,'\\NYSVDC3\Public\CUBI\Cubi_JAX');
             FileRec.SETRANGE(FileRec."Is a file", TRUE);
             IF FileRec.FINDSET THEN REPEAT
              FileVar.OPEN(FileRec.Path+'\'+FileRec.Name);
              FileVar.CREATEINSTREAM(XMLInstream);
              XMLPORT.IMPORT(XMLPORT::"Cubi Scan Upload",XMLInstream);
              FileVar.CLOSE;
              FILE.COPY(FileRec.Path+'\'+FileRec.Name,FileRec.Path+'\Archive\'+FileRec.Name);
              FILE.ERASE(FileRec.Path+'\'+FileRec.Name);
              CreateOutputFile(FileRec.Path,FileRec.Name);
             UNTIL FileRec.NEXT=0;

             FileRec.RESET;
             FileRec.SETRANGE(Path,'\\NYSVDC3\Public\CUBI\Cubi_PA');
             FileRec.SETRANGE(FileRec."Is a file", TRUE);
             IF FileRec.FINDSET THEN REPEAT
              FileVar.OPEN(FileRec.Path+'\'+FileRec.Name);
              FileVar.CREATEINSTREAM(XMLInstream);
              XMLPORT.IMPORT(XMLPORT::"Cubi Scan Upload",XMLInstream);
              FileVar.CLOSE;
              FILE.COPY(FileRec.Path+'\'+FileRec.Name,FileRec.Path+'\Archive\'+FileRec.Name);
              FILE.ERASE(FileRec.Path+'\'+FileRec.Name);
              CreateOutputFile(FileRec.Path,FileRec.Name);
             UNTIL FileRec.NEXT=0;
          END;

  }
  CODE
  {
    VAR
      FileRec@1000000000 : Record 2000000022;
      XMLInstream@1000000001 : InStream;
      FileVar@1000000002 : File;
      ExcelBuffer@1000000004 : Record 370;

    LOCAL PROCEDURE CreateOutputFile@1000000000(FilePath@1000000000 : Text;FileName@1000000001 : Text);
    BEGIN
      ExcelBuffer.CreateBook('', 'Cubi Scan Upload');
      ExcelBuffer.WriteSheet('Cubi Scan Upload', COMPANYNAME, USERID);
      ExcelBuffer.CloseBook;
      //ExcelBuffer.DownloadBookToClient(FilePath+'\Output\'+ ' upload log '+FileName+'.xlsx');
      ExcelBuffer.MoveBookInServer(FilePath+'\Output\'+ ' upload log '+FileName+'.xlsx');
      ExcelBuffer.DELETEALL;
    END;

    BEGIN
    END.
  }
}

