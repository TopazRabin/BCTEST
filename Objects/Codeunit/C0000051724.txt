OBJECT Codeunit 51724 Table5766EventSubscriber
{
  OBJECT-PROPERTIES
  {
    Date=02/18/21;
    Time=[ 4:33:18 AM];
    Modified=Yes;
    Version List=NAVEVENT;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {

    [EventSubscriber(Table,5766,OnBeforeInsertEvent)]
    PROCEDURE Tb5766_OnInsert@1000000013(VAR Rec@1000000000 : Record 5766;RunTrigger@1000000001 : Boolean);
    BEGIN
      IF NOT RunTrigger THEN
        EXIT;
      WITH Rec DO BEGIN
        //TM BEG 061615
        "Last Modified User ID" := USERID;
        "Last Modified Date" := TODAY;
        "Last Modified Time" := TIME;
         //TM END 061615
      END;
    END;

    [EventSubscriber(Table,5766,OnBeforeModifyEvent)]
    PROCEDURE Tb5766_OnModify@1000000015(VAR Rec@1000000000 : Record 5766;VAR xRec@1000000001 : Record 5766;RunTrigger@1000000002 : Boolean);
    BEGIN
      IF NOT RunTrigger THEN
        EXIT;
      WITH Rec DO BEGIN
        //TM BEG 061615
        "Last Modified User ID" := USERID;
        "Last Modified Date" := TODAY;
        "Last Modified Time" := TIME;
        //TM END 061615
      END;
    END;

    [EventSubscriber(Table,5766,OnBeforeDeleteEvent)]
    PROCEDURE Tb5766_OnDelete@1000000000(VAR Rec@1000000000 : Record 5766;RunTrigger@1000000001 : Boolean);
    VAR
      WhseActivLine2@1000000002 : Record 5767;
      WhseActivLine3@1000000003 : Record 5767;
      WhseRequest@1000000004 : Record 5765;
      OutWhseReqMgt@1000000005 : Codeunit 14002863;
    BEGIN
      IF NOT RunTrigger THEN
        EXIT;
      WhseActivLine2.SETRANGE("Activity Type",Rec.Type);
      WhseActivLine2.SETRANGE("No.",Rec."No.");
      IF WhseActivLine2.FINDFIRST THEN BEGIN
        WhseActivLine3.RESET;
        WhseActivLine3.SETCURRENTKEY("Source Type","Source Subtype","Source No.");
        WhseActivLine3.SETRANGE("Activity Type", WhseActivLine2."Activity Type");
        //WhseActivLine3.SETRANGE("Location Code", WhseActivLine2."Location Code");
        WhseActivLine3.SETRANGE("Source Type", WhseActivLine2."Source Type");
        WhseActivLine3.SETRANGE("Source Subtype", WhseActivLine2."Source Subtype");
        WhseActivLine3.SETRANGE("Source No.", WhseActivLine2."Source No.");
        WhseActivLine3.SETFILTER("No.", '<>%1', WhseActivLine2."No.");
        IF WhseActivLine3.ISEMPTY THEN BEGIN
          WhseRequest.SETCURRENTKEY("Source Type","Source Subtype","Source No.");
          //WhseRequest.SETRANGE("Location Code", WhseActivLine2."Location Code");
          WhseRequest.SETFILTER("Location Code", '<>%1','');//VSO2950
          WhseRequest.SETRANGE("Source Subtype", WhseActivLine2."Source Subtype");
          WhseRequest.SETRANGE("Source Type", WhseActivLine2."Source Type");
          WhseRequest.SETRANGE("Source No.", WhseActivLine2."Source No.");
          IF WhseRequest.FINDFIRST THEN BEGIN
            OutWhseReqMgt.SetWhseActivStatusToBlank(WhseRequest);
            WhseRequest.MODIFY;
          END;
        END;
      END;
    END;

    BEGIN
    {
      TPZ2830  PSHUKLA
    }
    END.
  }
}

