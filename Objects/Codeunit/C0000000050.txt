OBJECT Codeunit 50 SaaS Log In Management
{
  OBJECT-PROPERTIES
  {
    Date=11/22/17;
    Time=12:00:00 PM;
    Version List=NAVW111.00;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      NoPermissionToEnterTrialErr@1003 : TextConst '@@@="%1 = Company Name";ENU=In order to open %1, your company must start a trial. You must be an administrator to enter the trial period.;ESM=Para poder abrir %1, su empresa debe comenzar una prueba. Debe ser administrador para poder introducir el per¡odo de prueba.;FRC=Pour pouvoir ouvrir %1, votre compagnie doit d‚marrer une version d''‚valuation. Vous devez ˆtre un administrateur pour commencer la p‚riode d''‚valuation.;ENC=In order to open %1, your company must start a trial. You must be an administrator to enter the trial period.';

    LOCAL PROCEDURE ShowTermsAndConditions@1(Company@1000 : Record 2000000006);
    VAR
      TenantLicenseState@1002 : Record 2000000189;
      PermissionManager@1003 : Codeunit 9002;
      RoleCenterNotificationMgt@1004 : Codeunit 1430;
      ThirtyDayTrialDialog@1001 : Page 9193;
    BEGIN
      IF PermissionManager.IsSandboxConfiguration THEN
        EXIT;

      IF PermissionManager.IsPreview THEN
        EXIT;

      IF NOT PermissionManager.SoftwareAsAService THEN
        EXIT;

      IF Company."Evaluation Company" THEN
        EXIT;

      IF TenantLicenseState.FINDLAST THEN BEGIN
        IF TenantLicenseState.State <> TenantLicenseState.State::Evaluation THEN
          EXIT;
      END;

      // Verify, that the user has company setup rights
      IF NOT Company.WRITEPERMISSION THEN
        ERROR(NoPermissionToEnterTrialErr,Company.Name);

      COMMIT;
      ThirtyDayTrialDialog.RUNMODAL;

      IF NOT ThirtyDayTrialDialog.Confirmed THEN BEGIN
        IF RoleCenterNotificationMgt.IsEvaluationNotificationClicked THEN
          RoleCenterNotificationMgt.ShowEvaluationNotification;
        ERROR('');
      END;
    END;

    [EventSubscriber(Table,2000000073,OnBeforeValidateEvent,Company)]
    LOCAL PROCEDURE OnBeforeUserPersonalizationCompanyChange@2(VAR Rec@1000 : Record 2000000073;VAR xRec@1001 : Record 2000000073;CurrFieldNo@1003 : Integer);
    VAR
      Company@1002 : Record 2000000006;
    BEGIN
      IF Company.GET(Rec.Company) THEN
        ShowTermsAndConditions(Company);
    END;

    BEGIN
    END.
  }
}

