OBJECT Codeunit 51991 Select ParameterString
{
  OBJECT-PROPERTIES
  {
    Date=08/10/21;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00,001;
  }
  PROPERTIES
  {
    TableNo=472;
    OnRun=VAR
            NotificationManagement@1000000000 : Codeunit 1510;
            PurchaseHeader@1000000001 : Record 38;
            ApprovalEntry@1000000002 : Record 454;
          BEGIN
            //>>001 TPZ3134
            IF PurchaseHeader.GET(PurchaseHeader."Document Type"::Order,Description)THEN;
            IF "Parameter String" = 'Approved' THEN BEGIN
              ApprovalEntry.SETRANGE("Document No.",Description);
              ApprovalEntry.SETRANGE(Status,ApprovalEntry.Status::Approved);
              IF ApprovalEntry.FINDFIRST THEN;
              NotificationManagement.SendPurchaseApprovedMail(PurchaseHeader,ApprovalEntry);
            END ELSE IF "Parameter String" = 'Rejected' THEN BEGIN
              ApprovalEntry.SETRANGE("Document No.",Description);
              ApprovalEntry.SETRANGE(Status,ApprovalEntry.Status::Rejected);
              IF ApprovalEntry.FINDFIRST THEN;
              NotificationManagement.SendPurchaseRejectedMailManual(PurchaseHeader,ApprovalEntry);
            END ELSE IF "Parameter String" = 'Delegated' THEN BEGIN
              ApprovalEntry.SETRANGE("Document No.",Description);
              //ApprovalEntry.SETRANGE(Status,ApprovalEntry.Status::Open);
              ApprovalEntry.SETRANGE("Sequence No.",2);
              IF ApprovalEntry.FINDFIRST THEN;
              NotificationManagement.SendPurchaseDelegationsMail(PurchaseHeader,ApprovalEntry);
            END ELSE IF "Parameter String" = 'DelegatedAway' THEN BEGIN
              ApprovalEntry.SETRANGE("Document No.",Description);
              //ApprovalEntry.SETRANGE(Status,ApprovalEntry.Status::Open);
              ApprovalEntry.SETRANGE("Sequence No.",2);
              IF ApprovalEntry.FINDFIRST THEN;
              NotificationManagement.SendPurchaseDelegationsAwayMail(PurchaseHeader,ApprovalEntry);
            //>>RPS for Sherrie - 3rd approver
            END ELSE IF "Parameter String" = 'DelegatedAway2' THEN BEGIN
              ApprovalEntry.SETRANGE("Document No.",Description);
              ApprovalEntry.SETRANGE("Sequence No.",2);
              IF ApprovalEntry.FINDFIRST THEN;
              NotificationManagement.SendPurchaseDelegationsAwayMail(PurchaseHeader,ApprovalEntry);
            //<<RPS
            END ELSE IF "Parameter String" = 'SendApprovalRequest' THEN BEGIN
              NotificationManagement.SendPurchaseApprovalRequestMail(PurchaseHeader,ApprovalEntry);
            END;
            //<<001 TPZ3134
          END;

  }
  CODE
  {

    BEGIN
    {
      001 TPZ3134 RPS 05112021 - Workflow setup for PO approvals
    }
    END.
  }
}

