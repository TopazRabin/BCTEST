OBJECT Table 14002406 E.D.I. Status Code
{
  OBJECT-PROPERTIES
  {
    Date=07/07/17;
    Time=12:00:00 PM;
    Version List=SE0.60.14;
  }
  PROPERTIES
  {
    CaptionML=ENU=E.D.I. Status Code;
    LookupPageID=Page14002408;
    DrillDownPageID=Page14002408;
  }
  FIELDS
  {
    { 1   ;   ;Trade Partner No.   ;Code20        ;TableRelation="E.D.I. Trade Partner".No.;
                                                   CaptionML=ENU=Trade Partner No. }
    { 2   ;   ;EDI Document No.    ;Code30        ;CaptionML=ENU=EDI Document No. }
    { 3   ;   ;Type                ;Option        ;CaptionML=ENU=Type;
                                                   OptionCaptionML=ENU=" ,Status,Reason";
                                                   OptionString=[ ,Status,Reason] }
    { 4   ;   ;Sequence            ;Integer       ;CaptionML=ENU=Sequence }
    { 5   ;   ;Code                ;Code10        ;CaptionML=ENU=Code }
    { 6   ;   ;Default             ;Boolean       ;OnValidate=BEGIN
                                                                RecordFound := FALSE;

                                                                GetEDIDocumentNo;

                                                                IF Default = TRUE THEN BEGIN
                                                                  IF (Header = FALSE) AND (Line = FALSE) THEN
                                                                    ERROR(Text002,Type);
                                                                  IF Header = TRUE THEN BEGIN
                                                                    EDIStatusCode.RESET;
                                                                    EDIStatusCode.SETRANGE("Trade Partner No.","Trade Partner No.");
                                                                    EDIStatusCode.SETRANGE("EDI Document No.",EDIDocument."EDI Document No.");
                                                                    EDIStatusCode.SETRANGE(Type,Type);
                                                                    EDIStatusCode.SETRANGE(Header,TRUE);
                                                                    EDIStatusCode.SETRANGE(Default,TRUE);
                                                                    IF EDIStatusCode.FIND('-') THEN
                                                                      REPEAT
                                                                        IF (Rec.Code = EDIStatusCode.Code) AND (Rec.Sequence = EDIStatusCode.Sequence) THEN
                                                                          RecordFound := FALSE
                                                                        ELSE
                                                                          RecordFound := TRUE;
                                                                      UNTIL (EDIStatusCode.NEXT = 0) OR (RecordFound = TRUE);
                                                                    IF RecordFound THEN
                                                                      ERROR(
                                                                        Text003,
                                                                        EDIStatusCode.Code,EDIStatusCode.Sequence,EDIStatusCode.Type,EDIDocument."EDI Document No.");
                                                                  END;
                                                                  IF (Line = TRUE) THEN BEGIN
                                                                    EDIStatusCode.RESET;
                                                                    EDIStatusCode.SETRANGE("Trade Partner No.","Trade Partner No.");
                                                                    EDIStatusCode.SETRANGE("EDI Document No.",EDIDocument."EDI Document No.");
                                                                    EDIStatusCode.SETRANGE(Type,Type);
                                                                    EDIStatusCode.SETRANGE(Line,TRUE);
                                                                    EDIStatusCode.SETRANGE(Default,TRUE);
                                                                    IF EDIStatusCode.FIND('-') THEN
                                                                      REPEAT
                                                                        IF (Rec.Code = EDIStatusCode.Code) AND (Rec.Sequence = EDIStatusCode.Sequence) THEN
                                                                          RecordFound := FALSE
                                                                        ELSE
                                                                          RecordFound := TRUE
                                                                      UNTIL (EDIStatusCode.NEXT = 0) OR (RecordFound = TRUE);
                                                                    IF RecordFound THEN
                                                                      ERROR(
                                                                        Text004,
                                                                        EDIStatusCode.Code,EDIStatusCode.Sequence,EDIStatusCode.Type,EDIDocument."EDI Document No.");
                                                                  END;
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Default }
    { 7   ;   ;Header Status Send Only;Boolean    ;OnValidate=BEGIN
                                                                TESTFIELD(Line,FALSE);
                                                              END;

                                                   CaptionML=ENU=Header Status Send Only }
    { 11  ;   ;Description         ;Text30        ;CaptionML=ENU=Description }
    { 12  ;   ;Expected Date Required;Boolean     ;CaptionML=ENU=Expected Date Required }
    { 13  ;   ;Header              ;Boolean       ;OnValidate=BEGIN
                                                                RecordFound := FALSE;

                                                                GetEDIDocumentNo;

                                                                IF (Header = TRUE) AND (Default = TRUE) THEN BEGIN
                                                                  EDIStatusCode.RESET;
                                                                  EDIStatusCode.SETRANGE("Trade Partner No.","Trade Partner No.");
                                                                  EDIStatusCode.SETRANGE("EDI Document No.",EDIDocument."EDI Document No.");
                                                                  EDIStatusCode.SETRANGE(Type,Type);
                                                                  EDIStatusCode.SETRANGE(Header,TRUE);
                                                                  EDIStatusCode.SETRANGE(Default,TRUE);
                                                                  IF EDIStatusCode.FIND('-') THEN
                                                                    REPEAT
                                                                      IF (Rec.Code = EDIStatusCode.Code) AND (Rec.Sequence = EDIStatusCode.Sequence) THEN
                                                                        RecordFound := FALSE
                                                                      ELSE
                                                                        RecordFound := TRUE;
                                                                    UNTIL (EDIStatusCode.NEXT = 0) OR (RecordFound = TRUE);
                                                                  IF RecordFound THEN
                                                                    ERROR(
                                                                      Text003,
                                                                      EDIStatusCode.Code,EDIStatusCode.Sequence,EDIStatusCode.Type,EDIDocument."EDI Document No.");
                                                                END;

                                                                IF (Header = FALSE) AND (Line = FALSE) AND (Default = TRUE) THEN
                                                                  Default := FALSE;
                                                              END;

                                                   CaptionML=ENU=Header }
    { 14  ;   ;Line                ;Boolean       ;OnValidate=BEGIN
                                                                TESTFIELD("Header Status Send Only",FALSE);
                                                                RecordFound := FALSE;

                                                                GetEDIDocumentNo;

                                                                IF (Line = TRUE) AND (Default = TRUE) THEN BEGIN
                                                                    EDIStatusCode.RESET;
                                                                    EDIStatusCode.SETRANGE("Trade Partner No.","Trade Partner No.");
                                                                    EDIStatusCode.SETRANGE("EDI Document No.",EDIDocument."EDI Document No.");
                                                                    EDIStatusCode.SETRANGE(Type,Type);
                                                                    EDIStatusCode.SETRANGE(Line,TRUE);
                                                                    EDIStatusCode.SETRANGE(Default,TRUE);
                                                                    IF EDIStatusCode.FIND('-') THEN
                                                                      REPEAT
                                                                        IF (Rec.Code = EDIStatusCode.Code) AND (Rec.Sequence = EDIStatusCode.Sequence) THEN
                                                                          RecordFound := FALSE
                                                                        ELSE
                                                                          RecordFound := TRUE
                                                                      UNTIL (EDIStatusCode.NEXT = 0) OR (RecordFound = TRUE);
                                                                    IF RecordFound THEN
                                                                      ERROR(
                                                                        Text004,
                                                                        EDIStatusCode.Code,EDIStatusCode.Sequence,EDIStatusCode.Type,EDIDocument."EDI Document No.");
                                                                  END;

                                                                IF (Line = FALSE) AND (Header = FALSE) AND (Default = TRUE) THEN
                                                                  Default := FALSE;
                                                              END;

                                                   CaptionML=ENU=Line }
    { 15  ;   ;Clear Line Codes    ;Boolean       ;CaptionML=ENU=Clear Line Codes }
    { 17  ;   ;Action Message      ;Text30        ;OnLookup=BEGIN
                                                              IF (Header = FALSE) AND (Line = FALSE) THEN
                                                                ERROR(Text005);
                                                              "Action Message" := GetActionMessage;
                                                            END;

                                                   CaptionML=ENU=Action Message }
  }
  KEYS
  {
    {    ;Trade Partner No.,EDI Document No.,Type,Sequence,Code;
                                                   Clustered=Yes }
  }
  FIELDGROUPS
  {
    { 1   ;DropDown            ;EDI Document No.,Type,Code,Description   }
  }
  CODE
  {
    VAR
      Text001@1240020003 : TextConst 'ENU=An active EDI Document was not found for Trading Partner %1.\Navision Document No. for EDI Document No. %2 must be one of the following %3 when enabling the default setting.';
      Text002@1240020002 : TextConst 'ENU=%1 code must be marked as Header and/or Line before code can be set as a default';
      Text003@1240020001 : TextConst 'ENU=EDI Status Code %1 Sequence No. %2 is set as the default header level %3 code for EDI Document No. %4';
      Text004@1240020000 : TextConst 'ENU=EDI Status Code %1 Sequence No. %2 is set as the default line level %3 code for EDI Document No. %4';
      EDIStatusCode@1240020006 : Record 14002406;
      EDIDocument@1240020005 : Record 14002353;
      RecordFound@1240020004 : Boolean;
      Text005@1240020007 : TextConst 'ENU=EDI Status Code must be defined as Header and/or Line before Message Action Code can be set.';

    PROCEDURE GetEDIDocumentNo@1240030000();
    VAR
      ValidNAVDoc@1240020000 : Text[80];
    BEGIN
      ValidNAVDoc := 'E_SLSSTA, E_SLSPOC, E_ADVPOA, I_INVADJ, I_FUNCTACK';
      EDIDocument.RESET;
      EDIDocument.SETRANGE("Trade Partner No.","Trade Partner No.");
      EDIDocument.SETFILTER(Status,'%1|%2',EDIDocument.Status::Test,EDIDocument.Status::Production);
      EDIDocument.SETRANGE("EDI Document No.","EDI Document No.");
      EDIDocument.SETFILTER(
        "Navision Document",'%1|%2|%3|%4|%5','E_SLSSTA','E_SLSPOC','E_ADVPOA','I_INVADJ','I_FUNCTACK');
      IF NOT EDIDocument.FIND('-') THEN
        ERROR(
          Text001,"Trade Partner No.","EDI Document No.",ValidNAVDoc);
    END;

    LOCAL PROCEDURE GetActionMessage@1240020001() : Code[30];
    VAR
      EDIActionMessage@1240020000 : Record 14002381;
    BEGIN
      EDIDocument.RESET;
      EDIDocument.SETRANGE("Trade Partner No.","Trade Partner No.");
      EDIDocument.SETFILTER(Status,'%1|%2',EDIDocument.Status::Test,EDIDocument.Status::Production);
      EDIDocument.SETRANGE("EDI Document No.","EDI Document No.");
      IF EDIDocument.FIND('-') THEN BEGIN
        EDIActionMessage.RESET;
        EDIActionMessage.SETRANGE("Navision Document",EDIDocument."Navision Document");
        CASE TRUE OF
          Header:
            EDIActionMessage.SETRANGE(Header,TRUE);
          Line:
            EDIActionMessage.SETRANGE(Line,Line);
        END;
        CASE EDIDocument."Navision Document" OF
          'E_FUNCTACK':
            EDIActionMessage.SETRANGE(Process,EDIActionMessage.Process::Response)
        END;
        IF PAGE.RUNMODAL(0,EDIActionMessage) IN [ACTION::LookupOK,ACTION::OK] THEN
          EXIT(EDIActionMessage.Action)
        ELSE
          EXIT("Action Message");
      END ELSE
        ERROR(Text001,"Trade Partner No.");
    END;

    BEGIN
    END.
  }
}

