OBJECT Table 14000563 Vendor Buying Calendar
{
  OBJECT-PROPERTIES
  {
    Date=09/28/20;
    Time=[ 9:07:21 AM];
    Modified=Yes;
    Version List=UBP3.03,TPZ;
  }
  PROPERTIES
  {
    OnDelete=VAR
               ProcUnit@1240020000 : Record 14000555;
               SugOrderHeader@1240020001 : Record 14000565;
               VendBuyingCalendar@1240020002 : Record 14000563;
               DocNumber@1240020003 : Code[20];
             BEGIN
               ProcUnit.SETCURRENTKEY("Location Code", "Replenishment Source Type", "Replenishment Source Code");
               ProcUnit.SETRANGE("Location Code", "Location Code");
               ProcUnit.SETRANGE("Replenishment Source Type", ProcUnit."Replenishment Source Type"::Vendor);
               ProcUnit.SETRANGE("Replenishment Source Code", "Vendor No.");
               ProcUnit.SETRANGE("Division Code", "Division Code");
               IF NOT ProcUnit.ISEMPTY THEN
                   ERROR(Text002);
               IF "Procurement Group Code" = '' THEN BEGIN
                   IF "Division Code" <> '' THEN
                       DocNumber := "Location Code" + "Division Code"
                   ELSE
                       DocNumber := "Location Code";
                   SugOrderHeader.SETRANGE("Buy-from Vendor No.", "Vendor No.");
                   SugOrderHeader.SETRANGE("No.", DocNumber);
                   IF SugOrderHeader.FINDFIRST() THEN
                       SugOrderHeader.DELETE(TRUE);
               END ELSE BEGIN
                   VendBuyingCalendar.SETRANGE("Vendor No.", "Vendor No.");
                   VendBuyingCalendar.SETRANGE("Procurement Group Code", "Procurement Group Code");
                   IF (VendBuyingCalendar.COUNT = 1) THEN BEGIN
                       DocNumber := "Procurement Group Code";
                       SugOrderHeader.SETRANGE("Buy-from Vendor No.", "Vendor No.");
                       SugOrderHeader.SETRANGE("No.", DocNumber);
                       IF SugOrderHeader.FINDFIRST() THEN
                           SugOrderHeader.DELETE(TRUE);
                   END;
               END;
             END;

    OnRename=BEGIN
               ERROR(Text001);
             END;

    CaptionML=ENU=Vendor Buying Calendar;
    LookupPageID=Page14000572;
    DrillDownPageID=Page14000572;
  }
  FIELDS
  {
    { 1   ;   ;Vendor No.          ;Code20        ;TableRelation=Vendor.No.;
                                                   CaptionML=ENU=Vendor No. }
    { 2   ;   ;Location Code       ;Code10        ;TableRelation=Location.Code;
                                                   CaptionML=ENU=Location Code }
    { 3   ;   ;Division Code       ;Code10        ;CaptionML=ENU=Division Code }
    { 11  ;   ;Purchaser Code      ;Code20        ;TableRelation=Salesperson/Purchaser.Code;
                                                   CaptionML=ENU=Purchaser Code }
    { 12  ;   ;Procurement Group Code;Code20      ;TableRelation="Procurement Group".Code WHERE (Vendor No.=FIELD(Vendor No.));
                                                   CaptionML=ENU=Procurement Group Code }
    { 13  ;   ;Gross Weight Target ;Decimal       ;CaptionML=ENU=Gross Weight Target;
                                                   DecimalPlaces=0:5 }
    { 14  ;   ;Net Weight Target   ;Decimal       ;CaptionML=ENU=Net Weight Target;
                                                   DecimalPlaces=0:5 }
    { 15  ;   ;Volume Target       ;Decimal       ;CaptionML=ENU=Volume Target;
                                                   DecimalPlaces=0:4 }
    { 16  ;   ;Amount Target       ;Decimal       ;OnValidate=BEGIN
                                                                CalcReviewCycle;
                                                              END;

                                                   CaptionML=ENU=Amount Target }
    { 17  ;   ;Line Buy Vendor     ;Boolean       ;CaptionML=ENU=Line Buy Vendor }
    { 18  ;   ;Review Cycle (Days) ;Integer       ;CaptionML=ENU=Review Cycle (Days);
                                                   Editable=No }
    { 19  ;   ;Frozen Review Cycle (Days);Integer ;OnValidate=BEGIN
                                                                CalcReviewCycle;
                                                              END;

                                                   CaptionML=ENU=Frozen Review Cycle (Days) }
    { 22  ;   ;Next Review Date    ;Date          ;CaptionML=ENU=Next Review Date;
                                                   Editable=No }
    { 23  ;   ;Last Review Date    ;Date          ;OnValidate=BEGIN
                                                                IF "Last Review Date" <> 0D THEN
                                                                  "Next Review Date" := CALCDATE(STRSUBSTNO('<+%1D>',"Review Cycle (Days)"),"Last Review Date")
                                                                ELSE
                                                                  "Next Review Date" := 0D;
                                                              END;

                                                   CaptionML=ENU=Last Review Date }
    { 24  ;   ;Annual Purchases    ;Decimal       ;FieldClass=Normal;
                                                   CaptionML=ENU=Annual Purchases;
                                                   Editable=No }
    { 25  ;   ;Proj. Annual Purchases;Decimal     ;OnValidate=BEGIN
                                                                CalcReviewCycle;
                                                              END;

                                                   CaptionML=ENU=Proj. Annual Purchases }
    { 26  ;   ;Date Filter         ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Date Filter }
    { 27  ;   ;Created by Period End;Boolean      ;CaptionML=ENU=Created by Period End }
    { 28  ;   ;Vendor Purch. Requirements Met;Boolean;
                                                   CaptionML=ENU=Vendor Purch. Requirements Met;
                                                   Editable=No }
    { 30  ;   ;Suggested Order Exists;Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Suggested Order Line" WHERE (Buy-from Vendor No.=FIELD(Vendor No.),
                                                                                                   Document No.=FIELD(Doc. No. Filter)));
                                                   CaptionML=ENU=Suggested Order Exists;
                                                   Editable=No }
    { 31  ;   ;Default Repl. Location Code;Code10 ;TableRelation=Location.Code WHERE (Use As In-Transit=CONST(No));
                                                   OnValidate=BEGIN
                                                                IF "Location Code" = "Default Repl. Location Code" THEN
                                                                  ERROR(Text000);
                                                              END;

                                                   CaptionML=ENU=Default Repl. Location Code }
    { 32  ;   ;Default Min. Days Supply;Decimal   ;CaptionML=ENU=Default Min. Days Supply;
                                                   DecimalPlaces=0:5 }
    { 33  ;   ;Default Max. Days Supply;Decimal   ;CaptionML=ENU=Default Max. Days Supply;
                                                   DecimalPlaces=0:5 }
    { 34  ;   ;Default Min. Inventory;Decimal     ;CaptionML=ENU=Default Min. Inventory;
                                                   DecimalPlaces=0:5 }
    { 35  ;   ;Default Max. Inventory;Decimal     ;CaptionML=ENU=Default Max. Inventory;
                                                   DecimalPlaces=0:5 }
    { 36  ;   ;Push Vendor L.T. Days;Integer      ;CaptionML=ENU=Push Vendor L.T. Days;
                                                   Editable=Yes }
    { 37  ;   ;Default Container Def. Code;Code10 ;TableRelation="Container Definition".Code;
                                                   CaptionML=ENU=Default Container Def. Code }
    { 38  ;   ;Vendor Name         ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Vendor.Name WHERE (No.=FIELD(Vendor No.)));
                                                   CaptionML=ENU=Vendor Name }
    { 39  ;   ;Default Lead Time (Days);Integer   ;CaptionML=ENU=Default Lead Time (Days) }
    { 40  ;   ;Order Create  Error ;Boolean       ;CaptionML=ENU=Order Create  Error;
                                                   Editable=No }
    { 41  ;   ;Order Create Date   ;DateTime      ;CaptionML=ENU=Order Create Date;
                                                   Editable=No }
    { 42  ;   ;LTH Order Add Days  ;Integer       ;CaptionML=ENU=LTH Order Add Days }
    { 43  ;   ;Doc. No. Filter     ;Code20        ;CaptionML=ENU=Doc. No. Filter }
    { 44  ;   ;Lines Not Reviewed  ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Suggested Order Line" WHERE (Buy-from Vendor No.=FIELD(Vendor No.),
                                                                                                   Document No.=FIELD(Doc. No. Filter),
                                                                                                   Line Reviewed=CONST(No),
                                                                                                   Type=CONST(Item)));
                                                   CaptionML=ENU=Lines Not Reviewed;
                                                   Editable=No }
    { 45  ;   ;Frozen Lead Time (Days);Integer    ;CaptionML=ENU=Frozen Lead Time (Days) }
    { 100 ;   ;Vendor Spend Start Date;Date       ;CaptionML=ENU=Vendor Spend Start Date;
                                                   Editable=No }
    { 101 ;   ;Period Spend        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Vendor Spend"."Period Spend" WHERE (Vendor No.=FIELD(Vendor No.),
                                                                                                        Location Code=FIELD(Location Code),
                                                                                                        Division Code=FIELD(Division Code),
                                                                                                        Starting Date=FIELD(Date Filter)));
                                                   CaptionML=ENU=Period Spend;
                                                   Editable=No }
    { 102 ;   ;Critical Need (Group);Integer      ;ObsoleteState=Pending;
                                                   ObsoleteReason=Redesign;
                                                   CaptionML=ENU=Critical Need (Group);
                                                   Editable=No }
    { 103 ;   ;Critical Need       ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Suggested Order Line" WHERE (Buy-from Vendor No.=FIELD(Vendor No.),
                                                                                                   Document No.=FIELD(Doc. No. Filter),
                                                                                                   Critical Need=CONST(Yes),
                                                                                                   Division Code=FIELD(Division Code)));
                                                   CaptionML=ENU=Critical Need;
                                                   Editable=No }
    { 104 ;   ;Procurement Unit Count;Integer     ;FieldClass=FlowField;
                                                   CalcFormula=Count("Procurement Unit" WHERE (Location Code=FIELD(Location Code),
                                                                                               Replenishment Source Type=CONST(Vendor),
                                                                                               Replenishment Source Code=FIELD(Vendor No.),
                                                                                               Division Code=FIELD(Division Code)));
                                                   Editable=No }
    { 50000;  ;Suggest From Purchase Prices;Boolean;
                                                   DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Suggest From Purchase Prices }
    { 50001;  ;Include All Items   ;Boolean       ;DataClassification=ToBeClassified;
                                                   CaptionML=ENU=Include Items with No Purchase Quantity }
  }
  KEYS
  {
    {    ;Vendor No.,Location Code,Division Code  ;Clustered=Yes }
    {    ;Next Review Date                         }
    {    ;Last Review Date                         }
    {    ;Location Code,Line Buy Vendor            }
    {    ;Vendor No.,Procurement Group Code        }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      InvMgtSetup@14000501 : Record 14000551;
      Text000@1000000000 : TextConst 'ENU=Default Replenishment Location must not be the same as Vendor Buying Calendar Location.';
      Text001@1240020000 : TextConst 'ENU=Vendor Buying Calendar records cannot be renamed.';
      Text002@1240020001 : TextConst 'ENU=Vendor Buying Calendar records cannot be deleted while procurement units exist.';

    PROCEDURE CalcReviewCycle@1();
    BEGIN
      InvMgtSetup.GET;
      IF "Frozen Review Cycle (Days)" = 0 THEN BEGIN
        IF ("Amount Target" <> 0) AND
           ("Proj. Annual Purchases" <> 0) THEN BEGIN
          "Review Cycle (Days)" := ROUND(365 / ("Proj. Annual Purchases" / "Amount Target"),1.0);
          IF "Review Cycle (Days)" < InvMgtSetup."Min. Vend. Review Cycle (Days)" THEN
            "Review Cycle (Days)" := InvMgtSetup."Min. Vend. Review Cycle (Days)";
          IF "Review Cycle (Days)" > InvMgtSetup."Max. Vend. Review Cycle (Days)" THEN
            "Review Cycle (Days)" := InvMgtSetup."Max. Vend. Review Cycle (Days)";
        END ELSE
          "Review Cycle (Days)" := InvMgtSetup."Min. Vend. Review Cycle (Days)";
      END ELSE
        "Review Cycle (Days)" := "Frozen Review Cycle (Days)";
    END;

    BEGIN
    END.
  }
}

