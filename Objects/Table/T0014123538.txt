OBJECT Table 14123538 ES Windows Group Member
{
  OBJECT-PROPERTIES
  {
    Date=04/14/15;
    Time=12:00:00 PM;
    Version List=ES1.41;
  }
  PROPERTIES
  {
    CaptionML=ENU=Windows Group Member;
  }
  FIELDS
  {
    { 1   ;   ;Group GUID          ;Text38        ;CaptionML=ENU=Group GUID;
                                                   NotBlank=Yes }
    { 2   ;   ;Member GUID         ;Text38        ;CaptionML=ENU=Member GUID;
                                                   NotBlank=Yes }
    { 3   ;   ;Group ID            ;Text64        ;CaptionML=ENU=Group ID }
    { 4   ;   ;Member ID           ;Text64        ;CaptionML=ENU=Member ID }
    { 1001;   ;Created By User     ;Code50        ;CaptionML=ENU=Created By User;
                                                   Editable=No }
    { 1002;   ;Created Date Time   ;DateTime      ;CaptionML=ENU=Created Date Time;
                                                   Editable=No }
    { 1003;   ;Group Exists as Windows Login;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("ES Windows Login" WHERE (SID=FIELD(Group SID)));
                                                   CaptionML=ENU=Group Exists as User;
                                                   Editable=No }
    { 1004;   ;Member Exists as Windows Login;Boolean;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Exist("ES Windows Login" WHERE (SID=FIELD(Member SID)));
                                                   CaptionML=ENU=Member Exists as User;
                                                   Editable=No }
    { 1005;   ;Group SID           ;GUID          ;CaptionML=ENU=Group User Security ID }
    { 1006;   ;Member SID          ;GUID          ;CaptionML=ENU=Member User Security ID }
    { 1008;   ;Group Login User ID ;Code50        ;TableRelation="ES Login"."User ID" WHERE (Type=CONST(Windows));
                                                   CaptionML=ENU=Group Login User ID;
                                                   NotBlank=Yes }
    { 1010;   ;Member Login User ID;Code50        ;TableRelation="ES Login"."User ID" WHERE (Type=CONST(Windows));
                                                   CaptionML=ENU=Member Login User ID;
                                                   NotBlank=Yes }
  }
  KEYS
  {
    {    ;Group GUID,Member GUID                  ;Clustered=Yes }
    {    ;Member GUID                              }
    {    ;Created Date Time                        }
    {    ;Group SID                                }
    {    ;Member SID                               }
    {    ;Created By User,Created Date Time        }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text001@1001 : TextConst 'ENU=%1 Windows Group Members inserted.';

    PROCEDURE CopyFromLiveWindowsGroupMember@1240520008(ShowStatus@1240520011 : Boolean);
    VAR
      ESWindowsObjectTmp@1240520012 : TEMPORARY Record 14123539;
      ESWindowsGroupMember@1240520009 : Record 14123538;
      ESLogin@1240520014 : Record 14123527;
      InsertedRecords@1240520010 : Integer;
    BEGIN
      {
      NameDataTypeSubtypeLength
      WindowsGroupMember Record Table2000000052
      WindowsObject Record Table2000000050

      IF WindowsGroupMember.FIND('-') THEN BEGIN
        WindowsObject.RESET;
        IF WindowsObject.FIND('-') THEN
          REPEAT
            ESWindowsObjectTmp.INIT;
            ESWindowsObjectTmp.GUID := WindowsObject.GUID;
            ESWindowsObjectTmp.ID := WindowsObject.ID;
            ESWindowsObjectTmp.Name := WindowsObject.Name;
            ESWindowsObjectTmp.Type := WindowsObject.Type;
            ESWindowsObjectTmp.SID := WindowsObject.SID;
            ESWindowsObjectTmp."Distinguished Name" := WindowsObject."Distinguished Name";
            ESWindowsObjectTmp.INSERT;
          UNTIL WindowsObject.NEXT = 0;

        REPEAT
          IF NOT ESWindowsGroupMember.GET(
                   WindowsGroupMember."Group GUID",WindowsGroupMember."Member GUID")
          THEN BEGIN
            ESWindowsGroupMember.INIT;
            ESWindowsGroupMember."Group GUID" := WindowsGroupMember."Group GUID";
            ESWindowsGroupMember."Member GUID" := WindowsGroupMember."Member GUID";
            ESWindowsGroupMember."Group ID" := WindowsGroupMember."Group ID";
            ESWindowsGroupMember."Member ID" := WindowsGroupMember."Member ID";

            IF ESWindowsObjectTmp.GET(ESWindowsGroupMember."Group GUID") THEN BEGIN
              ESWindowsGroupMember."Group SID" := ESWindowsObjectTmp.SID;

              ESLogin.RESET;
              ESLogin.SETRANGE(Type,ESLogin.Type::Windows);
              ESLogin.SETRANGE("Login SID",ESWindowsGroupMember."Group SID");
              IF ESLogin.FIND('-') THEN BEGIN
                ESWindowsGroupMember."Group Login User ID" := ESLogin."User ID";
              END;
            END;

            IF ESWindowsObjectTmp.GET(ESWindowsGroupMember."Member GUID") THEN BEGIN
              ESWindowsGroupMember."Member SID" := ESWindowsObjectTmp.SID;

              ESLogin.RESET;
              ESLogin.SETRANGE(Type,ESLogin.Type::Windows);
              ESLogin.SETRANGE("Login SID",ESWindowsGroupMember."Member SID");
              IF ESLogin.FIND('-') THEN BEGIN
                ESWindowsGroupMember."Member Login User ID" := ESLogin."User ID";
              END;
            END;

            ESWindowsGroupMember.INSERT(TRUE);

            InsertedRecords := InsertedRecords + 1;
          END;
        UNTIL WindowsGroupMember.NEXT = 0;
      END;

      IF ShowStatus THEN
        MESSAGE(Text001,InsertedRecords);
      }
    END;

    BEGIN
    END.
  }
}

