OBJECT Table 50007 Customer Division
{
  OBJECT-PROPERTIES
  {
    Date=08/04/20;
    Time=12:00:00 PM;
    Modified=Yes;
    Version List=TOP140,100B,110,150,TOPFIX,TPZ1342,RS1.07,TPZ2651,TPZ2696,TPZ2715;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               PushUpdateToCustomer(Rec); //RS1.07
             END;

    OnModify=BEGIN
               PushUpdateToCustomer(Rec); //RS1.07
             END;

  }
  FIELDS
  {
    { 1   ;   ;Customer No.        ;Code20        ;TableRelation=Customer;
                                                   CaptionML=[ENU=Customer No.;
                                                              ESM=N§ cliente;
                                                              FRC=Nø client;
                                                              ENC=Customer No.] }
    { 2   ;   ;Shortcut Dimension 5 Code;Code20   ;OnValidate=VAR
                                                                ShiptoDivision@1000000001 : Record 51002;
                                                                ShiptoAddress@1000000000 : Record 222;
                                                              BEGIN
                                                                GLSetup.GET;
                                                                //TOP140 KT ABCSI - Payment Terms for Multiple Divisions 06032015
                                                                GLSetup.TESTFIELD("Shortcut Dimension 5 Code");
                                                                IF NOT DimVal.GET(GLSetup."Shortcut Dimension 5 Code","Shortcut Dimension 5 Code") THEN
                                                                //TOP140 KT ABCSI - Payment Terms for Multiple Divisions 06032015
                                                                  FIELDERROR("Shortcut Dimension 5 Code",ab001);

                                                                //<TPZ1554>
                                                                    ShiptoAddress.SETRANGE("Customer No.","Customer No.");
                                                                    IF ShiptoAddress.FINDFIRST THEN
                                                                        REPEAT
                                                                          ShiptoDivision.SETRANGE("Customer No.","Customer No.");
                                                                          ShiptoDivision.SETRANGE("Ship-to Code",ShiptoAddress.Code);
                                                                          ShiptoDivision.SETRANGE("Shortcut Dimension 5 Code","Shortcut Dimension 5 Code");
                                                                          IF NOT ShiptoDivision.FINDFIRST THEN
                                                                            REPEAT
                                                                              ShiptoDivision.INIT();

                                                                              ShiptoDivision.VALIDATE("Customer No.","Customer No.");
                                                                              ShiptoDivision.VALIDATE("Ship-to Code",ShiptoAddress.Code);
                                                                              ShiptoDivision.VALIDATE("Shortcut Dimension 5 Code","Shortcut Dimension 5 Code");
                                                                              ShiptoDivision.INSERT();
                                                                            UNTIL ShiptoDivision.NEXT=0;
                                                                       UNTIL ShiptoAddress.NEXT=0;
                                                                //</TPZ1554>
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupShortcutDimCode(5,"Shortcut Dimension 5 Code"); //TOP140 KT ABCSI Modification to Payment Terms 01222015
                                                            END;

                                                   CaptionClass='1,2,5' }
    { 3   ;   ;Payment Terms Code  ;Code10        ;TableRelation="Payment Terms" WHERE (Type=FILTER(' '|Sales));
                                                   CaptionML=[ENU=Payment Terms Code;
                                                              ESM=C¢d. t‚rminos pago;
                                                              FRC=Code modalit‚s de paiement;
                                                              ENC=Payment Terms Code] }
    { 4   ;   ;Multiplier          ;Decimal       ;OnValidate=BEGIN
                                                                //<TPZ2715>
                                                                IF Multiplier<>xRec.Multiplier THEN
                                                                  IF NOT CONFIRM(Text50001,FALSE,
                                                                            FIELDCAPTION("Customer No."),"Customer No.",FIELDCAPTION("Shortcut Dimension 5 Code"),"Shortcut Dimension 5 Code") THEN
                                                                    ERROR('');
                                                                //</TPZ2715>
                                                              END;

                                                   DecimalPlaces=3:3;
                                                   MinValue=0;
                                                   MaxValue=1;
                                                   Description=TOP100B }
    { 10  ;   ;Margin Approval %   ;Decimal       ;Description=TOP150 }
    { 14  ;   ;Our Account No.     ;Text20        ;CaptionML=ENU=Our Account No. }
    { 29  ;   ;Salesperson Code    ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   CaptionML=ENU=OSR Code }
    { 31  ;   ;Shipping Agent Code ;Code10        ;TableRelation="Shipping Agent";
                                                   OnValidate=BEGIN
                                                                // <TPZ161>
                                                                SalesSetup.GET;
                                                                IF ("Shipping Agent Code" <> xRec."Shipping Agent Code") AND SalesSetup."Enable Shipping" THEN
                                                                  IF "Shipping Agent Code" = '' THEN
                                                                    "E-Ship Agent Service" := ''
                                                                  ELSE BEGIN
                                                                    ShippingAgent.GET("Shipping Agent Code");
                                                                    Cust.GET("Customer No.");
                                                                    VALIDATE(
                                                                      "E-Ship Agent Service",
                                                                      EShipAgentService.DefaultShipAgentService(ShippingAgent,Cust."Country/Region Code"));
                                                                  END;
                                                                // </TPZ161>
                                                              END;

                                                   CaptionML=[ENU=Shipping Agent Code;
                                                              ESM=C¢d. transportista;
                                                              FRC=Code agent de livraison;
                                                              ENC=Shipping Agent Code] }
    { 5750;   ;Shipping Advice     ;Option        ;CaptionML=ENU=Shipping Advice;
                                                   OptionCaptionML=ENU=Partial,Complete,No Back Order;
                                                   OptionString=Partial,Complete,No Back Order }
    { 50000;  ;Payment Terms Code to Print;Code10 ;TableRelation="Payment Terms";
                                                   CaptionML=ENU=Payment Terms Code to Print }
    { 50035;  ;RSM Code            ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."RSM Code" WHERE (No.=FIELD(Customer No.)));
                                                   TableRelation=Salesperson/Purchaser;
                                                   CaptionML=[ENU=RSM Code;
                                                              ENC=RSM Code];
                                                   Editable=No }
    { 50036;  ;LED Fixtures Scaler ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Average("Scaler Sales Data"."Scaler Value" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                 Scaler Code=CONST(LED FIXTURE SCALER),
                                                                                                                 Shortcut Dimension 5 Code=FIELD(Shortcut Dimension 5 Code)));
                                                   Description=TPZ2651;
                                                   Editable=No }
    { 50037;  ;LED Lamps Scaler    ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Average("Scaler Sales Data"."Scaler Value" WHERE (Customer No.=FIELD(Customer No.),
                                                                                                                 Scaler Code=CONST(LED LAMPS SCALER),
                                                                                                                 Shortcut Dimension 5 Code=FIELD(Shortcut Dimension 5 Code)));
                                                   Description=TPZ2651;
                                                   Editable=No }
    { 50040;  ;Rebate Percentage   ;Decimal       ;DataClassification=ToBeClassified;
                                                   Description=TPZ2696 }
    { 50041;  ;Buying Group Code   ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."Buying Group Code" WHERE (No.=FIELD(Customer No.)));
                                                   TableRelation="Buying Group";
                                                   Description=TPZ2696;
                                                   Editable=No }
    { 50042;  ;Customer Group Code ;Code10        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."Customer Group Code" WHERE (No.=FIELD(Customer No.)));
                                                   TableRelation="Customer Group";
                                                   Description=TPZ2696;
                                                   Editable=No }
    { 50100;  ;Mfr. Rep. Code      ;Code20        ;TableRelation="Mfr. Rep.";
                                                   Description=TOP110 }
    { 50101;  ;ISR Code            ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   Description=TOP110 }
    { 50102;  ;CSR Code            ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   Description=TOP110 }
    { 51400;  ;Location Code       ;Code10        ;TableRelation=Location;
                                                   OnValidate=VAR
                                                                ShiptoDivision@1000000000 : Record 51002;
                                                              BEGIN
                                                                //<TPZ1554>
                                                                IF CONFIRM('Would you like to update all Ship-to Divisions for Customer '+"Customer No."+' Division '+"Shortcut Dimension 5 Code") THEN BEGIN
                                                                    ShiptoDivision.SETRANGE("Customer No.","Customer No.");
                                                                    ShiptoDivision.SETRANGE("Shortcut Dimension 5 Code","Shortcut Dimension 5 Code");
                                                                    IF ShiptoDivision.FINDFIRST THEN
                                                                        REPEAT
                                                                          ShiptoDivision.VALIDATE("Location Code","Location Code");
                                                                          ShiptoDivision.MODIFY();
                                                                        UNTIL ShiptoDivision.NEXT=0;
                                                                END;
                                                                //</TPZ1554>
                                                              END;

                                                   CaptionML=ENU=Location Code }
    { 51407;  ;Free Freight Min. Order Amount;Decimal;
                                                   CaptionML=ENU=Free Freight Min. Order Amount;
                                                   MinValue=0;
                                                   AutoFormatType=1 }
    { 51408;  ;Customer Name       ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.Name WHERE (No.=FIELD(Customer No.))) }
    { 51409;  ;City                ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.City WHERE (No.=FIELD(Customer No.))) }
    { 51410;  ;District            ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.District WHERE (No.=FIELD(Customer No.)));
                                                   CaptionML=ENU=County }
    { 51411;  ;Post Code           ;Text20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer."Post Code" WHERE (No.=FIELD(Customer No.)));
                                                   CaptionML=ENU=Zip Code }
    { 51412;  ;County              ;Text30        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Customer.County WHERE (No.=FIELD(Customer No.))) }
    { 14000701;;E-Ship Agent Service;Code30       ;TableRelation="E-Ship Agent Service".Code WHERE (Shipping Agent Code=FIELD(Shipping Agent Code));
                                                   OnValidate=BEGIN
                                                                // <TPZ161>
                                                                IF "E-Ship Agent Service" <> '' THEN BEGIN
                                                                  TESTFIELD("Shipping Agent Code");
                                                                  ShippingAgent.GET("Shipping Agent Code");
                                                                  Cust.GET("Customer No.");
                                                                  EShipAgentService.ValidateEShipAgentService(ShippingAgent,"E-Ship Agent Service",Cust."Country/Region Code");
                                                                END;
                                                                // </TPZ161>
                                                              END;

                                                   CaptionML=ENU=E-Ship Agent Service }
    { 14000702;;Free Freight       ;Boolean       ;CaptionML=ENU=Free Freight }
    { 14000708;;Shipping Payment Type;Option      ;OnValidate=BEGIN
                                                                // <TPZ161>
                                                                IF ShippingAgent.GET("Shipping Agent Code") THEN
                                                                  ShippingAccount.ValidateShippingAccount(
                                                                    ShippingAgent,"Shipping Payment Type",ShippingAccount."Ship-to Type"::Customer,"Customer No.",'');
                                                                // </TPZ161>
                                                              END;

                                                   CaptionML=ENU=Shipping Payment Type;
                                                   OptionCaptionML=ENU=Prepaid,Third Party,Freight Collect,Consignee;
                                                   OptionString=Prepaid,Third Party,Freight Collect,Consignee }
  }
  KEYS
  {
    {    ;Customer No.,Shortcut Dimension 5 Code  ;Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      PaymentTerms@1000000000 : Record 3;
      "****ABCSI Globals****"@1000000002 : Integer;
      DimMgt@1000000001 : Codeunit 408;
      DimVal@1000000003 : Record 349;
      ab001@1000000004 : TextConst 'ENU=is not valid.';
      GLSetup@1000000005 : Record 98;
      SalesSetup@1000000015 : Record 311;
      Cust@1000000008 : Record 18;
      ShippingAgent@1000000006 : Record 291;
      EShipAgentService@1000000007 : Record 14000708;
      ShippingAccount@1000000009 : Record 14000714;
      Text50001@1000000010 : TextConst 'ENU=Are you sure that you want to change the base customer multiplier for %1 %2, %3 %4.';

    PROCEDURE "****ABCSI Functions****"@1000000000();
    BEGIN
    END;

    PROCEDURE LookupShortcutDimCode@28(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN

      DimMgt.LookupDimValueCode(FieldNumber,ShortcutDimCode);
    END;

    PROCEDURE PushUpdateToCustomer@1000000001(VAR CustomerDivision@1000000000 : Record 50007);
    VAR
      Customer@1000000001 : Record 18;
    BEGIN
      //>>RS1.07
      IF Customer.GET(CustomerDivision."Customer No.") THEN BEGIN
        CASE CustomerDivision."Shortcut Dimension 5 Code" OF
          'E' :
            BEGIN

                Customer."Electric Mfr. Rep. Code" := CustomerDivision."Mfr. Rep. Code";
                Customer."Electric ISR Code" := CustomerDivision."ISR Code";
                Customer."Electric CSR Code" := CustomerDivision."CSR Code";
                Customer."Electric Salesperson Code" := CustomerDivision."Salesperson Code";
                Customer.MODIFY;

            END;
         'L' :
            BEGIN

                Customer."Lighting Mfr. Rep. Code" := CustomerDivision."Mfr. Rep. Code";
                Customer."Lighting ISR Code" := CustomerDivision."ISR Code";
                Customer."Lighting CSR Code" := CustomerDivision."CSR Code";
                Customer."Lighting Salesperson Code" := CustomerDivision."Salesperson Code";
                Customer.MODIFY;

            END;
          'P' :
            BEGIN

                Customer."Conduit Mfr. Rep. Code"  := CustomerDivision."Mfr. Rep. Code";
                Customer."Conduit ISR Code":= CustomerDivision."ISR Code";
                Customer."Conduit CSR Code" := CustomerDivision."CSR Code";
                Customer."Conduit Salesperson Code" := CustomerDivision."Salesperson Code";
                Customer.MODIFY;

            END;
        END;
      END;
      //<<RS1.07
    END;

    BEGIN
    {
      TOP100B KT ABCSI Item Cust. Avail. & Price 03182015
        - Added new field Multiplier

      TOP110 KT ABCSI Salesperson 03302015
        - Added new fields 50100 Mfr. Rep. Code, 50101 ISR Code, 50102 CSR Code

      TOP150 - KT ABCSI Sales Order Margin Review 04032015
        - Added field # 10 Margin Approval %

      TOP140 KT ABCSI - Payment Terms for Multiple Divisions 06032015
        - Fixed the validation code on OnValidate trigger of Shortcut Dimension 5 Code field

      2015-04-03 TPZ572 VCHERNYA
        RSM Code, OSR Code (Salesperson Code), and Location Code fields have been created
      2015-04-30 TPZ161 VCHERNYA
        Our Account No., Shipping Agent Code, E-Ship Agent Service, Free Freight, Shipping Payment Type fields have been created
      2015-05-29 TPZ573 VCHERNYA
        Free Freight Min. Order Amount field has been created
      2015-06-11 TPZ439 VCHERNYA
        Type filter has been added to Payment Terms Code field table relation
      2015-11-01 TPZ1117 TAKHMETO
        Payment Terms Code to Print field has been added
      2015-12-21 TPZ1342 VCHERNYA
        Shipping Advice field has been created
      2016-06-17 TPZ1554 EBAGIM
        Update Location code in the Ship-to division
      2019-10-23 TPZ2651 VAHAMAD
        Added Flow Fields "LED Fixtures Scaler" and "LED Lamps Scaler"
      2019-10-25 TPZ2696 RTIWARI
        Three new fields added viz. Rebate Percentage,Buying Group Code and Customer Group Code
      2019-11-27 TPZ2715 RTIWARI
        Code added to show warning message in case of change in Multiplier
    }
    END.
  }
}

