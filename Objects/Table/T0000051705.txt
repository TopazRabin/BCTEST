OBJECT Table 51705 Comm. Journal Line
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               LOCKTABLE;
               CommJnlTemplate.GET("Journal Template Name");
               CommJnlBatch.GET("Journal Template Name","Journal Batch Name");
               "Posting No. Series" := CommJnlBatch."Posting No. Series";
             END;

    CaptionML=[ENU=Comm. Journal Line;
               ESM=L¡n. diario general;
               FRC=Ligne journal g‚n‚ral;
               ENC=Gen. Journal Line];
    PasteIsValid=Yes;
  }
  FIELDS
  {
    { 1   ;   ;Journal Template Name;Code10       ;TableRelation="Comm. Journal Template";
                                                   CaptionML=[ENU=Journal Template Name;
                                                              ESM=Nombre libro diario;
                                                              FRC=Nom modŠle journal;
                                                              ENC=Journal Template Name] }
    { 2   ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              ESM=N§ l¡nea;
                                                              FRC=Nø ligne;
                                                              ENC=Line No.] }
    { 3   ;   ;Account Type        ;Option        ;OnValidate=BEGIN
                                                                VALIDATE("Account No.",'');
                                                              END;

                                                   CaptionML=[ENU=Account Type;
                                                              ESM=Tipo mov.;
                                                              FRC=Type de compte;
                                                              ENC=Account Type];
                                                   OptionCaptionML=ENU=Mfr. Rep.,Location;
                                                   OptionString=Mfr. Rep.,Location }
    { 4   ;   ;Account No.         ;Code20        ;TableRelation=IF (Account Type=CONST(Mfr. Rep.)) "Mfr. Rep."
                                                                 ELSE IF (Account Type=CONST(Location)) Location;
                                                   OnValidate=BEGIN
                                                                //CheckAlreadyExists;
                                                                CASE "Account Type" OF
                                                                  "Account Type"::"Mfr. Rep.":
                                                                    IF MfrRep.GET("Account No.") THEN
                                                                      "Account Name" := MfrRep.Name;
                                                                  "Account Type"::Location:
                                                                    IF Location.GET("Account No.") THEN
                                                                      "Account Name" := Location.Name;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Account No.;
                                                              ESM=N§ cuenta;
                                                              FRC=Nø de compte;
                                                              ENC=Account No.] }
    { 5   ;   ;Posting Date        ;Date          ;OnValidate=BEGIN
                                                                VALIDATE("Document Date","Posting Date");
                                                              END;

                                                   CaptionML=[ENU=Posting Date;
                                                              ESM=Fecha registro;
                                                              FRC=Date de report;
                                                              ENC=Posting Date];
                                                   ClosingDates=Yes }
    { 6   ;   ;Document Type       ;Option        ;CaptionML=[ENU=Document Type;
                                                              ESM=Tipo documento;
                                                              FRC=Type de document;
                                                              ENC=Document Type];
                                                   OptionCaptionML=ENU=" ,Payment,Deduction,Adjustment";
                                                   OptionString=[ ,Payment,Deduction,Adjustment] }
    { 7   ;   ;Document No.        ;Code20        ;OnValidate=BEGIN
                                                                //CheckUniqueDocNo;
                                                              END;

                                                   CaptionML=[ENU=Document No.;
                                                              ESM=N§ documento;
                                                              FRC=Nø de document;
                                                              ENC=Document No.] }
    { 8   ;   ;Description         ;Text100       ;CaptionML=[ENU=Description;
                                                              ESM=Descripci¢n;
                                                              FRC=Description;
                                                              ENC=Description] }
    { 10  ;   ;Source Document Type;Option        ;CaptionML=ENU=Source Document Type;
                                                   OptionCaptionML=ENU=" ,,Invoice,Credit Memo";
                                                   OptionString=[ ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund];
                                                   Editable=No }
    { 11  ;   ;Source Document No. ;Code20        ;Editable=No }
    { 12  ;   ;Source Document Posting Date;Date  ;Editable=No }
    { 13  ;   ;Amount              ;Decimal       ;CaptionML=[ENU=Commission Amount;
                                                              ESM=Importe;
                                                              FRC=Montant;
                                                              ENC=Amount];
                                                   DecimalPlaces=2:4;
                                                   AutoFormatType=1 }
    { 14  ;   ;Base Amount         ;Decimal       ;CaptionML=ENU=Sales Amount;
                                                   DecimalPlaces=2:2 }
    { 16  ;   ;Comm./Hdlg. %       ;Decimal       ;CaptionML=ENU=Comm./Hdlg. % }
    { 20  ;   ;Period Starting Date;Date           }
    { 21  ;   ;Period Ending Date  ;Date           }
    { 24  ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   CaptionML=[ENU=Shortcut Dimension 1 Code;
                                                              ESM=C¢d. dim. acceso dir. 1;
                                                              FRC=Code raccourci de dimension 1;
                                                              ENC=Shortcut Dimension 1 Code];
                                                   CaptionClass='1,2,1' }
    { 25  ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2));
                                                   CaptionML=[ENU=Shortcut Dimension 2 Code;
                                                              ESM=C¢d. dim. acceso dir. 2;
                                                              FRC=Code raccourci de dimension 2;
                                                              ENC=Shortcut Dimension 2 Code];
                                                   CaptionClass='1,2,2' }
    { 28  ;   ;Location Code       ;Code10         }
    { 51  ;   ;Journal Batch Name  ;Code10        ;TableRelation="Gen. Journal Batch".Name WHERE (Journal Template Name=FIELD(Journal Template Name));
                                                   CaptionML=[ENU=Journal Batch Name;
                                                              ESM=Nombre secci¢n diario;
                                                              FRC=Nom lot de journal;
                                                              ENC=Journal Batch Name] }
    { 76  ;   ;Document Date       ;Date          ;CaptionML=[ENU=Document Date;
                                                              ESM=Fecha emisi¢n documento;
                                                              FRC=Date document;
                                                              ENC=Document Date];
                                                   ClosingDates=Yes }
    { 77  ;   ;External Document No.;Code35       ;CaptionML=[ENU=External Document No.;
                                                              ESM=N§ documento externo;
                                                              FRC=Nø document externe;
                                                              ENC=External Document No.] }
    { 78  ;   ;Reason Type         ;Option        ;CaptionML=[ENU=Reason Type;
                                                              ESM=Tipo procedencia mov.;
                                                              FRC=Type origine;
                                                              ENC=Source Type];
                                                   OptionCaptionML=ENU=" ,Invoice,Credit Memo,Payment Discount,Invoice Past Terms";
                                                   OptionString=[ ,Invoice,Credit Memo,Payment Discount,Invoice Past Terms];
                                                   Editable=No }
    { 80  ;   ;Posting No. Series  ;Code10        ;TableRelation="No. Series";
                                                   CaptionML=[ENU=Posting No. Series;
                                                              ESM=N§ serie registro;
                                                              FRC=S‚ries de nø report;
                                                              ENC=Posting No. Series] }
    { 81  ;   ;Exception           ;Boolean       ;CaptionML=ENU=Exception }
    { 82  ;   ;Invoiced            ;Boolean        }
    { 83  ;   ;E-Mail Notification Handled;Boolean }
    { 84  ;   ;Account Name        ;Text50         }
    { 85  ;   ;Customer No.        ;Code20        ;TableRelation=Customer;
                                                   CaptionML=ENU=Customer No. }
    { 86  ;   ;Customer Name       ;Text50        ;CaptionML=ENU=Customer Name }
    { 5618;   ;Comment             ;Text250       ;CaptionML=[ENU=Comment;
                                                              ESM=Comentario;
                                                              FRC=Commentaire;
                                                              ENC=Comment] }
    { 5619;   ;Comment Type        ;Option        ;CaptionML=ENU=Comment Type;
                                                   OptionCaptionML=ENU=External,Internal;
                                                   OptionString=External,Internal }
    { 50200;  ;Shortcut Dimension 5 Code;Code20   ;CaptionML=ENU=Shortcut Dimension 5 Code;
                                                   CaptionClass='1,2,5' }
  }
  KEYS
  {
    {    ;Journal Template Name,Journal Batch Name,Line No.;
                                                   SumIndexFields=Amount;
                                                   MaintainSIFTIndex=No;
                                                   Clustered=Yes }
    {    ;Customer No.                             }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      CommJnlTemplate@1000000001 : Record 51703;
      CommJnlBatch@1000000003 : Record 51704;
      CommJnlLine@1000000002 : Record 51705;
      MfrRep@1000000007 : Record 50027;
      Location@1000000008 : Record 14;
      DimMgt@1000000000 : Codeunit 408;
      NoSeriesMgt@1000000004 : Codeunit 396;
      Text51700@1000000005 : TextConst 'ENU=%1 %2 already exists in different batch.';
      Text51701@1000000006 : TextConst 'ENU=Document No. must be %1 for %2 %3.';

    PROCEDURE EmptyLine@5() : Boolean;
    BEGIN
      EXIT(
        ("Account No." = '') AND (Amount = 0));
    END;

    PROCEDURE SetUpNewLine@9(LastCommJnlLine@1000 : Record 51705;BottomLine@1002 : Boolean);
    BEGIN
      CommJnlTemplate.GET("Journal Template Name");
      CommJnlBatch.GET("Journal Template Name","Journal Batch Name");
      CommJnlLine.SETRANGE("Journal Template Name","Journal Template Name");
      CommJnlLine.SETRANGE("Journal Batch Name","Journal Batch Name");
      IF CommJnlLine.FINDFIRST THEN BEGIN
        "Posting Date" := LastCommJnlLine."Posting Date";
        "Document Date" := LastCommJnlLine."Posting Date";
        "Document No." := LastCommJnlLine."Document No.";
        IF BottomLine AND NOT LastCommJnlLine.EmptyLine
        THEN
          "Document No." := INCSTR("Document No.");
      END ELSE BEGIN
        "Posting Date" := WORKDATE;
        "Document Date" := WORKDATE;
        IF CommJnlBatch."No. Series" <> '' THEN BEGIN
          CLEAR(NoSeriesMgt);
          "Document No." := NoSeriesMgt.TryGetNextNo(CommJnlBatch."No. Series","Posting Date");
        END;
      END;
      "Document Type" := LastCommJnlLine."Document Type";
      "Posting No. Series" := CommJnlBatch."Posting No. Series";
      Description := '';
    END;

    PROCEDURE DataCaption@29() : Text[250];
    VAR
      CommJnlBatch@1000 : Record 51704;
    BEGIN
      IF CommJnlBatch.GET("Journal Template Name","Journal Batch Name") THEN
        EXIT(CommJnlBatch.Name + '-' + CommJnlBatch.Description);
    END;

    PROCEDURE CheckAlreadyExists@1000000000();
    VAR
      NewCommJnlLine@1000000000 : Record 51705;
    BEGIN
      NewCommJnlLine.RESET;
      NewCommJnlLine.SETFILTER("Journal Batch Name",'<>%1',"Journal Batch Name");
      NewCommJnlLine.SETRANGE("Account Type","Account Type");
      NewCommJnlLine.SETRANGE("Account No.","Account No.");
      NewCommJnlLine.SETRANGE("Shortcut Dimension 5 Code","Shortcut Dimension 5 Code");
      IF NOT NewCommJnlLine.ISEMPTY THEN
        ERROR(Text51700,"Account Type","Account No.");
    END;

    PROCEDURE CheckUniqueDocNo@1000000001();
    VAR
      NewCommJnlLine@1000000000 : Record 51705;
    BEGIN
      NewCommJnlLine.RESET;
      NewCommJnlLine.SETRANGE("Journal Template Name","Journal Template Name");
      NewCommJnlLine.SETRANGE("Journal Batch Name","Journal Batch Name");
      NewCommJnlLine.SETRANGE("Account Type","Account Type");
      NewCommJnlLine.SETRANGE("Account No.","Account No.");
      NewCommJnlLine.SETFILTER("Document No.",'<>%1|<>%2',"Document No.",xRec."Document No.");
      IF NewCommJnlLine.FINDFIRST THEN
        ERROR(Text51701,NewCommJnlLine."Document No.","Account Type","Account No.");
    END;

    BEGIN
    {
      2015-05-11 TPZ92 TAKHMETO
        Table has been created
    }
    END.
  }
}

