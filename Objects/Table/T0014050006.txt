OBJECT Table 14050006 UPSlink Mail
{
  OBJECT-PROPERTIES
  {
    Date=03/05/18;
    Time=12:00:00 PM;
    Version List=SE0.60.19;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               "First Read Date" := TODAY;
               "First Read Time" := TIME;
               "First Read By" := USERID;
             END;

    OnDelete=VAR
               ShippingComment@1240030000 : Record 14000706;
             BEGIN
               ShippingComment.RESET;
               ShippingComment.SETRANGE("Table ID",14050006);
               ShippingComment.SETRANGE(Integer,"Entry No.");
               IF ShippingComment.FIND('-') THEN
                 ShippingComment.DELETEALL;
             END;

    CaptionML=ENU=UPSlink Mail;
  }
  FIELDS
  {
    { 1   ;   ;Entry No.           ;Integer       ;CaptionML=ENU=Entry No. }
    { 10  ;   ;Reference No.       ;Text30        ;CaptionML=ENU=Reference No.;
                                                   Editable=No }
    { 11  ;   ;File Name           ;Text250       ;CaptionML=ENU=File Name;
                                                   Editable=No }
    { 12  ;   ;Read and Processed  ;Boolean       ;CaptionML=ENU=Read and Processed }
    { 13  ;   ;Deleted from UPS    ;Boolean       ;CaptionML=ENU=Deleted from UPS;
                                                   Editable=No }
    { 14  ;   ;Message Type        ;Option        ;CaptionML=ENU=Message Type;
                                                   OptionCaptionML=ENU=" ,Phone List,Routing Code,Restricted Article,Shipper Config.,Addr. Val.,Air Commit,Paperless Invoice,WW Validation Data,Dim. Wt. Divisor,Letter Limit,3Party Bill-to Country,Comm. Inv. Removal Ctry,Billable Weight Exempt Ctry,Terms,Peak";
                                                   OptionString=[ ,Phone List,Routing Code,Restricted Article,Shipper Config.,Addr. Val.,Air Commit,Paperless Invoice,WW Validation Data,Dim. Wt. Divisor,Letter Limit,3Party Bill-to Country,Comm. Inv. Removal Ctry,Billable Weight Exempt Ctry,Terms,Peak];
                                                   Editable=No }
    { 15  ;   ;Exception Text      ;Code150       ;CaptionML=ENU=Exception Text;
                                                   Editable=No }
    { 16  ;   ;First Read By       ;Code50        ;CaptionML=ENU=First Read By;
                                                   Editable=No }
    { 17  ;   ;First Read Date     ;Date          ;CaptionML=ENU=First Read Date;
                                                   Editable=No }
    { 18  ;   ;First Read Time     ;Time          ;CaptionML=ENU=First Read Time;
                                                   Editable=No }
    { 19  ;   ;Processed By        ;Code50        ;CaptionML=ENU=Processed By;
                                                   Editable=No }
    { 20  ;   ;Processed Date      ;Date          ;CaptionML=ENU=Processed Date;
                                                   Editable=No }
    { 21  ;   ;Processed Time      ;Time          ;CaptionML=ENU=Processed Time;
                                                   Editable=No }
    { 22  ;   ;Deleted from UPS Date;Date         ;CaptionML=ENU=Deleted from UPS Date;
                                                   Editable=No }
    { 23  ;   ;Deleted from UPS Time;Time         ;CaptionML=ENU=Deleted from UPS Time;
                                                   Editable=No }
    { 24  ;   ;Date Deleted from Folder;Date      ;CaptionML=ENU=Date Deleted from Folder;
                                                   Editable=No }
    { 25  ;   ;Do not Delete from Folder;Boolean  ;CaptionML=ENU=Do not Delete from Folder }
    { 26  ;   ;Distributed Object File Name;Text250;
                                                   CaptionML=ENU=Distributed Object File Name }
    { 27  ;   ;Host Config. Account No.;Code10    ;CaptionML=ENU=Host Config. Account No.;
                                                   Editable=No }
    { 28  ;   ;Distribution ID     ;Text10        ;CaptionML=ENU=Distribution ID }
    { 29  ;   ;Enable Date         ;Date          ;CaptionML=ENU=Enable Date }
    { 30  ;   ;Object Distribution Type;Integer   ;CaptionML=ENU=Object Distribution Type }
    { 31  ;   ;Duplicate Receipt   ;Boolean       ;CaptionML=ENU=Duplicate Receipt }
    { 32  ;   ;Email File          ;BLOB          ;CaptionML=ENU=Email File }
    { 33  ;   ;Distributed Object  ;BLOB          ;CaptionML=ENU=Distributed Object }
    { 34  ;   ;Dist. Obj. Unzip FilePathName;Text250;
                                                   CaptionML=ENU=Dist. Obj. Unzip FilePathName }
    { 35  ;   ;Large Distributed Object;Boolean   ;CaptionML=ENU=Large Distributed Object }
    { 36  ;   ;Service Tier Suffix ;Text4         ;CaptionML=ENU=Service Tier Suffix }
  }
  KEYS
  {
    {    ;Entry No.                               ;Clustered=Yes }
    {    ;Deleted from UPS,Read and Processed      }
    {    ;Read and Processed,Duplicate Receipt,Reference No. }
    {    ;Reference No.                            }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text001@1001 : TextConst 'ENU=Distributed Object %1 is a compressed file.  It must be extracted and unzipped before it can be viewed with notepad.';
      Text002@1002 : TextConst 'ENU=The distributed object is empty.';
      UPSlinkSetup@1240030000 : Record 14050001;
      UPSlinkSetupRetrieved@1240030001 : Boolean;

    PROCEDURE ViewEmail@1240030000(EntryNo@1240020000 : Integer);
    VAR
      ShippingCommentLine@1240020001 : Record 14000706;
      PackingStation@1240020002 : Record 14000709;
      CarrierPackingStation@1240020003 : Record 14000729;
      FileName@1240020004 : Text[250];
    BEGIN
      GET(EntryNo);
      CLEAR(ShippingCommentLine);
      ShippingCommentLine.SETCURRENTKEY("Table ID",Code,"Code 2",Boolean,Integer,"Line No.");
      ShippingCommentLine.SETRANGE("Table ID", 14050006);
      ShippingCommentLine.SETRANGE(Integer, "Entry No.");
      IF ("Message Type" = "Message Type"::Terms) AND ("Distribution ID" = '' )THEN BEGIN
        CLEAR(PackingStation);
        CLEAR(CarrierPackingStation);
        PackingStation.GetPackingStation;
        CarrierPackingStation.GetPackingStation(PackingStation);
        FileName := CarrierPackingStation."UPSlink Temp. Files Directory";
        IF COPYSTR(FileName,STRLEN(FileName),1) <> '\'
        THEN
          FileName := FileName + '\';
        FileName := FileName + "Distributed Object File Name";
        ExportDistributedObject(FileName,FALSE);
        PackingStation.ViewFile(FileName);
      END ELSE BEGIN
        IF ShippingCommentLine.FINDLAST THEN
          PAGE.RUNMODAL(PAGE::"Shipping Comment",ShippingCommentLine);
      END;
    END;

    PROCEDURE ExtractDistributedObject@1240030002(UserDialog@1240030001 : Boolean);
    VAR
      PackingStation@1240030000 : Record 14000709;
      CarrierPackingStation@1240030002 : Record 14000729;
    BEGIN
      PackingStation.GetPackingStation;
      CarrierPackingStation.GetPackingStation(PackingStation);

      CarrierPackingStation.TESTFIELD("UPSlink Temp. Files Directory");

      CALCFIELDS("Distributed Object");

      IF NOT "Distributed Object".HASVALUE THEN
        ERROR(Text002);

      IF COPYSTR(
           CarrierPackingStation."UPSlink Temp. Files Directory",
           STRLEN(CarrierPackingStation."UPSlink Temp. Files Directory"),1) <> '\'
      THEN
        CarrierPackingStation."UPSlink Temp. Files Directory" :=
          CarrierPackingStation."UPSlink Temp. Files Directory" + '\';

      ExportDistributedObject(
        CarrierPackingStation."UPSlink Temp. Files Directory" + "File Name" + "Reference No." +
        "Distributed Object File Name",UserDialog);
    END;

    PROCEDURE ImportDistributedObject@1240030005(ImportFileName@1240030000 : Text[1000];CommonDialog@1240030001 : Boolean);
    VAR
      ImportFile@1240040000 : File;
      NVInStream@1240040001 : InStream;
      NVOutStream@1240040002 : OutStream;
    BEGIN
      IF ISSERVICETIER THEN BEGIN
        ImportFile.WRITEMODE(FALSE);
        ImportFile.TEXTMODE(FALSE);
        ImportFile.OPEN(ImportFileName);
        ImportFile.CREATEINSTREAM(NVInStream);
        "Distributed Object".CREATEOUTSTREAM(NVOutStream);
        COPYSTREAM(NVOutStream,NVInStream);
      END ELSE
        "Distributed Object".IMPORT(ImportFileName,CommonDialog);
    END;

    PROCEDURE ExportDistributedObject@1240030003(ExportFileName@1240030001 : Text[1000];CommonDialog@1240030000 : Boolean);
    VAR
      ExportFile@1240040002 : File;
      NVInStream@1240040001 : InStream;
      NVOutStream@1240040000 : OutStream;
    BEGIN
      CALCFIELDS("Distributed Object");
      IF NOT "Distributed Object".HASVALUE THEN
        TESTFIELD("Distributed Object");

      IF ISSERVICETIER THEN BEGIN
        ExportFile.WRITEMODE(TRUE);
        ExportFile.TEXTMODE(FALSE);
        ExportFile.CREATE(ExportFileName);
        "Distributed Object".CREATEINSTREAM(NVInStream);
        ExportFile.CREATEOUTSTREAM(NVOutStream);
        COPYSTREAM(NVOutStream,NVInStream);
        ExportFile.CLOSE;
      END ELSE
        "Distributed Object".EXPORT(ExportFileName,CommonDialog);
    END;

    LOCAL PROCEDURE GetUPSlinkSetup@1240030004();
    BEGIN
      IF NOT UPSlinkSetupRetrieved THEN BEGIN
        UPSlinkSetup.GET;
        UPSlinkSetupRetrieved := TRUE;
      END;
    END;

    BEGIN
    END.
  }
}

