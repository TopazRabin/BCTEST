OBJECT Table 14000724 Computer User Setup
{
  OBJECT-PROPERTIES
  {
    Date=06/28/17;
    Time=12:00:00 PM;
    Version List=SE0.60.11;
  }
  PROPERTIES
  {
    OnInsert=BEGIN
               TESTFIELD("Computer Name");
             END;

    OnRename=BEGIN
               TESTFIELD("Computer Name");
             END;

    CaptionML=ENU=Computer User Setup;
  }
  FIELDS
  {
    { 1   ;   ;Computer Name       ;Code20        ;CaptionML=ENU=Computer Name }
    { 2   ;   ;User ID             ;Code50        ;TableRelation=User;
                                                   OnValidate=BEGIN
                                                                LoginMgt.ValidateUserID("User ID");
                                                              END;

                                                   OnLookup=BEGIN
                                                              LoginMgt.LookupUserID("User ID");
                                                            END;

                                                   ValidateTableRelation=No;
                                                   TestTableRelation=No;
                                                   CaptionML=ENU=User ID }
    { 11  ;   ;Packing Station Code;Code10        ;TableRelation="Packing Station";
                                                   CaptionML=ENU=Packing Station Code }
    { 12  ;   ;Receive Station Code;Code10        ;TableRelation="Receive Station";
                                                   CaptionML=ENU=Receive Station Code }
    { 13  ;   ;Computer Type       ;Option        ;CaptionML=ENU=Computer Type;
                                                   OptionCaptionML=ENU=" ,Citrix,Terminal Server";
                                                   OptionString=[ ,Citrix,Terminal Server] }
  }
  KEYS
  {
    {    ;Computer Name,User ID                   ;Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      LoginMgt@1240030000 : Codeunit 418;

    PROCEDURE GetComputerName@1240030000() ComputerName : Code[30];
    VAR
      ComputerUserSetup@1240030000 : Record 14000724;
      WshNetwork@1240020000 : Automation "{F935DC20-1CF0-11D0-ADB9-00C04FD58A0B} 1.0:{093FF999-1EA0-4079-9525-9614C3504B74}:'Windows Script Host Object Model'.WshNetwork";
      WshShell@1240020001 : Automation "{F935DC20-1CF0-11D0-ADB9-00C04FD58A0B} 1.0:{72C24DD5-D70A-438B-8A42-98424B88AFB8}:'Windows Script Host Object Model'.WshShell";
      ClientName@1240020002 : Text[100];
      Text001@1240020003 : TextConst 'ENU=CLIENTNAME does not exist.';
    BEGIN
      IF ISSERVICETIER THEN BEGIN
        IF CREATE(WshNetwork,FALSE,TRUE) THEN
          ComputerName := WshNetwork.ComputerName
      END ELSE
        ComputerName := UPPERCASE(DELCHR(ENVIRON('COMPUTERNAME')));

      ComputerUserSetup.RESET;
      ComputerUserSetup.SETRANGE("Computer Name",ComputerName);
      ComputerUserSetup.SETFILTER("Computer Type",'<>%1',ComputerUserSetup."Computer Type"::" ");
      IF ComputerUserSetup.FIND('-') THEN
        CASE ComputerUserSetup."Computer Type" OF
          ComputerUserSetup."Computer Type"::Citrix,
          ComputerUserSetup."Computer Type"::"Terminal Server":
            BEGIN
              IF ISSERVICETIER THEN BEGIN
                IF CREATE(WshShell,FALSE,TRUE) THEN BEGIN
                  ClientName := WshShell.ExpandEnvironmentStrings('%CLIENTNAME%');
                  IF COPYSTR(ClientName,2,10) <> 'CLIENTNAME' THEN
                    ComputerName := ClientName
                  ELSE
                    ERROR(Text001);
                END;
              END ELSE
                ComputerName := UPPERCASE(DELCHR(ENVIRON('CLIENTNAME')));
            END;
        END;
    END;

    BEGIN
    END.
  }
}

