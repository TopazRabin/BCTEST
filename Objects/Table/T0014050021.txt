OBJECT Table 14050021 UPSlink Surcharge Data
{
  OBJECT-PROPERTIES
  {
    Date=07/13/20;
    Time=12:00:00 PM;
    Version List=SE0.62;
  }
  PROPERTIES
  {
    DataPerCompany=No;
    CaptionML=ENU=UPSlink Surcharge Data;
  }
  FIELDS
  {
    { 1   ;   ;Type                ;Option        ;CaptionML=ENU=Type;
                                                   OptionCaptionML=ENU=DateRange,Rate;
                                                   OptionString=DateRange,Rate }
    { 2   ;   ;Origin Country Code ;Code4         ;CaptionML=ENU=Origin Country Code }
    { 3   ;   ;Destination Country Code;Code4     ;CaptionML=ENU=Destination Country Code }
    { 4   ;   ;Movement Direction  ;Text30        ;CaptionML=ENU=Movement Direction }
    { 5   ;   ;Service Code        ;Code3         ;CaptionML=ENU=Service Code }
    { 6   ;   ;Accessorial Code    ;Code3         ;CaptionML=ENU=Accessorial Code }
    { 7   ;   ;Calculation Method  ;Text2         ;CaptionML=ENU=Calculation Method }
    { 8   ;   ;Start Date Range    ;Date          ;CaptionML=ENU=Start Date Range }
    { 9   ;   ;End Date Range      ;Date          ;CaptionML=ENU=End Date Range }
    { 10  ;   ;Package Code        ;Text2         ;CaptionML=ENU=Package Code }
    { 11  ;   ;Measurement Unit    ;Text1         ;CaptionML=ENU=Measurement Unit }
    { 12  ;   ;Accessorial Name    ;Text50        ;CaptionML=ENU=Accessorial Name }
    { 13  ;   ;Start Weight Range  ;Decimal       ;CaptionML=ENU=Start Weight Range }
    { 14  ;   ;End Weight Range    ;Decimal       ;CaptionML=ENU=End Weight Range }
    { 15  ;   ;Flat Rate           ;Decimal       ;CaptionML=ENU=Flat Rate }
    { 16  ;   ;Multiplier Rate     ;Decimal       ;CaptionML=ENU=Multiplier Rate }
    { 17  ;   ;Minimum Rate        ;Decimal       ;CaptionML=ENU=Minimum Rate }
    { 18  ;   ;Maximum Rate        ;Decimal       ;CaptionML=ENU=Maximum Rate }
    { 20  ;   ;Service Code Indicator;Code2       ;CaptionML=ENU=Service Code Indicator }
  }
  KEYS
  {
    {    ;Type,Origin Country Code,Destination Country Code,Movement Direction,Measurement Unit,Start Weight Range,End Weight Range,Service Code,Accessorial Code,Calculation Method,Start Date Range,End Date Range;
                                                   Clustered=Yes }
  }
  FIELDGROUPS
  {
  }
  CODE
  {

    PROCEDURE GetSurchargeRate@1240020000(UPSlinkSurchargeDateRange@1240020000 : Record 14050021;VAR CurrentPackage@1240020002 : Record 14000701;CurrentUPSOptionPage@1240020006 : Record 14000761;Units@1240020004 : Code[10]);
    VAR
      UPSlinkSurchargeRate@1240020001 : Record 14050021;
      Rate1@1240020007 : Decimal;
      Rate2@1240020008 : Decimal;
    BEGIN
      WITH CurrentPackage DO BEGIN
        UPSlinkSurchargeRate.RESET;
        UPSlinkSurchargeRate.SETRANGE(Type,UPSlinkSurchargeRate.Type::Rate);
        UPSlinkSurchargeRate.SETRANGE("Origin Country Code",UPSlinkSurchargeDateRange."Origin Country Code");
        UPSlinkSurchargeRate.SETRANGE("Destination Country Code",UPSlinkSurchargeDateRange."Destination Country Code");
        UPSlinkSurchargeRate.SETRANGE("Service Code",UPSlinkSurchargeDateRange."Service Code");

        IF "Packing Date" = 0D  THEN BEGIN
          UPSlinkSurchargeRate.SETFILTER("Start Date Range",'<=%1',WORKDATE);
          UPSlinkSurchargeRate.SETFILTER("End Date Range",'>=%1',WORKDATE);
        END ELSE BEGIN
          UPSlinkSurchargeRate.SETFILTER("Start Date Range",'<=%1',"Packing Date");
          UPSlinkSurchargeRate.SETFILTER("End Date Range",'>=%1',"Packing Date");
        END;

        UPSlinkSurchargeRate.SETRANGE("Accessorial Code",UPSlinkSurchargeDateRange."Accessorial Code");
        UPSlinkSurchargeRate.SETRANGE("Calculation Method",UPSlinkSurchargeDateRange."Calculation Method");
        UPSlinkSurchargeRate.SETRANGE("Measurement Unit",Units);
        UPSlinkSurchargeRate.SETFILTER(UPSlinkSurchargeRate."Start Weight Range",'<=%1',CurrentPackage."Calculation Weight (LBS)");
        UPSlinkSurchargeRate.SETFILTER(UPSlinkSurchargeRate."End Weight Range",'>=%1',CurrentPackage."Calculation Weight (LBS)");

        IF UPSlinkSurchargeRate.FIND('-') THEN BEGIN
          IF CurrentPackage."UPS Hundred Weight" AND
             ((NOT("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PHC')) OR
              (("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PHR'))) AND
             ("Package No." = "Total Packages") AND
             (UPSlinkSurchargeDateRange."Calculation Method" = '01')
          THEN BEGIN
             Rate1 := UPSlinkSurchargeRate."Flat Rate" * "Total Packages";
             Rate2 := UPSlinkSurchargeRate."Maximum Rate";

            IF Rate1 > Rate2 THEN
              Surcharge += Rate1
            ELSE
              Surcharge += Rate2;
          END;

          IF ((NOT("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PSC')) OR
             (("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PSR'))) AND
             ("Package No." = "Total Packages") AND
             (UPSlinkSurchargeDateRange."Calculation Method" = '03')
          THEN BEGIN
            IF ("Package No." = "Total Packages") THEN BEGIN
               "Base Charge" += (UPSlinkSurchargeRate."Flat Rate" * "Total Packages");
            END;
          END;
          IF ((NOT("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PSC')) OR
             (("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PSR'))) AND
             ("Package No." = "Total Packages") AND
             (UPSlinkSurchargeDateRange."Calculation Method" = '04')
          THEN BEGIN
            IF ("Package No." > 1) AND ("Package No." = "Total Packages") THEN
              IF UPSlinkSurchargeRate."Flat Rate" < 0 THEN
                "Base Charge" += (UPSlinkSurchargeRate."Multiplier Rate" * "Calculation Weight (LBS)")
              ELSE
                "Base Charge" += (UPSlinkSurchargeRate."Flat Rate" * "Calculation Weight (LBS)");
          END;

          IF ((NOT("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PSC')) OR
             (("Residential Delivery") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'PSR')) OR
             ((CurrentUPSOptionPage."Large Package") AND (UPSlinkSurchargeDateRange."Accessorial Code" = 'SLP'))) AND
             ("Total Packages" = 1) AND
             (UPSlinkSurchargeDateRange."Calculation Method" = '06')
          THEN BEGIN
            "Base Charge" += UPSlinkSurchargeRate."Flat Rate";
          END;

          IF ((CurrentUPSOptionPage."Additional Handling Required") AND
              (UPSlinkSurchargeDateRange."Accessorial Code" = 'SAH')) AND
             ("Total Packages" = 1) AND
             (UPSlinkSurchargeDateRange."Calculation Method" = '06')
          THEN BEGIN
            Surcharge += UPSlinkSurchargeRate."Flat Rate";
          END;
        END;
      END;
    END;

    BEGIN
    END.
  }
}

