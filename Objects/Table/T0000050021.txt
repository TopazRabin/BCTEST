OBJECT Table 50021 Sales Line Buffer
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=NAVW17.10.00.43896,NAVNA7.10.00.43896,SE0.60,SCW18.3.1,RF1.50,TOP010,030A,140,050,020,100A,030B,110,170,150,130,210,180,230,010E,TOPFIX,UBP2.86,TPZ1641,TPZ2785;
  }
  PROPERTIES
  {
    OnDelete=VAR
               CapableToPromise@1000 : Codeunit 99000886;
               JobCreateInvoice@1002 : Codeunit 1002;
               SalesCommentLine@1003 : Record 44;
             BEGIN
             END;

    OnRename=BEGIN
               ERROR(Text001,TABLECAPTION);
             END;

    CaptionML=[ENU=Sales Line Buffer;
               ESM=L¡n. venta;
               FRC=Ligne de paiement;
               ENC=Sales Line];
    PasteIsValid=Yes;
    LookupPageID=Page516;
    DrillDownPageID=Page516;
  }
  FIELDS
  {
    { 1   ;   ;Document Type       ;Option        ;CaptionML=[ENU=Document Type;
                                                              ESM=Tipo documento;
                                                              FRC=Type de document;
                                                              ENC=Document Type];
                                                   OptionCaptionML=[ENU=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order;
                                                                    ESM=Cotizaci¢n,Pedido,Factura,Nota cr‚dito,Pedido abierto,Devoluci¢n;
                                                                    FRC=Devis,Commande,Facture,Note de cr‚dit,Commande permanente,Retour;
                                                                    ENC=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order];
                                                   OptionString=Quote,Order,Invoice,Credit Memo,Blanket Order,Return Order }
    { 2   ;   ;Sell-to Customer No.;Code20        ;TableRelation=Customer;
                                                   OnValidate=VAR
                                                                tmpCustomer@1000000000 : Record 18;
                                                              BEGIN
                                                              END;

                                                   CaptionML=[ENU=Sell-to Customer No.;
                                                              ESM=Venta a-N§ cliente;
                                                              FRC=Nø client (d‚biteur);
                                                              ENC=Sell-to Customer No.];
                                                   Editable=No }
    { 3   ;   ;Document No.        ;Code20        ;TableRelation="Sales Header".No. WHERE (Document Type=FIELD(Document Type));
                                                   CaptionML=[ENU=Document No.;
                                                              ESM=N§ documento;
                                                              FRC=Nø de document;
                                                              ENC=Document No.] }
    { 4   ;   ;Line No.            ;Integer       ;CaptionML=[ENU=Line No.;
                                                              ESM=N§ l¡nea;
                                                              FRC=Nø ligne;
                                                              ENC=Line No.] }
    { 5   ;   ;Type                ;Option        ;OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                GetSalesHeader;

                                                                TESTFIELD("Qty. Shipped Not Invoiced",0);
                                                                TESTFIELD("Quantity Shipped",0);
                                                                TESTFIELD("Shipment No.",'');

                                                                TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                                                                TESTFIELD("Return Qty. Received",0);
                                                                TESTFIELD("Return Receipt No.",'');

                                                                TESTFIELD("Prepmt. Amt. Inv.",0);

                                                                CheckAssocPurchOrder(FIELDCAPTION(Type));

                                                                IF Type <> xRec.Type THEN
                                                                  CASE xRec.Type OF
                                                                    Type::Item:
                                                                      BEGIN
                                                                       // ATOLink.DeleteAsmFromSalesLine(Rec);
                                                                        IF Quantity <> 0 THEN BEGIN
                                                                          SalesHeader.TESTFIELD(Status,SalesHeader.Status::Open);
                                                                          CALCFIELDS("Reserved Qty. (Base)");
                                                                          TESTFIELD("Reserved Qty. (Base)",0);
                                                                          //ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                          //WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                        END;
                                                                      END;
                                                                    Type::"Fixed Asset":
                                                                      IF Quantity <> 0 THEN
                                                                        SalesHeader.TESTFIELD(Status,SalesHeader.Status::Open);
                                                                    Type::"Charge (Item)":
                                                                      DeleteChargeChargeAssgnt("Document Type","Document No.","Line No.");
                                                                  END;

                                                                //AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);
                                                                TempSalesLine := Rec;
                                                                INIT;
                                                                Type := TempSalesLine.Type;
                                                                "System-Created Entry" := TempSalesLine."System-Created Entry";

                                                                IF Type = Type::Item THEN
                                                                  "Allow Item Charge Assignment" := TRUE
                                                                ELSE
                                                                  "Allow Item Charge Assignment" := FALSE;
                                                                IF Type = Type::Item THEN BEGIN
                                                                  IF SalesHeader.InventoryPickConflict("Document Type","Document No.",SalesHeader."Shipping Advice") THEN
                                                                    ERROR(Text056,SalesHeader."Shipping Advice");
                                                                  IF SalesHeader.WhseShpmntConflict("Document Type","Document No.",SalesHeader."Shipping Advice") THEN
                                                                    ERROR(Text052,SalesHeader."Shipping Advice");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Type;
                                                              ESM=Tipo;
                                                              FRC=Type;
                                                              ENC=Type];
                                                   OptionCaptionML=[ENU=" ,G/L Account,Item,Resource,Fixed Asset,Charge (Item)";
                                                                    ESM=" ,Cuenta,Producto,Recurso,Activo fijo,Cargo (prod.)";
                                                                    FRC=" ,Compte (GL),Article,Ressource,Immobilisation,Frais annexes";
                                                                    ENC=" ,G/L Account,Item,Resource,Fixed Asset,Charge (Item)"];
                                                   OptionString=[ ,G/L Account,Item,Resource,Fixed Asset,Charge (Item)] }
    { 6   ;   ;No.                 ;Code20        ;TableRelation=IF (Type=CONST(" ")) "Standard Text"
                                                                 ELSE IF (Type=CONST(G/L Account),
                                                                          System-Created Entry=CONST(No)) "G/L Account" WHERE (Direct Posting=CONST(Yes),
                                                                                                                               Account Type=CONST(Posting),
                                                                                                                               Blocked=CONST(No))
                                                                                                                               ELSE IF (Type=CONST(G/L Account),
                                                                                                                                        System-Created Entry=CONST(Yes)) "G/L Account"
                                                                                                                                        ELSE IF (Type=CONST(Item)) Item
                                                                                                                                        ELSE IF (Type=CONST(Resource)) Resource
                                                                                                                                        ELSE IF (Type=CONST(Fixed Asset)) "Fixed Asset"
                                                                                                                                        ELSE IF (Type=CONST("Charge (Item)")) "Item Charge";
                                                   OnValidate=VAR
                                                                NewItem@1000000004 : Record 27;
                                                                Item2@1000000003 : Record 27;
                                                                PrepaymentMgt@1002 : Codeunit 441;
                                                                UserSetupMgt@1000000005 : Codeunit 5700;
                                                                "***ABCSI Locals***"@1000000000 : Integer;
                                                                ItemRec@1000000001 : Record 27;
                                                                ItemDivMatrix@1000000002 : Record 50032;
                                                                CustProdComm@1000000006 : Record 50039;
                                                                tmpCustomer@1000000007 : Record 18;
                                                              BEGIN
                                                                TempSalesLine := Rec;
                                                                INIT;
                                                                Type := TempSalesLine.Type;
                                                                "No." := TempSalesLine."No.";
                                                                IF "No." = '' THEN
                                                                  EXIT;
                                                                IF Type <> Type::" " THEN
                                                                  Quantity := TempSalesLine.Quantity;
                                                                   Quantity := 1;
                                                                  "Sell-to Customer No.":= TempSalesLine."Sell-to Customer No.";
                                                                  "Bill-to Customer No.":= TempSalesLine."Sell-to Customer No.";
                                                                  tmpCustomer.GET(TempSalesLine."Sell-to Customer No.");
                                                                  "Customer Price Group" := tmpCustomer."Customer Price Group";
                                                                  "Customer Disc. Group" := tmpCustomer."Customer Disc. Group";
                                                                  "Shortcut Dimension 5 Code":='E';
                                                                  "Unit of Measure Code":='PCS';
                                                                  VALIDATE("Location Code",'1');



                                                                  UpdateUnitPrice(FIELDNO("No."));
                                                              END;

                                                   OnLookup=VAR
                                                              "***ABCSI Locals***"@1000000000 : Integer;
                                                              StandardText@1000000001 : Record 7;
                                                              GLAccount@1000000006 : Record 15;
                                                              ItemRec@1000000005 : Record 27;
                                                              ResourceRec@1000000004 : Record 156;
                                                              FixedAssetRec@1000000003 : Record 5600;
                                                              ItemChargeRec@1000000002 : Record 5800;
                                                              ItemDivMatrix@1000000007 : Record 50032;
                                                            BEGIN
                                                            END;

                                                   CaptionML=[ENU=No.;
                                                              ESM=N§;
                                                              FRC=Nø;
                                                              ENC=No.;
                                                              ESG=N§;
                                                              ESC=N§;
                                                              ESA=N§;
                                                              ESD=N§;
                                                              ESV=N§;
                                                              ESO=N§;
                                                              ESE=N§;
                                                              ESU=N§] }
    { 7   ;   ;Location Code       ;Code10        ;TableRelation=Location WHERE (Use As In-Transit=CONST(No));
                                                   OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                CheckAssocPurchOrder(FIELDCAPTION("Location Code"));
                                                                IF "Location Code" <> '' THEN
                                                                  IF IsServiceItem THEN
                                                                    Item.TESTFIELD(Type,Item.Type::Inventory);
                                                                IF xRec."Location Code" <> "Location Code" THEN BEGIN
                                                                  IF NOT FullQtyIsForAsmToOrder THEN BEGIN
                                                                    CALCFIELDS("Reserved Qty. (Base)");
                                                                    TESTFIELD("Reserved Qty. (Base)","Qty. to Asm. to Order (Base)");
                                                                  END;
                                                                  TESTFIELD("Qty. Shipped Not Invoiced",0);
                                                                  TESTFIELD("Shipment No.",'');
                                                                  TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                                                                  TESTFIELD("Return Receipt No.",'');
                                                                END;

                                                                GetSalesHeader;
                                                                "Shipment Date" :=
                                                                  CalendarMgmt.CalcDateBOC(
                                                                    '',
                                                                    SalesHeader."Shipment Date",
                                                                    CalChange."Source Type"::Location,
                                                                    "Location Code",
                                                                    '',
                                                                    CalChange."Source Type"::"Shipping Agent",
                                                                    "Shipping Agent Code",
                                                                    "Shipping Agent Service Code",
                                                                    FALSE);

                                                                CheckItemAvailable(FIELDNO("Location Code"));

                                                                //<TPZ1047>
                                                                IF (Type = Type::Item) AND ("No." <> '') THEN BEGIN
                                                                  GetLocation("Location Code");
                                                                  IF Location.Code <> '' THEN
                                                                    VALIDATE("Purchasing Code", Location."Default Purchasing Code");
                                                                END;
                                                                //</TPZ1047>

                                                                IF NOT "Drop Shipment" THEN BEGIN
                                                                  IF "Location Code" = '' THEN BEGIN
                                                                    IF InvtSetup.GET THEN
                                                                      "Outbound Whse. Handling Time" := InvtSetup."Outbound Whse. Handling Time";
                                                                  END ELSE
                                                                    IF Location.GET("Location Code") THEN
                                                                      "Outbound Whse. Handling Time" := Location."Outbound Whse. Handling Time";
                                                                END ELSE
                                                                  EVALUATE("Outbound Whse. Handling Time",'<0D>');

                                                                IF "Location Code" <> xRec."Location Code" THEN BEGIN
                                                                  InitItemAppl(TRUE);
                                                                  GetDefaultBin;
                                                                  InitQtyToAsm;
                                                                  AutoAsmToOrder;
                                                                  IF Quantity <> 0 THEN BEGIN
                                                                    IF NOT "Drop Shipment" THEN
                                                                      UpdateWithWarehouseShip;
                                                                    //IF NOT FullReservedQtyIsForAsmToOrder THEN
                                                                     // ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                   // WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                  END;
                                                                END;

                                                                UpdateDates;

                                                                IF (Type = Type::Item) AND ("No." <> '') THEN
                                                                  GetUnitCost;

                                                                CheckWMS;

                                                                IF "Document Type" = "Document Type"::"Return Order" THEN
                                                                  ValidateReturnReasonCode(FIELDNO("Location Code"));
                                                                // <TPZ92>
                                                                GetLocationDivHdlgPct("Location Code","Shortcut Dimension 5 Code");
                                                                VALIDATE("Location Hdlg. %",LocationDivHdlgPct."Handling %");
                                                                // </TPZ92>
                                                              END;

                                                   CaptionML=[ENU=Location Code;
                                                              ESM=C¢d. almac‚n;
                                                              FRC=Code d'emplacement;
                                                              ENC=Location Code] }
    { 8   ;   ;Posting Group       ;Code10        ;TableRelation=IF (Type=CONST(Item)) "Inventory Posting Group"
                                                                 ELSE IF (Type=CONST(Fixed Asset)) "FA Posting Group";
                                                   CaptionML=[ENU=Posting Group;
                                                              ESM=Grupo contable;
                                                              FRC=ParamŠtre report;
                                                              ENC=Posting Group];
                                                   Editable=No }
    { 10  ;   ;Shipment Date       ;Date          ;OnValidate=VAR
                                                                CheckDateConflict@1000 : Codeunit 99000815;
                                                              BEGIN
                                                              END;

                                                   CaptionML=[ENU=Shipment Date;
                                                              ESM=Fecha env¡o;
                                                              FRC=Date de livraison;
                                                              ENC=Shipment Date] }
    { 11  ;   ;Description         ;Text50        ;CaptionML=[ENU=Description;
                                                              ESM=Descripci¢n;
                                                              FRC=Description;
                                                              ENC=Description;
                                                              ESG=Descripci¢n;
                                                              ESC=Descripci¢n;
                                                              ESA=Descripci¢n;
                                                              ESD=Descripci¢n;
                                                              ESV=Descripci¢n;
                                                              ESO=Descripci¢n;
                                                              ESE=Descripci¢n;
                                                              ESU=Descripci¢n] }
    { 12  ;   ;Description 2       ;Text50        ;CaptionML=[ENU=Description 2;
                                                              ESM=Descripci¢n 2;
                                                              FRC=Description 2;
                                                              ENC=Description 2] }
    { 13  ;   ;Unit of Measure     ;Text10        ;CaptionML=[ENU=Unit of Measure;
                                                              ESM=Unidad medida;
                                                              FRC=Unit‚ de mesure;
                                                              ENC=Unit of Measure] }
    { 15  ;   ;Quantity            ;Decimal       ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                                ItemLoc@1000000000 : Record 27;
                                                                RoundedUpQty@1000000001 : Decimal;
                                                                MinQty@1000000002 : Decimal;
                                                              BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                //CheckQtyRounding(Rec);//TPZ9429
                                                                // <TPZ69>
                                                                IF GUIALLOWED AND
                                                                   ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order]) AND
                                                                   (Type = Type::Item) AND
                                                                   (CurrFieldNo = FIELDNO(Quantity)) AND
                                                                   (Quantity <> 0) AND
                                                                   Item.GET("No.") AND
                                                                   (Item."Sales Order Multiple" <> 0)
                                                                THEN
                                                                  IF Quantity MOD Item."Sales Order Multiple" <> 0 THEN BEGIN
                                                                    RoundedUpQty := Item."Sales Order Multiple" * (Quantity DIV Item."Sales Order Multiple" + 1);
                                                                    IF CONFIRM(Text51078,TRUE,RoundedUpQty,"Unit of Measure Code") THEN
                                                                      Quantity := RoundedUpQty
                                                                      //<TPZ9429>
                                                                      ELSE
                                                                       ERROR(TextRNDERROR,Item."No.");  //EB
                                                                     //</TPZ9429>
                                                                  END;
                                                                // </TPZ69>

                                                                CheckAssocPurchOrder(FIELDCAPTION(Quantity));

                                                                IF "Shipment No." <> '' THEN
                                                                  CheckShipmentRelation
                                                                ELSE
                                                                  IF "Return Receipt No." <> '' THEN
                                                                    CheckRetRcptRelation;


                                                                //TM BEG 070215 - Only allow user to change quantity if new quantity is more than total qty. picked + qty. in pick ticket.
                                                                IF (Quantity <> xRec.Quantity) AND ("Document Type" <> "Document Type"::Quote) THEN BEGIN
                                                                  MinQty := CalcWhseMinQtyAllowToChangeTo;
                                                                  IF Quantity < MinQty THEN
                                                                    ERROR(Text51500, "Document No.", "Line No.", MinQty);
                                                                END;
                                                                //TM END 070215


                                                                "Quantity (Base)" := CalcBaseQty(Quantity);

                                                                // >> Shipping
                                                                "Std. Pack Quantity" := CalcStdPackQty("Quantity (Base)");
                                                                "Package Quantity" := CalcPackageQty("Std. Pack Quantity");
                                                                // << Shipping

                                                                //TOP030B KT ABCSI Lost Opportunities 03112015
                                                                IF Quantity <> 0 THEN
                                                                  TESTFIELD("Reason Code",'');
                                                                //TOP030B KT ABCSI Lost Opportunities 03112015

                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                                IF "Alt. UOM Code" <> '' THEN
                                                                  "Alt. UOM Quantity" := CalcAltUOMQty(Quantity);
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015

                                                                IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
                                                                  IF (Quantity * "Return Qty. Received" < 0) OR
                                                                     ((ABS(Quantity) < ABS("Return Qty. Received")) AND ("Return Receipt No." = ''))
                                                                  THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text003,FIELDCAPTION("Return Qty. Received")));
                                                                  IF ("Quantity (Base)" * "Return Qty. Received (Base)" < 0) OR
                                                                     ((ABS("Quantity (Base)") < ABS("Return Qty. Received (Base)")) AND ("Return Receipt No." = ''))
                                                                  THEN
                                                                    FIELDERROR("Quantity (Base)",STRSUBSTNO(Text003,FIELDCAPTION("Return Qty. Received (Base)")));
                                                                END ELSE BEGIN
                                                                  IF (Quantity * "Quantity Shipped" < 0) OR
                                                                     ((ABS(Quantity) < ABS("Quantity Shipped")) AND ("Shipment No." = ''))
                                                                  THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text003,FIELDCAPTION("Quantity Shipped")));
                                                                  IF ("Quantity (Base)" * "Qty. Shipped (Base)" < 0) OR
                                                                     ((ABS("Quantity (Base)") < ABS("Qty. Shipped (Base)")) AND ("Shipment No." = ''))
                                                                  THEN
                                                                    FIELDERROR("Quantity (Base)",STRSUBSTNO(Text003,FIELDCAPTION("Qty. Shipped (Base)")));
                                                                END;

                                                                IF (Type = Type::"Charge (Item)") AND (CurrFieldNo <> 0) THEN BEGIN
                                                                  IF (Quantity = 0) AND ("Qty. to Assign" <> 0) THEN
                                                                    FIELDERROR("Qty. to Assign",STRSUBSTNO(Text009,FIELDCAPTION(Quantity),Quantity));
                                                                  IF (Quantity * "Qty. Assigned" < 0) OR (ABS(Quantity) < ABS("Qty. Assigned")) THEN
                                                                    FIELDERROR(Quantity,STRSUBSTNO(Text003,FIELDCAPTION("Qty. Assigned")));
                                                                END;

                                                                //AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);
                                                                IF (xRec.Quantity <> Quantity) OR (xRec."Quantity (Base)" <> "Quantity (Base)") THEN BEGIN
                                                                  InitOutstanding;
                                                                  IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
                                                                    InitQtyToReceive
                                                                  ELSE
                                                                    InitQtyToShip;
                                                                  InitQtyToAsm;
                                                                  SetDefaultQuantity;
                                                                END;

                                                                CheckItemAvailable(FIELDNO(Quantity));

                                                                IF (Quantity * xRec.Quantity < 0) OR (Quantity = 0) THEN
                                                                  InitItemAppl(FALSE);

                                                                IF Type = Type::Item THEN BEGIN
                                                                  // <TPZ1172>
                                                                  IF "Shortcut Dimension 5 Code" <> 'E' THEN
                                                                    UpdateUnitPrice(FIELDNO(Quantity))
                                                                  ELSE
                                                                    VALIDATE("Unit Price");
                                                                  // </TPZ1172>
                                                                  {IF (xRec.Quantity <> Quantity) OR (xRec."Quantity (Base)" <> "Quantity (Base)") THEN BEGIN
                                                                    ReserveSalesLine.VerifyQuantity(Rec,xRec);
                                                                    IF NOT "Drop Shipment" THEN
                                                                      UpdateWithWarehouseShip;
                                                                    WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                    IF ("Quantity (Base)" * xRec."Quantity (Base)" <= 0) AND ("No." <> '') THEN BEGIN
                                                                      GetItem;
                                                                      IF (Item."Costing Method" = Item."Costing Method"::Standard) AND NOT IsShipment THEN
                                                                        GetUnitCost;
                                                                    END;
                                                                  END;
                                                                  }
                                                                  VALIDATE("Qty. to Assemble to Order");
                                                                  IF (Quantity = "Quantity Invoiced") AND (CurrFieldNo <> 0) THEN
                                                                    CheckItemChargeAssgnt;
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);
                                                                END ELSE
                                                                  VALIDATE("Line Discount %");

                                                                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 Start
                                                                {IF "Document Type" <> "Document Type"::Quote THEN BEGIN  //TOP010E KT ABCSI 07282015
                                                                IF Type = Type::Item THEN BEGIN
                                                                  IF (xRec.Quantity <> Quantity) AND (Quantity <> 0) AND (CurrFieldNo = FIELDNO(Quantity)) THEN
                                                                    BEGIN
                                                                      UpdateLastSalesPrice(Rec);
                                                                    END;
                                                                END;

                                                                END; //TOP010E KT ABCSI 07282015
                                                                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 End
                                                                }
                                                                IF (xRec.Quantity <> Quantity) AND (Quantity = 0) AND
                                                                   ((Amount <> 0) OR ("Amount Including VAT" <> 0) OR ("VAT Base Amount" <> 0))
                                                                THEN BEGIN
                                                                  Amount := 0;
                                                                  "Amount Including VAT" := 0;
                                                                  "VAT Base Amount" := 0;
                                                                END;

                                                                UpdateMarginPercent; //TOP230 KT ABCSI CRP 2 Fixes 05282015

                                                                UpdatePrePaymentAmounts;

                                                                CheckWMS;

                                                                CALCFIELDS("Reserved Qty. (Base)");
                                                                VALIDATE("Reserved Qty. (Base)");
                                                              END;

                                                   CaptionML=[ENU=Quantity;
                                                              ESM=Cantidad;
                                                              FRC=Quantit‚;
                                                              ENC=Quantity;
                                                              ESG=Cantidad;
                                                              ESC=Cantidad;
                                                              ESA=Cantidad;
                                                              ESD=Cantidad;
                                                              ESV=Cantidad;
                                                              ESO=Cantidad;
                                                              ESE=Cantidad;
                                                              ESU=Cantidad];
                                                   DecimalPlaces=0:5 }
    { 16  ;   ;Outstanding Quantity;Decimal       ;CaptionML=[ENU=Outstanding Quantity;
                                                              ESM=Cantidad pendiente;
                                                              FRC=Quantit‚ en suspens;
                                                              ENC=Outstanding Quantity];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 17  ;   ;Qty. to Invoice     ;Decimal       ;OnValidate=BEGIN
                                                                {IF "Qty. to Invoice" = MaxQtyToInvoice THEN
                                                                  InitQtyToInvoice
                                                                ELSE
                                                                  "Qty. to Invoice (Base)" := CalcBaseQty("Qty. to Invoice");
                                                                IF ("Qty. to Invoice" * Quantity < 0) OR
                                                                   (ABS("Qty. to Invoice") > ABS(MaxQtyToInvoice))
                                                                THEN
                                                                  ERROR(
                                                                    Text005,
                                                                    MaxQtyToInvoice);
                                                                IF ("Qty. to Invoice (Base)" * "Quantity (Base)" < 0) OR
                                                                   (ABS("Qty. to Invoice (Base)") > ABS(MaxQtyToInvoiceBase))
                                                                THEN
                                                                  ERROR(
                                                                    Text006,
                                                                    MaxQtyToInvoiceBase);
                                                                "VAT Difference" := 0;
                                                                CalcInvDiscToInvoice;
                                                                CalcPrepaymentToDeduct;
                                                                 }
                                                              END;

                                                   CaptionML=[ENU=Qty. to Invoice;
                                                              ESM=Cdad. a facturar;
                                                              FRC=Quantit‚ … facturer;
                                                              ENC=Qty. to Invoice];
                                                   DecimalPlaces=0:5 }
    { 18  ;   ;Qty. to Ship        ;Decimal       ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                              BEGIN
                                                                {
                                                                GetLocation("Location Code");
                                                                IF (CurrFieldNo <> 0) AND
                                                                   (Type = Type::Item) AND
                                                                   (NOT "Drop Shipment")
                                                                THEN BEGIN
                                                                  IF Location."Require Shipment" AND
                                                                     ("Qty. to Ship" <> 0)
                                                                  THEN
                                                                    CheckWarehouse;
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;

                                                                IF "Qty. to Ship" = "Outstanding Quantity" THEN
                                                                  InitQtyToShip
                                                                ELSE BEGIN
                                                                  "Qty. to Ship (Base)" := CalcBaseQty("Qty. to Ship");
                                                                  CheckServItemCreation;
                                                                  // >> Shipping
                                                                  "Std. Pack Qty. to Ship" := CalcStdPackQty("Qty. to Ship (Base)");
                                                                  "Package Qty. to Ship" := CalcPackageQty("Std. Pack Qty. to Ship");
                                                                  // << Shipping
                                                                  InitQtyToInvoice;
                                                                END;
                                                                IF ((("Qty. to Ship" < 0) XOR (Quantity < 0)) AND (Quantity <> 0) AND ("Qty. to Ship" <> 0)) OR
                                                                   (ABS("Qty. to Ship") > ABS("Outstanding Quantity")) OR
                                                                   (((Quantity < 0) XOR ("Outstanding Quantity" < 0)) AND (Quantity <> 0) AND ("Outstanding Quantity" <> 0))
                                                                THEN
                                                                  ERROR(
                                                                    Text007,
                                                                    "Outstanding Quantity");
                                                                IF ((("Qty. to Ship (Base)" < 0) XOR ("Quantity (Base)" < 0)) AND ("Qty. to Ship (Base)" <> 0) AND ("Quantity (Base)" <> 0)) OR
                                                                   (ABS("Qty. to Ship (Base)") > ABS("Outstanding Qty. (Base)")) OR
                                                                   ((("Quantity (Base)" < 0) XOR ("Outstanding Qty. (Base)" < 0)) AND ("Quantity (Base)" <> 0) AND ("Outstanding Qty. (Base)" <> 0))
                                                                THEN
                                                                  ERROR(
                                                                    Text008,
                                                                    "Outstanding Qty. (Base)");

                                                                IF (CurrFieldNo <> 0) AND (Type = Type::Item) AND ("Qty. to Ship" < 0) THEN
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);

                                                                ATOLink.UpdateQtyToAsmFromSalesLine(Rec);
                                                                }
                                                              END;

                                                   CaptionML=[ENU=Qty. to Ship;
                                                              ESM=Cantidad a enviar;
                                                              FRC=Quantit‚ … livrer;
                                                              ENC=Qty. to Ship];
                                                   DecimalPlaces=0:5 }
    { 22  ;   ;Unit Price          ;Decimal       ;OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                IF ("Prepmt. Amt. Inv." <> 0) AND
                                                                   ("Unit Price" <> xRec."Unit Price")
                                                                THEN
                                                                  FIELDERROR("Unit Price",STRSUBSTNO(Text050,xRec."Unit Price"));

                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                                IF "Alt. UOM Code" <> '' THEN
                                                                  "Alt. UOM Unit Price" := CalcAltUOMUnitPrice("Unit Price");
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015

                                                                VALIDATE("Line Discount %");

                                                                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 Start
                                                                {IF "Document Type" <> "Document Type"::Quote THEN BEGIN  //TOP010E KT ABCSI 07282015
                                                                IF Type = Type::Item THEN BEGIN
                                                                  IF (xRec."Unit Price" <> "Unit Price") AND ("Unit Price" <> 0) AND (CurrFieldNo = FIELDNO("Unit Price")) THEN
                                                                    BEGIN
                                                                      UpdateLastSalesPrice(Rec);
                                                                    END;
                                                                END;
                                                                END; //TOP010E KT ABCSI 07282015
                                                                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 End
                                                                 }
                                                                UpdateMarginPercent; //TOP230 KT ABCSI CRP 2 Fixes 05282015
                                                              END;

                                                   CaptionML=[ENU=Unit Price;
                                                              ESM=Precio unitario;
                                                              FRC=Prix unitaire;
                                                              ENC=Unit Price];
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Unit Price")) }
    { 23  ;   ;Unit Cost (LCY)     ;Decimal       ;OnValidate=BEGIN
                                                                IF (CurrFieldNo = FIELDNO("Unit Cost (LCY)")) AND
                                                                   ("Unit Cost (LCY)" <> xRec."Unit Cost (LCY)")
                                                                THEN
                                                                  CheckAssocPurchOrder(FIELDCAPTION("Unit Cost (LCY)"));

                                                                IF (CurrFieldNo = FIELDNO("Unit Cost (LCY)")) AND
                                                                   (Type = Type::Item) AND ("No." <> '') AND ("Quantity (Base)" <> 0)
                                                                THEN BEGIN
                                                                  TestJobPlanningLine;
                                                                  GetItem;
                                                                  IF (Item."Costing Method" = Item."Costing Method"::Standard) AND NOT IsShipment THEN BEGIN
                                                                    IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
                                                                      ERROR(
                                                                        Text037,
                                                                        FIELDCAPTION("Unit Cost (LCY)"),Item.FIELDCAPTION("Costing Method"),
                                                                        Item."Costing Method",FIELDCAPTION(Quantity));
                                                                    ERROR(
                                                                      Text038,
                                                                      FIELDCAPTION("Unit Cost (LCY)"),Item.FIELDCAPTION("Costing Method"),
                                                                      Item."Costing Method",FIELDCAPTION(Quantity));
                                                                  END;
                                                                END;

                                                                GetSalesHeader;
                                                                IF SalesHeader."Currency Code" <> '' THEN BEGIN
                                                                  Currency.TESTFIELD("Unit-Amount Rounding Precision");
                                                                  "Unit Cost" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtLCYToFCY(
                                                                        GetDate,SalesHeader."Currency Code",
                                                                        "Unit Cost (LCY)",SalesHeader."Currency Factor"),
                                                                      Currency."Unit-Amount Rounding Precision")
                                                                END ELSE
                                                                  "Unit Cost" := "Unit Cost (LCY)";

                                                                UpdateMarginPercent; //TOP230 KT ABCSI CRP 2 Fixes 05282015
                                                              END;

                                                   CaptionML=[ENU=Unit Cost ($);
                                                              ESM=Costo unitario ($);
                                                              FRC=Co–t unitaire ($);
                                                              ENC=Unit Cost ($)];
                                                   AutoFormatType=2 }
    { 25  ;   ;VAT %               ;Decimal       ;CaptionML=[ENU=Tax %;
                                                              ESM=% IVA;
                                                              FRC=% TVA;
                                                              ENC=Tax %];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 27  ;   ;Line Discount %     ;Decimal       ;OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                // <TPZ1276>
                                                                "Line Discount Amount" :=
                                                                  ROUND(
                                                                    Quantity * "Unit Price",
                                                                    Currency."Amount Rounding Precision") -
                                                                  ROUND(
                                                                    Quantity * ROUND("Unit Price" * (100 - "Line Discount %") / 100,Currency."Unit-Amount Rounding Precision"),
                                                                    Currency."Amount Rounding Precision");
                                                                // </TPZ1276>
                                                                "Inv. Discount Amount" := 0;
                                                                "Inv. Disc. Amount to Invoice" := 0;
                                                                //TOP100A KT ABCSI Multipliers 02192015
                                                                IF ((CurrFieldNo <> 0) AND (CurrFieldNo <> FIELDNO("Actual Unit Price"))) OR (CurrFieldNo = 0) THEN BEGIN  //TOP230 KT ABCSI Topaz Fixes 07152015
                                                                  IF "Line Discount %" <> 0 THEN BEGIN
                                                                    // <TPZ1276>
                                                                    Multiplier := ROUND(((100 - "Line Discount %")/100),0.0000001,'=');
                                                                    // </TPZ1276>
                                                                    IF NOT CalledFromActualUnitPrice THEN
                                                                      "Actual Unit Price" := ROUND(Multiplier * "Unit Price",0.0001)  //TOP230 KT ABCSI Go Live Fixes 11092015
                                                                    ELSE
                                                                      CLEAR(CalledFromActualUnitPrice);
                                                                  END ELSE BEGIN
                                                                    Multiplier := 0;
                                                                    "Actual Unit Price" := "Unit Price";
                                                                  END;
                                                                END;
                                                                  IF "Alt. UOM Code" <> '' THEN
                                                                    "Alt. UOM Actual Unit Price" := CalcAltUOMUnitPrice("Actual Unit Price");
                                                                //TOP100A KT ABCSI Multipliers 02192015
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Line Discount %;
                                                              ESM=% Descuento l¡nea;
                                                              FRC="Ligne % escompte ";
                                                              ENC=Line Discount %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 28  ;   ;Line Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                TESTFIELD(Quantity);
                                                                IF xRec."Line Discount Amount" <> "Line Discount Amount" THEN
                                                                  IF ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") <> 0 THEN
                                                                    "Line Discount %" :=
                                                                      ROUND(
                                                                        "Line Discount Amount" / ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") * 100,
                                                                        0.00001)
                                                                  ELSE
                                                                    "Line Discount %" := 0;
                                                                "Inv. Discount Amount" := 0;
                                                                "Inv. Disc. Amount to Invoice" := 0;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Line Discount Amount;
                                                              ESM=Importe dto. l¡nea;
                                                              FRC=Ligne Montant d'escompte;
                                                              ENC=Line Discount Amount];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 29  ;   ;Amount              ;Decimal       ;OnValidate=BEGIN
                                                                Amount := ROUND(Amount,Currency."Amount Rounding Precision");
                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Normal VAT",
                                                                  "VAT Calculation Type"::"Reverse Charge VAT":
                                                                    BEGIN
                                                                      "VAT Base Amount" :=
                                                                        ROUND(Amount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                                                                      "Amount Including VAT" :=
                                                                        ROUND(Amount + "VAT Base Amount" * "VAT %" / 100,Currency."Amount Rounding Precision");
                                                                    END;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    IF Amount <> 0 THEN
                                                                      FIELDERROR(Amount,
                                                                        STRSUBSTNO(
                                                                          Text009,FIELDCAPTION("VAT Calculation Type"),
                                                                          "VAT Calculation Type"));
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    BEGIN
                                                                      SalesHeader.TESTFIELD("VAT Base Discount %",0);
                                                                      "VAT Base Amount" := ROUND(Amount,Currency."Amount Rounding Precision");
                                                                      "Amount Including VAT" :=
                                                                        Amount +
                                                                        SalesTaxCalculate.CalculateTax(
                                                                          "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                                                                          "VAT Base Amount","Quantity (Base)",SalesHeader."Currency Factor");
                                                                      IF "VAT Base Amount" <> 0 THEN
                                                                        "VAT %" :=
                                                                          ROUND(100 * ("Amount Including VAT" - "VAT Base Amount") / "VAT Base Amount",0.00001)
                                                                      ELSE
                                                                        "VAT %" := 0;
                                                                      "Amount Including VAT" := ROUND("Amount Including VAT",Currency."Amount Rounding Precision");
                                                                    END;
                                                                END;

                                                                InitOutstandingAmount;
                                                              END;

                                                   CaptionML=[ENU=Amount;
                                                              ESM=Importe;
                                                              FRC=Montant;
                                                              ENC=Amount];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 30  ;   ;Amount Including VAT;Decimal       ;OnValidate=BEGIN
                                                                "Amount Including VAT" := ROUND("Amount Including VAT",Currency."Amount Rounding Precision");
                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Normal VAT",
                                                                  "VAT Calculation Type"::"Reverse Charge VAT":
                                                                    BEGIN
                                                                      Amount :=
                                                                        ROUND(
                                                                          "Amount Including VAT" /
                                                                          (1 + (1 - SalesHeader."VAT Base Discount %" / 100) * "VAT %" / 100),
                                                                          Currency."Amount Rounding Precision");
                                                                      "VAT Base Amount" :=
                                                                        ROUND(Amount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                                                                    END;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    BEGIN
                                                                      Amount := 0;
                                                                      "VAT Base Amount" := 0;
                                                                    END;
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    BEGIN
                                                                      SalesHeader.TESTFIELD("VAT Base Discount %",0);
                                                                      Amount :=
                                                                        SalesTaxCalculate.ReverseCalculateTax(
                                                                          "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                                                                          "Amount Including VAT","Quantity (Base)",SalesHeader."Currency Factor");
                                                                      IF Amount <> 0 THEN
                                                                        "VAT %" :=
                                                                          ROUND(100 * ("Amount Including VAT" - Amount) / Amount,0.00001)
                                                                      ELSE
                                                                        "VAT %" := 0;
                                                                      Amount := ROUND(Amount,Currency."Amount Rounding Precision");
                                                                      "VAT Base Amount" := Amount;
                                                                    END;
                                                                END;

                                                                InitOutstandingAmount;
                                                              END;

                                                   CaptionML=[ENU=Amount Including Tax;
                                                              ESM=Importe IVA incl.;
                                                              FRC=Montant avec TVA;
                                                              ENC=Amount Including Tax];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 32  ;   ;Allow Invoice Disc. ;Boolean       ;InitValue=Yes;
                                                   OnValidate=BEGIN
                                                                {TestStatusOpen;
                                                                IF ("Allow Invoice Disc." <> xRec."Allow Invoice Disc.") AND
                                                                   (NOT "Allow Invoice Disc.")
                                                                THEN BEGIN
                                                                  "Inv. Discount Amount" := 0;
                                                                  "Inv. Disc. Amount to Invoice" := 0;
                                                                  UpdateAmounts;
                                                                END;
                                                                 }
                                                              END;

                                                   CaptionML=[ENU=Allow Invoice Disc.;
                                                              ESM=Permitir dto. factura;
                                                              FRC=Escompte de facture permis;
                                                              ENC=Allow Invoice Disc.] }
    { 34  ;   ;Gross Weight        ;Decimal       ;CaptionML=[ENU=Gross Weight;
                                                              ESM=Peso bruto;
                                                              FRC=Poids brut;
                                                              ENC=Gross Weight];
                                                   DecimalPlaces=0:5 }
    { 35  ;   ;Net Weight          ;Decimal       ;CaptionML=[ENU=Net Weight;
                                                              ESM=Peso neto;
                                                              FRC=Poids net;
                                                              ENC=Net Weight];
                                                   DecimalPlaces=0:5 }
    { 36  ;   ;Units per Parcel    ;Decimal       ;CaptionML=[ENU=Units per Parcel;
                                                              ESM=Unidades por lote;
                                                              FRC=Unit‚s par colis;
                                                              ENC=Units per Parcel];
                                                   DecimalPlaces=0:5 }
    { 37  ;   ;Unit Volume         ;Decimal       ;CaptionML=[ENU=Unit Volume;
                                                              ESM=Volumen;
                                                              FRC=Volume unitaire;
                                                              ENC=Unit Volume];
                                                   DecimalPlaces=0:5 }
    { 38  ;   ;Appl.-to Item Entry ;Integer       ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                                ItemTrackingLines@1001 : Page 6510;
                                                              BEGIN
                                                                {IF "Appl.-to Item Entry" <> 0 THEN BEGIN
                                                                  AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);

                                                                  TESTFIELD(Type,Type::Item);
                                                                  TESTFIELD(Quantity);
                                                                  IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
                                                                    IF Quantity > 0 THEN
                                                                      FIELDERROR(Quantity,Text030);
                                                                  END ELSE BEGIN
                                                                    IF Quantity < 0 THEN
                                                                      FIELDERROR(Quantity,Text029);
                                                                  END;
                                                                  ItemLedgEntry.GET("Appl.-to Item Entry");
                                                                  ItemLedgEntry.TESTFIELD(Positive,TRUE);
                                                                  IF (ItemLedgEntry."Lot No." <> '') OR (ItemLedgEntry."Serial No." <> '') THEN
                                                                    ERROR(Text040,ItemTrackingLines.CAPTION,FIELDCAPTION("Appl.-to Item Entry"));
                                                                  IF ABS("Qty. to Ship (Base)") > ItemLedgEntry.Quantity THEN
                                                                    ERROR(ShippingMoreUnitsThanReceivedErr,ItemLedgEntry.Quantity,ItemLedgEntry."Document No.");

                                                                  VALIDATE("Unit Cost (LCY)",CalcUnitCost(ItemLedgEntry));

                                                                  "Location Code" := ItemLedgEntry."Location Code";
                                                                  IF NOT ItemLedgEntry.Open THEN
                                                                    MESSAGE(Text042,"Appl.-to Item Entry");
                                                                END;
                                                                  }
                                                              END;

                                                   OnLookup=BEGIN
                                                              SelectItemEntry(FIELDNO("Appl.-to Item Entry"));
                                                            END;

                                                   CaptionML=[ENU=Appl.-to Item Entry;
                                                              ESM=Liq. por n§ orden producto;
                                                              FRC=cr. article … affecter;
                                                              ENC=Appl.-to Item Entry] }
    { 40  ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(1));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
                                                                //ATOLink.UpdateAsmDimFromSalesLine(Rec);
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 1 Code;
                                                              ESM=C¢d. dim. acceso dir. 1;
                                                              FRC=Code raccourci de dimension 1;
                                                              ENC=Shortcut Dimension 1 Code];
                                                   CaptionClass='1,2,1' }
    { 41  ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE (Global Dimension No.=CONST(2));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
                                                                //ATOLink.UpdateAsmDimFromSalesLine(Rec);
                                                              END;

                                                   CaptionML=[ENU=Shortcut Dimension 2 Code;
                                                              ESM=C¢d. dim. acceso dir. 2;
                                                              FRC=Code raccourci de dimension 2;
                                                              ENC=Shortcut Dimension 2 Code];
                                                   CaptionClass='1,2,2' }
    { 42  ;   ;Customer Price Group;Code10        ;TableRelation="Customer Price Group";
                                                   OnValidate=BEGIN
                                                                IF Type = Type::Item THEN
                                                                  UpdateUnitPrice(FIELDNO("Customer Price Group"));
                                                              END;

                                                   CaptionML=[ENU=Customer Price Group;
                                                              ESM=Grupo precio cliente;
                                                              FRC=Groupe de prix du client;
                                                              ENC=Customer Price Group];
                                                   Editable=No }
    { 45  ;   ;Job No.             ;Code20        ;TableRelation=Job;
                                                   CaptionML=[ENU=Job No.;
                                                              ESM=N§ proyecto;
                                                              FRC=Nø projet;
                                                              ENC=Job No.];
                                                   Editable=No }
    { 52  ;   ;Work Type Code      ;Code10        ;TableRelation="Work Type";
                                                   OnValidate=BEGIN
                                                                IF Type = Type::Resource THEN BEGIN
                                                                  TestStatusOpen;
                                                                  IF WorkType.GET("Work Type Code") THEN
                                                                    VALIDATE("Unit of Measure Code",WorkType."Unit of Measure Code");
                                                                  UpdateUnitPrice(FIELDNO("Work Type Code"));
                                                                  VALIDATE("Unit Price");
                                                                  FindResUnitCost;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Work Type Code;
                                                              ESM=C¢d. tipo trabajo;
                                                              FRC=Code type travail;
                                                              ENC=Work Type Code] }
    { 57  ;   ;Outstanding Amount  ;Decimal       ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF SalesHeader."Currency Code" <> '' THEN
                                                                  "Outstanding Amount (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(
                                                                        GetDate,"Currency Code",
                                                                        "Outstanding Amount",SalesHeader."Currency Factor"),
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Outstanding Amount (LCY)" :=
                                                                    ROUND("Outstanding Amount",Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Outstanding Amount;
                                                              ESM=Importe pendiente;
                                                              FRC=Montant non pay‚;
                                                              ENC=Outstanding Amount];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 58  ;   ;Qty. Shipped Not Invoiced;Decimal  ;CaptionML=[ENU=Qty. Shipped Not Invoiced;
                                                              ESM=Cantidad enviada no facturada;
                                                              FRC=Quantit‚ livr‚e non factur‚e;
                                                              ENC=Qty. Shipped Not Invoiced];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 59  ;   ;Shipped Not Invoiced;Decimal       ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF SalesHeader."Currency Code" <> '' THEN
                                                                  "Shipped Not Invoiced (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(
                                                                        GetDate,"Currency Code",
                                                                        "Shipped Not Invoiced",SalesHeader."Currency Factor"),
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Shipped Not Invoiced (LCY)" :=
                                                                    ROUND("Shipped Not Invoiced",Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Shipped Not Invoiced;
                                                              ESM=Enviado no facturado;
                                                              FRC=Livr‚ non factur‚;
                                                              ENC=Shipped Not Invoiced];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 60  ;   ;Quantity Shipped    ;Decimal       ;CaptionML=[ENU=Quantity Shipped;
                                                              ESM=Cantidad enviada;
                                                              FRC=Quantit‚ livr‚e;
                                                              ENC=Quantity Shipped];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 61  ;   ;Quantity Invoiced   ;Decimal       ;CaptionML=[ENU=Quantity Invoiced;
                                                              ESM=Cantidad facturada;
                                                              FRC=Quantit‚ factur‚e;
                                                              ENC=Quantity Invoiced];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 63  ;   ;Shipment No.        ;Code20        ;CaptionML=[ENU=Shipment No.;
                                                              ESM=N§ remisi¢n;
                                                              FRC=Nø de livraison;
                                                              ENC=Shipment No.];
                                                   Editable=No }
    { 64  ;   ;Shipment Line No.   ;Integer       ;CaptionML=[ENU=Shipment Line No.;
                                                              ESM=N§ l¡nea de env¡o;
                                                              FRC=Nø ligne de livraison;
                                                              ENC=Shipment Line No.];
                                                   Editable=No }
    { 67  ;   ;Profit %            ;Decimal       ;CaptionML=[ENU=Profit %;
                                                              ESM=% Bf§ bruto;
                                                              FRC=% profit;
                                                              ENC=Profit %];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 68  ;   ;Bill-to Customer No.;Code20        ;TableRelation=Customer;
                                                   CaptionML=[ENU=Bill-to Customer No.;
                                                              ESM=Factura-a N§ cliente;
                                                              FRC=N§ client factur‚;
                                                              ENC=Bill-to Customer No.];
                                                   Editable=No }
    { 69  ;   ;Inv. Discount Amount;Decimal       ;OnValidate=BEGIN
                                                                CalcInvDiscToInvoice;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Inv. Discount Amount;
                                                              ESM=Importe dto. factura;
                                                              FRC=Montant d'escompte sur facture;
                                                              ENC=Inv. Discount Amount];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 71  ;   ;Purchase Order No.  ;Code20        ;TableRelation=IF (Drop Shipment=CONST(Yes)) "Purchase Header".No. WHERE (Document Type=CONST(Order));
                                                   OnValidate=BEGIN
                                                                {IF (xRec."Purchase Order No." <> "Purchase Order No.") AND (Quantity <> 0) THEN BEGIN
                                                                  ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;
                                                                 }
                                                              END;

                                                   CaptionML=[ENU=Purchase Order No.;
                                                              ESM=N§ pedido compra;
                                                              FRC=Nø bon de commande;
                                                              ENC=Purchase Order No.];
                                                   Editable=No }
    { 72  ;   ;Purch. Order Line No.;Integer      ;TableRelation=IF (Drop Shipment=CONST(Yes)) "Purchase Line"."Line No." WHERE (Document Type=CONST(Order),
                                                                                                                                 Document No.=FIELD(Purchase Order No.));
                                                   OnValidate=BEGIN
                                                                {IF (xRec."Purch. Order Line No." <> "Purch. Order Line No.") AND (Quantity <> 0) THEN BEGIN
                                                                  ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;
                                                                 }
                                                              END;

                                                   CaptionML=[ENU=Purch. Order Line No.;
                                                              ESM=N§ l¡nea pedido compra;
                                                              FRC=Nø ligne bon de commande;
                                                              ENC=Purch. Order Line No.];
                                                   Editable=No }
    { 73  ;   ;Drop Shipment       ;Boolean       ;OnValidate=BEGIN
                                                                TESTFIELD("Document Type","Document Type"::Order);
                                                                TESTFIELD(Type,Type::Item);
                                                                TESTFIELD("Quantity Shipped",0);
                                                                TESTFIELD("Job No.",'');
                                                                TESTFIELD("Qty. to Asm. to Order (Base)",0);

                                                                IF "Drop Shipment" THEN
                                                                  TESTFIELD("Special Order",FALSE);

                                                                CheckAssocPurchOrder(FIELDCAPTION("Drop Shipment"));

                                                                IF "Drop Shipment" THEN BEGIN
                                                                  Reserve := Reserve::Never;
                                                                  VALIDATE(Quantity,Quantity);
                                                                  IF "Drop Shipment" THEN BEGIN
                                                                    EVALUATE("Outbound Whse. Handling Time",'<0D>');
                                                                    EVALUATE("Shipping Time",'<0D>');
                                                                    UpdateDates;
                                                                    "Bin Code" := '';
                                                                  END;
                                                                END ELSE BEGIN
                                                                  GetItem;
                                                                  IF Item.Reserve = Item.Reserve::Optional THEN BEGIN
                                                                    GetSalesHeader;
                                                                    Reserve := SalesHeader.Reserve;
                                                                  END ELSE
                                                                    Reserve := Item.Reserve;
                                                                  IF "Special Order" THEN
                                                                    Reserve := Reserve::Never;
                                                                END;

                                                                IF "Drop Shipment" THEN
                                                                  "Bin Code" := '';

                                                                CheckItemAvailable(FIELDNO("Drop Shipment"));

                                                                //AddOnIntegrMgt.CheckReceiptOrderStatus(Rec);
                                                                IF (xRec."Drop Shipment" <> "Drop Shipment") AND (Quantity <> 0) THEN BEGIN
                                                                  IF NOT "Drop Shipment" THEN BEGIN
                                                                    InitQtyToAsm;
                                                                    AutoAsmToOrder;
                                                                    UpdateWithWarehouseShip
                                                                  END ELSE
                                                                    InitQtyToShip;
                                                                  //WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                 {
                                                                  IF NOT FullReservedQtyIsForAsmToOrder THEN
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                }
                                                                END;

                                                                // Shipping
                                                                // Qty. to Ship has been set to zero for not accidentially shipping the line when posting.
                                                                // This is not a Shipping Specific problem but and general "Feature" in Navision
                                                                IF "Drop Shipment" THEN BEGIN
                                                                  SalesSetup.GET;
                                                                  IF SalesSetup."Blank Drop Shipm. Qty. to Ship" THEN
                                                                    VALIDATE("Qty. to Ship",0);
                                                                END;
                                                                // Shipping
                                                              END;

                                                   CaptionML=[ENU=Drop Shipment;
                                                              ESM=Env¡o directo;
                                                              FRC=Livraison directe;
                                                              ENC=Drop Shipment];
                                                   Editable=Yes }
    { 74  ;   ;Gen. Bus. Posting Group;Code10     ;TableRelation="Gen. Business Posting Group";
                                                   OnValidate=BEGIN
                                                                IF xRec."Gen. Bus. Posting Group" <> "Gen. Bus. Posting Group" THEN
                                                                  IF GenBusPostingGrp.ValidateVatBusPostingGroup(GenBusPostingGrp,"Gen. Bus. Posting Group") THEN
                                                                    VALIDATE("VAT Bus. Posting Group",GenBusPostingGrp."Def. VAT Bus. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=Gen. Bus. Posting Group;
                                                              ESM=Grupo contable negocio;
                                                              FRC=Groupe de report de march‚;
                                                              ENC=Gen. Bus. Posting Group] }
    { 75  ;   ;Gen. Prod. Posting Group;Code10    ;TableRelation="Gen. Product Posting Group";
                                                   OnValidate=BEGIN
                                                                //<TPZ1682
                                                                IF ((CurrFieldNo = FIELDNO("Gen. Prod. Posting Group")) AND
                                                                     (Type = Type::Item) AND
                                                                     (Sample OR Promo) AND //<TPZ2368>
                                                                     ("Gen. Prod. Posting Group" <> xRec."Gen. Prod. Posting Group")) THEN
                                                                     IF Sample THEN
                                                                       ERROR(TPZText001,FIELDCAPTION("Gen. Prod. Posting Group"), "Gen. Prod. Posting Group", Item.TABLECAPTION, FIELDCAPTION(Sample))
                                                                     ELSE
                                                                       ERROR(TPZText001,FIELDCAPTION("Gen. Prod. Posting Group"), "Gen. Prod. Posting Group", Item.TABLECAPTION, FIELDCAPTION(Promo));//<TPZ2368>
                                                                //</TPZ1682>

                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                IF xRec."Gen. Prod. Posting Group" <> "Gen. Prod. Posting Group" THEN
                                                                  IF GenProdPostingGrp.ValidateVatProdPostingGroup(GenProdPostingGrp,"Gen. Prod. Posting Group") THEN
                                                                    VALIDATE("VAT Prod. Posting Group",GenProdPostingGrp."Def. VAT Prod. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=Gen. Prod. Posting Group;
                                                              ESM=Grupo contable producto;
                                                              FRC=Groupe de report de produit;
                                                              ENC=Gen. Prod. Posting Group] }
    { 77  ;   ;VAT Calculation Type;Option        ;CaptionML=[ENU=Tax Calculation Type;
                                                              ESM=Tipo c lculo IVA;
                                                              FRC=Type de calcul taxe;
                                                              ENC=Tax Calculation Type];
                                                   OptionCaptionML=[ENU=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                                    ESM=Normal,Reversi¢n,Total,Impto. venta;
                                                                    FRC=TVA normale,Frais renvers‚s TVA,TVA complŠte,Taxe de vente;
                                                                    ENC=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax];
                                                   OptionString=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                   Editable=No }
    { 78  ;   ;Transaction Type    ;Code10        ;TableRelation="Transaction Type";
                                                   CaptionML=[ENU=Transaction Type;
                                                              ESM=Naturaleza transacci¢n;
                                                              FRC=Type de transaction;
                                                              ENC=Transaction Type] }
    { 79  ;   ;Transport Method    ;Code10        ;TableRelation="Transport Method";
                                                   CaptionML=[ENU=Transport Method;
                                                              ESM=Modo transporte;
                                                              FRC=Mode de transport;
                                                              ENC=Transport Method] }
    { 80  ;   ;Attached to Line No.;Integer       ;TableRelation="Sales Line"."Line No." WHERE (Document Type=FIELD(Document Type),
                                                                                                Document No.=FIELD(Document No.));
                                                   CaptionML=[ENU=Attached to Line No.;
                                                              ESM=N§ l¡nea texto adicional;
                                                              FRC=Reli‚ … la ligne n§;
                                                              ENC=Attached to Line No.];
                                                   Editable=No }
    { 81  ;   ;Exit Point          ;Code10        ;TableRelation="Entry/Exit Point";
                                                   CaptionML=[ENU=Exit Point;
                                                              ESM=Puerto/Aerop. carga;
                                                              FRC=Pays destination;
                                                              ENC=Exit Point] }
    { 82  ;   ;Area                ;Code10        ;TableRelation=Area;
                                                   CaptionML=[ENU=Area;
                                                              ESM=C¢d. provincia;
                                                              FRC=Zone;
                                                              ENC=Area] }
    { 83  ;   ;Transaction Specification;Code10   ;TableRelation="Transaction Specification";
                                                   CaptionML=[ENU=Transaction Specification;
                                                              ESM=Especificaci¢n transacci¢n;
                                                              FRC=Sp‚cification transaction;
                                                              ENC=Transaction Specification] }
    { 85  ;   ;Tax Area Code       ;Code20        ;TableRelation="Tax Area";
                                                   OnValidate=VAR
                                                                TaxArea@1020000 : Record 318;
                                                                HeaderTaxArea@1020001 : Record 318;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                SalesHeader.TESTFIELD(Status,SalesHeader.Status::Open);
                                                                IF "Tax Area Code" <> '' THEN BEGIN
                                                                  TaxArea.GET("Tax Area Code");
                                                                  SalesHeader.TESTFIELD("Tax Area Code");
                                                                  HeaderTaxArea.GET(SalesHeader."Tax Area Code");

                                                                  IF TaxArea."Country/Region" <> HeaderTaxArea."Country/Region" THEN
                                                                    ERROR(
                                                                      Text1020003,
                                                                      TaxArea.FIELDCAPTION("Country/Region"),
                                                                      TaxArea.TABLECAPTION,
                                                                      TABLECAPTION,
                                                                      SalesHeader.TABLECAPTION);
                                                                  IF TaxArea."Use External Tax Engine" <> HeaderTaxArea."Use External Tax Engine" THEN
                                                                    ERROR(
                                                                      Text1020003,
                                                                      TaxArea.FIELDCAPTION("Use External Tax Engine"),
                                                                      TaxArea.TABLECAPTION,
                                                                      TABLECAPTION,
                                                                      SalesHeader.TABLECAPTION);

                                                                END;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Area Code;
                                                              ESM=C¢d.  rea impuesto;
                                                              FRC=Code de r‚gion fiscale;
                                                              ENC=Tax Area Code] }
    { 86  ;   ;Tax Liable          ;Boolean       ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Liable;
                                                              ESM=Sujeto a impuesto;
                                                              FRC=Imposable;
                                                              ENC=Tax Liable];
                                                   Editable=No }
    { 87  ;   ;Tax Group Code      ;Code10        ;TableRelation="Tax Group";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Group Code;
                                                              ESM=C¢d. grupo impuesto;
                                                              FRC=Code groupe fiscal;
                                                              ENC=Tax Group Code] }
    { 88  ;   ;VAT Clause Code     ;Code10        ;TableRelation="VAT Clause";
                                                   CaptionML=[ENU=Tax Clause Code;
                                                              ESM=C¢digo de cl usula de IVA;
                                                              FRC=Code clause TVA;
                                                              ENC=Tax Clause Code] }
    { 89  ;   ;VAT Bus. Posting Group;Code10      ;TableRelation="VAT Business Posting Group";
                                                   OnValidate=BEGIN
                                                                VALIDATE("VAT Prod. Posting Group");
                                                              END;

                                                   CaptionML=[ENU=Tax Bus. Posting Group;
                                                              ESM=Grupo registro IVA neg.;
                                                              FRC=Groupe de reports de taxe sur la valeur ajout‚e de l'entreprise;
                                                              ENC=Tax Bus. Posting Group] }
    { 90  ;   ;VAT Prod. Posting Group;Code10     ;TableRelation="VAT Product Posting Group";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                VATPostingSetup.GET("VAT Bus. Posting Group","VAT Prod. Posting Group");
                                                                "VAT Difference" := 0;
                                                                "VAT %" := VATPostingSetup."VAT %";
                                                                "VAT Calculation Type" := VATPostingSetup."VAT Calculation Type";
                                                                "VAT Identifier" := VATPostingSetup."VAT Identifier";
                                                                "VAT Clause Code" := VATPostingSetup."VAT Clause Code";
                                                                CASE "VAT Calculation Type" OF
                                                                  "VAT Calculation Type"::"Reverse Charge VAT",
                                                                  "VAT Calculation Type"::"Sales Tax":
                                                                    "VAT %" := 0;
                                                                  "VAT Calculation Type"::"Full VAT":
                                                                    BEGIN
                                                                      TESTFIELD(Type,Type::"G/L Account");
                                                                      VATPostingSetup.TESTFIELD("Sales VAT Account");
                                                                      TESTFIELD("No.",VATPostingSetup."Sales VAT Account");
                                                                    END;
                                                                END;
                                                                IF SalesHeader."Prices Including VAT" AND (Type IN [Type::Item,Type::Resource]) THEN
                                                                  "Unit Price" :=
                                                                    ROUND(
                                                                      "Unit Price" * (100 + "VAT %") / (100 + xRec."VAT %"),
                                                                      Currency."Unit-Amount Rounding Precision");
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Tax Prod. Posting Group;
                                                              ESM=Grupo registro IVA prod.;
                                                              FRC=Groupe de report de produit taxe;
                                                              ENC=Tax Prod. Posting Group] }
    { 91  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   CaptionML=[ENU=Currency Code;
                                                              ESM=C¢d. divisa;
                                                              FRC=Code devise;
                                                              ENC=Currency Code];
                                                   Editable=No }
    { 92  ;   ;Outstanding Amount (LCY);Decimal   ;CaptionML=[ENU=Outstanding Amount ($);
                                                              ESM=Importe pendiente ($);
                                                              FRC=Montant non pay‚ ($);
                                                              ENC=Outstanding Amount ($)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 93  ;   ;Shipped Not Invoiced (LCY);Decimal ;CaptionML=[ENU=Shipped Not Invoiced ($);
                                                              ESM=Enviado no facturado ($);
                                                              FRC=Livr‚ non factur‚ ($);
                                                              ENC=Shipped Not Invoiced ($)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 95  ;   ;Reserved Quantity   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Reservation Entry".Quantity WHERE (Source ID=FIELD(Document No.),
                                                                                                        Source Ref. No.=FIELD(Line No.),
                                                                                                        Source Type=CONST(37),
                                                                                                        Source Subtype=FIELD(Document Type),
                                                                                                        Reservation Status=CONST(Reservation)));
                                                   CaptionML=[ENU=Reserved Quantity;
                                                              ESM=Cantidad reservada;
                                                              FRC=Quantit‚ r‚serv‚e;
                                                              ENC=Reserved Quantity];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 96  ;   ;Reserve             ;Option        ;OnValidate=BEGIN
                                                                IF Reserve <> Reserve::Never THEN BEGIN
                                                                  TESTFIELD(Type,Type::Item);
                                                                  TESTFIELD("No.");
                                                                END;
                                                                CALCFIELDS("Reserved Qty. (Base)");
                                                                IF (Reserve = Reserve::Never) AND ("Reserved Qty. (Base)" > 0) THEN
                                                                  TESTFIELD("Reserved Qty. (Base)",0);

                                                                IF "Drop Shipment" OR "Special Order" THEN
                                                                  TESTFIELD(Reserve,Reserve::Never);
                                                                IF xRec.Reserve = Reserve::Always THEN BEGIN
                                                                  GetItem;
                                                                  IF Item.Reserve = Item.Reserve::Always THEN
                                                                    TESTFIELD(Reserve,Reserve::Always);
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Reserve;
                                                              ESM=Reserva;
                                                              FRC=R‚server;
                                                              ENC=Reserve];
                                                   OptionCaptionML=[ENU=Never,Optional,Always;
                                                                    ESM=Nunca,Opcional,Siempre;
                                                                    FRC=Jamais,Optionnel,Toujours;
                                                                    ENC=Never,Optional,Always];
                                                   OptionString=Never,Optional,Always }
    { 97  ;   ;Blanket Order No.   ;Code20        ;TableRelation="Sales Header".No. WHERE (Document Type=CONST(Blanket Order));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Quantity Shipped",0);
                                                                IF "Blanket Order No." = '' THEN
                                                                  "Blanket Order Line No." := 0
                                                                ELSE
                                                                  VALIDATE("Blanket Order Line No.");
                                                              END;

                                                   OnLookup=BEGIN
                                                              TESTFIELD("Quantity Shipped",0);
                                                              BlanketOrderLookup;
                                                            END;

                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Blanket Order No.;
                                                              ESM=N§ pedido abierto;
                                                              FRC=Nø de commande permanente;
                                                              ENC=Blanket Order No.] }
    { 98  ;   ;Blanket Order Line No.;Integer     ;TableRelation="Sales Line"."Line No." WHERE (Document Type=CONST(Blanket Order),
                                                                                                Document No.=FIELD(Blanket Order No.));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Quantity Shipped",0);
                                                                IF "Blanket Order Line No." <> 0 THEN BEGIN
                                                                  SalesLine2.GET("Document Type"::"Blanket Order","Blanket Order No.","Blanket Order Line No.");
                                                                  SalesLine2.TESTFIELD(Type,Type);
                                                                  SalesLine2.TESTFIELD("No.","No.");
                                                                  SalesLine2.TESTFIELD("Bill-to Customer No.","Bill-to Customer No.");
                                                                  SalesLine2.TESTFIELD("Sell-to Customer No.","Sell-to Customer No.");
                                                                  VALIDATE("Location Code",SalesLine2."Location Code");
                                                                  VALIDATE("Unit of Measure Code",SalesLine2."Unit of Measure Code");
                                                                  VALIDATE("Unit Price",SalesLine2."Unit Price");
                                                                  VALIDATE("Line Discount %",SalesLine2."Line Discount %");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              BlanketOrderLookup;
                                                            END;

                                                   TestTableRelation=No;
                                                   CaptionML=[ENU=Blanket Order Line No.;
                                                              ESM=N§ l¡n. pedido abierto;
                                                              FRC=Nø ligne commande permanente;
                                                              ENC=Blanket Order Line No.] }
    { 99  ;   ;VAT Base Amount     ;Decimal       ;CaptionML=[ENU=Tax Base Amount;
                                                              ESM=Importe base IVA;
                                                              FRC=Montant de base de la taxe;
                                                              ENC=Tax Base Amount];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 100 ;   ;Unit Cost           ;Decimal       ;CaptionML=[ENU=Unit Cost;
                                                              ESM=Costo unitario;
                                                              FRC=Co–t unitaire;
                                                              ENC=Unit Cost];
                                                   Editable=No;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 101 ;   ;System-Created Entry;Boolean       ;CaptionML=[ENU=System-Created Entry;
                                                              ESM=Asiento autom tico;
                                                              FRC=criture systŠme;
                                                              ENC=System-Created Entry];
                                                   Editable=No }
    { 103 ;   ;Line Amount         ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD(Type);
                                                                TESTFIELD(Quantity);
                                                                TESTFIELD("Unit Price");
                                                                GetSalesHeader;
                                                                "Line Amount" := ROUND("Line Amount",Currency."Amount Rounding Precision");
                                                                VALIDATE(
                                                                  "Line Discount Amount",ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") - "Line Amount");
                                                              END;

                                                   CaptionML=[ENU=Line Amount;
                                                              ESM=Importe l¡nea;
                                                              FRC=Montant ligne;
                                                              ENC=Line Amount;
                                                              ESG=Importe l¡nea;
                                                              ESC=Importe l¡nea;
                                                              ESA=Importe l¡nea;
                                                              ESD=Importe l¡nea;
                                                              ESV=Importe l¡nea;
                                                              ESO=Importe l¡nea;
                                                              ESE=Importe l¡nea;
                                                              ESU=Importe l¡nea];
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Line Amount")) }
    { 104 ;   ;VAT Difference      ;Decimal       ;CaptionML=[ENU=Tax Difference;
                                                              ESM=Diferencia  IVA;
                                                              FRC=Diff‚rence TVA;
                                                              ENC=Tax Difference];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 105 ;   ;Inv. Disc. Amount to Invoice;Decimal;
                                                   CaptionML=[ENU=Inv. Disc. Amount to Invoice;
                                                              ESM=Importe dto. fact. para facturar;
                                                              FRC=Mont. escompte fact. … ‚mettre;
                                                              ENC=Inv. Disc. Amount to Invoice];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 106 ;   ;VAT Identifier      ;Code10        ;CaptionML=[ENU=Tax Identifier;
                                                              ESM=Identific. IVA;
                                                              FRC=Identificateur de TVA;
                                                              ENC=Tax Identifier];
                                                   Editable=No }
    { 107 ;   ;IC Partner Ref. Type;Option        ;OnValidate=BEGIN
                                                                IF "IC Partner Code" <> '' THEN
                                                                  "IC Partner Ref. Type" := "IC Partner Ref. Type"::"G/L Account";
                                                                IF "IC Partner Ref. Type" <> xRec."IC Partner Ref. Type" THEN
                                                                  "IC Partner Reference" := '';
                                                                IF "IC Partner Ref. Type" = "IC Partner Ref. Type"::"Common Item No." THEN BEGIN
                                                                  IF Item."No." <> "No." THEN
                                                                    Item.GET("No.");
                                                                  Item.TESTFIELD("Common Item No.");
                                                                  "IC Partner Reference" := Item."Common Item No.";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=IC Partner Ref. Type;
                                                              ESM=Tipo referencia socio IC;
                                                              FRC=Type r‚f. partenaire IC;
                                                              ENC=IC Partner Ref. Type];
                                                   OptionCaptionML=[ENU=" ,G/L Account,Item,,,Charge (Item),Cross Reference,Common Item No.";
                                                                    ESM=" ,Cuenta,Producto,,,Cargo (prod.),Referencia cruzada,N§ producto com£n";
                                                                    FRC=" ,Compte du grand livre,Article,,,Frais (Article),Renvoi,Nø article commun.";
                                                                    ENC=" ,G/L Account,Item,,,Charge (Item),Cross Reference,Common Item No."];
                                                   OptionString=[ ,G/L Account,Item,,,Charge (Item),Cross Reference,Common Item No.] }
    { 108 ;   ;IC Partner Reference;Code20        ;OnLookup=VAR
                                                              ICGLAccount@1000 : Record 410;
                                                              ItemCrossReference@1001 : Record 5717;
                                                            BEGIN
                                                              IF "No." <> '' THEN
                                                                CASE "IC Partner Ref. Type" OF
                                                                  "IC Partner Ref. Type"::"G/L Account":
                                                                    BEGIN
                                                                      IF ICGLAccount.GET("IC Partner Reference") THEN;
                                                                      IF PAGE.RUNMODAL(PAGE::"IC G/L Account List",ICGLAccount) = ACTION::LookupOK THEN
                                                                        VALIDATE("IC Partner Reference",ICGLAccount."No.");
                                                                    END;
                                                                  "IC Partner Ref. Type"::Item:
                                                                    BEGIN
                                                                      IF Item.GET("IC Partner Reference") THEN;
                                                                      IF PAGE.RUNMODAL(PAGE::"Item List",Item) = ACTION::LookupOK THEN
                                                                        VALIDATE("IC Partner Reference",Item."No.");
                                                                    END;
                                                                  "IC Partner Ref. Type"::"Cross Reference":
                                                                    BEGIN
                                                                      ItemCrossReference.RESET;
                                                                      ItemCrossReference.SETCURRENTKEY("Cross-Reference Type","Cross-Reference Type No.");
                                                                      ItemCrossReference.SETFILTER(
                                                                        "Cross-Reference Type",'%1|%2',
                                                                        ItemCrossReference."Cross-Reference Type"::Customer,
                                                                        ItemCrossReference."Cross-Reference Type"::" ");
                                                                      ItemCrossReference.SETFILTER("Cross-Reference Type No.",'%1|%2',"Sell-to Customer No.",'');
                                                                      IF PAGE.RUNMODAL(PAGE::"Cross Reference List",ItemCrossReference) = ACTION::LookupOK THEN
                                                                        VALIDATE("IC Partner Reference",ItemCrossReference."Cross-Reference No.");
                                                                    END;
                                                                END;
                                                            END;

                                                   CaptionML=[ENU=IC Partner Reference;
                                                              ESM=Referencia socio IC;
                                                              FRC=R‚f‚rence de partenaire IC;
                                                              ENC=IC Partner Reference] }
    { 109 ;   ;Prepayment %        ;Decimal       ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                UpdatePrepmtSetupFields;

                                                                IF Type <> Type::" " THEN
                                                                  UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment %;
                                                              ESM=% anticipo;
                                                              FRC=% paiement anticip‚;
                                                              ENC=Prepayment %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 110 ;   ;Prepmt. Line Amount ;Decimal       ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                PrePaymentLineAmountEntered := TRUE;
                                                                TESTFIELD("Line Amount");
                                                                IF "Prepmt. Line Amount" < "Prepmt. Amt. Inv." THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text044,"Prepmt. Amt. Inv."));
                                                                IF "Prepmt. Line Amount" > "Line Amount" THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,"Line Amount"));
                                                                IF "System-Created Entry" THEN
                                                                  FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,0));
                                                                IF Quantity <> 0 THEN
                                                                  VALIDATE("Prepayment %",ROUND("Prepmt. Line Amount" /
                                                                      ("Line Amount" * (Quantity - "Quantity Invoiced") / Quantity) * 100,0.00001))
                                                                ELSE
                                                                  VALIDATE("Prepayment %",ROUND("Prepmt. Line Amount" * 100 / "Line Amount",0.00001));
                                                              END;

                                                   CaptionML=[ENU=Prepmt. Line Amount;
                                                              ESM=Importe l¡nea anticipo;
                                                              FRC=Montant de ligne de paiement anticip‚;
                                                              ENC=Prepmt. Line Amount];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt. Line Amount")) }
    { 111 ;   ;Prepmt. Amt. Inv.   ;Decimal       ;CaptionML=[ENU=Prepmt. Amt. Inv.;
                                                              ESM=Importe anticipo facturado;
                                                              FRC=Montant facture pour paiement anticip‚;
                                                              ENC=Prepmt. Amt. Inv.];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt. Amt. Inv.")) }
    { 112 ;   ;Prepmt. Amt. Incl. VAT;Decimal     ;CaptionML=[ENU=Prepmt. Amt. Incl. Tax;
                                                              ESM=Importe anticipo con IVA;
                                                              FRC=TVA incluse sur montant paiement anticip‚;
                                                              ENC=Prepmt. Amt. Incl. Tax];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 113 ;   ;Prepayment Amount   ;Decimal       ;CaptionML=[ENU=Prepayment Amount;
                                                              ESM=Importe anticipo;
                                                              FRC=Montant de paiement anticip‚;
                                                              ENC=Prepayment Amount];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 114 ;   ;Prepmt. VAT Base Amt.;Decimal      ;CaptionML=[ENU=Prepmt. Tax Base Amt.;
                                                              ESM=Importe base IVA anticipo;
                                                              FRC=Montant de TVA de base de paiement anticip‚;
                                                              ENC=Prepmt. Tax Base Amt.];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 115 ;   ;Prepayment VAT %    ;Decimal       ;CaptionML=[ENU=Prepayment Tax %;
                                                              ESM=% IVA anticipo;
                                                              FRC=% TVA de paiement anticip‚;
                                                              ENC=Prepayment Tax %];
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   Editable=No }
    { 116 ;   ;Prepmt. VAT Calc. Type;Option      ;CaptionML=[ENU=Prepmt. Tax Calc. Type;
                                                              ESM=Tipo calc. IVA anticipo;
                                                              FRC=Type calcul TVA de paiement anticip‚;
                                                              ENC=Prepmt. Tax Calc. Type];
                                                   OptionCaptionML=[ENU=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                                    ESM=Normal,Reversi¢n,Total,Impto. venta;
                                                                    FRC=TVA normale,Frais renvers‚s TVA,TVA complŠte,Taxe de vente;
                                                                    ENC=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax];
                                                   OptionString=Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax;
                                                   Editable=No }
    { 117 ;   ;Prepayment VAT Identifier;Code10   ;CaptionML=[ENU=Prepayment Tax Identifier;
                                                              ESM=Identificador IVA anticipo;
                                                              FRC=Identificateur de TVA de paiement anticip‚;
                                                              ENC=Prepayment VAT Identifier];
                                                   Editable=No }
    { 118 ;   ;Prepayment Tax Area Code;Code20    ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Area Code;
                                                              ESM=C¢d.  rea impuesto anticipo;
                                                              FRC=Code de r‚gion fiscale de paiement anticip‚;
                                                              ENC=Prepayment Tax Area Code] }
    { 119 ;   ;Prepayment Tax Liable;Boolean      ;OnValidate=BEGIN
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Liable;
                                                              ESM=Sujeto a impuesto anticipo;
                                                              FRC=Solde imposable de paiement anticip‚;
                                                              ENC=Prepayment Tax Liable] }
    { 120 ;   ;Prepayment Tax Group Code;Code10   ;TableRelation="Tax Group";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                UpdateAmounts;
                                                              END;

                                                   CaptionML=[ENU=Prepayment Tax Group Code;
                                                              ESM=C¢d. grupo impuesto anticipo;
                                                              FRC=Code de groupe fiscal de paiement anticip‚;
                                                              ENC=Prepayment Tax Group Code] }
    { 121 ;   ;Prepmt Amt to Deduct;Decimal       ;OnValidate=BEGIN
                                                                IF "Prepmt Amt to Deduct" > "Prepmt. Amt. Inv." - "Prepmt Amt Deducted" THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text045,"Prepmt. Amt. Inv." - "Prepmt Amt Deducted"));

                                                                IF "Prepmt Amt to Deduct" > "Qty. to Invoice" * "Unit Price" THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text045,"Qty. to Invoice" * "Unit Price"));

                                                                IF ("Prepmt. Amt. Inv." - "Prepmt Amt to Deduct" - "Prepmt Amt Deducted") >
                                                                   (Quantity - "Qty. to Invoice" - "Quantity Invoiced") * "Unit Price"
                                                                THEN
                                                                  FIELDERROR(
                                                                    "Prepmt Amt to Deduct",
                                                                    STRSUBSTNO(Text044,
                                                                      "Prepmt. Amt. Inv." - "Prepmt Amt Deducted" - (Quantity - "Qty. to Invoice" - "Quantity Invoiced") * "Unit Price"));
                                                              END;

                                                   CaptionML=[ENU=Prepmt Amt to Deduct;
                                                              ESM=Importe anticipo para descontar;
                                                              FRC=Montant de paiement anticip‚ … d‚duire;
                                                              ENC=Prepmt Amt to Deduct];
                                                   MinValue=0;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt Amt to Deduct")) }
    { 122 ;   ;Prepmt Amt Deducted ;Decimal       ;CaptionML=[ENU=Prepmt Amt Deducted;
                                                              ESM=Importe anticipo descontado;
                                                              FRC=Montant de paiement anticip‚ d‚duit;
                                                              ENC=Prepmt Amt Deducted];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Prepmt Amt Deducted")) }
    { 123 ;   ;Prepayment Line     ;Boolean       ;CaptionML=[ENU=Prepayment Line;
                                                              ESM=L¡nea anticipo;
                                                              FRC=Ligne de paiement anticip‚;
                                                              ENC=Prepayment Line];
                                                   Editable=No }
    { 124 ;   ;Prepmt. Amount Inv. Incl. VAT;Decimal;
                                                   CaptionML=[ENU=Prepmt. Amount Inv. Incl. Tax;
                                                              ESM=Importe anticipo fact. con IVA;
                                                              FRC=TVA incluse sur montant de paiement anticip‚;
                                                              ENC=Prepmt. Amount Inv. Incl. Tax];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 129 ;   ;Prepmt. Amount Inv. (LCY);Decimal  ;CaptionML=[ENU=Prepmt. Amount Inv. ($);
                                                              ESM=Importe anticipo fact. ($);
                                                              FRC=Montant paiem. ant. factur‚ ($);
                                                              ENC=Prepmt. Amount Inv. ($)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 130 ;   ;IC Partner Code     ;Code20        ;TableRelation="IC Partner";
                                                   OnValidate=BEGIN
                                                                IF "IC Partner Code" <> '' THEN BEGIN
                                                                  TESTFIELD(Type,Type::"G/L Account");
                                                                  GetSalesHeader;
                                                                  SalesHeader.TESTFIELD("Sell-to IC Partner Code",'');
                                                                  SalesHeader.TESTFIELD("Bill-to IC Partner Code",'');
                                                                  VALIDATE("IC Partner Ref. Type","IC Partner Ref. Type"::"G/L Account");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=IC Partner Code;
                                                              ESM=C¢digo socio IC;
                                                              FRC=Code de partenaire IC;
                                                              ENC=IC Partner Code] }
    { 132 ;   ;Prepmt. VAT Amount Inv. (LCY);Decimal;
                                                   CaptionML=[ENU=Prepmt. Tax Amount Inv. ($);
                                                              ESM=Importe IVA anticipo fact. ($);
                                                              FRC=Montant TVA paiement anticip‚ factur‚ $;
                                                              ENC=Prepmt. Tax Amount Inv. ($)];
                                                   Editable=No }
    { 135 ;   ;Prepayment VAT Difference;Decimal  ;CaptionML=[ENU=Prepayment Tax Difference;
                                                              ESM=Diferencia IVA anticipo;
                                                              FRC=Diff‚rence TVA pour paiement anticip‚;
                                                              ENC=Prepayment Tax Difference];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 136 ;   ;Prepmt VAT Diff. to Deduct;Decimal ;CaptionML=[ENU=Prepmt Tax Diff. to Deduct;
                                                              ESM=Diferencia IVA anticipo a deducir;
                                                              FRC=Diff. TVA pr paiement anticip‚ … d‚duire;
                                                              ENC=Prepmt Tax Diff. to Deduct];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 137 ;   ;Prepmt VAT Diff. Deducted;Decimal  ;CaptionML=[ENU=Prepmt Tax Diff. Deducted;
                                                              ESM=Diferencia IVA anticipo deducida;
                                                              FRC=Diff. TVA pr paiement anticip‚ d‚duite;
                                                              ENC=Prepmt Tax Diff. Deducted];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 480 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnLookup=BEGIN
                                                              ShowDimensions;
                                                            END;

                                                   CaptionML=[ENU=Dimension Set ID;
                                                              ESM=Id. grupo dimensiones;
                                                              FRC=Code ensemble de dimensions;
                                                              ENC=Dimension Set ID];
                                                   Editable=No }
    { 900 ;   ;Qty. to Assemble to Order;Decimal  ;OnValidate=VAR
                                                                SalesLineReserve@1000 : Codeunit 99000832;
                                                              BEGIN
                                                                {
                                                                WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);

                                                                "Qty. to Asm. to Order (Base)" := CalcBaseQty("Qty. to Assemble to Order");

                                                                IF "Qty. to Asm. to Order (Base)" <> 0 THEN BEGIN
                                                                  TESTFIELD("Drop Shipment",FALSE);
                                                                  TESTFIELD("Special Order",FALSE);
                                                                  IF "Qty. to Asm. to Order (Base)" < 0 THEN
                                                                    FIELDERROR("Qty. to Assemble to Order",STRSUBSTNO(Text009,FIELDCAPTION("Quantity (Base)"),"Quantity (Base)"));
                                                                  TESTFIELD("Appl.-to Item Entry",0);

                                                                  CASE "Document Type" OF
                                                                    "Document Type"::"Blanket Order",
                                                                    "Document Type"::Quote:
                                                                      IF ("Quantity (Base)" = 0) OR ("Qty. to Asm. to Order (Base)" <= 0) OR SalesLineReserve.ReservEntryExist(Rec) THEN
                                                                        TESTFIELD("Qty. to Asm. to Order (Base)",0)
                                                                      ELSE
                                                                        IF "Quantity (Base)" <> "Qty. to Asm. to Order (Base)" THEN
                                                                          FIELDERROR("Qty. to Assemble to Order",STRSUBSTNO(Text031,0,"Quantity (Base)"));
                                                                    "Document Type"::Order:
                                                                      ;
                                                                    ELSE
                                                                      TESTFIELD("Qty. to Asm. to Order (Base)",0);
                                                                  END;
                                                                END;

                                                                CheckItemAvailable(FIELDNO("Qty. to Assemble to Order"));
                                                                IF NOT (CurrFieldNo IN [FIELDNO(Quantity),FIELDNO("Qty. to Assemble to Order")]) THEN
                                                                  GetDefaultBin;
                                                                AutoAsmToOrder;
                                                                   }
                                                              END;

                                                   CaptionML=[ENU=Qty. to Assemble to Order;
                                                              ESM=Cdad. en ensamblar para pedido;
                                                              FRC=Qt‚ vers Assembler pour commande;
                                                              ENC=Qty. to Assemble to Order];
                                                   DecimalPlaces=0:5 }
    { 901 ;   ;Qty. to Asm. to Order (Base);Decimal;
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Assemble to Order","Qty. to Asm. to Order (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Asm. to Order (Base);
                                                              ESM=Cdad. en pedido contra ensamblado (base);
                                                              FRC=Qt‚ vers Assembler pour commande (base);
                                                              ENC=Qty. to Asm. to Order (Base)];
                                                   DecimalPlaces=0:5 }
    { 902 ;   ;ATO Whse. Outstanding Qty.;Decimal ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding" WHERE (Source Type=CONST(37),
                                                                                                                       Source Subtype=FIELD(Document Type),
                                                                                                                       Source No.=FIELD(Document No.),
                                                                                                                       Source Line No.=FIELD(Line No.),
                                                                                                                       Assemble to Order=FILTER(Yes)));
                                                   CaptionML=[ENU=ATO Whse. Outstanding Qty.;
                                                              ESM=Cdad. pdte. almac‚n de ATO;
                                                              FRC=Qt‚ restante entrep“t ATO;
                                                              ENC=ATO Whse. Outstanding Qty.];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 903 ;   ;ATO Whse. Outstd. Qty. (Base);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding (Base)" WHERE (Source Type=CONST(37),
                                                                                                                              Source Subtype=FIELD(Document Type),
                                                                                                                              Source No.=FIELD(Document No.),
                                                                                                                              Source Line No.=FIELD(Line No.),
                                                                                                                              Assemble to Order=FILTER(Yes)));
                                                   CaptionML=[ENU=ATO Whse. Outstd. Qty. (Base);
                                                              ESM=Cdad. pdte. salida alm. de ATO;
                                                              FRC=Qt‚ restante entrep“t ATO (base);
                                                              ENC=ATO Whse. Outstd. Qty. (Base)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 1001;   ;Job Task No.        ;Code20        ;TableRelation="Job Task"."Job Task No." WHERE (Job No.=FIELD(Job No.));
                                                   CaptionML=[ENU=Job Task No.;
                                                              ESM=N§ tarea proyecto;
                                                              FRC=Nø tƒche de projet;
                                                              ENC=Job Task No.];
                                                   Editable=No }
    { 1002;   ;Job Contract Entry No.;Integer     ;OnValidate=VAR
                                                                JobPlanningLine@1001 : Record 1003;
                                                              BEGIN
                                                                JobPlanningLine.SETCURRENTKEY("Job Contract Entry No.");
                                                                JobPlanningLine.SETRANGE("Job Contract Entry No.","Job Contract Entry No.");
                                                                JobPlanningLine.FINDFIRST;
                                                                CreateDim(
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::Job,JobPlanningLine."Job No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");
                                                              END;

                                                   CaptionML=[ENU=Job Contract Entry No.;
                                                              ESM=N§ mov. contrato proyecto;
                                                              FRC=Nø ‚criture contrat de projet;
                                                              ENC=Job Contract Entry No.];
                                                   Editable=No }
    { 1300;   ;Posting Date        ;Date          ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Sales Header"."Posting Date" WHERE (Document Type=FIELD(Document Type),
                                                                                                           No.=FIELD(Document No.)));
                                                   CaptionML=[ENU=Posting Date;
                                                              ESM=Fecha registro;
                                                              FRC=Date de report;
                                                              ENC=Posting Date] }
    { 5402;   ;Variant Code        ;Code10        ;TableRelation=IF (Type=CONST(Item)) "Item Variant".Code WHERE (Item No.=FIELD(No.));
                                                   OnValidate=BEGIN
                                                                {
                                                                TestJobPlanningLine;
                                                                IF "Variant Code" <> '' THEN
                                                                  TESTFIELD(Type,Type::Item);
                                                                TestStatusOpen;
                                                                CheckAssocPurchOrder(FIELDCAPTION("Variant Code"));

                                                                IF xRec."Variant Code" <> "Variant Code" THEN BEGIN
                                                                  TESTFIELD("Qty. Shipped Not Invoiced",0);
                                                                  TESTFIELD("Shipment No.",'');

                                                                  TESTFIELD("Return Qty. Rcd. Not Invd.",0);
                                                                  TESTFIELD("Return Receipt No.",'');
                                                                  InitItemAppl(FALSE);
                                                                END;

                                                                CheckItemAvailable(FIELDNO("Variant Code"));

                                                                IF Type = Type::Item THEN BEGIN
                                                                  GetUnitCost;
                                                                  UpdateUnitPrice(FIELDNO("Variant Code"));
                                                                END;

                                                                GetDefaultBin;
                                                                InitQtyToAsm;
                                                                AutoAsmToOrder;
                                                                IF (xRec."Variant Code" <> "Variant Code") AND (Quantity <> 0) THEN BEGIN
                                                                  IF NOT FullReservedQtyIsForAsmToOrder THEN
                                                                    ReserveSalesLine.VerifyChange(Rec,xRec);
                                                                  WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                END;

                                                                UpdateItemCrossRef;
                                                                }
                                                              END;

                                                   CaptionML=[ENU=Variant Code;
                                                              ESM=C¢d. variante;
                                                              FRC=Code variante;
                                                              ENC=Variant Code] }
    { 5403;   ;Bin Code            ;Code20        ;TableRelation=IF (Document Type=FILTER(Order|Invoice),
                                                                     Quantity=FILTER(>=0),
                                                                     Qty. to Asm. to Order (Base)=CONST(0)) "Bin Content"."Bin Code" WHERE (Location Code=FIELD(Location Code),
                                                                                                                                            Item No.=FIELD(No.),
                                                                                                                                            Variant Code=FIELD(Variant Code))
                                                                                                                                            ELSE IF (Document Type=FILTER(Return Order|Credit Memo),
                                                                                                                                                     Quantity=FILTER(<0)) "Bin Content"."Bin Code" WHERE (Location Code=FIELD(Location Code),
                                                                                                                                                                                                          Item No.=FIELD(No.),
                                                                                                                                                                                                          Variant Code=FIELD(Variant Code))
                                                                                                                                                                                                          ELSE Bin.Code WHERE (Location Code=FIELD(Location Code));
                                                   OnValidate=VAR
                                                                WMSManagement@1001 : Codeunit 7302;
                                                              BEGIN
                                                                {
                                                                IF "Bin Code" <> '' THEN BEGIN
                                                                  IF NOT IsInbound AND ("Quantity (Base)" <> 0) AND ("Qty. to Asm. to Order (Base)" = 0) THEN
                                                                    WMSManagement.FindBinContent("Location Code","Bin Code","No.","Variant Code",'')
                                                                  ELSE
                                                                    WMSManagement.FindBin("Location Code","Bin Code",'');
                                                                END;

                                                                IF "Drop Shipment" THEN
                                                                  CheckAssocPurchOrder(FIELDCAPTION("Bin Code"));

                                                                TESTFIELD(Type,Type::Item);
                                                                TESTFIELD("Location Code");

                                                                IF (Type = Type::Item) AND ("Bin Code" <> '') THEN BEGIN
                                                                  TESTFIELD("Drop Shipment",FALSE);
                                                                  GetLocation("Location Code");
                                                                  Location.TESTFIELD("Bin Mandatory");
                                                                  CheckWarehouse;
                                                                END;
                                                                ATOLink.UpdateAsmBinCodeFromSalesLine(Rec);
                                                                 }
                                                              END;

                                                   OnLookup=VAR
                                                              WMSManagement@1002 : Codeunit 7302;
                                                              BinCode@1000 : Code[20];
                                                            BEGIN
                                                              IF NOT IsInbound AND ("Quantity (Base)" <> 0) THEN
                                                                BinCode := WMSManagement.BinContentLookUp("Location Code","No.","Variant Code",'',"Bin Code")
                                                              ELSE
                                                                BinCode := WMSManagement.BinLookUp("Location Code","No.","Variant Code",'');

                                                              IF BinCode <> '' THEN
                                                                VALIDATE("Bin Code",BinCode);
                                                            END;

                                                   CaptionML=[ENU=Bin Code;
                                                              ESM=C¢d. ubicaci¢n;
                                                              FRC=Code de zone;
                                                              ENC=Bin Code] }
    { 5404;   ;Qty. per Unit of Measure;Decimal   ;InitValue=1;
                                                   CaptionML=[ENU=Qty. per Unit of Measure;
                                                              ESM=Cdad. por unidad medida;
                                                              FRC=Quantit‚ par unit‚ de mesure;
                                                              ENC=Qty. per Unit of Measure];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5405;   ;Planned             ;Boolean       ;CaptionML=[ENU=Planned;
                                                              ESM=Planificada;
                                                              FRC=Planifi‚;
                                                              ENC=Planned];
                                                   Editable=No }
    { 5407;   ;Unit of Measure Code;Code10        ;TableRelation=IF (Type=CONST(Item),
                                                                     No.=FILTER(<>'')) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.))
                                                                     ELSE IF (Type=CONST(Resource),
                                                                              No.=FILTER(<>'')) "Resource Unit of Measure".Code WHERE (Resource No.=FIELD(No.))
                                                                              ELSE "Unit of Measure";
                                                   OnValidate=VAR
                                                                UnitOfMeasureTranslation@1000 : Record 5402;
                                                                ResUnitofMeasure@1001 : Record 205;
                                                                GLSetup@1310000 : Record 98;
                                                              BEGIN
                                                                TestJobPlanningLine;
                                                                TestStatusOpen;
                                                                GLSetup.GET;
                                                                IF GLSetup."PAC Environment" <> GLSetup."PAC Environment"::Disabled THEN
                                                                  TESTFIELD("Unit of Measure Code");
                                                                TESTFIELD("Quantity Shipped",0);
                                                                TESTFIELD("Qty. Shipped (Base)",0);
                                                                IF "Unit of Measure Code" <> xRec."Unit of Measure Code" THEN BEGIN
                                                                  TESTFIELD("Shipment No.",'');
                                                                  TESTFIELD("Return Receipt No.",'');
                                                                END;

                                                                CheckAssocPurchOrder(FIELDCAPTION("Unit of Measure Code"));

                                                                IF "Unit of Measure Code" = '' THEN
                                                                  "Unit of Measure" := ''
                                                                ELSE BEGIN
                                                                  IF NOT UnitOfMeasure.GET("Unit of Measure Code") THEN
                                                                    UnitOfMeasure.INIT;
                                                                  "Unit of Measure" := UnitOfMeasure.Description;
                                                                  GetSalesHeader;
                                                                  IF SalesHeader."Language Code" <> '' THEN BEGIN
                                                                    UnitOfMeasureTranslation.SETRANGE(Code,"Unit of Measure Code");
                                                                    UnitOfMeasureTranslation.SETRANGE("Language Code",SalesHeader."Language Code");
                                                                    IF UnitOfMeasureTranslation.FINDFIRST THEN
                                                                      "Unit of Measure" := UnitOfMeasureTranslation.Description;
                                                                  END;
                                                                END;
                                                                UpdateItemCrossRef;
                                                                CASE Type OF
                                                                  Type::Item:
                                                                    BEGIN
                                                                      GetItem;
                                                                      GetUnitCost;
                                                                      UpdateUnitPrice(FIELDNO("Unit of Measure Code"));
                                                                      CheckItemAvailable(FIELDNO("Unit of Measure Code"));
                                                                      "Gross Weight" := Item."Gross Weight" * "Qty. per Unit of Measure";
                                                                      "Net Weight" := Item."Net Weight" * "Qty. per Unit of Measure";
                                                                      "Unit Volume" := Item."Unit Volume" * "Qty. per Unit of Measure";
                                                                      "Units per Parcel" := ROUND(Item."Units per Parcel" / "Qty. per Unit of Measure",0.00001);
                                                                      {IF (xRec."Unit of Measure Code" <> "Unit of Measure Code") AND (Quantity <> 0) THEN
                                                                        WhseValidateSourceLine.SalesLineVerifyChange(Rec,xRec);
                                                                      }
                                                                      IF "Qty. per Unit of Measure" > xRec."Qty. per Unit of Measure" THEN
                                                                        InitItemAppl(FALSE);
                                                                      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 Start
                                                                      {IF "Document Type" <> "Document Type"::Quote THEN BEGIN  //TOP010E KT ABCSI 07282015
                                                                      IF (xRec."Unit of Measure Code" <> "Unit of Measure Code") AND ("Unit of Measure Code" <> '') AND (CurrFieldNo = FIELDNO("Unit of Measure Code")) THEN
                                                                        BEGIN
                                                                          UpdateLastSalesPrice(Rec);
                                                                        END;
                                                                      END; //TOP010E KT ABCSI 07282015
                                                                      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 End
                                                                        }
                                                                    END;
                                                                  Type::Resource:
                                                                    BEGIN
                                                                      IF "Unit of Measure Code" = '' THEN BEGIN
                                                                        GetResource;
                                                                        "Unit of Measure Code" := Resource."Base Unit of Measure";
                                                                      END;
                                                                      ResUnitofMeasure.GET("No.","Unit of Measure Code");
                                                                      "Qty. per Unit of Measure" := ResUnitofMeasure."Qty. per Unit of Measure";
                                                                      UpdateUnitPrice(FIELDNO("Unit of Measure Code"));
                                                                      FindResUnitCost;
                                                                    END;
                                                                  Type::"G/L Account",Type::"Fixed Asset",Type::"Charge (Item)",Type::" ":
                                                                    "Qty. per Unit of Measure" := 1;
                                                                END;

                                                                // << Shipping
                                                                CASE Type OF
                                                                  Type::Item:
                                                                    BEGIN
                                                                      "Dimmed Weight" := Item."Dimmed Weight" * "Qty. per Unit of Measure";
                                                                    END;
                                                                  Type::Resource:
                                                                    BEGIN
                                                                      Res.GET("No.");
                                                                      "Gross Weight" := Res."Gross Weight";
                                                                      "Net Weight" := Res."Net Weight";
                                                                      "Dimmed Weight" := Res."Dimmed Weight";
                                                                      "Unit Volume" := Res."Unit Volume";
                                                                    END;
                                                                END;
                                                                // >> Shipping

                                                                VALIDATE(Quantity);
                                                              END;

                                                   CaptionML=[ENU=Unit of Measure Code;
                                                              ESM=C¢d. unidad medida;
                                                              FRC=Code unit‚ de mesure;
                                                              ENC=Unit of Measure Code;
                                                              ESG=C¢d. unidad medida;
                                                              ESC=C¢d. unidad medida;
                                                              ESA=C¢d. unidad medida;
                                                              ESD=C¢d. unidad medida;
                                                              ESV=C¢d. unidad medida;
                                                              ESO=C¢d. unidad medida;
                                                              ESE=C¢d. unidad medida;
                                                              ESU=C¢d. unidad medida] }
    { 5415;   ;Quantity (Base)     ;Decimal       ;OnValidate=BEGIN
                                                                TestJobPlanningLine;
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE(Quantity,"Quantity (Base)");
                                                                UpdateUnitPrice(FIELDNO("Quantity (Base)"));
                                                              END;

                                                   CaptionML=[ENU=Quantity (Base);
                                                              ESM=Cantidad (base);
                                                              FRC=Quantit‚ (base);
                                                              ENC=Quantity (Base)];
                                                   DecimalPlaces=0:5 }
    { 5416;   ;Outstanding Qty. (Base);Decimal    ;CaptionML=[ENU=Outstanding Qty. (Base);
                                                              ESM=Cdad. pendiente (base);
                                                              FRC=Quantit‚ en suspens (base);
                                                              ENC=Outstanding Qty. (Base)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5417;   ;Qty. to Invoice (Base);Decimal     ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Invoice","Qty. to Invoice (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Invoice (Base);
                                                              ESM=Cdad. a facturar (base);
                                                              FRC=Quantit‚ … facturer (base);
                                                              ENC=Qty. to Invoice (Base)];
                                                   DecimalPlaces=0:5 }
    { 5418;   ;Qty. to Ship (Base) ;Decimal       ;OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Qty. to Ship","Qty. to Ship (Base)");
                                                              END;

                                                   CaptionML=[ENU=Qty. to Ship (Base);
                                                              ESM=Cdad. a enviar (base);
                                                              FRC=Quantit‚ … livrer (base);
                                                              ENC=Qty. to Ship (Base)];
                                                   DecimalPlaces=0:5 }
    { 5458;   ;Qty. Shipped Not Invd. (Base);Decimal;
                                                   CaptionML=[ENU=Qty. Shipped Not Invd. (Base);
                                                              ESM=Cdad. enviada no fact. (base);
                                                              FRC=Qt‚ livr‚e non fact. (base);
                                                              ENC=Qty. Shipped Not Invd. (Base)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5460;   ;Qty. Shipped (Base) ;Decimal       ;CaptionML=[ENU=Qty. Shipped (Base);
                                                              ESM=Cdad. enviada (base);
                                                              FRC=Quantit‚ livr‚e (base);
                                                              ENC=Qty. Shipped (Base)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5461;   ;Qty. Invoiced (Base);Decimal       ;CaptionML=[ENU=Qty. Invoiced (Base);
                                                              ESM=Cdad. facturada (base);
                                                              FRC=Quantit‚ factur‚e (base);
                                                              ENC=Qty. Invoiced (Base)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5495;   ;Reserved Qty. (Base);Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=-Sum("Reservation Entry"."Quantity (Base)" WHERE (Source ID=FIELD(Document No.),
                                                                                                                 Source Ref. No.=FIELD(Line No.),
                                                                                                                 Source Type=CONST(37),
                                                                                                                 Source Subtype=FIELD(Document Type),
                                                                                                                 Reservation Status=CONST(Reservation)));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure");
                                                                CALCFIELDS("Reserved Quantity");
                                                                Planned := "Reserved Quantity" = "Outstanding Quantity";
                                                              END;

                                                   CaptionML=[ENU=Reserved Qty. (Base);
                                                              ESM=Cdad. reservada (base);
                                                              FRC=Quantit‚ r‚serv‚e (base);
                                                              ENC=Reserved Qty. (Base)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5600;   ;FA Posting Date     ;Date          ;CaptionML=[ENU=FA Posting Date;
                                                              ESM=A/F Fecha registro;
                                                              FRC=Date report immo.;
                                                              ENC=FA Posting Date] }
    { 5602;   ;Depreciation Book Code;Code10      ;TableRelation="Depreciation Book";
                                                   OnValidate=BEGIN
                                                                GetFAPostingGroup;
                                                              END;

                                                   CaptionML=[ENU=Depreciation Book Code;
                                                              ESM=C¢d. libro amortizaci¢n;
                                                              FRC=Code registre amortissement;
                                                              ENC=Depreciation Book Code] }
    { 5605;   ;Depr. until FA Posting Date;Boolean;CaptionML=[ENU=Depr. until FA Posting Date;
                                                              ESM=A/F Amort. hasta fecha reg.;
                                                              FRC=Amort. jusqu'… date report;
                                                              ENC=Depr. until FA Posting Date] }
    { 5612;   ;Duplicate in Depreciation Book;Code10;
                                                   TableRelation="Depreciation Book";
                                                   OnValidate=BEGIN
                                                                "Use Duplication List" := FALSE;
                                                              END;

                                                   CaptionML=[ENU=Duplicate in Depreciation Book;
                                                              ESM=Duplicado en libro amort.;
                                                              FRC=Registre amortiss. en double;
                                                              ENC=Duplicate in Depreciation Book] }
    { 5613;   ;Use Duplication List;Boolean       ;OnValidate=BEGIN
                                                                "Duplicate in Depreciation Book" := '';
                                                              END;

                                                   CaptionML=[ENU=Use Duplication List;
                                                              ESM=Utilizar lista duplicados;
                                                              FRC=Utiliser liste duplication;
                                                              ENC=Use Duplication List] }
    { 5700;   ;Responsibility Center;Code10       ;TableRelation="Responsibility Center";
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DimMgt.TypeToTableID3(Type),"No.",
                                                                  DATABASE::Job,"Job No.");
                                                              END;

                                                   CaptionML=[ENU=Responsibility Center;
                                                              ESM=Centro responsabilidad;
                                                              FRC=Centre de gestion;
                                                              ENC=Responsibility Centre];
                                                   Editable=No }
    { 5701;   ;Out-of-Stock Substitution;Boolean  ;CaptionML=[ENU=Out-of-Stock Substitution;
                                                              ESM=Sustituc. por falta de existencias;
                                                              FRC=Substitution sur rupture;
                                                              ENC=Out-of-Stock Substitution];
                                                   Editable=No }
    { 5702;   ;Substitution Available;Boolean     ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Item Substitution" WHERE (Type=CONST(Item),
                                                                                                No.=FIELD(No.),
                                                                                                Substitute Type=CONST(Item)));
                                                   CaptionML=[ENU=Substitution Available;
                                                              ESM=Disponible sustituci¢n;
                                                              FRC=Substitution disponible;
                                                              ENC=Substitution Available];
                                                   Editable=No }
    { 5703;   ;Originally Ordered No.;Code20      ;TableRelation=IF (Type=CONST(Item)) Item;
                                                   CaptionML=[ENU=Originally Ordered No.;
                                                              ESM=N§ pedido originalmente;
                                                              FRC=Nø article substitu‚;
                                                              ENC=Originally Ordered No.] }
    { 5704;   ;Originally Ordered Var. Code;Code10;TableRelation=IF (Type=CONST(Item)) "Item Variant".Code WHERE (Item No.=FIELD(Originally Ordered No.));
                                                   CaptionML=[ENU=Originally Ordered Var. Code;
                                                              ESM=C¢d. var. ped. originalmente;
                                                              FRC=Code variante substitu‚;
                                                              ENC=Originally Ordered Var. Code] }
    { 5705;   ;Cross-Reference No. ;Code20        ;OnValidate=VAR
                                                                ReturnedCrossRef@1000 : Record 5717;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                "Sell-to Customer No." := SalesHeader."Sell-to Customer No.";
                                                                ReturnedCrossRef.INIT;
                                                                IF "Cross-Reference No." <> '' THEN BEGIN
                                                                  // <TPZ449>
                                                                  DistIntegration.SetHideValidationDialog(HideValidationDialog);
                                                                  // </TPZ449>
                                                                  //DistIntegration.ICRLookupSalesItem(Rec,ReturnedCrossRef);
                                                                  IF "No." <> ReturnedCrossRef."Item No." THEN
                                                                    VALIDATE("No.",ReturnedCrossRef."Item No.");
                                                                  IF ReturnedCrossRef."Variant Code" <> '' THEN
                                                                    VALIDATE("Variant Code",ReturnedCrossRef."Variant Code");

                                                                  IF ReturnedCrossRef."Unit of Measure" <> '' THEN
                                                                    VALIDATE("Unit of Measure Code",ReturnedCrossRef."Unit of Measure");
                                                                END;

                                                                "Unit of Measure (Cross Ref.)" := ReturnedCrossRef."Unit of Measure";
                                                                "Cross-Reference Type" := ReturnedCrossRef."Cross-Reference Type";
                                                                "Cross-Reference Type No." := ReturnedCrossRef."Cross-Reference Type No.";
                                                                "Cross-Reference No." := ReturnedCrossRef."Cross-Reference No.";

                                                                IF ReturnedCrossRef.Description <> '' THEN
                                                                  Description := ReturnedCrossRef.Description;

                                                                UpdateUnitPrice(FIELDNO("Cross-Reference No."));
                                                                UpdateICPartner;
                                                              END;

                                                   OnLookup=BEGIN
                                                              CrossReferenceNoLookUp;
                                                            END;

                                                   CaptionML=[ENU=Cross-Reference No.;
                                                              ESM=N§ referencia cruzada;
                                                              FRC=R‚f‚rence externe;
                                                              ENC=Cross-Reference No.;
                                                              ESG=N§ referencia cruzada;
                                                              ESC=N§ referencia cruzada;
                                                              ESA=N§ referencia cruzada;
                                                              ESD=N§ referencia cruzada;
                                                              ESV=N§ referencia cruzada;
                                                              ESO=N§ referencia cruzada;
                                                              ESE=N§ referencia cruzada;
                                                              ESU=N§ referencia cruzada] }
    { 5706;   ;Unit of Measure (Cross Ref.);Code10;TableRelation=IF (Type=CONST(Item)) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.));
                                                   CaptionML=[ENU=Unit of Measure (Cross Ref.);
                                                              ESM=Unidad de medida (ref.cruz.);
                                                              FRC=Unit‚ de mesure (r‚f‚rence crois‚e);
                                                              ENC=Unit of Measure (Cross Ref.)] }
    { 5707;   ;Cross-Reference Type;Option        ;CaptionML=[ENU=Cross-Reference Type;
                                                              ESM=Tipo referencia cruzada;
                                                              FRC=Type r‚f‚rence externe;
                                                              ENC=Cross-Reference Type];
                                                   OptionCaptionML=[ENU=" ,Customer,Vendor,Bar Code";
                                                                    ESM=" ,Cliente,Prov.,C¢d. barra";
                                                                    FRC=" ,Client,Fournisseur,Code … barres";
                                                                    ENC=" ,Customer,Vendor,Bar Code"];
                                                   OptionString=[ ,Customer,Vendor,Bar Code] }
    { 5708;   ;Cross-Reference Type No.;Code30    ;CaptionML=[ENU=Cross-Reference Type No.;
                                                              ESM=N§ tipo referencia cruzada;
                                                              FRC=Nø type r‚f‚rence externe;
                                                              ENC=Cross-Reference Type No.] }
    { 5709;   ;Item Category Code  ;Code10        ;TableRelation="Item Category";
                                                   CaptionML=[ENU=Item Category Code;
                                                              ESM=C¢d. categor¡a producto;
                                                              FRC=Code cat‚gorie;
                                                              ENC=Item Category Code] }
    { 5710;   ;Nonstock            ;Boolean       ;CaptionML=[ENU=Nonstock;
                                                              ESM=Prod. no inventariable;
                                                              FRC=Non stock‚;
                                                              ENC=Nonstock];
                                                   Editable=No }
    { 5711;   ;Purchasing Code     ;Code10        ;TableRelation=Purchasing;
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                TESTFIELD(Type,Type::Item);
                                                                CheckAssocPurchOrder(FIELDCAPTION(Type));

                                                                IF PurchasingCode.GET("Purchasing Code") THEN BEGIN
                                                                  "Drop Shipment" := PurchasingCode."Drop Shipment";
                                                                  "Special Order" := PurchasingCode."Special Order";
                                                                  IF "Drop Shipment" OR "Special Order" THEN BEGIN
                                                                    TESTFIELD("Qty. to Asm. to Order (Base)",0);
                                                                    CALCFIELDS("Reserved Qty. (Base)");
                                                                    TESTFIELD("Reserved Qty. (Base)",0);
                                                                    IF (Quantity <> 0) AND (Quantity = "Quantity Shipped") THEN
                                                                      ERROR(SalesLineCompletelyShippedErr);
                                                                    Reserve := Reserve::Never;
                                                                    VALIDATE(Quantity,Quantity);
                                                                    IF "Drop Shipment" THEN BEGIN
                                                                      EVALUATE("Outbound Whse. Handling Time",'<0D>');
                                                                      EVALUATE("Shipping Time",'<0D>');
                                                                      UpdateDates;
                                                                      "Bin Code" := '';
                                                                    END;
                                                                  END;
                                                                END ELSE BEGIN
                                                                  "Drop Shipment" := FALSE;
                                                                  "Special Order" := FALSE;

                                                                  GetItem;
                                                                  IF Item.Reserve = Item.Reserve::Optional THEN BEGIN
                                                                    GetSalesHeader;
                                                                    Reserve := SalesHeader.Reserve;
                                                                  END ELSE
                                                                    Reserve := Item.Reserve;
                                                                END;

                                                                IF ("Purchasing Code" <> xRec."Purchasing Code") AND
                                                                   (NOT "Drop Shipment") AND
                                                                   ("Drop Shipment" <> xRec."Drop Shipment")
                                                                THEN BEGIN
                                                                  IF "Location Code" = '' THEN BEGIN
                                                                    IF InvtSetup.GET THEN
                                                                      "Outbound Whse. Handling Time" := InvtSetup."Outbound Whse. Handling Time";
                                                                  END ELSE
                                                                    IF Location.GET("Location Code") THEN
                                                                      "Outbound Whse. Handling Time" := Location."Outbound Whse. Handling Time";
                                                                  IF ShippingAgentServices.GET("Shipping Agent Code","Shipping Agent Service Code") THEN
                                                                    "Shipping Time" := ShippingAgentServices."Shipping Time"
                                                                  ELSE BEGIN
                                                                    GetSalesHeader;
                                                                    "Shipping Time" := SalesHeader."Shipping Time";
                                                                  END;
                                                                  UpdateDates;
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Purchasing Code;
                                                              ESM=C¢d. compra;
                                                              FRC=Code achat;
                                                              ENC=Purchasing Code] }
    { 5712;   ;Product Group Code  ;Code10        ;TableRelation="Product Group".Code WHERE (Item Category Code=FIELD(Item Category Code));
                                                   CaptionML=[ENU=Product Group Code;
                                                              ESM=C¢d. grupo producto;
                                                              FRC=Code groupe produits;
                                                              ENC=Product Group Code] }
    { 5713;   ;Special Order       ;Boolean       ;CaptionML=[ENU=Special Order;
                                                              ESM=Pedido especial;
                                                              FRC=Commande sp‚ciale;
                                                              ENC=Special Order];
                                                   Editable=No }
    { 5714;   ;Special Order Purchase No.;Code20  ;TableRelation=IF (Special Order=CONST(Yes)) "Purchase Header".No. WHERE (Document Type=CONST(Order));
                                                   CaptionML=[ENU=Special Order Purchase No.;
                                                              ESM=N§ pedido compra especial;
                                                              FRC=N§ bon de commande sp‚ciale;
                                                              ENC=Special Order Purchase No.] }
    { 5715;   ;Special Order Purch. Line No.;Integer;
                                                   TableRelation=IF (Special Order=CONST(Yes)) "Purchase Line"."Line No." WHERE (Document Type=CONST(Order),
                                                                                                                                 Document No.=FIELD(Special Order Purchase No.));
                                                   CaptionML=[ENU=Special Order Purch. Line No.;
                                                              ESM=N§ l¡n. ped. compra especial;
                                                              FRC=Nø ligne bon de comm. sp‚ciale;
                                                              ENC=Special Order Purch. Line No.] }
    { 5749;   ;Whse. Outstanding Qty.;Decimal     ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding" WHERE (Source Type=CONST(37),
                                                                                                                       Source Subtype=FIELD(Document Type),
                                                                                                                       Source No.=FIELD(Document No.),
                                                                                                                       Source Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Whse. Outstanding Qty.;
                                                              ESM=Cdad. pdte. almac‚n;
                                                              FRC=Qt‚ restante magasin;
                                                              ENC=Whse. Outstanding Qty.];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 5750;   ;Whse. Outstanding Qty. (Base);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. Outstanding (Base)" WHERE (Source Type=CONST(37),
                                                                                                                              Source Subtype=FIELD(Document Type),
                                                                                                                              Source No.=FIELD(Document No.),
                                                                                                                              Source Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Whse. Outstanding Qty. (Base);
                                                              ESM=Cdad. pdte. almac‚n (base);
                                                              FRC=Qt‚ restante entrep“t (base);
                                                              ENC=Whse. Outstanding Qty. (Base)];
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 5752;   ;Completely Shipped  ;Boolean       ;CaptionML=[ENU=Completely Shipped;
                                                              ESM=Enviado completamente;
                                                              FRC=EntiŠrement livr‚e;
                                                              ENC=Completely Shipped];
                                                   Editable=No }
    { 5790;   ;Requested Delivery Date;Date       ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF ("Requested Delivery Date" <> xRec."Requested Delivery Date") AND
                                                                   ("Promised Delivery Date" <> 0D)
                                                                THEN
                                                                  ERROR(
                                                                    Text028,
                                                                    FIELDCAPTION("Requested Delivery Date"),
                                                                    FIELDCAPTION("Promised Delivery Date"));

                                                                 // UBP
                                                                IF "Requested Delivery Date" <> 0D THEN BEGIN
                                                                  VALIDATE("Planned Delivery Date","Requested Delivery Date");
                                                                  "Demand Date" := "Planned Delivery Date";
                                                                END ELSE BEGIN
                                                                // UBP
                                                                  GetSalesHeader;
                                                                  VALIDATE("Shipment Date",SalesHeader."Shipment Date");
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Requested Delivery Date;
                                                              ESM=Fecha entrega requerida;
                                                              FRC=Date livraison demand‚e;
                                                              ENC=Requested Delivery Date] }
    { 5791;   ;Promised Delivery Date;Date        ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Promised Delivery Date" <> 0D THEN
                                                                  VALIDATE("Planned Delivery Date","Promised Delivery Date")
                                                                ELSE
                                                                  VALIDATE("Requested Delivery Date");
                                                              END;

                                                   CaptionML=[ENU=Promised Delivery Date;
                                                              ESM=Fecha entrega prometida;
                                                              FRC=Date livraison confirm‚e;
                                                              ENC=Promised Delivery Date] }
    { 5792;   ;Shipping Time       ;DateFormula   ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Drop Shipment" THEN
                                                                  DateFormularZero("Shipping Time",FIELDNO("Shipping Time"),FIELDCAPTION("Shipping Time"));
                                                                UpdateDates;
                                                              END;

                                                   CaptionML=[ENU=Shipping Time;
                                                              ESM=Tiempo env¡o;
                                                              FRC=D‚lai de livraison;
                                                              ENC=Shipping Time] }
    { 5793;   ;Outbound Whse. Handling Time;DateFormula;
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Drop Shipment" THEN
                                                                  DateFormularZero("Outbound Whse. Handling Time",
                                                                    FIELDNO("Outbound Whse. Handling Time"),FIELDCAPTION("Outbound Whse. Handling Time"));
                                                                UpdateDates;
                                                              END;

                                                   CaptionML=[ENU=Outbound Whse. Handling Time;
                                                              ESM=Tiempo manip. alm. salida;
                                                              FRC=D‚lai d‚senlogement;
                                                              ENC=Outbound Whse. Handling Time] }
    { 5794;   ;Planned Delivery Date;Date         ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Planned Delivery Date" <> 0D THEN BEGIN
                                                                  PlannedDeliveryDateCalculated := TRUE;

                                                                  IF FORMAT("Shipping Time") <> '' THEN
                                                                    VALIDATE("Planned Shipment Date",CalcPlannedDeliveryDate(FIELDNO("Planned Delivery Date")))
                                                                  ELSE
                                                                    VALIDATE("Planned Shipment Date",CalcPlannedShptDate(FIELDNO("Planned Delivery Date")));

                                                                  IF "Planned Shipment Date" > "Planned Delivery Date" THEN
                                                                    "Planned Delivery Date" := "Planned Shipment Date";
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Planned Delivery Date;
                                                              ESM=Fecha entrega planificada;
                                                              FRC=Date livraison planifi‚e;
                                                              ENC=Planned Delivery Date] }
    { 5795;   ;Planned Shipment Date;Date         ;OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Planned Shipment Date" <> 0D THEN BEGIN
                                                                  PlannedShipmentDateCalculated := TRUE;

                                                                  IF FORMAT("Outbound Whse. Handling Time") <> '' THEN
                                                                    VALIDATE(
                                                                      "Shipment Date",
                                                                      CalendarMgmt.CalcDateBOC2(
                                                                        FORMAT("Outbound Whse. Handling Time"),
                                                                        "Planned Shipment Date",
                                                                        CalChange."Source Type"::"Shipping Agent",
                                                                        "Shipping Agent Code",
                                                                        "Shipping Agent Service Code",
                                                                        CalChange."Source Type"::Location,
                                                                        "Location Code",
                                                                        '',
                                                                        FALSE))
                                                                  ELSE
                                                                    VALIDATE(
                                                                      "Shipment Date",
                                                                      CalendarMgmt.CalcDateBOC(
                                                                        FORMAT(FORMAT('')),
                                                                        "Planned Shipment Date",
                                                                        CalChange."Source Type"::"Shipping Agent",
                                                                        "Shipping Agent Code",
                                                                        "Shipping Agent Service Code",
                                                                        CalChange."Source Type"::Location,
                                                                        "Location Code",
                                                                        '',
                                                                        FALSE));
                                                                END;
                                                              END;

                                                   CaptionML=[ENU=Planned Shipment Date;
                                                              ESM=Fecha env¡o planificada;
                                                              FRC=Date de livraison planifi‚e;
                                                              ENC=Planned Shipment Date] }
    { 5796;   ;Shipping Agent Code ;Code10        ;TableRelation="Shipping Agent";
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Shipping Agent Code" <> xRec."Shipping Agent Code" THEN
                                                                  VALIDATE("Shipping Agent Service Code",'');

                                                                // >> Shipping
                                                                IF ("Shipping Agent Code" <> xRec."Shipping Agent Code") AND
                                                                   (CurrFieldNo = FIELDNO("Shipping Agent Code"))
                                                                THEN
                                                                  VALIDATE("E-Ship Agent Code","Shipping Agent Code");
                                                                // << Shipping
                                                              END;

                                                   CaptionML=[ENU=Shipping Agent Code;
                                                              ESM=C¢d. transportista;
                                                              FRC=Code agent de livraison;
                                                              ENC=Shipping Agent Code] }
    { 5797;   ;Shipping Agent Service Code;Code10 ;TableRelation="Shipping Agent Services".Code WHERE (Shipping Agent Code=FIELD(Shipping Agent Code));
                                                   OnValidate=BEGIN
                                                                TestStatusOpen;
                                                                IF "Shipping Agent Service Code" <> xRec."Shipping Agent Service Code" THEN
                                                                  EVALUATE("Shipping Time",'<>');

                                                                IF "Drop Shipment" THEN BEGIN
                                                                  EVALUATE("Shipping Time",'<0D>');
                                                                  UpdateDates;
                                                                END ELSE BEGIN
                                                                  IF ShippingAgentServices.GET("Shipping Agent Code","Shipping Agent Service Code") THEN
                                                                    "Shipping Time" := ShippingAgentServices."Shipping Time"
                                                                  ELSE BEGIN
                                                                    GetSalesHeader;
                                                                    "Shipping Time" := SalesHeader."Shipping Time";
                                                                  END;
                                                                END;

                                                                IF ShippingAgentServices."Shipping Time" <> xRec."Shipping Time" THEN
                                                                  VALIDATE("Shipping Time","Shipping Time");
                                                              END;

                                                   CaptionML=[ENU=Shipping Agent Service Code;
                                                              ESM=C¢d. servicio transportista;
                                                              FRC=Code prestation agent de livraison;
                                                              ENC=Shipping Agent Service Code] }
    { 5800;   ;Allow Item Charge Assignment;Boolean;
                                                   InitValue=Yes;
                                                   OnValidate=BEGIN
                                                                CheckItemChargeAssgnt;
                                                              END;

                                                   CaptionML=[ENU=Allow Item Charge Assignment;
                                                              ESM=Permitir asign. cargos prod.;
                                                              FRC=Autor. affect. frais annexes;
                                                              ENC=Allow Item Charge Assignment] }
    { 5801;   ;Qty. to Assign      ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Charge Assignment (Sales)"."Qty. to Assign" WHERE (Document Type=FIELD(Document Type),
                                                                                                                            Document No.=FIELD(Document No.),
                                                                                                                            Document Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Qty. to Assign;
                                                              ESM=Cdad. a asignar;
                                                              FRC=Qt‚ … affecter;
                                                              ENC=Qty. to Assign];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5802;   ;Qty. Assigned       ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Item Charge Assignment (Sales)"."Qty. Assigned" WHERE (Document Type=FIELD(Document Type),
                                                                                                                           Document No.=FIELD(Document No.),
                                                                                                                           Document Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Qty. Assigned;
                                                              ESM=Cdad. asignada;
                                                              FRC=Qt‚ affect‚e;
                                                              ENC=Qty Assig];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5803;   ;Return Qty. to Receive;Decimal     ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                              BEGIN
                                                                IF (CurrFieldNo <> 0) AND
                                                                   (Type = Type::Item) AND
                                                                   ("Return Qty. to Receive" <> 0) AND
                                                                   (NOT "Drop Shipment")
                                                                THEN
                                                                  CheckWarehouse;

                                                                IF "Return Qty. to Receive" = Quantity - "Return Qty. Received" THEN
                                                                  InitQtyToReceive
                                                                ELSE BEGIN
                                                                  "Return Qty. to Receive (Base)" := CalcBaseQty("Return Qty. to Receive");
                                                                  InitQtyToInvoice;
                                                                END;
                                                                IF ("Return Qty. to Receive" * Quantity < 0) OR
                                                                   (ABS("Return Qty. to Receive") > ABS("Outstanding Quantity")) OR
                                                                   (Quantity * "Outstanding Quantity" < 0)
                                                                THEN
                                                                  ERROR(
                                                                    Text020,
                                                                    "Outstanding Quantity");
                                                                IF ("Return Qty. to Receive (Base)" * "Quantity (Base)" < 0) OR
                                                                   (ABS("Return Qty. to Receive (Base)") > ABS("Outstanding Qty. (Base)")) OR
                                                                   ("Quantity (Base)" * "Outstanding Qty. (Base)" < 0)
                                                                THEN
                                                                  ERROR(
                                                                    Text021,
                                                                    "Outstanding Qty. (Base)");

                                                                IF (CurrFieldNo <> 0) AND (Type = Type::Item) AND ("Return Qty. to Receive" > 0) THEN
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);
                                                              END;

                                                   CaptionML=[ENU=Return Qty. to Receive;
                                                              ESM=Cantidad dev. a recibir;
                                                              FRC=Qt‚ retour … recevoir;
                                                              ENC=Return Qty. to Receive];
                                                   DecimalPlaces=0:5 }
    { 5804;   ;Return Qty. to Receive (Base);Decimal;
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Qty. per Unit of Measure",1);
                                                                VALIDATE("Return Qty. to Receive","Return Qty. to Receive (Base)");
                                                              END;

                                                   CaptionML=[ENU=Return Qty. to Receive (Base);
                                                              ESM=Cantidad dev. a recibir (Base);
                                                              FRC=Qt‚ retour … recevoir (base);
                                                              ENC=Return Qty. to Receive (Base)];
                                                   DecimalPlaces=0:5 }
    { 5805;   ;Return Qty. Rcd. Not Invd.;Decimal ;CaptionML=[ENU=Return Qty. Rcd. Not Invd.;
                                                              ESM=Cantidad dev. rec. no fact.;
                                                              FRC=Qt‚ retour re‡ue non factur‚e;
                                                              ENC=Return Qty. Rcd. Not Invd.];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5806;   ;Ret. Qty. Rcd. Not Invd.(Base);Decimal;
                                                   CaptionML=[ENU=Ret. Qty. Rcd. Not Invd.(Base);
                                                              ESM=Cantidad dev. rec. no fact.(Base);
                                                              FRC=Qt‚ ret. re‡ue non fac. (base);
                                                              ENC=Ret. Qty. Rcd. Not Invd.(Base)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5807;   ;Return Rcd. Not Invd.;Decimal      ;OnValidate=VAR
                                                                Currency2@1000 : Record 4;
                                                              BEGIN
                                                                GetSalesHeader;
                                                                Currency2.InitRoundingPrecision;
                                                                IF SalesHeader."Currency Code" <> '' THEN
                                                                  "Return Rcd. Not Invd. (LCY)" :=
                                                                    ROUND(
                                                                      CurrExchRate.ExchangeAmtFCYToLCY(
                                                                        GetDate,"Currency Code",
                                                                        "Return Rcd. Not Invd.",SalesHeader."Currency Factor"),
                                                                      Currency2."Amount Rounding Precision")
                                                                ELSE
                                                                  "Return Rcd. Not Invd. (LCY)" :=
                                                                    ROUND("Return Rcd. Not Invd.",Currency2."Amount Rounding Precision");
                                                              END;

                                                   CaptionML=[ENU=Return Rcd. Not Invd.;
                                                              ESM=Dev. recib. no facturada;
                                                              FRC=R‚ception retour non factur‚e;
                                                              ENC=Return Rcd. Not Invd.];
                                                   Editable=No;
                                                   AutoFormatType=1;
                                                   AutoFormatExpr="Currency Code" }
    { 5808;   ;Return Rcd. Not Invd. (LCY);Decimal;CaptionML=[ENU=Return Rcd. Not Invd. ($);
                                                              ESM=Dev. recib. no facturada ($);
                                                              FRC=R‚cept. retour non factur‚e ($);
                                                              ENC=Return Rcd. Not Invd. ($)];
                                                   Editable=No;
                                                   AutoFormatType=1 }
    { 5809;   ;Return Qty. Received;Decimal       ;CaptionML=[ENU=Return Qty. Received;
                                                              ESM=Cantidad dev. rec.;
                                                              FRC=Qt‚ retour re‡ue;
                                                              ENC=Return Qty. Received];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5810;   ;Return Qty. Received (Base);Decimal;CaptionML=[ENU=Return Qty. Received (Base);
                                                              ESM=Cantidad  dev. rec. (Base);
                                                              FRC=Qt‚ retour re‡ue (base);
                                                              ENC=Return Qty. Received (Base)];
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 5811;   ;Appl.-from Item Entry;Integer      ;OnValidate=VAR
                                                                ItemLedgEntry@1000 : Record 32;
                                                              BEGIN
                                                                IF "Appl.-from Item Entry" <> 0 THEN BEGIN
                                                                  CheckApplFromItemLedgEntry(ItemLedgEntry);
                                                                  VALIDATE("Unit Cost (LCY)",CalcUnitCost(ItemLedgEntry));
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              SelectItemEntry(FIELDNO("Appl.-from Item Entry"));
                                                            END;

                                                   CaptionML=[ENU=Appl.-from Item Entry;
                                                              ESM=Liq. mov. prod.;
                                                              FRC=criture article … affecter;
                                                              ENC=Appl.-from Item Entry];
                                                   MinValue=0 }
    { 5909;   ;BOM Item No.        ;Code20        ;TableRelation=Item;
                                                   CaptionML=[ENU=BOM Item No.;
                                                              ESM=N§ L.M. pdto.;
                                                              FRC=Nø article nomenclature;
                                                              ENC=BOM Item No.] }
    { 6600;   ;Return Receipt No.  ;Code20        ;CaptionML=[ENU=Return Receipt No.;
                                                              ESM=N§ recep. devol.;
                                                              FRC=Nø r‚ception retour;
                                                              ENC=Return Receipt No.];
                                                   Editable=No }
    { 6601;   ;Return Receipt Line No.;Integer    ;CaptionML=[ENU=Return Receipt Line No.;
                                                              ESM=N§ l¡n. recep. dev.;
                                                              FRC=Nø ligne r‚ception retour;
                                                              ENC=Return Receipt Line No.];
                                                   Editable=No }
    { 6608;   ;Return Reason Code  ;Code10        ;TableRelation="Return Reason";
                                                   OnValidate=BEGIN
                                                                ValidateReturnReasonCode(FIELDNO("Return Reason Code"));
                                                              END;

                                                   CaptionML=[ENU=Return Reason Code;
                                                              ESM=C¢d. auditor¡a dev.;
                                                              FRC=Code motif retour;
                                                              ENC=Return Reason Code] }
    { 7001;   ;Allow Line Disc.    ;Boolean       ;InitValue=Yes;
                                                   CaptionML=[ENU=Allow Line Multiplier;
                                                              ESM=Permite dto. l¡nea;
                                                              FRC=Autoriser remise ligne;
                                                              ENC=Allow Line Disc.];
                                                   Description=TOP100A }
    { 7002;   ;Customer Disc. Group;Code20        ;TableRelation="Customer Discount Group";
                                                   OnValidate=BEGIN
                                                                IF Type = Type::Item THEN
                                                                  UpdateUnitPrice(FIELDNO("Customer Disc. Group"))
                                                              END;

                                                   CaptionML=[ENU=Customer Multiplier Group;
                                                              ESM=Grupo dto. cliente;
                                                              FRC=Groupe d'escompte du client;
                                                              ENC=Customer Disc. Group];
                                                   Description=TOP100A }
    { 10000;  ;Package Tracking No.;Text30        ;CaptionML=[ENU=Package Tracking No.;
                                                              ESM=N§ seguimiento bulto;
                                                              FRC=Nø de tra‡abilit‚;
                                                              ENC=Package Tracking No.] }
    { 50000;  ;Gross Margin %      ;Decimal       ;DecimalPlaces=0:5;
                                                   Description=TOP230;
                                                   Editable=No }
    { 50001;  ;Lost Opportunity Description;Text50;Description=TOP230 }
    { 50007;  ;Last Unit Price     ;Decimal       ;AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 50008;  ;Last Price UOM      ;Code10        ;Editable=No }
    { 50009;  ;Last Price Qty.     ;Decimal       ;DecimalPlaces=0:5;
                                                   Editable=No }
    { 50010;  ;Unit Price Color    ;Code15        ;Description=TOP1125 }
    { 50011;  ;Return Reason Desc  ;Text50        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Reason Code".Description WHERE (Code=FIELD(Return Reason Code)));
                                                   Description=TPZ911;
                                                   Editable=No }
    { 50012;  ;QA Sub Reason Code  ;Code10        ;TableRelation="Return Reason".Code WHERE (Type=CONST(Sub Quality));
                                                   Description=TPZ1692 }
    { 50013;  ;Last Price Date     ;Date          ;Editable=No }
    { 50014;  ;Pricing Logic       ;Option        ;OptionCaptionML=ENU=" ,Sales Price,Hot Sheet,Sales Line Multiplier(Cust.),Sales Line Multiplier(Cust. Mult. Grp.),Customer Base Multiplier,Item Unit Price";
                                                   OptionString=[ ,Sales Price,Hot Sheet,Sales Line Multiplier(Cust.),Sales Line Multiplier(Cust. Mult. Grp.),Customer Base Multiplier,Item Unit Price];
                                                   Description=TOP230;
                                                   Editable=No }
    { 50026;  ;Lost Opportunity    ;Boolean       ;Description=TOP030B }
    { 50027;  ;Reason Code         ;Code10        ;TableRelation=IF (Document Type=CONST(Order)) "Reason Code" WHERE (Order Type=CONST(Order))
                                                                 ELSE IF (Document Type=CONST(Quote)) "Reason Code" WHERE (Order Type=CONST(Quote));
                                                   OnValidate=VAR
                                                                ab_ReasonCode@1000000000 : Record 231;
                                                              BEGIN
                                                                //TOP030B KT ABCSI Lost Opportunities 03092015
                                                                IF ab_ReasonCode.GET("Reason Code") AND (ab_ReasonCode.Type = ab_ReasonCode.Type::"Lost Opportunity") THEN BEGIN
                                                                  "Lost Opportunity" := TRUE;
                                                                  "Lost Opportunity Description" := ab_ReasonCode.Description; //TOP230 KT ABCSI CRP 2 Fixes 05012015
                                                                  UpdateLostOpportunity;
                                                                  IF "Document Type" = "Document Type"::Quote THEN BEGIN
                                                                    VALIDATE("Qty. to Order",0);//TOP030B KT ABCSI Lost Opportunities 06042015
                                                                  VALIDATE(Quantity,0);
                                                                  END;
                                                                END ELSE CLEAR("Lost Opportunity");
                                                                //TOP030B KT ABCSI Lost Opportunities 03092015
                                                              END;

                                                   Description=TOP030B }
    { 50028;  ;Reason Code Comment ;Text60        ;Description=TOP030B }
    { 50029;  ;Hot Sheet Code      ;Code10        ;TableRelation="Hot Sheet Price".Code;
                                                   Description=TOP180 }
    { 50051;  ;Sample              ;Boolean       ;OnValidate=BEGIN
                                                                //<TPZ1682
                                                                //IF Sample <> xRec.Sample THEN
                                                                 //SetGPPG_DIMForSampleLines(Rec);
                                                                //</TPZ1682>
                                                              END;

                                                   Description=TOP150,TPZ1682 }
    { 50100;  ;Mfr. Rep. Code      ;Code20        ;TableRelation="Mfr. Rep.";
                                                   OnValidate=BEGIN
                                                                // <TPZ92>
                                                                GetSalesHeader;
                                                                VALIDATE("Mfr. Rep. Comm. %",SalesHeader."Mfr. Rep. Comm. %");
                                                                // </TPZ92>
                                                              END;

                                                   CaptionML=ENU=Mfr. Rep. Code;
                                                   Description=TOP110;
                                                   Editable=No }
    { 50101;  ;ISR Code            ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   Description=TOP110 }
    { 50102;  ;CSR Code            ;Code10        ;TableRelation=Salesperson/Purchaser;
                                                   Description=TOP110 }
    { 50103;  ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Sales Comment Line" WHERE (Document Type=FIELD(Document Type),
                                                                                                 No.=FIELD(Document No.),
                                                                                                 Document Line No.=FIELD(Line No.)));
                                                   CaptionML=[ENU=Comment;
                                                              ESM=Comentario;
                                                              FRC=Commentaire;
                                                              ENC=Comment];
                                                   Description=TOP170;
                                                   Editable=No }
    { 50200;  ;Shortcut Dimension 5 Code;Code20   ;OnValidate=BEGIN
                                                                ValidateShortcutDimCode(5,"Shortcut Dimension 5 Code");
                                                              END;

                                                   OnLookup=BEGIN
                                                              LookupShortcutDimCode(5,"Shortcut Dimension 5 Code"); //TOP140 KT ABCSI Modification to Payment Terms 01222015
                                                            END;

                                                   CaptionML=[ENU=Shortcut Dimension 5 Code;
                                                              ESM=C¢d. dim. acceso dir. 2;
                                                              FRC=Code raccourci de dimension 2;
                                                              ENC=Shortcut Dimension 2 Code];
                                                   CaptionClass='1,2,5' }
    { 50201;  ;Multiplier          ;Decimal       ;OnValidate=BEGIN
                                                                //TOP100A KT ABCSI Multipliers 02192015
                                                                IF Multiplier <> 0 THEN BEGIN
                                                                //<TPZ1829>
                                                                  //IF CurrFieldNo <> FIELDNO(Multiplier) THEN
                                                                    //IF (Multiplier < 0) OR (Multiplier > 1) THEN
                                                                     // ERROR(abcsi0001,Multiplier);
                                                                //</TPZ1829>
                                                                  VALIDATE("Line Discount %",ROUND((1 - Multiplier) * 100,0.00001)); //TOP230 KT ABCSI Go Live Fixes 11092015
                                                                END ELSE BEGIN
                                                                  VALIDATE("Line Discount %",0);
                                                                END;
                                                                UpdateAmounts;
                                                                //TOP100A KT ABCSI Multipliers 02192015
                                                              END;

                                                   DecimalPlaces=3:7;
                                                   MinValue=0;
                                                   MaxValue=1;
                                                   Description=TOP100A }
    { 50202;  ;Recomm. Unit Price  ;Decimal       ;Description=TOP100A;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Recomm. Unit Price")) }
    { 50203;  ;Actual Unit Price   ;Decimal       ;OnValidate=BEGIN
                                                                // <TPZ1276>
                                                                IF "Document Type" = "Document Type"::"Credit Memo" THEN
                                                                  VALIDATE("Unit Price","Actual Unit Price");
                                                                // </TPZ1276>

                                                                //TOP100A KT ABCSI Multipliers 02192015
                                                                IF "Actual Unit Price" <> 0 THEN BEGIN
                                                                  //IF "Allow Line Disc." THEN BEGIN
                                                                    CalledFromActualUnitPrice := TRUE;
                                                                    IF "Unit Price" <> 0 THEN BEGIN
                                                                      //<TPZ1597>
                                                                       IF "Actual Unit Price" > "Unit Price" THEN BEGIN //EB <TPZ1597> Comment out
                                                                        VALIDATE("Unit Price","Actual Unit Price");
                                                                        VALIDATE(Multiplier,1);
                                                                      END ELSE BEGIN  //<TPZ1597> //EB Comment out
                                                                        // <TPZ1305>
                                                                        IF "Pricing Logic" = "Pricing Logic"::"Item Unit Price" THEN
                                                                          VALIDATE("Unit Price","Actual Unit Price")   //<TPZ1597>//EB Comment out
                                                                        // </TPZ1305>
                                                                        ELSE  //<TPZ1597>
                                                                          // <TPZ1276>
                                                                          VALIDATE(Multiplier,ROUND("Actual Unit Price"/"Unit Price",0.0000001)); //TOP230 KT ABCSI Go Live Fixes 11092015
                                                                          // </TPZ1276>
                                                                        END;   //<TPZ1597>//EB Comment out
                                                                    END ELSE BEGIN
                                                                      IF Multiplier <> 0 THEN
                                                                        VALIDATE("Unit Price",ROUND("Actual Unit Price"/Multiplier,0.0001)) //TOP230 KT ABCSI Go Live Fixes 11092015
                                                                      ELSE
                                                                        VALIDATE("Unit Price","Actual Unit Price");
                                                                    END;
                                                                 // END ELSE
                                                                  //  VALIDATE("Unit Price","Actual Unit Price");

                                                                  IF "Alt. UOM Code" <> '' THEN
                                                                    "Alt. UOM Actual Unit Price" := CalcAltUOMUnitPrice("Actual Unit Price");
                                                                 // IF "Alt. UOM Code" <> '' THEN
                                                                 //  "Alt. UOM Unit Price" := CalcAltUOMUnitPrice("Unit Price");//EB <TPZ1597>

                                                                END ELSE BEGIN
                                                                  VALIDATE("Unit Price",0);
                                                                END;
                                                                //TOP100A KT ABCSI Multipliers 02192015

                                                                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 Start
                                                                // <TPZ462>
                                                                IF ("Document Type" <> "Document Type"::Quote) AND ("Quote No." = '') THEN BEGIN  //TOP010E KT ABCSI 07282015
                                                                // </TPZ462>
                                                                {IF Type = Type::Item THEN BEGIN
                                                                  IF (xRec."Actual Unit Price" <> "Actual Unit Price") AND ("Actual Unit Price" <> 0) AND (CurrFieldNo = FIELDNO("Actual Unit Price")) THEN
                                                                    BEGIN
                                                                      UpdateLastSalesPrice(Rec);
                                                                    END;
                                                                END;
                                                                }
                                                                END; //TOP010E KT ABCSI 07282015

                                                                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 End

                                                                UpdateMarginPercent; //TOP230 KT ABCSI CRP 2 Fixes 05282015
                                                              END;

                                                   CaptionML=[ENU=Actual Unit Price;
                                                              ESM=Precio unitario real;
                                                              FRC=Prix unitaire r‚el;
                                                              ENC=Actual Unit Price;
                                                              ESG=Precio unitario real;
                                                              ESC=Precio unitario real;
                                                              ESA=Precio unitario real;
                                                              ESD=Precio unitario real;
                                                              ESV=Precio unitario real;
                                                              ESO=Precio unitario real;
                                                              ESE=Precio unitario real;
                                                              ESU=Precio unitario real];
                                                   Description=TOP100A;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Actual Unit Price")) }
    { 50204;  ;Alt. UOM Recomm. Unit Price;Decimal;Description=TOP100A;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Alt. UOM Recomm. Unit Price")) }
    { 50205;  ;Alt. UOM Actual Unit Price;Decimal ;OnValidate=BEGIN
                                                                //TOP100A KT ABCSI Multipliers 02192015
                                                                TestStatusOpen;

                                                                IF Type <> Type::Item THEN
                                                                  FIELDERROR(Type);
                                                                IF CurrFieldNo = FIELDNO("Alt. UOM Actual Unit Price") THEN BEGIN
                                                                  IF "Alt. UOM Actual Unit Price" <> 0 THEN BEGIN
                                                                    IF "Alt. UOM Unit Price" <> 0 THEN BEGIN
                                                                      // <TPZ1276>
                                                                      VALIDATE(Multiplier,ROUND("Alt. UOM Actual Unit Price"/"Alt. UOM Unit Price",0.000001)); //TOP230 KT ABCSI Go Live Fixes 11092015
                                                                      // </TPZ1276>
                                                                    END ELSE BEGIN
                                                                      IF Multiplier <> 0 THEN
                                                                        VALIDATE("Alt. UOM Unit Price",ROUND("Alt. UOM Actual Unit Price"/Multiplier,0.0001)) //TOP230 KT ABCSI Go Live Fixes 11092015
                                                                      ELSE
                                                                        VALIDATE("Alt. UOM Unit Price","Alt. UOM Actual Unit Price");
                                                                    END;

                                                                    "Actual Unit Price" := CalcUnitPriceFromAltUOMUnitPrice("Alt. UOM Actual Unit Price");
                                                                  END;
                                                                END;
                                                                UpdateAmounts;
                                                                //TOP100A KT ABCSI Multipliers 02192015
                                                              END;

                                                   Description=TOP100A;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Alt. UOM Actual Unit Price")) }
    { 50206;  ;Recomm. Multiplier  ;Decimal       ;DecimalPlaces=3:3;
                                                   MinValue=0;
                                                   MaxValue=1;
                                                   Description=TOP100A }
    { 50329;  ;Item Blocked        ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item.Blocked WHERE (No.=FIELD(No.)));
                                                   CaptionML=[ENU=Item Blocked;
                                                              ESM=Bloqueado;
                                                              FRC=Bloqu‚;
                                                              ENC=Blocked];
                                                   Editable=No }
    { 50390;  ;Item Blocked Reason Code;Code10    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item."Blocked Reason Code" WHERE (No.=FIELD(No.)));
                                                   TableRelation="Reason Code";
                                                   CaptionML=ENU=Item Blocked Reason Code;
                                                   Editable=No }
    { 50500;  ;Alt. UOM Code       ;Code10        ;TableRelation=IF (Type=CONST(Item)) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.));
                                                   OnValidate=VAR
                                                                UnitOfMeasureTranslation@1000000000 : Record 5402;
                                                              BEGIN
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                                IF "Alt. UOM Code" <> '' THEN BEGIN
                                                                  GetItem;
                                                                  "Qty. per Alt. UOM" := UOMMgt.GetQtyPerUnitOfMeasure(Item,"Alt. UOM Code")
                                                                END ELSE
                                                                  "Qty. per Alt. UOM" := 0;

                                                                IF "Alt. UOM Code" <> '' THEN BEGIN
                                                                  "Alt. UOM Quantity" := CalcAltUOMQty(Quantity);
                                                                  "Alt. UOM Unit Price" := CalcAltUOMUnitPrice("Unit Price");
                                                                END;

                                                                IF "Alt. UOM Code" = '' THEN
                                                                  "Alt. Unit of Measure" := ''
                                                                ELSE BEGIN
                                                                  IF NOT UnitOfMeasure.GET("Alt. UOM Code") THEN
                                                                    UnitOfMeasure.INIT;
                                                                  "Alt. Unit of Measure" := UnitOfMeasure.Description;
                                                                  GetSalesHeader;
                                                                  IF SalesHeader."Language Code" <> '' THEN BEGIN
                                                                    UnitOfMeasureTranslation.SETRANGE(Code,"Alt. UOM Code");
                                                                    UnitOfMeasureTranslation.SETRANGE("Language Code",SalesHeader."Language Code");
                                                                    IF UnitOfMeasureTranslation.FINDFIRST THEN
                                                                      "Alt. Unit of Measure" := UnitOfMeasureTranslation.Description;
                                                                  END;
                                                                END;
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                              END;

                                                   Description=TOP050 }
    { 50501;  ;Alt. Unit of Measure;Text10        ;Description=TOP050 }
    { 50502;  ;Alt. UOM Quantity   ;Decimal       ;OnValidate=BEGIN
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                                TestStatusOpen;

                                                                IF Type <> Type::Item THEN
                                                                  FIELDERROR(Type);
                                                                IF CurrFieldNo = FIELDNO("Alt. UOM Quantity") THEN
                                                                  IF "Qty. per Alt. UOM" <> 0 THEN
                                                                    VALIDATE(Quantity,CalcQtyFromAltUOMQty("Alt. UOM Quantity"));

                                                                UpdateAmounts;
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                              END;

                                                   DecimalPlaces=0:5;
                                                   Description=TOP050 }
    { 50503;  ;Alt. UOM Unit Price ;Decimal       ;OnValidate=BEGIN
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                                TestStatusOpen;

                                                                IF Type <> Type::Item THEN
                                                                  FIELDERROR(Type);
                                                                IF CurrFieldNo = FIELDNO("Alt. UOM Unit Price") THEN
                                                                  IF "Qty. per Alt. UOM" <> 0 THEN
                                                                    VALIDATE("Unit Price",CalcUnitPriceFromAltUOMUnitPrice("Alt. UOM Unit Price"));

                                                                UpdateAmounts;
                                                                //TOP050 KT ABCSI Modification to Item Cards 01212015
                                                              END;

                                                   Description=TOP050;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Alt. UOM Unit Price")) }
    { 50504;  ;Qty. per Alt. UOM   ;Decimal       ;DecimalPlaces=0:5;
                                                   Description=TOP050 }
    { 51017;  ;Old Actual Unit Price;Decimal      ;OnValidate=BEGIN
                                                                // <TPZ459>
                                                                GetSalesHeader;
                                                                SalesHeader.TESTFIELD("Price Adjustment",TRUE);
                                                                IF ("Document Type" = "Document Type"::"Credit Memo") AND
                                                                   (Type = Type::"Charge (Item)") AND
                                                                   ("Old Actual Unit Price" <> 0) AND
                                                                   ("New Actual Unit Price" <> 0)
                                                                THEN
                                                                  VALIDATE("Unit Price","Old Actual Unit Price" - "New Actual Unit Price");
                                                                // </TPZ459>
                                                              END;

                                                   CaptionML=ENU=Old Actual Unit Price;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Old Actual Unit Price")) }
    { 51018;  ;New Actual Unit Price;Decimal      ;OnValidate=BEGIN
                                                                // <TPZ459>
                                                                GetSalesHeader;
                                                                SalesHeader.TESTFIELD("Price Adjustment",TRUE);
                                                                IF ("Document Type" = "Document Type"::"Credit Memo") AND
                                                                   (Type = Type::"Charge (Item)") AND
                                                                   ("Old Actual Unit Price" <> 0) AND
                                                                   ("New Actual Unit Price" <> 0)
                                                                THEN
                                                                  VALIDATE("Unit Price","Old Actual Unit Price" - "New Actual Unit Price");
                                                                // </TPZ459>
                                                              END;

                                                   CaptionML=ENU=New Actual Unit Price;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("New Actual Unit Price")) }
    { 51019;  ;Requested Unit Price;Decimal       ;CaptionML=ENU=Requested Unit Price;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code";
                                                   CaptionClass=GetCaptionClass(FIELDNO("Requested Unit Price")) }
    { 51082;  ;Quote No.           ;Code20        ;TableRelation="Sales Header".No. WHERE (Document Type=CONST(Quote));
                                                   CaptionML=ENU=Quote No.;
                                                   Description=TOP030A }
    { 51084;  ;Quote Line No.      ;Integer       ;TableRelation="Sales Line"."Line No." WHERE (Document Type=CONST(Quote),
                                                                                                Document No.=FIELD(Quote No.));
                                                   CaptionML=ENU=Quote Line No.;
                                                   Description=TOP030A }
    { 51086;  ;Qty. to Order       ;Decimal       ;OnValidate=BEGIN
                                                                //TOP030A KT ABCSI Sales Quotes 02132015
                                                                // <TPZ1067>
                                                                IF ("Document Type" = "Document Type"::Quote) AND
                                                                   (Type = Type::Item)
                                                                THEN BEGIN
                                                                  CALCFIELDS("Qty. Ordered","Qte. Qty. Invoiced");
                                                                  IF ("Qty. to Order") > (Quantity - "Qty. Ordered" - "Qte. Qty. Invoiced") THEN
                                                                    FIELDERROR(
                                                                      "Qty. to Order",
                                                                      STRSUBSTNO(
                                                                        Text51080,
                                                                        FIELDCAPTION(Quantity),
                                                                        FIELDCAPTION("Qty. Ordered"),
                                                                        FIELDCAPTION("Qte. Qty. Invoiced")));
                                                                END;
                                                                // </TPZ1067>
                                                                //TOP030A KT ABCSI Sales Quotes 02132015
                                                              END;

                                                   DecimalPlaces=0:5;
                                                   Description=TOP030A }
    { 51087;  ;Qty. Ordered        ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Sales Line".Quantity WHERE (Document Type=CONST(Order),
                                                                                                Quote No.=FIELD(Document No.),
                                                                                                Quote Line No.=FIELD(Line No.)));
                                                   DecimalPlaces=0:5;
                                                   Description=TOP030A;
                                                   Editable=No }
    { 51088;  ;Qte. Qty. Shipped   ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Sales Shipment Line".Quantity WHERE (Quote No.=FIELD(Document No.),
                                                                                                         Quote Line No.=FIELD(Line No.)));
                                                   DecimalPlaces=0:5;
                                                   Description=TOP030A;
                                                   Editable=No }
    { 51089;  ;Qte. Qty. Invoiced  ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Sales Invoice Line".Quantity WHERE (Quote No.=FIELD(Document No.),
                                                                                                        Quote Line No.=FIELD(Line No.)));
                                                   DecimalPlaces=0:5;
                                                   Description=TOP030A;
                                                   Editable=No }
    { 51091;  ;External Document Line No.;Code10  ;CaptionML=ENU=Customer PO Line No.;
                                                   Description=TPZ1312 Changed type from Integer to Code }
    { 51434;  ;Vendor Item No.     ;Text20        ;FieldClass=FlowField;
                                                   CalcFormula=Lookup(Item."Vendor Item No." WHERE (No.=FIELD(No.)));
                                                   CaptionML=ENU=Vendor Item No.;
                                                   Editable=No }
    { 51700;  ;Mfr. Rep. Comm. %   ;Decimal       ;OnValidate=BEGIN
                                                                // <TPZ92,TPZ1539>
                                                                IF (Type = Type::Item) OR
                                                                   ((Type = Type::"G/L Account") AND
                                                                    "Commission Payable") OR
                                                                   ((Type = Type::"Charge (Item)") AND
                                                                    "Commission Payable")
                                                                THEN
                                                                  "Mfr. Rep. Comm. Amount" := ("Mfr. Rep. Comm. %" * "Line Amount" ) / 100;
                                                                // </TPZ92,TPZ1539>
                                                              END;

                                                   CaptionML=ENU=Mfr. Rep. Comm. %;
                                                   DecimalPlaces=0:2;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 51701;  ;Mfr. Rep. Comm. Amount;Decimal     ;CaptionML=ENU=Mfr. Rep. Comm. Amount }
    { 51702;  ;Location Hdlg. %    ;Decimal       ;OnValidate=BEGIN
                                                                // <TPZ92,TPZ1539>
                                                                IF (Type = Type::Item) OR
                                                                   ((Type = Type::"G/L Account") AND
                                                                    "Commission Payable") OR
                                                                   ((Type = Type::"Charge (Item)") AND
                                                                    "Commission Payable")
                                                                THEN
                                                                  "Location Hdlg. Amount" := ("Location Hdlg. %" * "Line Amount" ) / 100;
                                                                // </TPZ92,TPZ1539>
                                                              END;

                                                   CaptionML=ENU=Location Hdlg. %;
                                                   DecimalPlaces=0:2;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 51703;  ;Location Hdlg. Amount;Decimal      ;CaptionML=ENU=Location Hdlg. Amount }
    { 51704;  ;Commission Payable  ;Boolean       ;CaptionML=ENU=Commission Payable }
    { 55000;  ;Base UOM Price      ;Decimal       ;OnValidate=VAR
                                                                SalesPrice@1000000001 : Record 7002;
                                                                NewSalesPrice@1000000000 : Record 7002;
                                                                Msg@1000000002 : Text[250];
                                                              BEGIN
                                                              END;

                                                   Description=TOP010;
                                                   AutoFormatType=2 }
    { 55040;  ;Modified UserID     ;Code20        ;Description=TOP010 }
    { 55041;  ;Promo               ;Boolean       ;OnValidate=BEGIN
                                                                {//<TPZ2368>
                                                                IF Promo <> xRec.Promo THEN
                                                                 SetGPPG_DIMForPromoLines(Rec);
                                                                //</TPZ2368>
                                                                }
                                                              END;

                                                   Description=TPZ2368 }
    { 69000;  ;Temp Sales Order No.;Code20        ;Description=TOP210 used when multiple temp sales orders are created from a single order }
    { 70551;  ;Original Order Qty. ;Decimal       ;CaptionML=ENU=Original Order Qty.;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 70552;  ;First Shipment      ;Boolean       ;CaptionML=ENU=First Shipment;
                                                   Editable=No }
    { 70553;  ;First Shipment Complete;Boolean    ;CaptionML=ENU=First Shipment Complete;
                                                   Editable=No }
    { 70554;  ;Exclude from Usage  ;Boolean       ;CaptionML=ENU=Exclude from Usage }
    { 70558;  ;Demand Date         ;Date          ;CaptionML=ENU=Demand Date;
                                                   Editable=No }
    { 14000350;;EDI Ship Confirmed ;Boolean       ;CaptionML=ENU=EDI Ship Confirmed;
                                                   Editable=No }
    { 14000351;;EDI Item Cross Ref.;Code20        ;CaptionML=ENU=EDI Item Cross Ref. }
    { 14000352;;EDI Unit of Measure;Code10        ;CaptionML=ENU=EDI Unit of Measure }
    { 14000353;;EDI Unit Price     ;Decimal       ;CaptionML=ENU=EDI Unit Price }
    { 14000354;;EDI Price Discrepancy;Boolean     ;CaptionML=ENU=EDI Price Discrepancy }
    { 14000355;;EDI Segment Group  ;Integer       ;CaptionML=ENU=EDI Segment Group;
                                                   Editable=No }
    { 14000356;;EDI Original Qty.  ;Decimal       ;CaptionML=ENU=EDI Original Qty.;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 14000357;;EDI Status Pending ;Boolean       ;CaptionML=ENU=EDI Status Pending;
                                                   Editable=No }
    { 14000358;;EDI Release No.    ;Code20        ;CaptionML=ENU=EDI Release No. }
    { 14000359;;EDI Ship Req. Date ;Date          ;CaptionML=ENU=EDI Ship Req. Date }
    { 14000360;;EDI Kanban No.     ;Code20        ;CaptionML=ENU=EDI Kanban No. }
    { 14000361;;EDI Line Type      ;Option        ;CaptionML=ENU=EDI Line Type;
                                                   OptionCaptionML=ENU=" ,Forecast,Release,Change,Forecast & Release,Recreate";
                                                   OptionString=[ ,Forecast,Release,Change,Forecast & Release,Recreate] }
    { 14000362;;EDI Line Status    ;Option        ;CaptionML=ENU=EDI Line Status;
                                                   OptionCaptionML=ENU=" ,New,Order Exists,Shipment Exists,Release Created,Change Made,Cancellation,Add Item,Closed";
                                                   OptionString=[ ,New,Order Exists,Shipment Exists,Release Created,Change Made,Cancellation,Add Item,Closed] }
    { 14000363;;EDI Cumulative Quantity;Decimal   ;CaptionML=ENU=EDI Cumulative Quantity }
    { 14000364;;EDI Forecast Begin Date;Date      ;CaptionML=ENU=EDI Forecast Begin Date }
    { 14000365;;EDI Forecast End Date;Date        ;CaptionML=ENU=EDI Forecast End Date }
    { 14000366;;EDI Code           ;Code35        ;CaptionML=ENU=EDI Code }
    { 14000602;;Over Receive       ;Boolean       ;CaptionML=ENU=Over Receive;
                                                   Editable=No }
    { 14000603;;Over Receive Verified;Boolean     ;OnValidate=BEGIN
                                                                IF "Over Receive Verified" THEN
                                                                  TESTFIELD("Over Receive");
                                                              END;

                                                   CaptionML=ENU=Over Receive Verified }
    { 14000701;;Shipping Charge    ;Boolean       ;CaptionML=ENU=Shipping Charge }
    { 14000702;;Dimmed Weight      ;Decimal       ;CaptionML=ENU=Dimmed Weight;
                                                   DecimalPlaces=0:5 }
    { 14000703;;Pack               ;Boolean       ;CaptionML=ENU=Pack;
                                                   Editable=No }
    { 14000704;;Rate Quoted        ;Boolean       ;OnValidate=VAR
                                                                ShippingAgent@14000700 : Record 291;
                                                              BEGIN
                                                                IF "Rate Quoted" THEN BEGIN
                                                                  TESTFIELD("Quantity Shipped",0);

                                                                  GetSalesHeader;
                                                                  SalesHeader.TESTFIELD("Shipping Agent Code");
                                                                  ShippingAgent.GET(SalesHeader."Shipping Agent Code");
                                                                  TESTFIELD(Type,ShippingAgent."Prepaid Freight Type");
                                                                  TESTFIELD("No.",ShippingAgent."Prepaid Freight Code");
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Rate Quoted }
    { 14000705;;Std. Pack Unit of Measure Code;Code10;
                                                   TableRelation=IF (Type=CONST(Item)) "Item Unit of Measure".Code WHERE (Item No.=FIELD(No.));
                                                   OnValidate=BEGIN
                                                                TESTFIELD(Type,Type::Item);
                                                                TESTFIELD("No.");

                                                                IF "Std. Pack Unit of Measure Code" <> '' THEN BEGIN
                                                                  GetItem;
                                                                  "Qty. per Std. Pack" := UOMMgt.GetQtyPerUnitOfMeasure(Item,"Std. Pack Unit of Measure Code")
                                                                END ELSE
                                                                  "Qty. per Std. Pack" := 0;
                                                                "Std. Pack Quantity" := CalcStdPackQty("Quantity (Base)");
                                                                "Package Quantity" := CalcPackageQty("Std. Pack Quantity");
                                                                "Std. Pack Qty. to Ship" := CalcStdPackQty("Qty. to Ship (Base)");
                                                                "Package Qty. to Ship" := CalcPackageQty("Std. Pack Qty. to Ship");
                                                              END;

                                                   CaptionML=ENU=Std. Pack Unit of Measure Code }
    { 14000706;;Std. Pack Quantity ;Decimal       ;CaptionML=ENU=Std. Pack Quantity;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 14000707;;Qty. per Std. Pack ;Decimal       ;CaptionML=ENU=Qty. per Std. Pack;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 14000708;;Std. Pack Qty. to Ship;Decimal    ;CaptionML=ENU=Std. Pack Qty. to Ship;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 14000709;;Std. Packs per Package;Integer    ;OnValidate=BEGIN
                                                                IF "Std. Packs per Package" <> 0 THEN
                                                                  TESTFIELD("Std. Pack Unit of Measure Code");

                                                                "Package Quantity" := CalcPackageQty("Std. Pack Quantity");
                                                                "Package Qty. to Ship" := CalcPackageQty("Std. Pack Qty. to Ship");
                                                              END;

                                                   CaptionML=ENU=Std. Packs per Package }
    { 14000710;;Package Quantity   ;Decimal       ;CaptionML=ENU=Package Quantity;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 14000711;;Package Qty. to Ship;Decimal      ;CaptionML=ENU=Package Qty. to Ship;
                                                   DecimalPlaces=0:5;
                                                   BlankZero=Yes;
                                                   Editable=No }
    { 14000712;;E-Ship Whse. Outst. Qty (Base);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Activity Line"."Qty. Outstanding (Base)" WHERE (Activity Type=FILTER(Pick),
                                                                                                                              Source Type=CONST(37),
                                                                                                                              Source Subtype=FIELD(Document Type),
                                                                                                                              Source No.=FIELD(Document No.),
                                                                                                                              Source Line No.=FIELD(Line No.),
                                                                                                                              Action Type=FILTER(' '|Take),
                                                                                                                              Breakbulk No.=FILTER(0)));
                                                   CaptionML=ENU=E-Ship Whse. Outst. Qty (Base);
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 14000713;;Shipping Charge BOL No.;Code20    ;TableRelation="Bill of Lading";
                                                   CaptionML=ENU=Shipping Charge BOL No. }
    { 14000714;;E-Ship Whse. Outstanding Qty.;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Activity Line"."Qty. Outstanding" WHERE (Activity Type=FILTER(Pick),
                                                                                                                       Source Type=CONST(37),
                                                                                                                       Source Subtype=FIELD(Document Type),
                                                                                                                       Source No.=FIELD(Document No.),
                                                                                                                       Source Line No.=FIELD(Line No.),
                                                                                                                       Action Type=FILTER(' '|Take),
                                                                                                                       Breakbulk No.=FILTER(0)));
                                                   CaptionML=ENU=E-Ship Whse. Outstanding Qty.;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 14000715;;Required Shipping Agent Code;Code10;
                                                   TableRelation="Shipping Agent";
                                                   OnValidate=VAR
                                                                PackageLine@14000701 : Record 14000702;
                                                              BEGIN
                                                                IF "Required Shipping Agent Code" <> '' THEN
                                                                  TESTFIELD(Pack);

                                                                IF "Required Shipping Agent Code" <> xRec."Required Shipping Agent Code" THEN BEGIN
                                                                  IF (CurrFieldNo = FIELDNO("Required Shipping Agent Code"))
                                                                  THEN BEGIN
                                                                    PackageLine.RESET;
                                                                    PackageLine.SETCURRENTKEY(
                                                                      "Source Type","Source Subtype","Source ID","No.","Variant Code",Type);
                                                                    PackageLine.SETRANGE("Source Type",DATABASE::"Sales Header");
                                                                    PackageLine.SETRANGE("Source Subtype","Document Type");
                                                                    PackageLine.SETRANGE("Source ID","Document No.");
                                                                    PackageLine.SETRANGE(Type,Type);
                                                                    PackageLine.SETRANGE("No.","No.");
                                                                    PackageLine.SETRANGE("Variant Code","Variant Code");
                                                                    IF PackageLine.FIND('-') THEN
                                                                      MESSAGE(Text14000701);
                                                                  END;

                                                                  VALIDATE("Required E-Ship Agent Service",'');
                                                                  VALIDATE("Allow Other Ship. Agent/Serv.",FALSE);
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Required Shipping Agent Code }
    { 14000716;;Required E-Ship Agent Service;Code30;
                                                   TableRelation="E-Ship Agent Service".Code WHERE (Shipping Agent Code=FIELD(Required Shipping Agent Code));
                                                   OnValidate=VAR
                                                                PackageLine@14000701 : Record 14000702;
                                                                ShippingAgent@14000702 : Record 291;
                                                                EShipAgentService@14000703 : Record 14000708;
                                                              BEGIN
                                                                IF "Required E-Ship Agent Service" <> '' THEN BEGIN
                                                                  TESTFIELD(Pack);

                                                                  GetSalesHeader;

                                                                  TESTFIELD("Required Shipping Agent Code");
                                                                  ShippingAgent.GET("Required Shipping Agent Code");
                                                                  EShipAgentService.GET(
                                                                    "Required Shipping Agent Code","Required E-Ship Agent Service",SalesHeader."World Wide Service");
                                                                  IF EShipAgentService.UPSCanadianShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code") THEN
                                                                    EShipAgentService.TESTFIELD("UPS Canadian Service");
                                                                  IF EShipAgentService.UPSPuertoRicoShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code") THEN
                                                                    EShipAgentService.TESTFIELD("UPS Puerto Rico Service");
                                                                END;

                                                                IF ("Required E-Ship Agent Service" <> xRec."Required E-Ship Agent Service") AND
                                                                   (CurrFieldNo = FIELDNO("Required E-Ship Agent Service"))
                                                                THEN BEGIN
                                                                  PackageLine.RESET;
                                                                  PackageLine.SETCURRENTKEY("Source Type","Source Subtype","Source ID","No.","Variant Code",Type);
                                                                  PackageLine.SETRANGE("Source Type",DATABASE::"Sales Header");
                                                                  PackageLine.SETRANGE("Source Subtype","Document Type");
                                                                  PackageLine.SETRANGE("Source ID","Document No.");
                                                                  PackageLine.SETRANGE(Type,Type);
                                                                  PackageLine.SETRANGE("No.","No.");
                                                                  PackageLine.SETRANGE("Variant Code","Variant Code");
                                                                  IF PackageLine.FIND('-') THEN
                                                                    MESSAGE(Text14000701);
                                                                END;
                                                              END;

                                                   OnLookup=VAR
                                                              ShippingAgent@14000701 : Record 291;
                                                              EShipAgentService@14000702 : Record 14000708;
                                                            BEGIN
                                                              GetSalesHeader;

                                                              TESTFIELD("Required Shipping Agent Code");
                                                              ShippingAgent.GET("Required Shipping Agent Code");
                                                              EShipAgentService.RESET;
                                                              EShipAgentService.SETRANGE("Shipping Agent Code",ShippingAgent.Code);
                                                              EShipAgentService.SETRANGE(
                                                                "World Wide Service",
                                                                EShipAgentService.InternationalShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code"));
                                                              IF EShipAgentService.UPSCanadianShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code") THEN
                                                                EShipAgentService.SETRANGE("UPS Canadian Service",TRUE);
                                                              IF EShipAgentService.UPSPuertoRicoShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code") THEN
                                                                EShipAgentService.SETRANGE("UPS Puerto Rico Service",TRUE);
                                                              IF PAGE.RUNMODAL(0,EShipAgentService) = ACTION::LookupOK THEN
                                                                VALIDATE("Required E-Ship Agent Service",EShipAgentService.Code);
                                                            END;

                                                   CaptionML=ENU=Required E-Ship Agent Service }
    { 14000717;;Allow Other Ship. Agent/Serv.;Boolean;
                                                   OnValidate=BEGIN
                                                                IF "Allow Other Ship. Agent/Serv." THEN BEGIN
                                                                  TESTFIELD(Pack);
                                                                  TESTFIELD("Required Shipping Agent Code");
                                                                  TESTFIELD("Required E-Ship Agent Service");
                                                                END;
                                                              END;

                                                   CaptionML=ENU=Allow Other Ship. Agent/Serv. }
    { 14000718;;E-Ship Whse. Ship. Qty (Base);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. to Ship (Base)" WHERE (Source Type=CONST(37),
                                                                                                                          Source Subtype=FIELD(Document Type),
                                                                                                                          Source No.=FIELD(Document No.),
                                                                                                                          Source Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=E-Ship Whse. Ship. Qty (Base);
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 14000719;;E-Ship Whse. Shipment Qty.;Decimal;FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Shipment Line"."Qty. to Ship" WHERE (Source Type=CONST(37),
                                                                                                                   Source Subtype=FIELD(Document Type),
                                                                                                                   Source No.=FIELD(Document No.),
                                                                                                                   Source Line No.=FIELD(Line No.)));
                                                   CaptionML=ENU=E-Ship Whse. Shipment Qty.;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 14000720;;E-Ship Agent Code  ;Code10        ;TableRelation="Shipping Agent";
                                                   OnValidate=BEGIN
                                                                GetSalesHeader;

                                                                IF ("E-Ship Agent Code" <> xRec."E-Ship Agent Code") AND
                                                                   (xRec."E-Ship Agent Code" <> '')
                                                                THEN
                                                                  VALIDATE("E-Ship Agent Service",'');

                                                                IF "E-Ship Agent Code" <> '' THEN BEGIN
                                                                  ShippingAgent.GET("E-Ship Agent Code");
                                                                  VALIDATE(
                                                                    "E-Ship Agent Service",
                                                                    EShipAgentService.DefaultShipAgentService(ShippingAgent,SalesHeader."Ship-to Country/Region Code"));
                                                                END;

                                                                IF "E-Ship Agent Code" <> xRec."E-Ship Agent Code" THEN BEGIN
                                                                  IF "E-Ship Agent Code" <> '' THEN BEGIN
                                                                    VALIDATE("Shipping Payment Type",SalesHeader."Shipping Payment Type");
                                                                    VALIDATE("Shipping Insurance",SalesHeader."Shipping Insurance");
                                                                  END ELSE BEGIN
                                                                    VALIDATE("Shipping Payment Type","Shipping Payment Type"::Prepaid);
                                                                    VALIDATE("Shipping Insurance","Shipping Insurance"::" ");
                                                                  END;

                                                                  IF CurrFieldNo = FIELDNO("E-Ship Agent Code") THEN
                                                                    IF "E-Ship Agent Code" <> '' THEN
                                                                      VALIDATE("Shipping Agent Code","E-Ship Agent Code")
                                                                    ELSE
                                                                      VALIDATE("Shipping Agent Code",SalesHeader."Shipping Agent Code");

                                                                  IF "Shipping Payment Type" = "Shipping Payment Type"::Prepaid THEN
                                                                    VALIDATE("Third Party Ship. Account No.",'')
                                                                  ELSE
                                                                    IF ShippingAccount.GetPrimaryShippingAccountNo(
                                                                         "E-Ship Agent Code",ShippingAccount."Ship-to Type"::Customer,
                                                                         SalesHeader."Sell-to Customer No.",SalesHeader."Ship-to Code")
                                                                    THEN
                                                                      VALIDATE("Third Party Ship. Account No.",ShippingAccount."Account No.")
                                                                    ELSE
                                                                      VALIDATE("Third Party Ship. Account No.",'');
                                                                END;
                                                              END;

                                                   CaptionML=ENU=E-Ship Agent Code }
    { 14000721;;E-Ship Agent Service;Code30       ;OnValidate=BEGIN
                                                                GetSalesHeader;

                                                                IF "E-Ship Agent Service" <> '' THEN BEGIN
                                                                  TESTFIELD("E-Ship Agent Code");
                                                                  ShippingAgent.GET("E-Ship Agent Code");
                                                                  EShipAgentService.ValidateEShipAgentService(
                                                                    ShippingAgent,"E-Ship Agent Service",SalesHeader."Ship-to Country/Region Code");
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              GetSalesHeader;

                                                              TESTFIELD("E-Ship Agent Code");
                                                              ShippingAgent.GET("E-Ship Agent Code");
                                                              EShipAgentService.LookupEShipAgentService(
                                                                ShippingAgent,"E-Ship Agent Service",SalesHeader."Ship-to Country/Region Code");
                                                              IF PAGE.RUNMODAL(0,EShipAgentService) = ACTION::LookupOK THEN
                                                                VALIDATE("E-Ship Agent Service",EShipAgentService.Code);
                                                            END;

                                                   CaptionML=ENU=E-Ship Agent Service }
    { 14000722;;Shipping Payment Type;Option      ;OnValidate=BEGIN
                                                                GetSalesHeader;

                                                                IF "Shipping Payment Type" = "Shipping Payment Type"::Prepaid THEN
                                                                  VALIDATE("Third Party Ship. Account No.",'')
                                                                ELSE
                                                                  IF ShippingAccount.GetPrimaryShippingAccountNo(
                                                                       "E-Ship Agent Code",ShippingAccount."Ship-to Type"::Customer,
                                                                       SalesHeader."Sell-to Customer No.",SalesHeader."Ship-to Code")
                                                                  THEN
                                                                    VALIDATE("Third Party Ship. Account No.",ShippingAccount."Account No.");
                                                              END;

                                                   CaptionML=ENU=Shipping Payment Type;
                                                   OptionCaptionML=ENU=Prepaid,Third Party,Freight Collect,Consignee;
                                                   OptionString=Prepaid,Third Party,Freight Collect,Consignee }
    { 14000723;;Third Party Ship. Account No.;Code20;
                                                   OnValidate=BEGIN
                                                                GetSalesHeader;

                                                                ShippingAccount."Shipping Agent Code" := "E-Ship Agent Code";
                                                                ShippingAccount.TestShippingAccountNo("Third Party Ship. Account No.");

                                                                IF ("Third Party Ship. Account No." <> '') AND
                                                                   ("Shipping Payment Type" <> "Shipping Payment Type"::Prepaid)
                                                                THEN BEGIN
                                                                  CLEAR(ShippingAccount);

                                                                  IF NOT ShippingAccount.GET(
                                                                           ShippingAccount."Ship-to Type"::Customer,
                                                                           SalesHeader."Sell-to Customer No.",SalesHeader."Ship-to Code","E-Ship Agent Code",
                                                                           "Third Party Ship. Account No.")
                                                                  THEN BEGIN
                                                                    ShippingAccount.RESET;
                                                                    ShippingAccount.SETCURRENTKEY("Shipping Agent Code","Account No.");
                                                                    ShippingAccount.SETRANGE("Shipping Agent Code","E-Ship Agent Code");
                                                                    ShippingAccount.SETRANGE("Account No.","Third Party Ship. Account No.");
                                                                    IF NOT ShippingAccount.FIND('-') THEN
                                                                      ;
                                                                  END;

                                                                  IF (ShippingAccount."Account No." <> '') AND
                                                                     ("Shipping Payment Type" <> "Shipping Payment Type"::Prepaid)
                                                                  THEN
                                                                    "Shipping Insurance" := ShippingAccount."Shipping Insurance";
                                                                END;
                                                              END;

                                                   OnLookup=BEGIN
                                                              GetSalesHeader;

                                                              IF ShippingAccount.LookupThirdPartyAccountNo(
                                                                   "E-Ship Agent Code",ShippingAccount."Ship-to Type"::Customer,
                                                                   SalesHeader."Sell-to Customer No.",SalesHeader."Ship-to Code")
                                                              THEN
                                                                VALIDATE("Third Party Ship. Account No.",ShippingAccount.GetLookupAccountNo);
                                                            END;

                                                   CaptionML=ENU=Third Party Ship. Account No. }
    { 14000724;;Shipping Insurance ;Option        ;CaptionML=ENU=Shipping Insurance;
                                                   OptionCaptionML=ENU=" ,Never,Always";
                                                   OptionString=[ ,Never,Always] }
    { 14000725;;E-Ship Invt. Outst. Qty (Base);Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Activity Line"."Qty. Outstanding (Base)" WHERE (Activity Type=FILTER(Invt. Pick),
                                                                                                                              Source Type=CONST(37),
                                                                                                                              Source Subtype=FIELD(Document Type),
                                                                                                                              Source No.=FIELD(Document No.),
                                                                                                                              Source Line No.=FIELD(Line No.),
                                                                                                                              Action Type=FILTER(' '|Take),
                                                                                                                              Breakbulk No.=FILTER(0)));
                                                   CaptionML=ENU=E-Ship Invt. Outst. Qty (Base);
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
    { 14000726;;E-Ship Invt. Outstanding Qty.;Decimal;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Sum("Warehouse Activity Line"."Qty. Outstanding" WHERE (Activity Type=FILTER(Invt. Pick),
                                                                                                                       Source Type=CONST(37),
                                                                                                                       Source Subtype=FIELD(Document Type),
                                                                                                                       Source No.=FIELD(Document No.),
                                                                                                                       Source Line No.=FIELD(Line No.),
                                                                                                                       Action Type=FILTER(' '|Take),
                                                                                                                       Breakbulk No.=FILTER(0)));
                                                   CaptionML=ENU=E-Ship Invt. Outstanding Qty.;
                                                   DecimalPlaces=0:5;
                                                   Editable=No }
  }
  KEYS
  {
    {    ;Document Type,Document No.,Line No.     ;SumIndexFields=Amount,Amount Including VAT,Outstanding Amount,Shipped Not Invoiced,Outstanding Amount (LCY),Shipped Not Invoiced (LCY),Mfr. Rep. Comm. Amount,Location Hdlg. Amount;
                                                   Clustered=Yes }
    {    ;Document No.,Line No.,Document Type      }
    {    ;Document Type,Type,No.,Variant Code,Drop Shipment,Location Code,Shipment Date,Special Order;
                                                   SumIndexFields=Outstanding Qty. (Base);
                                                   SIFTLevelsToMaintain=[{Document Type,Type},
                                                                         {Document Type,Type,No.},
                                                                         {Document Type,Type,No.,Variant Code},
                                                                         {Document Type,Type,No.,Variant Code,Drop Shipment},
                                                                         {Document Type,Type,No.,Variant Code,Drop Shipment,Location Code},
                                                                         {Document Type,Type,No.,Variant Code,Drop Shipment,Location Code,Shipment Date:Year},
                                                                         {Document Type,Type,No.,Variant Code,Drop Shipment,Location Code,Shipment Date:Month},
                                                                         {Document Type,Type,No.,Variant Code,Drop Shipment,Location Code,Shipment Date:Day},
                                                                         {Document Type,Type,No.,Variant Code,Drop Shipment,Location Code,Shipment Date:Day,Special Order},
                                                                         {Document Type,Type,No.,Variant Code,Drop Shipment,Location Code,Shipment Date:Day,Special Order,Document No.}] }
    {    ;Document Type,Bill-to Customer No.,Currency Code;
                                                   SumIndexFields=Outstanding Amount,Shipped Not Invoiced,Outstanding Amount (LCY),Shipped Not Invoiced (LCY),Return Rcd. Not Invd. (LCY) }
    { No ;Document Type,Type,No.,Variant Code,Drop Shipment,Shortcut Dimension 1 Code,Shortcut Dimension 2 Code,Location Code,Shipment Date;
                                                   SumIndexFields=Outstanding Qty. (Base);
                                                   KeyGroups=Item(Dim) }
    { No ;Document Type,Bill-to Customer No.,Shortcut Dimension 1 Code,Shortcut Dimension 2 Code,Currency Code;
                                                   SumIndexFields=Outstanding Amount,Shipped Not Invoiced,Outstanding Amount (LCY),Shipped Not Invoiced (LCY);
                                                   KeyGroups=Cust(Dim) }
    {    ;Document Type,Blanket Order No.,Blanket Order Line No.;
                                                   KeyGroups=SOP(Blank) }
    {    ;Document Type,Document No.,Location Code }
    {    ;Document Type,Shipment No.,Shipment Line No. }
    {    ;Type,No.,Variant Code,Drop Shipment,Location Code,Document Type,Shipment Date;
                                                   MaintainSQLIndex=No }
    {    ;Document Type,Sell-to Customer No.,Shipment No.;
                                                   SumIndexFields=Outstanding Amount (LCY) }
    {    ;Job Contract Entry No.                   }
    {    ;Document Type,Document No.,Qty. Shipped Not Invoiced }
    {    ;Document Type,Document No.,Type,No.      }
    {    ;Document Type,Document No.,Type,No.,Variant Code,Drop Shipment,Pack,Location Code;
                                                   SumIndexFields=Qty. to Ship (Base),Outstanding Qty. (Base),Return Qty. to Receive (Base);
                                                   KeyGroups=SE-ESHIP;
                                                   MaintainSIFTIndex=No }
    {    ;Document Type,Document No.,Type,EDI Code;KeyGroups=SE-EDI }
    {    ;Document Type,Type,No.,Variant Code,Drop Shipment,Shipment Date,Location Code;
                                                   SumIndexFields=Outstanding Qty. (Base),Return Qty. to Receive (Base) }
    {    ;Document Type,Quote No.,Quote Line No.  ;SumIndexFields=Quantity }
  }
  FIELDGROUPS
  {
    { 1   ;DropDown            ;Document Type,Document No.,Line No.,Type,No.,Description }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=You cannot delete the order line because it is associated with purchase order %1 line %2.;ESM=No se puede eliminar la l¡nea del pedido porque est  asociada a la l¡nea %2 del pedido de compra %1.;FRC=Vous ne pouvez supprimer cette ligne de commande car elle est li‚e au bon de commande %1, ligne %2.;ENC=You cannot delete the order line because it is associated with purchase order %1 line %2.';
      Text010@1000000036 : TextConst 'ENU=Prices including VAT cannot be calculated when %1 is %2.;ESM=No se pueden calcular precios IVA incluido cuando %1 es %2.;FRC=Impossible de calculer les prix incluant la TVA lorsque %1 est %2.;ENC=Prices including VAT cannot be calculated when %1 is %2.';
      Text001@1001 : TextConst 'ENU=You cannot rename a %1.;ESM=No se puede cambiar el nombre a %1.;FRC=Vous ne pouvez pas renommer un %1.;ENC=You cannot rename a %1.';
      Text002@1002 : TextConst 'ENU=You cannot change %1 because the order line is associated with purchase order %2 line %3.;ESM=No se puede cambiar %1 porque la l¡nea de pedido est  asociada a la l¡nea %3 del pedido de compra %2.;FRC=Vous ne pouvez modifier %1 car cette commande est li‚e au bon de commande %2, ligne %3.;ENC=You cannot change %1 because the order line is associated with purchase order %2 line %3.';
      Text003@1003 : TextConst 'ENU=must not be less than %1;ESM=No puede ser inferior a %1.;FRC=ne doit pas ˆtre inf‚rieur … %1;ENC=must not be less than %1';
      Text005@1004 : TextConst 'ENU=You cannot invoice more than %1 units.;ESM=No se pueden facturar m s de %1 unidades.;FRC=Vous ne pouvez pas facturer plus de %1 unit‚s.;ENC=You cannot invoice more than %1 units.';
      Text006@1005 : TextConst 'ENU=You cannot invoice more than %1 base units.;ESM=No se pueden facturar m s de %1 unidades base.;FRC=Vous ne pouvez facturer plus de %1 unit‚s de base.;ENC=You cannot invoice more than %1 base units.';
      Text007@1006 : TextConst 'ENU=You cannot ship more than %1 units.;ESM=No se pueden enviar m s de %1 unidades.;FRC=Vous ne pouvez livrer plus de %1 unit‚s.;ENC=You cannot ship more than %1 units.';
      Text008@1007 : TextConst 'ENU=You cannot ship more than %1 base units.;ESM=No se pueden enviar m s de %1 unidades base.;FRC=Vous ne pouvez livrer plus de %1 unit‚s de base.;ENC=You cannot ship more than %1 base units.';
      Text009@1008 : TextConst 'ENU=" must be 0 when %1 is %2";ESM=" debe ser 0 cuando %1 es %2";FRC=" doit ˆtre 0 lorsque %1 est %2";ENC=" must be 0 when %1 is %2"';
      Text011@1010 : TextConst 'ENU=Automatic reservation is not possible.\Do you want to reserve items manually?;ESM=No se puede reservar autom ticamente.\¨Desea reservar los productos manualmente?;FRC=La r‚servation automatique n''est pas possible.\Souhaitez-vous r‚server les articles manuellementÿ?;ENC=Automatic reservation is not possible.\Do you want to reserve items manually?';
      Text014@1013 : TextConst 'ENU=%1 %2 is before work date %3;ESM=%1 %2 es antes de la fecha trab. %3;FRC=La %1 %2 est ant‚rieure … la date de travail %3.;ENC=%1 %2 is before work date %3';
      Text016@1040 : TextConst 'ENU="%1 is required for %2 = %3.";ESM="Se requiere %1 para %2 = %3.";FRC="%1 est requis pour %2 = %3.";ENC="%1 is required for %2 = %3."';
      Text017@1044 : TextConst 'ENU=\The entered information may be disregarded by warehouse operations.;ESM=\La informaci¢n introducida puede ser ignorada por operaciones almac‚n.;FRC=\Les informations entr‚es peuvent ˆtre ignor‚es par les op‚rations de distribution.;ENC=\The entered information may be disregarded by warehouse operations.';
      Text020@1019 : TextConst 'ENU=You cannot return more than %1 units.;ESM=No puede devolver m s de %1 unidades.;FRC=Vous ne pouvez pas retourner plus de %1 unit‚(s).;ENC=You cannot return more than %1 units.';
      Text021@1020 : TextConst 'ENU=You cannot return more than %1 base units.;ESM=No puede dev. m s del %1 unidades base.;FRC=Vous ne pouvez pas retourner plus de %1 unit‚(s) de base.;ENC=You cannot return more than %1 base units.';
      Text026@1025 : TextConst 'ENU=You cannot change %1 if the item charge has already been posted.;ESM=No puede cambiar %1 si el cargo prod. ya ha sido registrado.;FRC=Vous ne pouvez pas modifier %1 si les frais annexes ont ‚t‚ report‚s.;ENC=You cannot change %1 if the item charge has already been posted.';
      PricesInclVAT@1000000029 : Boolean;
      AllowInvDisc@1000000035 : Boolean;
      CurrExchRate@1030 : Record 330;
      GLSetup@1000000028 : Record 98;
      SalesHeader@1031 : TEMPORARY Record 36;
      VATCalcType@1000000031 : 'Normal VAT,Reverse Charge VAT,Full VAT,Sales Tax';
      SalesLine2@1032 : Record 50021;
      FoundHotSheetPrice@1000000037 : Boolean;
      AllowLineDisc@1000000034 : Boolean;
      ExchRateDate@1000000027 : Date;
      TempSalesLine@1033 : Record 50021;
      CurrencyFactor@1000000026 : Decimal;
      QtyPerUOM@1000000033 : Decimal;
      VATBusPostingGr@1000000032 : Code[10];
      GLAcc@1035 : Record 15;
      Item@1036 : Record 27;
      Resource@1400 : Record 156;
      Currency@1037 : Record 4;
      VATPerCent@1000000030 : Decimal;
      ItemTranslation@1038 : Record 30;
      Res@1043 : Record 156;
      ResCost@1045 : Record 202;
      WorkType@1046 : Record 200;
      VATPostingSetup@1048 : Record 325;
      StdTxt@1049 : Record 7;
      GenBusPostingGrp@1050 : Record 250;
      GenProdPostingGrp@1051 : Record 251;
      ReservEntry@1052 : Record 337;
      UnitOfMeasure@1054 : Record 204;
      FA@1056 : Record 5600;
      ShippingAgentServices@1057 : Record 5790;
      NonstockItem@1058 : Record 5718;
      PurchasingCode@1059 : Record 5721;
      SKU@1060 : Record 5700;
      ItemCharge@1061 : Record 5800;
      ItemChargeAssgntSales@1062 : Record 5809;
      InvtSetup@1063 : Record 313;
      Location@1064 : Record 14;
      ReturnReason@1089 : Record 6635;
      CustomerItemPackageUOM@14000701 : Record 14000703;
      ShippingAgent@14000702 : Record 291;
      EShipAgentService@14000703 : Record 14000708;
      ShippingAccount@14000704 : Record 14000714;
      ATOLink@1016 : Record 904;
      SalesSetup@1065 : Record 311;
      CustMfrRepExcp@1000000096 : Record 51047;
      LocationDivHdlgPct@1000000009 : Record 51712;
      Division@1000000208 : Record 51001;
      Reservation@1066 : Page 498;
      PriceCalcMgt@1071 : Codeunit 7000;
      ResFindUnitCost@1073 : Codeunit 220;
      CustCheckCreditLimit@1074 : Codeunit 312;
      ItemCheckAvail@1075 : Codeunit 311;
      SalesTaxCalculate@1076 : Codeunit 398;
      ReservMgt@1077 : Codeunit 99000845;
      ReservEngineMgt@1078 : Codeunit 99000831;
      ReserveSalesLine@1079 : Codeunit 99000832;
      UOMMgt@1080 : Codeunit 5402;
      AddOnIntegrMgt@1081 : Codeunit 5403;
      DimMgt@1082 : Codeunit 408;
      ItemSubstitutionMgt@1085 : Codeunit 5701;
      DistIntegration@1086 : Codeunit 5702;
      NonstockItemMgt@1087 : Codeunit 5703;
      WhseValidateSourceLine@1088 : Codeunit 5777;
      TransferExtendedText@1100 : Codeunit 378;
      JobPostLine@1097 : Codeunit 1001;
      EDISalesOrderStatusSend@14000351 : Codeunit 14002400;
      RunFromEDI@14000352 : Boolean;
      EDITemp@14000353 : Boolean;
      FullAutoReservation@1092 : Boolean;
      StatusCheckSuspended@1094 : Boolean;
      HasBeenShown@1018 : Boolean;
      PlannedShipmentDateCalculated@1012 : Boolean;
      PlannedDeliveryDateCalculated@1070 : Boolean;
      Text028@1098 : TextConst 'ENU=You cannot change the %1 when the %2 has been filled in.;ESM=No puede cambiar %1 despu‚s de introducir datos en %2.;FRC=Vous ne pouvez pas modifier le champ %1 lorsque le champ %2 a ‚t‚ renseign‚.;ENC=You cannot change the %1 when the %2 has been filled in.';
      ItemCategory@1099 : Record 5722;
      Text029@1021 : TextConst 'ENU=must be positive;ESM=debe ser positivo;FRC=doit ˆtre positif;ENC=must be positive';
      Text030@1042 : TextConst 'ENU=must be negative;ESM=debe ser negativo;FRC=doit ˆtre n‚gatif;ENC=must be negative';
      Text031@1093 : TextConst 'ENU=You must either specify %1 or %2.;ESM=Debe especificar %1 o %2.;FRC=Vous devez sp‚cifier %1 ou %2.;ENC=You must either specify %1 or %2.';
      CalendarMgmt@1101 : Codeunit 7600;
      CalChange@1102 : Record 7602;
      Text034@1084 : TextConst 'ENU=The value of %1 field must be a whole number for the item included in the service item group if the %2 field in the Service Item Groups window contains a check mark.;ESM=El valor del campo %1 debe ser un n£mero entero correspondiente al producto incluido en el grupo de productos de servicio si est  activada la casilla de verificaci¢n del campo %2 en la ventana Grupos producto servicio.;FRC=La valeur du champ %1 doit ˆtre un nombre entier pour l''article compris dans le groupe d''articles de service si le champ %2 de la fenˆtre Groupes d''articles de service est coch‚.;ENC=The value of %1 field must be a whole number for the item included in the service item group if the %2 field in the Service Item Groups window contains a check mark.';
      Text035@1083 : TextConst 'ENU="Warehouse ";ESM="Almac‚n ";FRC="Entrep“t ";ENC="Warehouse "';
      Text036@1090 : TextConst 'ENU="Inventory ";ESM="Inventario ";FRC="Inventaire ";ENC="Inventory "';
      HideValidationDialog@1109 : Boolean;
      Text037@1009 : TextConst 'ENU=You cannot change %1 when %2 is %3 and %4 is positive.;ESM=No puede cambiar el %1 cuando la %2 es %3 y la %4 es positiva.;FRC=Vous ne pouvez pas modifier %1 lorsque %2 est %3 et que %4 est positif.;ENC=You cannot change %1 when %2 is %3 and %4 is positive.';
      Text038@1014 : TextConst 'ENU=You cannot change %1 when %2 is %3 and %4 is negative.;ESM=No puede cambiar el %1 cuando la %2 es %3 y la %4 es negativa.;FRC=Vous ne pouvez pas modifier %1 lorsque %2 est %3 et que %4 est n‚gatif.;ENC=You cannot change %1 when %2 is %3 and %4 is negative.';
      Text039@1034 : TextConst 'ENU=%1 units for %2 %3 have already been returned. Therefore, only %4 units can be returned.;ESM=%1 unidades para el %2 %3 ya se han devuelto. Por lo tanto, s¢lo se pueden devolver %4 unidades.;FRC=%1 unit‚s de %2 %3 ont d‚j… ‚t‚ retourn‚es. Aussi, seulement %4 unit‚s peuvent ˆtre retourn‚es.;ENC=%1 units for %2 %3 have already been returned. Therefore, only %4 units can be returned.';
      Text040@1039 : TextConst 'ENU=You must use form %1 to enter %2, if item tracking is used.;ESM=Utilice el formulario %1 para insertar %2, si se utiliza el seguimiento de productos.;FRC=Si on utilise la tra‡abilit‚, vous devez vous servir du formulaire %1 pour entrer %2.;ENC=You must use form %1 to enter %2, if item tracking is used.';
      Text042@1055 : TextConst 'ENU=When posting the Applied to Ledger Entry %1 will be opened first;ESM=Al registrar Liq. por mov. contable, %1 se abrir  primero;FRC=Lors du report de l''‚criture affect‚e, %1 sera ouvert en premier.;ENC=When posting the Applied to Ledger Entry %1 will be opened first';
      ShippingMoreUnitsThanReceivedErr@1047 : TextConst 'ENU=You cannot ship more than the %1 units that you have received for document no. %2.;ESM=No se puede enviar m s de %1 unidades que se hayan recibido para el documento n§ %2.;FRC=Vous ne pouvez pas livrer plus que les %1ÿunit‚s que vous avez re‡ues pour le document nø %2.;ENC=You cannot ship more than the %1 units that you have received for document no. %2.';
      Text044@1103 : TextConst 'ENU=cannot be less than %1;ESM=no puede ser inferior a %1;FRC=ne peut ˆtre inf‚rieur … %1;ENC=cannot be less than %1';
      Text045@1104 : TextConst 'ENU=cannot be more than %1;ESM=no puede ser superior a %1;FRC=ne peut ˆtre sup‚rieur … %1;ENC=cannot be more than %1';
      Text046@1105 : TextConst 'ENU=You cannot return more than the %1 units that you have shipped for %2 %3.;ESM=No puede devolver m s de las %1 unidades enviadas para el %2 %3.;FRC=Vous ne pouvez pas retourner plus que les %1 unit‚s que vous avez livr‚es pour %2 %3.;ENC=You cannot return more than the %1 units that you have shipped for %2 %3.';
      Text047@1106 : TextConst 'ENU=must be positive when %1 is not 0.;ESM=debe ser positivo cuando %1 no es 0.;FRC=doit ˆtre positif lorsque %1 n''est pas 0.;ENC=must be positive when %1 is not 0.';
      TrackingBlocked@1107 : Boolean;
      Text048@1108 : TextConst 'ENU=You cannot use item tracking on a %1 created from a %2.;ESM=No puede utilizar el seguimiento de productos en una %1 creada desde un %2.;FRC=Vous ne pouvez pas utiliser la tra‡abilit‚ sur un %1 cr‚‚ depuis un %2.;ENC=You cannot use item tracking on a %1 created from a %2.';
      Text049@1139 : TextConst 'ENU=cannot be %1.;ESM=no puede ser %1.;FRC=ne peut ˆtre %1.;ENC=cannot be %1.';
      Text050@1140 : TextConst '@@@="starts with a field name; %1 - numeric value";ENU=must be %1 when the Prepayment Invoice has already been posted;ESM=debe ser %1 cuando la factura de prepago ya se haya registrado;FRC=doit ˆtre %1 si la facture pour paiement anticip‚ a d‚j… ‚t‚ report‚e;ENC=must be %1 when the Prepayment Invoice has already been posted';
      Text051@1141 : TextConst 'ENU=You cannot use %1 in a %2.;ESM=No puede usar %1 en un %2.;FRC=Vous ne pouvez pas utiliser %1 dans un %2.;ENC=You cannot use %1 in a %2.';
      PrePaymentLineAmountEntered@1015 : Boolean;
      Text052@1022 : TextConst 'ENU=You cannot add an item line because an open warehouse shipment exists for the sales header and Shipping Advice is %1.\\You must add items as new lines to the existing warehouse shipment or change Shipping Advice to Partial.;ESM=No puede agregar una l¡nea de producto porque existe un env¡o de almac‚n abierto para la Cabecera venta y el Aviso env¡o es %1.\\Debe agregar productos como l¡neas nuevas en el env¡o de almac‚n existente o cambiar el Aviso env¡o a Parcial.;FRC=Vous ne pouvez pas ajouter une ligne article car il existe une livraison entrep“t ouverte pour l''en-tˆte vente et parce que l''option de livraison est %1.\\Vous devez ajouter les articles comme nouvelles lignes … la livraison entrep“t existante ou modifier l''option de livraison en la d‚finissant sur Partielle.;ENC=You cannot add an item line because an open warehouse shipment exists for the sales header and Shipping Advice is %1.\\You must add items as new lines to the existing warehouse shipment or change Shipping Advice to Partial.';

      Text053@1017 : TextConst
        'ENU=You have changed one or more dimensions on the %1, which is already shipped. When you post the line with the changed dimension to General Ledger, amounts on the Inventory Interim account will be out of balance when reported per dimension.\\Do you want to keep the changed dimension?',
        'ESM=Ha modificado una o varias dimensiones de %1, que ya se ha enviado. Al registrar la l¡nea con la dimensi¢n modificada en la contabilidad, los importes de la cuenta provisional de inventario no cuadrar n cuando se notifiquen por dimensi¢n.\\¨Desea conservar la dimensi¢n modificada?',
        'FRC=Vous avez modifi‚ une ou plusieurs dimensions dans %1, qui a d‚j… ‚t‚ livr‚. Lorsque vous reportez la ligne avec la dimension modifi‚e dans le grand livre, les montants du compte provisoire inventaire sont hors balance si un ‚tat est g‚n‚r‚ par dimension.\\Voulez-vous conserver la dimension modifi‚eÿ?',
        'ENC=You have changed one or more dimensions on the %1, which is already shipped. When you post the line with the changed dimension to General Ledger, amounts on the Inventory Interim account will be out of balance when reported per dimension.\\Do you want to keep the changed dimension?';
      Text054@1023 : TextConst 'ENU=Canceled.;ESM=Cancelado.;FRC=Annul‚.;ENC=Cancelled.';
      Text055@1024 : TextConst '@@@=Quantity Invoiced must not be greater than the sum of Qty. Assigned and Qty. to Assign.;ENU=%1 must not be greater than the sum of %2 and %3.;ESM=%1 no debe ser superior a la suma de %2 y %3.;FRC=%1 ne doit pas ˆtre sup‚rieur … la somme de %2 et de %3.;ENC=%1 must not be greater than the sum of %2 and %3.';
      Text056@1011 : TextConst 'ENU=You cannot add an item line because an open inventory pick exists for the Sales Header and because Shipping Advice is %1.\\You must first post or delete the inventory pick or change Shipping Advice to Partial.;ESM=No puede agregar una l¡nea de producto porque existe un picking inventario para la Cabecera venta y porque el Aviso env¡o es %1.\\Primero debe registrar o eliminar el picking inventario o cambiar el Aviso env¡o a Parcial.;FRC=Vous ne pouvez pas ajouter une ligne article car il existe un pr‚lŠvement inventaire ouvert pour l''en-tˆte vente et parce que l''option de livraison est %1.\\Vous devez tout d''abord reporter ou supprimer le pr‚lŠvement inventaire ou remplacer l''option de livraison par Partielle.;ENC=You cannot add an item line because an open inventory pick exists for the Sales Header and because Shipping Advice is %1.\\You must first post or delete the inventory pick or change Shipping Advice to Partial.';
      Text057@1027 : TextConst 'ENU=must have the same sign as the shipment;ESM=debe tener el mismo signo que el env¡o.;FRC=doit avoir le mˆme signe que la livraison;ENC=must have the same sign as the shipment';
      Text058@1028 : TextConst 'ENU=The quantity that you are trying to invoice is greater than the quantity in shipment %1.;ESM=La cantidad que est  intentando facturar es mayor que la cantidad en el env¡o %1.;FRC=La quantit‚ que vous tentez de facturer est sup‚rieure … la quantit‚ livr‚e %1.;ENC=The quantity that you are trying to invoice is greater than the quantity in shipment %1.';
      Text059@1029 : TextConst 'ENU=must have the same sign as the return receipt;ESM=debe tener el mismo nombre que la recep. dev.;FRC=doit avoir le mˆme signe que la r‚ception retour;ENC=must have the same sign as the return receipt';
      Text060@1041 : TextConst 'ENU=The quantity that you are trying to invoice is greater than the quantity in return receipt %1.;ESM=La cantidad que est  intentando facturar es mayor que la cantidad en la recepci¢n de devoluci¢n %1.;FRC=La quantit‚ que vous tentez de facturer est sup‚rieure … la quantit‚ de la r‚ception retour %1.;ENC=The quantity that you are trying to invoice is greater than the quantity in return receipt %1.';
      Text1020000@1020000 : TextConst 'ENU=You must reopen the document since this will affect Sales Tax.;ESM=Debe volver a abrir el documento ya que esto afectar  al impto. ventas.;FRC=Vous devez ouvrir le document de nouveau car cette op‚ration affectera la taxe de vente.;ENC=You must reopen the document since this will affect Sales Tax.';
      Text1020003@1020004 : TextConst 'ENU=The %1 field in the %2 used on the %3 must match the %1 field in the %2 used on the %4.;ESM=El campo %1 en %2 usado en %3 debe coincidir con el campo %1 en %2 usado en %4.;FRC=Le champ %1 dans %2 utilis‚ sur %3 doit correspondre au champ %1 dans %2 utilis‚ sur %4.;ENC=The %1 field in the %2 used on the %3 must match the %1 field in the %2 used on the %4.';
      Text14000701@14000705 : TextConst 'ENU=Packages already exist for this line.';
      SalesLineCompletelyShippedErr@1053 : TextConst 'ENU=You cannot change the purchasing code for a sales line that has been completely shipped.;ESM=No es posible modificar el c¢digo de compra para una l¡nea de venta que se ha enviado por completo.;FRC=Vous ne pouvez pas modifier le code d''achat d''une ligne vente qui a ‚t‚ entiŠrement livr‚e.;ENC=You cannot change the purchasing code for a sales line that has been completely shipped.';
      SalesSetupRead@1067 : Boolean;
      DoNotUpdateUnitPrice@1000000011 : Boolean;
      DoNotCheckItemAvailability@1000000010 : Boolean;
      "***ABCSI Globals****"@1000000000 : Integer;
      CustDivision@1000000001 : Record 50007;
      GotSalesPrice@1000000002 : Boolean;
      GotHotSheetPrice@1000000003 : Boolean;
      ProfitAmt@1000000004 : Decimal;
      abcsi0001@1000000005 : TextConst 'ENU=The value must be less than or equal to 1. Value: %1.';
      CalledFromActualUnitPrice@1000000006 : Boolean;
      Text50000@1000000012 : TextConst 'ENU=You can enter items with Price Book Code %1 only.';
      Text51000@1000000206 : TextConst 'ENU=%1 exists for %2 %3 that doesn''t allow to have different Mfr. Reps. on the same order.';
      Text51078@1000000205 : TextConst 'ENU=Do you want to round the quantity up to %1 %2?';
      Text51400@1000000007 : TextConst 'ENU="%1 must not be %2 in %3 %4=''%5''. %6=''%7''. %8=''%9''."';
      Text51500@1000000008 : TextConst 'ENU=In Sales Document %1, Line no. %2 you cannot change Quantity to less than %3 because total quantity in ship bin and being picked is %3.';
      Text51080@1000000209 : TextConst 'ENU=cannot be more than %1 less %2 and %3';
      TextRNDERROR@1000000013 : TextConst 'ENU="You Must Round the Qty in order to sell this item %1 "';
      TPZGenLedgSetup@1000000014 : Record 98;
      TPZText001@1000000015 : TextConst 'ENU=You cannot manually change %1: %2, when the %3 is sold as %4.';
      EDIIntegration@1240020002 : Codeunit 14000363;
      PricesInCurrency@1000000016 : Boolean;
      TempSalesPrice@1000000021 : TEMPORARY Record 7002;
      TempSalesLineDisc@1000000020 : TEMPORARY Record 7004;
      ResFindUnitPrice@1000000019 : Codeunit 221;
      LineDiscPerCent@1000000018 : Decimal;
      Qty@1000000017 : Decimal;
      FoundSalesPrice@1000000022 : Boolean;
      ResPrice@1000000023 : Record 201;
      DateCaption@1000000024 : Text[30];
      TempHotSheetPrice@1000000025 : TEMPORARY Record 50017;

    PROCEDURE InitOutstanding@16();
    BEGIN
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
        "Outstanding Quantity" := Quantity - "Return Qty. Received";
        "Outstanding Qty. (Base)" := "Quantity (Base)" - "Return Qty. Received (Base)";
        "Return Qty. Rcd. Not Invd." := "Return Qty. Received" - "Quantity Invoiced";
        "Ret. Qty. Rcd. Not Invd.(Base)" := "Return Qty. Received (Base)" - "Qty. Invoiced (Base)";
      END ELSE BEGIN
        "Outstanding Quantity" := Quantity - "Quantity Shipped";
        "Outstanding Qty. (Base)" := "Quantity (Base)" - "Qty. Shipped (Base)";
        "Qty. Shipped Not Invoiced" := "Quantity Shipped" - "Quantity Invoiced";
        "Qty. Shipped Not Invd. (Base)" := "Qty. Shipped (Base)" - "Qty. Invoiced (Base)";
      END;
      CALCFIELDS("Reserved Quantity");
      Planned := "Reserved Quantity" = "Outstanding Quantity";
      "Completely Shipped" := (Quantity <> 0) AND ("Outstanding Quantity" = 0);
      InitOutstandingAmount;
    END;

    PROCEDURE InitOutstandingAmount@17();
    VAR
      AmountInclVAT@1000 : Decimal;
    BEGIN
      IF Quantity = 0 THEN BEGIN
        "Outstanding Amount" := 0;
        "Outstanding Amount (LCY)" := 0;
        "Shipped Not Invoiced" := 0;
        "Shipped Not Invoiced (LCY)" := 0;
        "Return Rcd. Not Invd." := 0;
        "Return Rcd. Not Invd. (LCY)" := 0;
      END ELSE BEGIN
        GetSalesHeader;
        IF SalesHeader."Prices Including VAT" THEN
          AmountInclVAT := "Line Amount" - "Inv. Discount Amount"
        ELSE
          IF "VAT Calculation Type" = "VAT Calculation Type"::"Sales Tax" THEN
            AmountInclVAT :=
              "Line Amount" - "Inv. Discount Amount" +
              ROUND(
                SalesTaxCalculate.CalculateTax(
                  "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                  "Line Amount" - "Inv. Discount Amount","Quantity (Base)",SalesHeader."Currency Factor"),
                Currency."Amount Rounding Precision")
          ELSE
            AmountInclVAT :=
              ROUND(
                ("Line Amount" - "Inv. Discount Amount") *
                (1 + "VAT %" / 100 * (1 - SalesHeader."VAT Base Discount %" / 100)),
                Currency."Amount Rounding Precision");
        VALIDATE(
          "Outstanding Amount",
          ROUND(
            AmountInclVAT * "Outstanding Quantity" / Quantity,
            Currency."Amount Rounding Precision"));
        IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
          VALIDATE(
            "Return Rcd. Not Invd.",
            ROUND(
              AmountInclVAT * "Return Qty. Rcd. Not Invd." / Quantity,
              Currency."Amount Rounding Precision"))
        ELSE
          VALIDATE(
            "Shipped Not Invoiced",
            ROUND(
              AmountInclVAT * "Qty. Shipped Not Invoiced" / Quantity,
              Currency."Amount Rounding Precision"));
      END;
    END;

    PROCEDURE InitQtyToShip@15();
    BEGIN
      GetSalesSetup;
      IF (SalesSetup."Default Quantity to Ship" = SalesSetup."Default Quantity to Ship"::Remainder) OR
         ("Document Type" = "Document Type"::Invoice)
      THEN BEGIN
        "Qty. to Ship" := "Outstanding Quantity";
        "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";
      END ELSE
        IF "Qty. to Ship" <> 0 THEN
          "Qty. to Ship (Base)" := CalcBaseQty("Qty. to Ship");
      // >> Shipping
      // Qty. to Ship has been set to zero for not accidentially shipping the line when posting.
      // This is not a Shipping Specific problem but and general "Feature" in Navision
      // "Qty. to Ship" := "Outstanding Quantity";
      // "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";
      IF "Drop Shipment" THEN BEGIN
        SalesSetup.GET;
        IF SalesSetup."Blank Drop Shipm. Qty. to Ship" AND (CurrFieldNo <> FIELDNO("Qty. to Ship"))
        THEN BEGIN
          "Qty. to Ship" := 0;
          "Qty. to Ship (Base)" := 0;
        END ELSE BEGIN
          "Qty. to Ship" := "Outstanding Quantity";
          "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";
        END;
      END ELSE BEGIN
        "Qty. to Ship" := "Outstanding Quantity";
        "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";
      END;

      "Std. Pack Qty. to Ship" := CalcStdPackQty("Qty. to Ship (Base)");
      "Package Qty. to Ship" := CalcPackageQty("Std. Pack Qty. to Ship");
      // << Shipping

      CheckServItemCreation;

      InitQtyToInvoice;
    END;

    PROCEDURE InitQtyToReceive@5803();
    BEGIN
      GetSalesSetup;
      IF (SalesSetup."Default Quantity to Ship" = SalesSetup."Default Quantity to Ship"::Remainder) OR
         ("Document Type" = "Document Type"::"Credit Memo")
      THEN BEGIN
        "Return Qty. to Receive" := "Outstanding Quantity";
        "Return Qty. to Receive (Base)" := "Outstanding Qty. (Base)";
      END ELSE
        IF "Return Qty. to Receive" <> 0 THEN
          "Return Qty. to Receive (Base)" := CalcBaseQty("Return Qty. to Receive");

      InitQtyToInvoice;
    END;

    PROCEDURE InitQtyToInvoice@13();
    BEGIN
      "Qty. to Invoice" := MaxQtyToInvoice;
      "Qty. to Invoice (Base)" := MaxQtyToInvoiceBase;
      "VAT Difference" := 0;
      CalcInvDiscToInvoice;
      IF SalesHeader."Document Type" <> SalesHeader."Document Type"::Invoice THEN
        CalcPrepaymentToDeduct;
    END;

    PROCEDURE IsItemNoInHotSheet@1000000053(HotSheetCode@1000000001 : Code[10];ItemNo@1000000000 : Code[20];UOM@1000000003 : Code[10];StartingDate@1000000004 : Date) : Boolean;
    VAR
      HotSheetPrice@1000000002 : Record 50017;
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 Start
      HotSheetPrice.RESET;
      HotSheetPrice.SETRANGE(Code,HotSheetCode);
      HotSheetPrice.SETRANGE("Item No.",ItemNo);
      HotSheetPrice.SETFILTER("Ending Date",'%1|>=%2',0D,StartingDate);
      HotSheetPrice.SETRANGE("Starting Date",0D,StartingDate);
      IF UOM <> '' THEN
        HotSheetPrice.SETFILTER("Unit of Measure Code",'%1|%2',UOM,'');
      EXIT(HotSheetPrice.FINDFIRST);
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 End
    END;

    LOCAL PROCEDURE InitItemAppl@40(OnlyApplTo@1000 : Boolean);
    BEGIN
      "Appl.-to Item Entry" := 0;
      IF NOT OnlyApplTo THEN
        "Appl.-from Item Entry" := 0;
    END;

    PROCEDURE MaxQtyToInvoice@18() : Decimal;
    BEGIN
      IF "Prepayment Line" THEN
        EXIT(1);
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        EXIT("Return Qty. Received" + "Return Qty. to Receive" - "Quantity Invoiced");

      EXIT("Quantity Shipped" + "Qty. to Ship" - "Quantity Invoiced");
    END;

    LOCAL PROCEDURE ActivatedCampaignExists@1000000052(VAR ToCampaignTargetGr@1001 : Record 7030;CustNo@1000 : Code[20];ContNo@1002 : Code[20];CampaignNo@1004 : Code[20]) : Boolean;
    VAR
      FromCampaignTargetGr@1003 : Record 7030;
      Cont@1005 : Record 5050;
    BEGIN
      WITH FromCampaignTargetGr DO BEGIN
        ToCampaignTargetGr.RESET;
        ToCampaignTargetGr.DELETEALL;

        IF CampaignNo <> '' THEN BEGIN
          ToCampaignTargetGr."Campaign No." := CampaignNo;
          ToCampaignTargetGr.INSERT;
        END ELSE BEGIN
          SETRANGE(Type,Type::Customer);
          SETRANGE("No.",CustNo);
          IF FINDSET THEN
            REPEAT
              ToCampaignTargetGr := FromCampaignTargetGr;
              ToCampaignTargetGr.INSERT;
            UNTIL NEXT = 0
          ELSE BEGIN
            IF Cont.GET(ContNo) THEN BEGIN
              SETRANGE(Type,Type::Contact);
              SETRANGE("No.",Cont."Company No.");
              IF FINDSET THEN
                REPEAT
                  ToCampaignTargetGr := FromCampaignTargetGr;
                  ToCampaignTargetGr.INSERT;
                UNTIL NEXT = 0;
            END;
          END;
        END;
        EXIT(ToCampaignTargetGr.FINDFIRST);
      END;
    END;

    PROCEDURE MaxQtyToInvoiceBase@19() : Decimal;
    BEGIN
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        EXIT("Return Qty. Received (Base)" + "Return Qty. to Receive (Base)" - "Qty. Invoiced (Base)");

      EXIT("Qty. Shipped (Base)" + "Qty. to Ship (Base)" - "Qty. Invoiced (Base)");
    END;

    LOCAL PROCEDURE CalcBaseQty@14(Qty@1000 : Decimal) : Decimal;
    BEGIN
      TESTFIELD("Qty. per Unit of Measure");
      EXIT(ROUND(Qty * "Qty. per Unit of Measure",0.00001));
    END;

    LOCAL PROCEDURE SelectItemEntry@8(CurrentFieldNo@1000 : Integer);
    VAR
      ItemLedgEntry@1001 : Record 32;
      SalesLine3@1002 : Record 50021;
    BEGIN
      ItemLedgEntry.SETRANGE("Item No.","No.");
      IF "Location Code" <> '' THEN
        ItemLedgEntry.SETRANGE("Location Code","Location Code");
      ItemLedgEntry.SETRANGE("Variant Code","Variant Code");

      IF CurrentFieldNo = FIELDNO("Appl.-to Item Entry") THEN BEGIN
        ItemLedgEntry.SETCURRENTKEY("Item No.",Open);
        ItemLedgEntry.SETRANGE(Positive,TRUE);
        ItemLedgEntry.SETRANGE(Open,TRUE);
      END ELSE BEGIN
        ItemLedgEntry.SETCURRENTKEY("Item No.",Positive);
        ItemLedgEntry.SETRANGE(Positive,FALSE);
        ItemLedgEntry.SETFILTER("Shipped Qty. Not Returned",'<0');
      END;
      IF PAGE.RUNMODAL(PAGE::"Item Ledger Entries",ItemLedgEntry) = ACTION::LookupOK THEN BEGIN
        SalesLine3 := Rec;
        IF CurrentFieldNo = FIELDNO("Appl.-to Item Entry") THEN
          SalesLine3.VALIDATE("Appl.-to Item Entry",ItemLedgEntry."Entry No.")
        ELSE
          SalesLine3.VALIDATE("Appl.-from Item Entry",ItemLedgEntry."Entry No.");
        CheckItemAvailable(CurrentFieldNo);
        Rec := SalesLine3;
      END;
    END;

    PROCEDURE SetSalesHeader@24(NewSalesHeader@1000 : Record 36);
    BEGIN
      SalesHeader := NewSalesHeader;

      IF SalesHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE BEGIN
        SalesHeader.TESTFIELD("Currency Factor");
        Currency.GET(SalesHeader."Currency Code");
        Currency.TESTFIELD("Amount Rounding Precision");
      END;
    END;

    LOCAL PROCEDURE GetSalesHeader@1();
    BEGIN
      {TESTFIELD("Document No.");
      //TOP210 DM 04/11/15 start
      IF "Temp Sales Order No." <> '' THEN BEGIN
        IF ("Document Type" <> SalesHeader."Document Type") OR ("Temp Sales Order No." <> SalesHeader."No.") THEN BEGIN
          SalesHeader.GET("Document Type","Temp Sales Order No.");
          IF SalesHeader."Currency Code" = '' THEN
            Currency.InitRoundingPrecision
          ELSE BEGIN
            SalesHeader.TESTFIELD("Currency Factor");
            Currency.GET(SalesHeader."Currency Code");
            Currency.TESTFIELD("Amount Rounding Precision");
          END;
        END;

      END ELSE BEGIN
      //TOP210 DM 04/11/15 end
        IF ("Document Type" <> SalesHeader."Document Type") OR ("Document No." <> SalesHeader."No.") THEN BEGIN
          SalesHeader.GET("Document Type","Document No.");
          IF SalesHeader."Currency Code" = '' THEN
            Currency.InitRoundingPrecision
          ELSE BEGIN
            SalesHeader.TESTFIELD("Currency Factor");
            Currency.GET(SalesHeader."Currency Code");
            Currency.TESTFIELD("Amount Rounding Precision");
          END;
        END;

      END; //TOP210 DM 04/11/15
         }
    END;

    LOCAL PROCEDURE GetItem@9();
    BEGIN
      TESTFIELD("No.");
      IF "No." <> Item."No." THEN
        Item.GET("No.");
    END;

    PROCEDURE GetResource@49();
    BEGIN
      TESTFIELD("No.");
      IF "No." <> Resource."No." THEN
        Resource.GET("No.");
    END;

    LOCAL PROCEDURE UpdateUnitPrice@2(CalledByFieldNo@1000 : Integer);
    BEGIN
      // START,SC
      IF DoNotUpdateUnitPrice THEN
        EXIT;
      // END,SC

      IF (CalledByFieldNo <> CurrFieldNo) AND (CurrFieldNo <> 0) THEN
        EXIT;

      GetSalesHeader;
      TESTFIELD("Qty. per Unit of Measure");

      CASE Type OF

        Type::Item:
          BEGIN
            CLEAR(GotSalesPrice);
            CLEAR(GotHotSheetPrice);
            //"Pricing Logic" := "Pricing Logic"::" "; //TOP230 KT ABCSI CRP 2 Fixes 06042015
            SalesHeader."Document Type":=SalesHeader."Document Type"::Order;
            SalesHeader."Sell-to Customer No.":="Sell-to Customer No.";
            SalesHeader."Customer Price Group" := "Customer Price Group";
            SalesHeader."Customer Disc. Group" :="Customer Disc. Group";
            SalesHeader."Shortcut Dimension 5 Code" := 'E';
            SalesHeader."Order Date":=WORKDATE;
            FindSalesLineSalesPrice(SalesHeader,Rec,CalledByFieldNo);

            IF "Pricing Logic" = "Pricing Logic"::"Sales Price" THEN GotSalesPrice := TRUE;


            IF ("Pricing Logic" <> "Pricing Logic"::"Sales Price") THEN BEGIN
              FindSalesLineLineDisc(SalesHeader,Rec);
              IF "Pricing Logic" = "Pricing Logic"::"Hot Sheet" THEN GotHotSheetPrice := TRUE;
            END;


            IF (NOT GotSalesPrice) AND (NOT GotHotSheetPrice) THEN BEGIN
              FindSalesLinePrice(SalesHeader,Rec,CalledByFieldNo);
              //if "Unit price" <> 0 then "Pricing Logic" := "Pricing Logic"::"Item Unit Price";
            END;


            //TOP230 KT ABCSI CRP 2 Fixes 05282015
            IF (NOT GotSalesPrice) AND (NOT GotHotSheetPrice) THEN
              IF "Recomm. Multiplier" = 0 THEN BEGIN
                IF CustDivision.GET(SalesHeader."Sell-to Customer No.",SalesHeader."Shortcut Dimension 5 Code") THEN BEGIN
                  IF CustDivision.Multiplier <> 0 THEN BEGIN
                    "Line Discount %" := ROUND((1 - CustDivision.Multiplier) * 100,0.00001); //TOP230 KT ABCSI Go Live Fixes 11092015
                    "Recomm. Multiplier" := CustDivision.Multiplier;
                    Multiplier := CustDivision.Multiplier;
                    "Pricing Logic" := "Pricing Logic"::"Customer Base Multiplier"; //TOP230 KT ABCSI CRP 2 Fixes 06022015
                  END;
                END;
              END;
             //TOP230 KT ABCSI CRP 2 Fixes 05282015

          END;

      END;
      //TOP100A KT ABCSI Multipliers 02192015
      CASE Type OF
        Type::Item:
          BEGIN
            IF "Recomm. Multiplier" <> 0 THEN
              "Recomm. Unit Price" := ROUND("Unit Price" * "Recomm. Multiplier",0.0001) //TOP230 KT ABCSI Go Live Fixes 11092015
            ELSE
              "Recomm. Unit Price" := "Unit Price";

            IF Multiplier <> 0 THEN
              "Actual Unit Price" := ROUND("Unit Price" * Multiplier,0.0001)  //TOP230 KT ABCSI Go Live Fixes 11092015
            ELSE
              "Actual Unit Price" := "Unit Price";

            IF "Alt. UOM Code" <> '' THEN BEGIN
              "Alt. UOM Actual Unit Price" := CalcAltUOMUnitPrice("Actual Unit Price");
              "Alt. UOM Recomm. Unit Price" := CalcAltUOMUnitPrice("Recomm. Unit Price");
            END;
          END;
      END;
      //TOP100A KT ABCSI Multipliers 02192015

      // <TPZ875>
      IF ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order,"Document Type"::Invoice]) AND
         (Type = Type::Item) AND
         Division.GET(SalesHeader."Shortcut Dimension 5 Code") AND
         Division."Use Last Price as Recomm Price"
      THEN BEGIN
        GetLastSalesPrice(Rec);
        "Line Discount %" := 0;
        "Recomm. Multiplier" := 0;
        Multiplier := 0;
        "Unit Price" := "Last Unit Price";
        "Recomm. Unit Price" := "Last Unit Price";
        "Actual Unit Price" := "Last Unit Price";
      END;
      // </TPZ875>

      VALIDATE("Unit Price");
    END;

    LOCAL PROCEDURE FindResUnitCost@5();
    BEGIN
      ResCost.INIT;
      ResCost.Code := "No.";
      ResCost."Work Type Code" := "Work Type Code";
      ResFindUnitCost.RUN(ResCost);
      VALIDATE("Unit Cost (LCY)",ResCost."Unit Cost" * "Qty. per Unit of Measure");
    END;

    PROCEDURE UpdatePrepmtSetupFields@102();
    VAR
      GenPostingSetup@1001 : Record 252;
      GLAcc@1000 : Record 15;
    BEGIN
      IF ("Prepmt. Amt. Inv." <> 0) AND
         ("Prepayment %" <> xRec."Prepayment %")
      THEN
        FIELDERROR("Prepayment %",STRSUBSTNO(Text050,xRec."Prepayment %"));

      IF ("Prepayment %" <> 0) AND (Type <> Type::" ") THEN BEGIN
        TESTFIELD("Document Type","Document Type"::Order);
        TESTFIELD("No.");
        IF CurrFieldNo = FIELDNO("Prepayment %") THEN
          IF "System-Created Entry" THEN
            FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,0));
        IF "System-Created Entry" THEN
          "Prepayment %" := 0;
        GenPostingSetup.GET("Gen. Bus. Posting Group","Gen. Prod. Posting Group");
        IF GenPostingSetup."Sales Prepayments Account" <> '' THEN BEGIN
          GLAcc.GET(GenPostingSetup."Sales Prepayments Account");
          VATPostingSetup.GET("VAT Bus. Posting Group",GLAcc."VAT Prod. Posting Group");
          VATPostingSetup.TESTFIELD("VAT Calculation Type","VAT Calculation Type");
        END ELSE
          CLEAR(VATPostingSetup);
        "Prepayment VAT %" := VATPostingSetup."VAT %";
        "Prepmt. VAT Calc. Type" := VATPostingSetup."VAT Calculation Type";
        "Prepayment VAT Identifier" := VATPostingSetup."VAT Identifier";
        IF "Prepmt. VAT Calc. Type" IN
           ["Prepmt. VAT Calc. Type"::"Reverse Charge VAT","Prepmt. VAT Calc. Type"::"Sales Tax"]
        THEN
          "Prepayment VAT %" := 0;
        "Prepayment Tax Group Code" := GLAcc."Tax Group Code";
      END;
    END;

    PROCEDURE UpdateAmounts@3();
    VAR
      SalesCrMemoHdr@1001 : Record 114;
      RemLineAmountToInvoice@1000 : Decimal;
    BEGIN
      IF CurrFieldNo <> FIELDNO("Allow Invoice Disc.") THEN
        TESTFIELD(Type);
      GetSalesHeader;

      IF "Line Amount" <> xRec."Line Amount" THEN
        "VAT Difference" := 0;
      IF "Line Amount" <> ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") - "Line Discount Amount" THEN BEGIN
        "Line Amount" := ROUND(Quantity * "Unit Price",Currency."Amount Rounding Precision") - "Line Discount Amount";
        "VAT Difference" := 0;
      END;
      IF SalesHeader."Tax Area Code" = '' THEN
        UpdateVATAmounts
      ELSE
        IF (CurrFieldNo <> 0) AND (SalesHeader.Status = SalesHeader.Status::Released) THEN
          ERROR(Text1020000);
      IF NOT "Prepayment Line" THEN BEGIN
        IF "Prepayment %" <> 0 THEN BEGIN
          IF Quantity < 0 THEN
            FIELDERROR(Quantity,STRSUBSTNO(Text047,FIELDCAPTION("Prepayment %")));
          IF "Unit Price" < 0 THEN
            FIELDERROR("Unit Price",STRSUBSTNO(Text047,FIELDCAPTION("Prepayment %")));
        END;
        IF SalesHeader."Document Type" <> SalesHeader."Document Type"::Invoice THEN BEGIN
          "Prepayment VAT Difference" := 0;
          IF NOT PrePaymentLineAmountEntered THEN
            "Prepmt. Line Amount" := ROUND("Line Amount" * "Prepayment %" / 100,Currency."Amount Rounding Precision");
          IF "Prepmt. Line Amount" < "Prepmt. Amt. Inv." THEN
            FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text049,"Prepmt. Amt. Inv."));
          PrePaymentLineAmountEntered := FALSE;
          IF "Prepmt. Line Amount" <> 0 THEN BEGIN
            RemLineAmountToInvoice :=
              ROUND("Line Amount" * (Quantity - "Quantity Invoiced") / Quantity,Currency."Amount Rounding Precision");
            IF RemLineAmountToInvoice < ("Prepmt. Line Amount" - "Prepmt Amt Deducted") THEN
              FIELDERROR("Prepmt. Line Amount",STRSUBSTNO(Text045,RemLineAmountToInvoice + "Prepmt Amt Deducted"));
          END;
        END ELSE
          IF (CurrFieldNo <> 0) AND ("Line Amount" <> xRec."Line Amount") AND
             ("Prepmt. Amt. Inv." <> 0) AND ("Prepayment %" = 100)
          THEN BEGIN
            IF "Line Amount" < xRec."Line Amount" THEN
              FIELDERROR("Line Amount",STRSUBSTNO(Text044,xRec."Line Amount"));
            FIELDERROR("Line Amount",STRSUBSTNO(Text045,xRec."Line Amount"));
        END;
      END;
      InitOutstandingAmount;
      IF (CurrFieldNo <> 0) AND
         NOT ((Type = Type::Item) AND (CurrFieldNo = FIELDNO("No.")) AND (Quantity <> 0) AND
              // a write transaction may have been started
              ("Qty. per Unit of Measure" <> xRec."Qty. per Unit of Measure")) AND // ...continued condition
         ("Document Type" <= "Document Type"::Invoice) AND
         (("Outstanding Amount" + "Shipped Not Invoiced") > 0)
      THEN
       // CustCheckCreditLimit.SalesLineCheck(Rec);

      IF Type = Type::"Charge (Item)" THEN
        UpdateItemChargeAssgnt;

      IF Quantity < xRec.Quantity THEN BEGIN
        SalesCrMemoHdr.SETCURRENTKEY("Prepayment Order No.");
        SalesCrMemoHdr.SETRANGE("Prepayment Order No.","Document No.");
        IF SalesCrMemoHdr.FINDFIRST THEN BEGIN
          SalesCrMemoHdr.CALCFIELDS(Amount);
          IF ("Prepmt. Amt. Inv." <> 0) AND ("Prepayment %" <> 0) THEN
            IF "Line Amount" <> xRec."Line Amount" - SalesCrMemoHdr.Amount * 100 / "Prepayment %" THEN
              FIELDERROR("Line Amount",STRSUBSTNO(Text050,xRec."Line Amount"));
        END;
      END;
      CalcPrepaymentToDeduct;

      //<TPZ1375>
      UpdateMarginPercent;
      //</TPZ1375>

      // <TPZ92>
      VALIDATE("Mfr. Rep. Comm. %");
      VALIDATE("Location Hdlg. %");;
      // </TPZ92>
    END;

    LOCAL PROCEDURE UpdateVATAmounts@38();
    VAR
      SalesLine2@1000 : Record 37;
      TotalLineAmount@1005 : Decimal;
      TotalInvDiscAmount@1004 : Decimal;
      TotalAmount@1001 : Decimal;
      TotalAmountInclVAT@1002 : Decimal;
      TotalQuantityBase@1003 : Decimal;
    BEGIN
      GetSalesHeader;
      SalesLine2.SETRANGE("Document Type","Document Type");
      SalesLine2.SETRANGE("Document No.","Document No.");
      SalesLine2.SETFILTER("Line No.",'<>%1',"Line No.");
      IF "Line Amount" = 0 THEN
        IF xRec."Line Amount" >= 0 THEN
          SalesLine2.SETFILTER(Amount,'>%1',0)
        ELSE
          SalesLine2.SETFILTER(Amount,'<%1',0)
      ELSE
        IF "Line Amount" > 0 THEN
          SalesLine2.SETFILTER(Amount,'>%1',0)
        ELSE
          SalesLine2.SETFILTER(Amount,'<%1',0);
      SalesLine2.SETRANGE("VAT Identifier","VAT Identifier");
      SalesLine2.SETRANGE("Tax Group Code","Tax Group Code");

      IF "Line Amount" = "Inv. Discount Amount" THEN BEGIN
        Amount := 0;
        "VAT Base Amount" := 0;
        "Amount Including VAT" := 0;
      END ELSE BEGIN
        TotalLineAmount := 0;
        TotalInvDiscAmount := 0;
        TotalAmount := 0;
        TotalAmountInclVAT := 0;
        TotalQuantityBase := 0;
        IF ("VAT Calculation Type" = "VAT Calculation Type"::"Sales Tax") OR
           (("VAT Calculation Type" IN
             ["VAT Calculation Type"::"Normal VAT","VAT Calculation Type"::"Reverse Charge VAT"]) AND ("VAT %" <> 0))
        THEN
          IF NOT SalesLine2.ISEMPTY THEN BEGIN
            SalesLine2.CALCSUMS("Line Amount","Inv. Discount Amount",Amount,"Amount Including VAT","Quantity (Base)");
            TotalLineAmount := SalesLine2."Line Amount";
            TotalInvDiscAmount := SalesLine2."Inv. Discount Amount";
            TotalAmount := SalesLine2.Amount;
            TotalAmountInclVAT := SalesLine2."Amount Including VAT";
            TotalQuantityBase := SalesLine2."Quantity (Base)";
        END;

        IF SalesHeader."Prices Including VAT" THEN
          CASE "VAT Calculation Type" OF
            "VAT Calculation Type"::"Normal VAT",
            "VAT Calculation Type"::"Reverse Charge VAT":
              BEGIN
                Amount :=
                  ROUND(
                    (TotalLineAmount - TotalInvDiscAmount + "Line Amount" - "Inv. Discount Amount") / (1 + "VAT %" / 100),
                    Currency."Amount Rounding Precision") -
                  TotalAmount;
                "VAT Base Amount" :=
                  ROUND(
                    Amount * (1 - SalesHeader."VAT Base Discount %" / 100),
                    Currency."Amount Rounding Precision");
                "Amount Including VAT" :=
                  TotalLineAmount + "Line Amount" -
                  ROUND(
                    (TotalAmount + Amount) * (SalesHeader."VAT Base Discount %" / 100) * "VAT %" / 100,
                    Currency."Amount Rounding Precision",Currency.VATRoundingDirection) -
                  TotalAmountInclVAT - TotalInvDiscAmount - "Inv. Discount Amount";
              END;
            "VAT Calculation Type"::"Full VAT":
              BEGIN
                Amount := 0;
                "VAT Base Amount" := 0;
              END;
            "VAT Calculation Type"::"Sales Tax":
              BEGIN
                SalesHeader.TESTFIELD("VAT Base Discount %",0);
                Amount :=
                  SalesTaxCalculate.ReverseCalculateTax(
                    "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                    TotalAmountInclVAT + "Amount Including VAT",TotalQuantityBase + "Quantity (Base)",
                    SalesHeader."Currency Factor") -
                  TotalAmount;
                IF Amount <> 0 THEN
                  "VAT %" :=
                    ROUND(100 * ("Amount Including VAT" - Amount) / Amount,0.00001)
                ELSE
                  "VAT %" := 0;
                Amount := ROUND(Amount,Currency."Amount Rounding Precision");
                "VAT Base Amount" := Amount;
              END;
          END
        ELSE
          CASE "VAT Calculation Type" OF
            "VAT Calculation Type"::"Normal VAT",
            "VAT Calculation Type"::"Reverse Charge VAT":
              BEGIN
                Amount := ROUND("Line Amount" - "Inv. Discount Amount",Currency."Amount Rounding Precision");
                "VAT Base Amount" :=
                  ROUND(Amount * (1 - SalesHeader."VAT Base Discount %" / 100),Currency."Amount Rounding Precision");
                "Amount Including VAT" :=
                  TotalAmount + Amount +
                  ROUND(
                    (TotalAmount + Amount) * (1 - SalesHeader."VAT Base Discount %" / 100) * "VAT %" / 100,
                    Currency."Amount Rounding Precision",Currency.VATRoundingDirection) -
                  TotalAmountInclVAT;
              END;
            "VAT Calculation Type"::"Full VAT":
              BEGIN
                Amount := 0;
                "VAT Base Amount" := 0;
                "Amount Including VAT" := "Line Amount" - "Inv. Discount Amount";
              END;
            "VAT Calculation Type"::"Sales Tax":
              BEGIN
                Amount := ROUND("Line Amount" - "Inv. Discount Amount",Currency."Amount Rounding Precision");
                "VAT Base Amount" := Amount;
                "Amount Including VAT" :=
                  TotalAmount + Amount +
                  ROUND(
                    SalesTaxCalculate.CalculateTax(
                      "Tax Area Code","Tax Group Code","Tax Liable",SalesHeader."Posting Date",
                      TotalAmount + Amount,TotalQuantityBase + "Quantity (Base)",
                      SalesHeader."Currency Factor"),Currency."Amount Rounding Precision") -
                  TotalAmountInclVAT;
                IF "VAT Base Amount" <> 0 THEN
                  "VAT %" :=
                    ROUND(100 * ("Amount Including VAT" - "VAT Base Amount") / "VAT Base Amount",0.00001)
                ELSE
                  "VAT %" := 0;
              END;
          END;
      END;
    END;

    LOCAL PROCEDURE CheckItemAvailable@4(CalledByFieldNo@1000 : Integer);
    VAR
      CalledByDateField@1001 : Boolean;
    BEGIN
      {IF Reserve = Reserve::Always THEN
        EXIT;

      IF "Shipment Date" = 0D THEN BEGIN
        GetSalesHeader;
        IF SalesHeader."Shipment Date" <> 0D THEN
          VALIDATE("Shipment Date",SalesHeader."Shipment Date")
        ELSE
          VALIDATE("Shipment Date",WORKDATE);
      END;

      // START,SC
      IF DoNotCheckItemAvailability THEN
        EXIT;
      // END,SC

      IF ((CalledByFieldNo = CurrFieldNo) OR (CalledByFieldNo = FIELDNO("Shipment Date"))) AND GUIALLOWED AND
         ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
         (Type = Type::Item) AND ("No." <> '') AND
         ("Outstanding Quantity" > 0) AND
         ("Job Contract Entry No." = 0) AND
         NOT (Nonstock OR "Special Order")
      THEN BEGIN
        CalledByDateField :=
          CalledByFieldNo IN [FIELDNO("Shipment Date"),FIELDNO("Requested Delivery Date"),FIELDNO("Promised Delivery Date"),
                              FIELDNO("Planned Shipment Date"),FIELDNO("Planned Delivery Date")];
        IF ItemCheckAvail.SalesLineCheck(Rec,CalledByDateField) THEN
          ItemCheckAvail.RaiseUpdateInterruptedError;
      END;
       }
    END;

    PROCEDURE ShowReservation@10();
    BEGIN
      {
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      TESTFIELD(Reserve);
      CLEAR(Reservation);
      Reservation.SetSalesLine(Rec);
      Reservation.RUNMODAL;
       }
    END;

    PROCEDURE ShowReservationEntries@21(Modal@1000 : Boolean);
    BEGIN
      {TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      ReservEngineMgt.InitFilterAndSortingLookupFor(ReservEntry,TRUE);
      ReserveSalesLine.FilterReservFor(ReservEntry,Rec);
      IF Modal THEN
        PAGE.RUNMODAL(PAGE::"Reservation Entries",ReservEntry)
      ELSE
        PAGE.RUN(PAGE::"Reservation Entries",ReservEntry);
       }
    END;

    PROCEDURE AutoReserve@11(ShowReservationForm@1020000 : Boolean);
    VAR
      QtyToReserve@1000 : Decimal;
      QtyToReserveBase@1001 : Decimal;
    BEGIN
      {TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");

      ReserveSalesLine.ReservQuantity(Rec,QtyToReserve,QtyToReserveBase);
      IF QtyToReserveBase <> 0 THEN BEGIN
        ReservMgt.SetSalesLine(Rec);
        TESTFIELD("Shipment Date");
        ReservMgt.AutoReserve(FullAutoReservation,'',"Shipment Date",QtyToReserve,QtyToReserveBase);
        FIND;
        IF NOT FullAutoReservation AND ShowReservationForm THEN BEGIN
          COMMIT;
          IF CONFIRM(Text011,TRUE) THEN BEGIN
            ShowReservation;
            FIND;
          END;
        END;
      END;
      }
    END;

    PROCEDURE AutoAsmToOrder@82();
    BEGIN
      //ATOLink.UpdateAsmFromSalesLine(Rec);
    END;

    PROCEDURE GetDate@22() : Date;
    BEGIN
      IF SalesHeader."Posting Date" <> 0D THEN
        EXIT(SalesHeader."Posting Date");
      EXIT(WORKDATE);
    END;

    PROCEDURE CalcPlannedDeliveryDate@92(CurrFieldNo@1000 : Integer) : Date;
    BEGIN
      IF "Shipment Date" = 0D THEN
        EXIT("Planned Delivery Date");

      CASE CurrFieldNo OF
        FIELDNO("Shipment Date"):
          EXIT(CalendarMgmt.CalcDateBOC(
              FORMAT("Shipping Time"),
              "Planned Shipment Date",
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              CalChange."Source Type"::Customer,
              "Sell-to Customer No.",
              '',
              TRUE));
        FIELDNO("Planned Delivery Date"):
          EXIT(CalendarMgmt.CalcDateBOC2(
              FORMAT("Shipping Time"),
              "Planned Delivery Date",
              CalChange."Source Type"::Customer,
              "Sell-to Customer No.",
              '',
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              TRUE))
      END;
    END;

    PROCEDURE CalcPlannedShptDate@93(CurrFieldNo@1000 : Integer) : Date;
    BEGIN
      IF "Shipment Date" = 0D THEN
        EXIT("Planned Shipment Date");

      CASE CurrFieldNo OF
        FIELDNO("Shipment Date"):
          EXIT(CalendarMgmt.CalcDateBOC(
              FORMAT("Outbound Whse. Handling Time"),
              "Shipment Date",
              CalChange."Source Type"::Location,
              "Location Code",
              '',
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              TRUE));
        FIELDNO("Planned Delivery Date"):
          EXIT(CalendarMgmt.CalcDateBOC(
              FORMAT(''),
              "Planned Delivery Date",
              CalChange."Source Type"::Customer,
              "Sell-to Customer No.",
              '',
              CalChange."Source Type"::"Shipping Agent",
              "Shipping Agent Code",
              "Shipping Agent Service Code",
              TRUE));
      END;
    END;

    PROCEDURE SignedXX@20(Value@1000 : Decimal) : Decimal;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Quote,
        "Document Type"::Order,
        "Document Type"::Invoice,
        "Document Type"::"Blanket Order":
          EXIT(-Value);
        "Document Type"::"Return Order",
        "Document Type"::"Credit Memo":
          EXIT(Value);
      END;
    END;

    PROCEDURE BlanketOrderLookup@23();
    BEGIN
      SalesLine2.RESET;
      SalesLine2.SETCURRENTKEY("Document Type",Type,"No.");
      SalesLine2.SETRANGE("Document Type","Document Type"::"Blanket Order");
      SalesLine2.SETRANGE(Type,Type);
      SalesLine2.SETRANGE("No.","No.");
      SalesLine2.SETRANGE("Bill-to Customer No.","Bill-to Customer No.");
      SalesLine2.SETRANGE("Sell-to Customer No.","Sell-to Customer No.");
      IF PAGE.RUNMODAL(PAGE::"Sales Lines",SalesLine2) = ACTION::LookupOK THEN BEGIN
        SalesLine2.TESTFIELD("Document Type","Document Type"::"Blanket Order");
        "Blanket Order No." := SalesLine2."Document No.";
        VALIDATE("Blanket Order Line No.",SalesLine2."Line No.");
      END;
    END;

    PROCEDURE ShowDimensions@25();
    VAR
      OldDimSetID@1020000 : Integer;
    BEGIN
      {OldDimSetID := "Dimension Set ID";
      "Dimension Set ID" :=
        DimMgt.EditDimensionSet("Dimension Set ID",STRSUBSTNO('%1 %2 %3',"Document Type","Document No.","Line No."));
      VerifyItemLineDim;
      //TOP020 KT ABCSI Sales Orders by Division Code 01272015
      //DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");  Commented Out for TOP020
      DimMgt.UpdateGlobalDimFromDimSetIDCustom("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code","Shortcut Dimension 5 Code");
      //TOP020 KT ABCSI Sales Orders by Division Code 01272015
      ATOLink.UpdateAsmDimFromSalesLine(Rec);

      IF OldDimSetID <> "Dimension Set ID" THEN
        MODIFY;
        }
    END;

    PROCEDURE OpenItemTrackingLines@6500();
    VAR
      Job@1000 : Record 167;
    BEGIN
      {
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      TESTFIELD("Quantity (Base)");
      IF "Job Contract Entry No." <> 0 THEN
        ERROR(Text048,TABLECAPTION,Job.TABLECAPTION);
      ReserveSalesLine.CallItemTracking(Rec);
        }
    END;

    PROCEDURE CreateDim@26(Type1@1000 : Integer;No1@1001 : Code[20];Type2@1002 : Integer;No2@1003 : Code[20];Type3@1004 : Integer;No3@1005 : Code[20]);
    VAR
      SourceCodeSetup@1006 : Record 242;
      TableID@1007 : ARRAY [10] OF Integer;
      No@1008 : ARRAY [10] OF Code[20];
    BEGIN
      {
      // >> EDI
      IF EDITemp THEN
        EXIT;
      // << EDI

      SourceCodeSetup.GET;
      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;
      "Shortcut Dimension 1 Code" := '';
      "Shortcut Dimension 2 Code" := '';
      GetSalesHeader;
      "Dimension Set ID" :=
        DimMgt.GetDefaultDimID(
          TableID,No,SourceCodeSetup.Sales,
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",
          SalesHeader."Dimension Set ID",DATABASE::Customer);

      //TOP020 KT ABCSI Sales Orders by Division Code 01272015
      //DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");  Commented out for TOP020
      DimMgt.UpdateGlobalDimFromDimSetIDCustom("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code","Shortcut Dimension 5 Code");
      //TOP020 KT ABCSI Sales Orders by Division Code 01272015
      ATOLink.UpdateAsmDimFromSalesLine(Rec);
        }
    END;

    PROCEDURE ValidateShortcutDimCode@29(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      // >> EDI
      IF EDITemp THEN
        EXIT;
      // << EDI

      DimMgt.ValidateShortcutDimValues(FieldNumber,ShortcutDimCode,"Dimension Set ID");
    END;

    PROCEDURE LookupShortcutDimCode@28(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      // >> EDI
      IF EDITemp THEN
        EXIT;
      // << EDI

      DimMgt.LookupDimValueCode(FieldNumber,ShortcutDimCode);
      ValidateShortcutDimCode(FieldNumber,ShortcutDimCode);
    END;

    PROCEDURE ShowShortcutDimCode@27(VAR ShortcutDimCode@1000 : ARRAY [8] OF Code[20]);
    BEGIN
      // >> EDI
      IF EDITemp THEN
        EXIT;
      // << EDI

      DimMgt.GetShortcutDimensions("Dimension Set ID",ShortcutDimCode);
    END;

    PROCEDURE ShowItemSub@30();
    BEGIN
      {
      CLEAR(SalesHeader);
      TestStatusOpen;
      ItemSubstitutionMgt.ItemSubstGet(Rec);
      IF TransferExtendedText.SalesCheckIfAnyExtText(Rec,TRUE) THEN
        TransferExtendedText.InsertSalesExtText(Rec);
      }
    END;

    PROCEDURE ShowNonstock@32();
    BEGIN
      {
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.",'');
      IF PAGE.RUNMODAL(PAGE::"Nonstock Item List",NonstockItem) = ACTION::LookupOK THEN BEGIN
        NonstockItem.TESTFIELD("Item Category Code");
        ItemCategory.GET(NonstockItem."Item Category Code");
        ItemCategory.TESTFIELD("Def. Gen. Prod. Posting Group");
        ItemCategory.TESTFIELD("Def. Inventory Posting Group");

        "No." := NonstockItem."Entry No.";
        NonstockItemMgt.NonStockSales(Rec);
        VALIDATE("No.","No.");
        VALIDATE("Unit Price",NonstockItem."Unit Price");
      END;
      }
    END;

    LOCAL PROCEDURE GetSalesSetup@100();
    BEGIN
      IF NOT SalesSetupRead THEN
        SalesSetup.GET;
      SalesSetupRead := TRUE;
    END;

    LOCAL PROCEDURE GetFAPostingGroup@6();
    VAR
      LocalGLAcc@1000 : Record 15;
      FASetup@1001 : Record 5603;
      FAPostingGr@1002 : Record 5606;
      FADeprBook@1003 : Record 5612;
      GLSetup@1004 : Record 98;
    BEGIN
      IF (Type <> Type::"Fixed Asset") OR ("No." = '') THEN
        EXIT;
      IF "Depreciation Book Code" = '' THEN BEGIN
        FASetup.GET;
        "Depreciation Book Code" := FASetup."Default Depr. Book";
        IF NOT FADeprBook.GET("No.","Depreciation Book Code") THEN
          "Depreciation Book Code" := '';
        IF "Depreciation Book Code" = '' THEN
          EXIT;
      END;
      FADeprBook.GET("No.","Depreciation Book Code");
      FADeprBook.TESTFIELD("FA Posting Group");
      FAPostingGr.GET(FADeprBook."FA Posting Group");
      FAPostingGr.TESTFIELD("Acq. Cost Acc. on Disposal");
      LocalGLAcc.GET(FAPostingGr."Acq. Cost Acc. on Disposal");
      LocalGLAcc.CheckGLAcc;
      GLSetup.GET;
      IF GLSetup."VAT in Use" THEN
        LocalGLAcc.TESTFIELD("Gen. Prod. Posting Group");
      "Posting Group" := FADeprBook."FA Posting Group";
      "Gen. Prod. Posting Group" := LocalGLAcc."Gen. Prod. Posting Group";
      "Tax Group Code" := LocalGLAcc."Tax Group Code";
      VALIDATE("VAT Prod. Posting Group",LocalGLAcc."VAT Prod. Posting Group");
    END;

    LOCAL PROCEDURE GetFieldCaption@31(FieldNumber@1000 : Integer) : Text[100];
    VAR
      Field@1001 : Record 2000000041;
    BEGIN
      Field.GET(DATABASE::"Sales Line",FieldNumber);
      EXIT(Field."Field Caption");
    END;

    LOCAL PROCEDURE GetCaptionClass@34(FieldNumber@1000 : Integer) : Text[80];
    VAR
      SalesHeader2@1102601000 : Record 36;
    BEGIN
      IF SalesHeader2.GET("Document Type","Document No.") THEN;
      IF SalesHeader2."Prices Including VAT" THEN
        EXIT('2,1,' + GetFieldCaption(FieldNumber))
      ELSE
        EXIT('2,0,' + GetFieldCaption(FieldNumber));
    END;

    LOCAL PROCEDURE GetSKU@5806() : Boolean;
    BEGIN
      IF (SKU."Location Code" = "Location Code") AND
         (SKU."Item No." = "No.") AND
         (SKU."Variant Code" = "Variant Code")
      THEN
        EXIT(TRUE);
      IF SKU.GET("Location Code","No.","Variant Code") THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE GetUnitCost@5808();
    BEGIN
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.");
      GetItem;
      "Qty. per Unit of Measure" := UOMMgt.GetQtyPerUnitOfMeasure(Item,"Unit of Measure Code");
      "Qty. per Alt. UOM" := UOMMgt.GetQtyPerUnitOfMeasure(Item,"Alt. UOM Code");  //TOP050 KT ABCSI Modification to Item Cards 01202015
      IF GetSKU THEN
        VALIDATE("Unit Cost (LCY)",SKU."Unit Cost" * "Qty. per Unit of Measure")
      ELSE
        VALIDATE("Unit Cost (LCY)",Item."Unit Cost" * "Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE CalcUnitCost@5809(ItemLedgEntry@1000 : Record 32) : Decimal;
    VAR
      ValueEntry@1001 : Record 5802;
      UnitCost@1004 : Decimal;
    BEGIN
      WITH ValueEntry DO BEGIN
        SETCURRENTKEY("Item Ledger Entry No.");
        SETRANGE("Item Ledger Entry No.",ItemLedgEntry."Entry No.");
        IF IsServiceItem THEN BEGIN
          CALCSUMS("Cost Amount (Non-Invtbl.)");
          UnitCost := "Cost Amount (Non-Invtbl.)" / ItemLedgEntry.Quantity;
        END ELSE BEGIN
          CALCSUMS("Cost Amount (Actual)","Cost Amount (Expected)");
          UnitCost :=
            ("Cost Amount (Expected)" + "Cost Amount (Actual)") / ItemLedgEntry.Quantity;
        END;
      END;

      EXIT(ABS(UnitCost * "Qty. per Unit of Measure"));
    END;

    PROCEDURE ShowItemChargeAssgnt@5801();
    VAR
      ItemChargeAssgnts@1000 : Page 5814;
      AssignItemChargeSales@1001 : Codeunit 5807;
      ItemChargeAssgntLineAmt@1002 : Decimal;
    BEGIN
      {
      GET("Document Type","Document No.","Line No.");
      TESTFIELD(Type,Type::"Charge (Item)");
      TESTFIELD("No.");
      TESTFIELD(Quantity);

      GetSalesHeader;
      IF SalesHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET(SalesHeader."Currency Code");
      IF ("Inv. Discount Amount" = 0) AND
         ("Line Discount Amount" = 0) AND
         (NOT SalesHeader."Prices Including VAT")
      THEN
        ItemChargeAssgntLineAmt := "Line Amount"
      ELSE
        IF SalesHeader."Prices Including VAT" THEN
          ItemChargeAssgntLineAmt :=
            ROUND(("Line Amount" - "Inv. Discount Amount") / (1 + "VAT %" / 100),
              Currency."Amount Rounding Precision")
        ELSE
          ItemChargeAssgntLineAmt := "Line Amount" - "Inv. Discount Amount";
      ItemChargeAssgntSales.RESET;
      ItemChargeAssgntSales.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Document No.","Document No.");
      ItemChargeAssgntSales.SETRANGE("Document Line No.","Line No.");
      ItemChargeAssgntSales.SETRANGE("Item Charge No.","No.");
      IF NOT ItemChargeAssgntSales.FINDLAST THEN BEGIN
        ItemChargeAssgntSales."Document Type" := "Document Type";
        ItemChargeAssgntSales."Document No." := "Document No.";
        ItemChargeAssgntSales."Document Line No." := "Line No.";
        ItemChargeAssgntSales."Item Charge No." := "No.";
        ItemChargeAssgntSales."Unit Cost" :=
          ROUND(ItemChargeAssgntLineAmt / Quantity,
            Currency."Unit-Amount Rounding Precision");
      END;

      ItemChargeAssgntLineAmt :=
        ROUND(
          ItemChargeAssgntLineAmt * ("Qty. to Invoice" / Quantity),
          Currency."Amount Rounding Precision");

      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        AssignItemChargeSales.CreateDocChargeAssgn(ItemChargeAssgntSales,"Return Receipt No.")
      ELSE
        AssignItemChargeSales.CreateDocChargeAssgn(ItemChargeAssgntSales,"Shipment No.");
      CLEAR(AssignItemChargeSales);
      COMMIT;

      ItemChargeAssgnts.Initialize(Rec,ItemChargeAssgntLineAmt);
      ItemChargeAssgnts.RUNMODAL;
      CALCFIELDS("Qty. to Assign");
       }
    END;

    PROCEDURE UpdateItemChargeAssgnt@5807();
    VAR
      ShareOfVAT@1000 : Decimal;
      TotalQtyToAssign@1001 : Decimal;
      TotalAmtToAssign@1002 : Decimal;
    BEGIN
      CALCFIELDS("Qty. Assigned","Qty. to Assign");
      IF ABS("Quantity Invoiced") > ABS(("Qty. Assigned" + "Qty. to Assign")) THEN
        ERROR(Text055,FIELDCAPTION("Quantity Invoiced"),FIELDCAPTION("Qty. Assigned"),FIELDCAPTION("Qty. to Assign"));

      ItemChargeAssgntSales.RESET;
      ItemChargeAssgntSales.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Document No.","Document No.");
      ItemChargeAssgntSales.SETRANGE("Document Line No.","Line No.");
      ItemChargeAssgntSales.CALCSUMS("Qty. to Assign");
      TotalQtyToAssign := ItemChargeAssgntSales."Qty. to Assign";
      IF (CurrFieldNo <> 0) AND (Amount <> xRec.Amount) THEN BEGIN
        ItemChargeAssgntSales.SETFILTER("Qty. Assigned",'<>0');
        IF NOT ItemChargeAssgntSales.ISEMPTY THEN
          ERROR(Text026,
            FIELDCAPTION(Amount));
        ItemChargeAssgntSales.SETRANGE("Qty. Assigned");
      END;

      IF ItemChargeAssgntSales.FINDSET THEN BEGIN
        GetSalesHeader;
        IF SalesHeader."Prices Including VAT" THEN
          TotalAmtToAssign :=
            ROUND(("Line Amount" - "Inv. Discount Amount") / (1 + "VAT %" / 100),
              Currency."Amount Rounding Precision")
        ELSE
          TotalAmtToAssign := "Line Amount" - "Inv. Discount Amount";
        REPEAT
          ShareOfVAT := 1;
          IF SalesHeader."Prices Including VAT" THEN
            ShareOfVAT := 1 + "VAT %" / 100;
          IF Quantity <> 0 THEN
            IF ItemChargeAssgntSales."Unit Cost" <> ROUND(
                 ("Line Amount" - "Inv. Discount Amount") / Quantity / ShareOfVAT,
                 Currency."Unit-Amount Rounding Precision")
            THEN
              ItemChargeAssgntSales."Unit Cost" :=
                ROUND(("Line Amount" - "Inv. Discount Amount") / Quantity / ShareOfVAT,
                  Currency."Unit-Amount Rounding Precision");
          IF TotalQtyToAssign > 0 THEN BEGIN
            ItemChargeAssgntSales."Amount to Assign" :=
              ROUND(ItemChargeAssgntSales."Qty. to Assign" / TotalQtyToAssign * TotalAmtToAssign,
                Currency."Amount Rounding Precision");
            TotalQtyToAssign -= ItemChargeAssgntSales."Qty. to Assign";
            TotalAmtToAssign -= ItemChargeAssgntSales."Amount to Assign";
          END;
          ItemChargeAssgntSales.MODIFY;
        UNTIL ItemChargeAssgntSales.NEXT = 0;
        CALCFIELDS("Qty. to Assign");
      END;
    END;

    LOCAL PROCEDURE DeleteItemChargeAssgnt@5802(DocType@1000 : Option;DocNo@1001 : Code[20];DocLineNo@1002 : Integer);
    BEGIN
      ItemChargeAssgntSales.SETCURRENTKEY(
        "Applies-to Doc. Type","Applies-to Doc. No.","Applies-to Doc. Line No.");
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Type",DocType);
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. No.",DocNo);
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Line No.",DocLineNo);
      IF NOT ItemChargeAssgntSales.ISEMPTY THEN
        ItemChargeAssgntSales.DELETEALL(TRUE);
    END;

    LOCAL PROCEDURE DeleteChargeChargeAssgnt@5804(DocType@1000 : Option;DocNo@1001 : Code[20];DocLineNo@1002 : Integer);
    BEGIN
      IF DocType <> "Document Type"::"Blanket Order" THEN
        IF "Quantity Invoiced" <> 0 THEN BEGIN
          CALCFIELDS("Qty. Assigned");
          TESTFIELD("Qty. Assigned","Quantity Invoiced");
        END;
      ItemChargeAssgntSales.RESET;
      ItemChargeAssgntSales.SETRANGE("Document Type",DocType);
      ItemChargeAssgntSales.SETRANGE("Document No.",DocNo);
      ItemChargeAssgntSales.SETRANGE("Document Line No.",DocLineNo);
      IF NOT ItemChargeAssgntSales.ISEMPTY THEN
        ItemChargeAssgntSales.DELETEALL;
    END;

    PROCEDURE CheckItemChargeAssgnt@5800();
    VAR
      ItemChargeAssgntSales@1000 : Record 5809;
    BEGIN
      ItemChargeAssgntSales.SETCURRENTKEY(
        "Applies-to Doc. Type","Applies-to Doc. No.","Applies-to Doc. Line No.");
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. No.","Document No.");
      ItemChargeAssgntSales.SETRANGE("Applies-to Doc. Line No.","Line No.");
      ItemChargeAssgntSales.SETRANGE("Document Type","Document Type");
      ItemChargeAssgntSales.SETRANGE("Document No.","Document No.");
      IF ItemChargeAssgntSales.FINDSET THEN BEGIN
        TESTFIELD("Allow Item Charge Assignment");
        REPEAT
          ItemChargeAssgntSales.TESTFIELD("Qty. to Assign",0);
        UNTIL ItemChargeAssgntSales.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE TestStatusOpen@33();
    BEGIN
      IF StatusCheckSuspended THEN
        EXIT;
      GetSalesHeader;
      IF NOT "System-Created Entry" THEN
        IF Type <> Type::" " THEN
          SalesHeader.TESTFIELD(Status,SalesHeader.Status::Open);
    END;

    PROCEDURE SuspendStatusCheck@39(Suspend@1000 : Boolean);
    BEGIN
      StatusCheckSuspended := Suspend;
    END;

    PROCEDURE UpdateVATOnLines@36(QtyType@1000 : 'General,Invoicing,Shipping';VAR SalesHeader@1001 : Record 36;VAR SalesLine@1002 : Record 37;VAR VATAmountLine@1003 : Record 290);
    VAR
      TempVATAmountLineRemainder@1004 : TEMPORARY Record 290;
      Currency@1005 : Record 4;
      NewAmount@1006 : Decimal;
      NewAmountIncludingVAT@1007 : Decimal;
      NewVATBaseAmount@1008 : Decimal;
      VATAmount@1009 : Decimal;
      VATDifference@1010 : Decimal;
      InvDiscAmount@1011 : Decimal;
      LineAmountToInvoice@1012 : Decimal;
      LineAmountToInvoiceDiscounted@1013 : Decimal;
    BEGIN
      IF QtyType = QtyType::Shipping THEN
        EXIT;
      IF SalesHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET(SalesHeader."Currency Code");

      TempVATAmountLineRemainder.DELETEALL;

      WITH SalesLine DO BEGIN
        SETRANGE("Document Type",SalesHeader."Document Type");
        SETRANGE("Document No.",SalesHeader."No.");
        LOCKTABLE;
        IF FINDSET THEN
          REPEAT
            IF NOT ZeroAmountLine(QtyType) THEN BEGIN
              VATAmountLine.GET("VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"Line Amount" >= 0);
              IF VATAmountLine.Modified THEN BEGIN
                IF NOT TempVATAmountLineRemainder.GET(
                     "VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"Line Amount" >= 0)
                THEN BEGIN
                  TempVATAmountLineRemainder := VATAmountLine;
                  TempVATAmountLineRemainder.INIT;
                  TempVATAmountLineRemainder.INSERT;
                END;

                IF QtyType = QtyType::General THEN
                  LineAmountToInvoice := "Line Amount"
                ELSE
                  LineAmountToInvoice :=
                    ROUND("Line Amount" * "Qty. to Invoice" / Quantity,Currency."Amount Rounding Precision");

                IF "Allow Invoice Disc." THEN BEGIN
                  IF (VATAmountLine."Inv. Disc. Base Amount" = 0) OR (LineAmountToInvoice = 0) THEN
                    InvDiscAmount := 0
                  ELSE BEGIN
                    LineAmountToInvoiceDiscounted :=
                      VATAmountLine."Invoice Discount Amount" * LineAmountToInvoice /
                      VATAmountLine."Inv. Disc. Base Amount";
                    TempVATAmountLineRemainder."Invoice Discount Amount" :=
                      TempVATAmountLineRemainder."Invoice Discount Amount" + LineAmountToInvoiceDiscounted;
                    InvDiscAmount :=
                      ROUND(
                        TempVATAmountLineRemainder."Invoice Discount Amount",Currency."Amount Rounding Precision");
                    TempVATAmountLineRemainder."Invoice Discount Amount" :=
                      TempVATAmountLineRemainder."Invoice Discount Amount" - InvDiscAmount;
                  END;
                  IF QtyType = QtyType::General THEN BEGIN
                    "Inv. Discount Amount" := InvDiscAmount;
                    CalcInvDiscToInvoice;
                  END ELSE
                    "Inv. Disc. Amount to Invoice" := InvDiscAmount;
                END ELSE
                  InvDiscAmount := 0;

                IF QtyType = QtyType::General THEN
                  IF SalesHeader."Prices Including VAT" THEN BEGIN
                    IF (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount" = 0) OR
                       ("Line Amount" = 0)
                    THEN BEGIN
                      VATAmount := 0;
                      NewAmountIncludingVAT := 0;
                    END ELSE BEGIN
                      VATAmount :=
                        TempVATAmountLineRemainder."VAT Amount" +
                        VATAmountLine."VAT Amount" *
                        ("Line Amount" - "Inv. Discount Amount") /
                        (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount");
                      NewAmountIncludingVAT :=
                        TempVATAmountLineRemainder."Amount Including VAT" +
                        VATAmountLine."Amount Including VAT" *
                        ("Line Amount" - "Inv. Discount Amount") /
                        (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount");
                    END;
                    NewAmount :=
                      ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision") -
                      ROUND(VATAmount,Currency."Amount Rounding Precision");
                    NewVATBaseAmount :=
                      ROUND(
                        NewAmount * (1 - SalesHeader."VAT Base Discount %" / 100),
                        Currency."Amount Rounding Precision");
                  END ELSE BEGIN
                    IF "VAT Calculation Type" = "VAT Calculation Type"::"Full VAT" THEN BEGIN
                      VATAmount := "Line Amount" - "Inv. Discount Amount";
                      NewAmount := 0;
                      NewVATBaseAmount := 0;
                    END ELSE BEGIN
                      NewAmount := "Line Amount" - "Inv. Discount Amount";
                      NewVATBaseAmount :=
                        ROUND(
                          NewAmount * (1 - SalesHeader."VAT Base Discount %" / 100),
                          Currency."Amount Rounding Precision");
                      IF VATAmountLine."VAT Base" = 0 THEN
                        VATAmount := 0
                      ELSE
                        VATAmount :=
                          TempVATAmountLineRemainder."VAT Amount" +
                          VATAmountLine."VAT Amount" * NewAmount / VATAmountLine."VAT Base";
                    END;
                    NewAmountIncludingVAT := NewAmount + ROUND(VATAmount,Currency."Amount Rounding Precision");
                  END
                ELSE BEGIN
                  IF (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount") = 0 THEN
                    VATDifference := 0
                  ELSE
                    VATDifference :=
                      TempVATAmountLineRemainder."VAT Difference" +
                      VATAmountLine."VAT Difference" * (LineAmountToInvoice - InvDiscAmount) /
                      (VATAmountLine."Line Amount" - VATAmountLine."Invoice Discount Amount");
                  IF LineAmountToInvoice = 0 THEN
                    "VAT Difference" := 0
                  ELSE
                    "VAT Difference" := ROUND(VATDifference,Currency."Amount Rounding Precision");
                END;
                IF QtyType = QtyType::General THEN BEGIN
                  Amount := NewAmount;
                  "Amount Including VAT" := ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision");
                  "VAT Base Amount" := NewVATBaseAmount;
                END;
                InitOutstanding;
                IF Type = Type::"Charge (Item)" THEN
                  UpdateItemChargeAssgnt;
                MODIFY;

                TempVATAmountLineRemainder."Amount Including VAT" :=
                  NewAmountIncludingVAT - ROUND(NewAmountIncludingVAT,Currency."Amount Rounding Precision");
                TempVATAmountLineRemainder."VAT Amount" := VATAmount - NewAmountIncludingVAT + NewAmount;
                TempVATAmountLineRemainder."VAT Difference" := VATDifference - "VAT Difference";
                TempVATAmountLineRemainder.MODIFY;
              END;
            END;
          UNTIL NEXT = 0;
      END;
    END;

    PROCEDURE CalcVATAmountLines@35(QtyType@1000 : 'General,Invoicing,Shipping';VAR SalesHeader@1001 : Record 36;VAR SalesLine@1002 : Record 37;VAR VATAmountLine@1003 : Record 290);
    VAR
      PrevVatAmountLine@1007 : Record 290;
      Currency@1004 : Record 4;
      SalesTaxCalculate@1005 : Codeunit 398;
      TotalVATAmount@1011 : Decimal;
      QtyToHandle@1006 : Decimal;
      RoundingLineInserted@1010 : Boolean;
    BEGIN
      IF SalesHeader."Currency Code" = '' THEN
        Currency.InitRoundingPrecision
      ELSE
        Currency.GET(SalesHeader."Currency Code");

      VATAmountLine.DELETEALL;

      WITH SalesLine DO BEGIN
        SETRANGE("Document Type",SalesHeader."Document Type");
        SETRANGE("Document No.",SalesHeader."No.");
        IF FINDSET THEN
          REPEAT
            IF NOT ZeroAmountLine(QtyType) THEN BEGIN
              IF (Type = Type::"G/L Account") AND NOT "Prepayment Line" THEN
                RoundingLineInserted := ("No." = GetCPGInvRoundAcc(SalesHeader)) OR RoundingLineInserted;
              IF "VAT Calculation Type" IN
                 ["VAT Calculation Type"::"Reverse Charge VAT","VAT Calculation Type"::"Sales Tax"]
              THEN
                "VAT %" := 0;
              IF NOT VATAmountLine.GET(
                   "VAT Identifier","VAT Calculation Type","Tax Group Code",FALSE,"Line Amount" >= 0)
              THEN BEGIN
                VATAmountLine.INIT;
                VATAmountLine."VAT Identifier" := "VAT Identifier";
                VATAmountLine."VAT Calculation Type" := "VAT Calculation Type";
                VATAmountLine."Tax Group Code" := "Tax Group Code";
                VATAmountLine."VAT %" := "VAT %";
                VATAmountLine.Modified := TRUE;
                VATAmountLine.Positive := "Line Amount" >= 0;
                VATAmountLine.INSERT;
              END;
              CASE QtyType OF
                QtyType::General:
                  BEGIN
                    VATAmountLine.Quantity := VATAmountLine.Quantity + "Quantity (Base)";
                    VATAmountLine."Line Amount" := VATAmountLine."Line Amount" + "Line Amount";
                    IF "Allow Invoice Disc." THEN
                      VATAmountLine."Inv. Disc. Base Amount" :=
                        VATAmountLine."Inv. Disc. Base Amount" + "Line Amount";
                    VATAmountLine."Invoice Discount Amount" :=
                      VATAmountLine."Invoice Discount Amount" + "Inv. Discount Amount";
                    VATAmountLine."VAT Difference" := VATAmountLine."VAT Difference" + "VAT Difference";
                    IF "Prepayment Line" THEN
                      VATAmountLine."Includes Prepayment" := TRUE;
                    VATAmountLine.MODIFY;
                  END;
                QtyType::Invoicing:
                  BEGIN
                    CASE TRUE OF
                      ("Document Type" IN ["Document Type"::Order,"Document Type"::Invoice]) AND
                      (NOT SalesHeader.Ship) AND SalesHeader.Invoice AND (NOT "Prepayment Line"):
                        BEGIN
                          IF "Shipment No." = '' THEN BEGIN
                            QtyToHandle := GetAbsMin("Qty. to Invoice","Qty. Shipped Not Invoiced");
                            VATAmountLine.Quantity :=
                              VATAmountLine.Quantity + GetAbsMin("Qty. to Invoice (Base)","Qty. Shipped Not Invd. (Base)");
                          END ELSE BEGIN
                            QtyToHandle := "Qty. to Invoice";
                            VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Invoice (Base)";
                          END;
                        END;
                      ("Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"]) AND
                      (NOT SalesHeader.Receive) AND SalesHeader.Invoice:
                        BEGIN
                          IF "Return Receipt No." = '' THEN BEGIN
                            QtyToHandle := GetAbsMin("Qty. to Invoice","Return Qty. Rcd. Not Invd.");
                            VATAmountLine.Quantity :=
                              VATAmountLine.Quantity + GetAbsMin("Qty. to Invoice (Base)","Ret. Qty. Rcd. Not Invd.(Base)");
                          END ELSE BEGIN
                            QtyToHandle := "Qty. to Invoice";
                            VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Invoice (Base)";
                          END;
                        END;
                      ELSE
                        BEGIN
                        QtyToHandle := "Qty. to Invoice";
                        VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Invoice (Base)";
                      END;
                    END;
                    VATAmountLine."Line Amount" :=
                      VATAmountLine."Line Amount" + GetLineAmountToHandle(QtyToHandle);
                    IF "Allow Invoice Disc." THEN
                      VATAmountLine."Inv. Disc. Base Amount" :=
                        VATAmountLine."Inv. Disc. Base Amount" + GetLineAmountToHandle(QtyToHandle);
                    IF SalesHeader."Invoice Discount Calculation" <> SalesHeader."Invoice Discount Calculation"::Amount THEN
                      VATAmountLine."Invoice Discount Amount" :=
                        VATAmountLine."Invoice Discount Amount" +
                        ROUND("Inv. Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision")
                    ELSE
                      VATAmountLine."Invoice Discount Amount" :=
                        VATAmountLine."Invoice Discount Amount" + "Inv. Disc. Amount to Invoice";
                    VATAmountLine."VAT Difference" := VATAmountLine."VAT Difference" + "VAT Difference";
                    IF "Prepayment Line" THEN
                      VATAmountLine."Includes Prepayment" := TRUE;
                    VATAmountLine.MODIFY;
                  END;
                QtyType::Shipping:
                  BEGIN
                    IF "Document Type" IN
                       ["Document Type"::"Return Order","Document Type"::"Credit Memo"]
                    THEN BEGIN
                      QtyToHandle := "Return Qty. to Receive";
                      VATAmountLine.Quantity := VATAmountLine.Quantity + "Return Qty. to Receive (Base)";
                    END ELSE BEGIN
                      QtyToHandle := "Qty. to Ship";
                      VATAmountLine.Quantity := VATAmountLine.Quantity + "Qty. to Ship (Base)";
                    END;
                    VATAmountLine."Line Amount" :=
                      VATAmountLine."Line Amount" + GetLineAmountToHandle(QtyToHandle);
                    IF "Allow Invoice Disc." THEN
                      VATAmountLine."Inv. Disc. Base Amount" :=
                        VATAmountLine."Inv. Disc. Base Amount" + GetLineAmountToHandle(QtyToHandle);
                    VATAmountLine."Invoice Discount Amount" :=
                      VATAmountLine."Invoice Discount Amount" +
                      ROUND("Inv. Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision");
                    VATAmountLine."VAT Difference" := VATAmountLine."VAT Difference" + "VAT Difference";
                    IF "Prepayment Line" THEN
                      VATAmountLine."Includes Prepayment" := TRUE;
                    VATAmountLine.MODIFY;
                  END;
              END;
              TotalVATAmount := TotalVATAmount + "Amount Including VAT" - Amount;
            END;
          UNTIL NEXT = 0;
      END;

      WITH VATAmountLine DO
        IF FINDSET THEN
          REPEAT
            IF (PrevVatAmountLine."VAT Identifier" <> "VAT Identifier") OR
               (PrevVatAmountLine."VAT Calculation Type" <> "VAT Calculation Type") OR
               (PrevVatAmountLine."Tax Group Code" <> "Tax Group Code") OR
               (PrevVatAmountLine."Use Tax" <> "Use Tax")
            THEN
              PrevVatAmountLine.INIT;
            IF SalesHeader."Prices Including VAT" THEN BEGIN
              CASE "VAT Calculation Type" OF
                "VAT Calculation Type"::"Normal VAT",
                "VAT Calculation Type"::"Reverse Charge VAT":
                  BEGIN
                    "VAT Base" :=
                      ROUND(
                        ("Line Amount" - "Invoice Discount Amount") / (1 + "VAT %" / 100),
                        Currency."Amount Rounding Precision") - "VAT Difference";
                    "VAT Amount" :=
                      "VAT Difference" +
                      ROUND(
                        PrevVatAmountLine."VAT Amount" +
                        ("Line Amount" - "Invoice Discount Amount" - "VAT Base" - "VAT Difference") *
                        (1 - SalesHeader."VAT Base Discount %" / 100),
                        Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    "Amount Including VAT" := "VAT Base" + "VAT Amount";
                    IF Positive THEN
                      PrevVatAmountLine.INIT
                    ELSE BEGIN
                      PrevVatAmountLine := VATAmountLine;
                      PrevVatAmountLine."VAT Amount" :=
                        ("Line Amount" - "Invoice Discount Amount" - "VAT Base" - "VAT Difference") *
                        (1 - SalesHeader."VAT Base Discount %" / 100);
                      PrevVatAmountLine."VAT Amount" :=
                        PrevVatAmountLine."VAT Amount" -
                        ROUND(PrevVatAmountLine."VAT Amount",Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    END;
                  END;
                "VAT Calculation Type"::"Full VAT":
                  BEGIN
                    "VAT Base" := 0;
                    "VAT Amount" := "VAT Difference" + "Line Amount" - "Invoice Discount Amount";
                    "Amount Including VAT" := "VAT Amount";
                  END;
                "VAT Calculation Type"::"Sales Tax":
                  BEGIN
                    "Amount Including VAT" := "Line Amount" - "Invoice Discount Amount";
                    "VAT Base" :=
                      ROUND(
                        SalesTaxCalculate.ReverseCalculateTax(
                          SalesHeader."Tax Area Code","Tax Group Code",SalesHeader."Tax Liable",
                          SalesHeader."Posting Date","Amount Including VAT",Quantity,SalesHeader."Currency Factor"),
                        Currency."Amount Rounding Precision");
                    "VAT Amount" := "VAT Difference" + "Amount Including VAT" - "VAT Base";
                    IF "VAT Base" = 0 THEN
                      "VAT %" := 0
                    ELSE
                      "VAT %" := ROUND(100 * "VAT Amount" / "VAT Base",0.00001);
                  END;
              END;
            END ELSE
              CASE "VAT Calculation Type" OF
                "VAT Calculation Type"::"Normal VAT",
                "VAT Calculation Type"::"Reverse Charge VAT":
                  BEGIN
                    "VAT Base" := "Line Amount" - "Invoice Discount Amount";
                    "VAT Amount" :=
                      "VAT Difference" +
                      ROUND(
                        PrevVatAmountLine."VAT Amount" +
                        "VAT Base" * "VAT %" / 100 * (1 - SalesHeader."VAT Base Discount %" / 100),
                        Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    "Amount Including VAT" := "Line Amount" - "Invoice Discount Amount" + "VAT Amount";
                    IF Positive THEN
                      PrevVatAmountLine.INIT
                    ELSE
                      IF NOT "Includes Prepayment" THEN BEGIN
                        PrevVatAmountLine := VATAmountLine;
                        PrevVatAmountLine."VAT Amount" :=
                          "VAT Base" * "VAT %" / 100 * (1 - SalesHeader."VAT Base Discount %" / 100);
                        PrevVatAmountLine."VAT Amount" :=
                          PrevVatAmountLine."VAT Amount" -
                          ROUND(PrevVatAmountLine."VAT Amount",Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                      END;
                  END;
                "VAT Calculation Type"::"Full VAT":
                  BEGIN
                    "VAT Base" := 0;
                    "VAT Amount" := "VAT Difference" + "Line Amount" - "Invoice Discount Amount";
                    "Amount Including VAT" := "VAT Amount";
                  END;
                "VAT Calculation Type"::"Sales Tax":
                  BEGIN
                    "VAT Base" := "Line Amount" - "Invoice Discount Amount";
                    "VAT Amount" :=
                      SalesTaxCalculate.CalculateTax(
                        SalesHeader."Tax Area Code","Tax Group Code",SalesHeader."Tax Liable",
                        SalesHeader."Posting Date","VAT Base",Quantity,SalesHeader."Currency Factor");
                    IF "VAT Base" = 0 THEN
                      "VAT %" := 0
                    ELSE
                      "VAT %" := ROUND(100 * "VAT Amount" / "VAT Base",0.00001);
                    "VAT Amount" :=
                      "VAT Difference" +
                      ROUND("VAT Amount",Currency."Amount Rounding Precision",Currency.VATRoundingDirection);
                    "Amount Including VAT" := "VAT Base" + "VAT Amount";
                  END;
              END;

            IF RoundingLineInserted THEN
              TotalVATAmount := TotalVATAmount - "VAT Amount";
            "Calculated VAT Amount" := "VAT Amount" - "VAT Difference";
            MODIFY;
          UNTIL NEXT = 0;

      IF RoundingLineInserted AND (TotalVATAmount <> 0) THEN
        IF VATAmountLine.GET(SalesLine."VAT Identifier",SalesLine."VAT Calculation Type",
             SalesLine."Tax Group Code",FALSE,SalesLine."Line Amount" >= 0)
        THEN BEGIN
          VATAmountLine."VAT Amount" := VATAmountLine."VAT Amount" + TotalVATAmount;
          VATAmountLine."Amount Including VAT" := VATAmountLine."Amount Including VAT" + TotalVATAmount;
          VATAmountLine."Calculated VAT Amount" := VATAmountLine."Calculated VAT Amount" + TotalVATAmount;
          VATAmountLine.MODIFY;
        END;
    END;

    PROCEDURE GetCPGInvRoundAcc@71(VAR SalesHeader@1000 : Record 36) : Code[20];
    VAR
      Cust@1002 : Record 18;
      CustTemplate@1003 : Record 5105;
      CustPostingGroup@1004 : Record 92;
    BEGIN
      GetSalesSetup;
      IF SalesSetup."Invoice Rounding" THEN
        IF Cust.GET(SalesHeader."Bill-to Customer No.") THEN
          CustPostingGroup.GET(Cust."Customer Posting Group")
        ELSE
          IF CustTemplate.GET(SalesHeader."Sell-to Customer Template Code") THEN
            CustPostingGroup.GET(CustTemplate."Customer Posting Group");

      EXIT(CustPostingGroup."Invoice Rounding Account");
    END;

    LOCAL PROCEDURE CalcInvDiscToInvoice@37();
    VAR
      OldInvDiscAmtToInv@1000 : Decimal;
    BEGIN
      GetSalesHeader;
      OldInvDiscAmtToInv := "Inv. Disc. Amount to Invoice";
      IF Quantity = 0 THEN
        VALIDATE("Inv. Disc. Amount to Invoice",0)
      ELSE
        VALIDATE(
          "Inv. Disc. Amount to Invoice",
          ROUND(
            "Inv. Discount Amount" * "Qty. to Invoice" / Quantity,
            Currency."Amount Rounding Precision"));

      IF OldInvDiscAmtToInv <> "Inv. Disc. Amount to Invoice" THEN BEGIN
        "Amount Including VAT" := "Amount Including VAT" - "VAT Difference";
        "VAT Difference" := 0;
      END;
    END;

    PROCEDURE UpdateWithWarehouseShip@41();
    BEGIN
      IF Type = Type::Item THEN
        CASE TRUE OF
          ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order]) AND (Quantity >= 0):
            IF Location.RequireShipment("Location Code") THEN
              VALIDATE("Qty. to Ship",0)
            ELSE
              VALIDATE("Qty. to Ship","Outstanding Quantity");
          ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order]) AND (Quantity < 0):
            IF Location.RequireReceive("Location Code") THEN
              VALIDATE("Qty. to Ship",0)
            ELSE
              VALIDATE("Qty. to Ship","Outstanding Quantity");
          ("Document Type" = "Document Type"::"Return Order") AND (Quantity >= 0):
            IF Location.RequireReceive("Location Code") THEN
              VALIDATE("Return Qty. to Receive",0)
            ELSE
              VALIDATE("Return Qty. to Receive","Outstanding Quantity");
          ("Document Type" = "Document Type"::"Return Order") AND (Quantity < 0):
            IF Location.RequireShipment("Location Code") THEN
              VALIDATE("Return Qty. to Receive",0)
            ELSE
              VALIDATE("Return Qty. to Receive","Outstanding Quantity");
        END;
      SetDefaultQuantity;
    END;

    LOCAL PROCEDURE CheckWarehouse@46();
    VAR
      Location2@1002 : Record 14;
      WhseSetup@1000 : Record 5769;
      ShowDialog@1001 : ' ,Message,Error';
      DialogText@1003 : Text[50];
    BEGIN
      GetLocation("Location Code");
      IF "Location Code" = '' THEN BEGIN
        WhseSetup.GET;
        Location2."Require Shipment" := WhseSetup."Require Shipment";
        Location2."Require Pick" := WhseSetup."Require Pick";
        Location2."Require Receive" := WhseSetup."Require Receive";
        Location2."Require Put-away" := WhseSetup."Require Put-away";
      END ELSE
        Location2 := Location;

      DialogText := Text035;
      IF ("Document Type" IN ["Document Type"::Order,"Document Type"::"Return Order"]) AND
         Location2."Directed Put-away and Pick"
      THEN BEGIN
        ShowDialog := ShowDialog::Error;
        IF (("Document Type" = "Document Type"::Order) AND (Quantity >= 0)) OR
           (("Document Type" = "Document Type"::"Return Order") AND (Quantity < 0))
        THEN
          DialogText :=
            DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Shipment"))
        ELSE
          DialogText :=
            DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Receive"));
      END ELSE BEGIN
        IF (("Document Type" = "Document Type"::Order) AND (Quantity >= 0) AND
            (Location2."Require Shipment" OR Location2."Require Pick")) OR
           (("Document Type" = "Document Type"::"Return Order") AND (Quantity < 0) AND
            (Location2."Require Shipment" OR Location2."Require Pick"))
        THEN BEGIN
          IF WhseValidateSourceLine.WhseLinesExist(
               DATABASE::"Sales Line",
               "Document Type",
               "Document No.",
               "Line No.",
               0,
               Quantity)
          THEN
            ShowDialog := ShowDialog::Error
          ELSE
            IF Location2."Require Shipment" THEN
              ShowDialog := ShowDialog::Message;
          IF Location2."Require Shipment" THEN
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Shipment"))
          ELSE BEGIN
            DialogText := Text036;
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Pick"));
          END;
        END;

        IF (("Document Type" = "Document Type"::Order) AND (Quantity < 0) AND
            (Location2."Require Receive" OR Location2."Require Put-away")) OR
           (("Document Type" = "Document Type"::"Return Order") AND (Quantity >= 0) AND
            (Location2."Require Receive" OR Location2."Require Put-away"))
        THEN BEGIN
          IF WhseValidateSourceLine.WhseLinesExist(
               DATABASE::"Sales Line",
               "Document Type",
               "Document No.",
               "Line No.",
               0,
               Quantity)
          THEN
            ShowDialog := ShowDialog::Error
          ELSE
            IF Location2."Require Receive" THEN
              ShowDialog := ShowDialog::Message;
          IF Location2."Require Receive" THEN
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Receive"))
          ELSE BEGIN
            DialogText := Text036;
            DialogText :=
              DialogText + Location2.GetRequirementText(Location2.FIELDNO("Require Put-away"));
          END;
        END;
      END;

      CASE ShowDialog OF
        ShowDialog::Message:
          MESSAGE(Text016 + Text017,DialogText,FIELDCAPTION("Line No."),"Line No.");
        ShowDialog::Error:
          ERROR(Text016,DialogText,FIELDCAPTION("Line No."),"Line No.");
      END;

      HandleDedicatedBin(TRUE);
    END;

    PROCEDURE UpdateDates@43();
    BEGIN
      IF CurrFieldNo = 0 THEN BEGIN
        PlannedShipmentDateCalculated := FALSE;
        PlannedDeliveryDateCalculated := FALSE;
      END;
      IF "Promised Delivery Date" <> 0D THEN
        VALIDATE("Promised Delivery Date")
      ELSE
        IF "Requested Delivery Date" <> 0D THEN
          VALIDATE("Requested Delivery Date")
        ELSE
          VALIDATE("Shipment Date");
    END;

    PROCEDURE GetItemTranslation@42();
    BEGIN
      GetSalesHeader;
      IF ItemTranslation.GET("No.","Variant Code",SalesHeader."Language Code") THEN BEGIN
        Description := ItemTranslation.Description;
        "Description 2" := ItemTranslation."Description 2";
      END;
    END;

    LOCAL PROCEDURE GetLocation@7300(LocationCode@1000 : Code[10]);
    BEGIN
      IF LocationCode = '' THEN
        CLEAR(Location)
      ELSE
        IF Location.Code <> LocationCode THEN
          Location.GET(LocationCode);
    END;

    PROCEDURE PriceExists@44() : Boolean;
    BEGIN
      IF "Document No." <> '' THEN BEGIN
        GetSalesHeader;
        EXIT(SalesLinePriceExists(SalesHeader,Rec,TRUE));
      END;
      EXIT(FALSE);
    END;

    PROCEDURE LineDiscExists@45() : Boolean;
    BEGIN
      IF "Document No." <> '' THEN BEGIN
        GetSalesHeader;
        EXIT(SalesLineLineDiscExists(SalesHeader,Rec,TRUE));
      END;
      EXIT(FALSE);
    END;

    PROCEDURE RowID1@47() : Text[250];
    VAR
      ItemTrackingMgt@1000 : Codeunit 6500;
    BEGIN
      EXIT(ItemTrackingMgt.ComposeRowID(DATABASE::"Sales Line","Document Type",
          "Document No.",'',0,"Line No."));
    END;

    PROCEDURE UpdateItemCrossRef@48();
    BEGIN
      {DistIntegration.EnterSalesItemCrossRef(Rec);
      UpdateICPartner;
       }
    END;

    LOCAL PROCEDURE GetDefaultBin@50();
    VAR
      WMSManagement@1000 : Codeunit 7302;
    BEGIN
      IF Type <> Type::Item THEN
        EXIT;

      "Bin Code" := '';
      IF "Drop Shipment" THEN
        EXIT;

      IF ("Location Code" <> '') AND ("No." <> '') THEN BEGIN
        GetLocation("Location Code");
        IF Location."Bin Mandatory" AND NOT Location."Directed Put-away and Pick" THEN BEGIN
          IF ("Qty. to Assemble to Order" > 0) OR IsAsmToOrderRequired THEN
            IF GetATOBin(Location,"Bin Code") THEN
              EXIT;

          WMSManagement.GetDefaultBin("No.","Variant Code","Location Code","Bin Code");
          HandleDedicatedBin(FALSE);
        END;
      END;
    END;

    PROCEDURE GetATOBin@89(Location@1001 : Record 14;VAR BinCode@1002 : Code[20]) : Boolean;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF NOT Location."Require Shipment" THEN
        BinCode := Location."Asm.-to-Order Shpt. Bin Code";
      IF BinCode <> '' THEN
        EXIT(TRUE);

      IF AsmHeader.GetFromAssemblyBin(Location,BinCode) THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE IsInbound@97() : Boolean;
    BEGIN
      CASE "Document Type" OF
        "Document Type"::Order,"Document Type"::Invoice,"Document Type"::Quote,"Document Type"::"Blanket Order":
          EXIT("Quantity (Base)" < 0);
        "Document Type"::"Return Order","Document Type"::"Credit Memo":
          EXIT("Quantity (Base)" > 0);
      END;

      EXIT(FALSE);
    END;

    LOCAL PROCEDURE HandleDedicatedBin@70(IssueWarning@1001 : Boolean);
    VAR
      WhseIntegrationMgt@1002 : Codeunit 7317;
    BEGIN
      IF NOT IsInbound AND ("Quantity (Base)" <> 0) THEN
        WhseIntegrationMgt.CheckIfBinDedicatedOnSrcDoc("Location Code","Bin Code",IssueWarning);
    END;

    PROCEDURE CheckAssocPurchOrder@51(TheFieldCaption@1000 : Text[250]);
    BEGIN
      IF TheFieldCaption = '' THEN BEGIN // If sales line is being deleted
        IF "Purch. Order Line No." <> 0 THEN
          ERROR(
            Text000,
            "Purchase Order No.",
            "Purch. Order Line No.");
        IF "Special Order Purch. Line No." <> 0 THEN
          ERROR(
            Text000,
            "Special Order Purchase No.",
            "Special Order Purch. Line No.");
      END;
      IF "Purch. Order Line No." <> 0 THEN
        ERROR(
          Text002,
          TheFieldCaption,
          "Purchase Order No.",
          "Purch. Order Line No.");
      IF "Special Order Purch. Line No." <> 0 THEN
        ERROR(
          Text002,
          TheFieldCaption,
          "Special Order Purchase No.",
          "Special Order Purch. Line No.");
    END;

    PROCEDURE CrossReferenceNoLookUp@53();
    VAR
      ItemCrossReference@1000 : Record 5717;
      ICGLAcc@1001 : Record 410;
    BEGIN
      CASE Type OF
        Type::Item:
          BEGIN
            GetSalesHeader;
            ItemCrossReference.RESET;
            ItemCrossReference.SETCURRENTKEY("Cross-Reference Type","Cross-Reference Type No.");
            ItemCrossReference.SETFILTER(
              "Cross-Reference Type",'%1|%2',
              ItemCrossReference."Cross-Reference Type"::Customer,
              ItemCrossReference."Cross-Reference Type"::" ");
            ItemCrossReference.SETFILTER("Cross-Reference Type No.",'%1|%2',SalesHeader."Sell-to Customer No.",'');
            IF PAGE.RUNMODAL(PAGE::"Cross Reference List",ItemCrossReference) = ACTION::LookupOK THEN BEGIN
              VALIDATE("Cross-Reference No.",ItemCrossReference."Cross-Reference No.");
              FindSalesLineLineDisc(SalesHeader,Rec);
              FindSalesLinePrice(SalesHeader,Rec,FIELDNO("Cross-Reference No."));
              VALIDATE("Unit Price");
            END;
          END;
        Type::"G/L Account",Type::Resource:
          BEGIN
            GetSalesHeader;
            SalesHeader.TESTFIELD("Sell-to IC Partner Code");
            IF PAGE.RUNMODAL(PAGE::"IC G/L Account List") = ACTION::LookupOK THEN
              "Cross-Reference No." := ICGLAcc."No.";
          END;
      END;
    END;

    PROCEDURE CheckServItemCreation@52();
    VAR
      ServItemGroup@1000 : Record 5904;
    BEGIN
      IF CurrFieldNo = 0 THEN
        EXIT;
      IF Type <> Type::Item THEN
        EXIT;
      Item.GET("No.");
      IF Item."Service Item Group" = '' THEN
        EXIT;
      IF ServItemGroup.GET(Item."Service Item Group") THEN
        IF ServItemGroup."Create Service Item" THEN
          IF "Qty. to Ship (Base)" <> ROUND("Qty. to Ship (Base)",1) THEN
            ERROR(
              Text034,
              FIELDCAPTION("Qty. to Ship (Base)"),
              ServItemGroup.FIELDCAPTION("Create Service Item"));
    END;

    PROCEDURE ItemExists@54(ItemNo@1000 : Code[20]) : Boolean;
    VAR
      Item2@1001 : Record 27;
    BEGIN
      IF Type = Type::Item THEN
        IF NOT Item2.GET(ItemNo) THEN
          EXIT(FALSE);
      EXIT(TRUE);
    END;

    PROCEDURE IsShipment@55() : Boolean;
    BEGIN
      EXIT(SignedXX("Quantity (Base)") < 0);
    END;

    LOCAL PROCEDURE GetAbsMin@56(QtyToHandle@1000 : Decimal;QtyHandled@1001 : Decimal) : Decimal;
    BEGIN
      IF ABS(QtyHandled) < ABS(QtyToHandle) THEN
        EXIT(QtyHandled);

      EXIT(QtyToHandle);
    END;

    PROCEDURE SetHideValidationDialog@57(NewHideValidationDialog@1000 : Boolean);
    BEGIN
      HideValidationDialog := NewHideValidationDialog;
    END;

    LOCAL PROCEDURE CheckApplFromItemLedgEntry@157(VAR ItemLedgEntry@1000 : Record 32);
    VAR
      ItemTrackingLines@1003 : Page 6510;
      QtyNotReturned@1002 : Decimal;
      QtyReturned@1004 : Decimal;
    BEGIN
      IF "Appl.-from Item Entry" = 0 THEN
        EXIT;

      IF "Shipment No." <> '' THEN
        EXIT;

      TESTFIELD(Type,Type::Item);
      TESTFIELD(Quantity);
      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN BEGIN
        IF Quantity < 0 THEN
          FIELDERROR(Quantity,Text029);
      END ELSE BEGIN
        IF Quantity > 0 THEN
          FIELDERROR(Quantity,Text030);
      END;

      ItemLedgEntry.GET("Appl.-from Item Entry");
      ItemLedgEntry.TESTFIELD(Positive,FALSE);
      ItemLedgEntry.TESTFIELD("Item No.","No.");
      ItemLedgEntry.TESTFIELD("Variant Code","Variant Code");
      IF (ItemLedgEntry."Lot No." <> '') OR (ItemLedgEntry."Serial No." <> '') THEN
        ERROR(Text040,ItemTrackingLines.CAPTION,FIELDCAPTION("Appl.-from Item Entry"));

      IF ABS("Quantity (Base)") > -ItemLedgEntry.Quantity THEN
        ERROR(
          Text046,
          -ItemLedgEntry.Quantity,ItemLedgEntry.FIELDCAPTION("Document No."),
          ItemLedgEntry."Document No.");

      IF "Document Type" IN ["Document Type"::"Return Order","Document Type"::"Credit Memo"] THEN
        IF ABS("Outstanding Qty. (Base)") > -ItemLedgEntry."Shipped Qty. Not Returned" THEN BEGIN
          QtyNotReturned := ItemLedgEntry."Shipped Qty. Not Returned";
          QtyReturned := ItemLedgEntry.Quantity - ItemLedgEntry."Shipped Qty. Not Returned";
          IF "Qty. per Unit of Measure" <> 0 THEN BEGIN
            QtyNotReturned :=
              ROUND(ItemLedgEntry."Shipped Qty. Not Returned" / "Qty. per Unit of Measure",0.00001);
            QtyReturned :=
              ROUND(
                (ItemLedgEntry.Quantity - ItemLedgEntry."Shipped Qty. Not Returned") /
                "Qty. per Unit of Measure",0.00001);
          END;
          ERROR(
            Text039,
            -QtyReturned,ItemLedgEntry.FIELDCAPTION("Document No."),
            ItemLedgEntry."Document No.",-QtyNotReturned);
        END;
    END;

    PROCEDURE CalcPrepaymentToDeduct@63();
    BEGIN
      IF ("Qty. to Invoice" <> 0) AND ("Prepmt. Amt. Inv." <> 0) THEN BEGIN
        GetSalesHeader;
        IF ("Prepayment %" = 100) AND NOT IsFinalInvoice THEN
          "Prepmt Amt to Deduct" := GetLineAmountToHandle("Qty. to Invoice")
        ELSE
          "Prepmt Amt to Deduct" :=
            ROUND(
              ("Prepmt. Amt. Inv." - "Prepmt Amt Deducted") *
              "Qty. to Invoice" / (Quantity - "Quantity Invoiced"),Currency."Amount Rounding Precision")
      END ELSE
        "Prepmt Amt to Deduct" := 0
    END;

    PROCEDURE IsFinalInvoice@116() : Boolean;
    BEGIN
      EXIT("Qty. to Invoice" = Quantity - "Quantity Invoiced");
    END;

    PROCEDURE GetLineAmountToHandle@117(QtyToHandle@1002 : Decimal) : Decimal;
    VAR
      LineAmount@1001 : Decimal;
      LineDiscAmount@1000 : Decimal;
    BEGIN
      IF "Line Discount %" = 100 THEN
        EXIT(0);

      GetSalesHeader;
      LineAmount := ROUND(QtyToHandle * "Unit Price",Currency."Amount Rounding Precision");
      LineDiscAmount := ROUND("Line Discount Amount" * QtyToHandle / Quantity,Currency."Amount Rounding Precision");
      EXIT(LineAmount - LineDiscAmount);
    END;

    PROCEDURE SetHasBeenShown@59();
    BEGIN
      HasBeenShown := TRUE;
    END;

    PROCEDURE TestJobPlanningLine@60();
    BEGIN
      {IF "Job Contract Entry No." = 0 THEN
        EXIT;
      JobPostLine.TestSalesLine(Rec);
       }
    END;

    PROCEDURE BlockDynamicTracking@58(SetBlock@1000 : Boolean);
    BEGIN
      TrackingBlocked := SetBlock;
      ReserveSalesLine.Block(SetBlock);
    END;

    PROCEDURE InitQtyToShip2@7();
    BEGIN
      {
      "Qty. to Ship" := "Outstanding Quantity";
      "Qty. to Ship (Base)" := "Outstanding Qty. (Base)";

      ATOLink.UpdateQtyToAsmFromSalesLine(Rec);

      CheckServItemCreation;

      "Qty. to Invoice" := MaxQtyToInvoice;
      "Qty. to Invoice (Base)" := MaxQtyToInvoiceBase;
      "VAT Difference" := 0;

      CalcInvDiscToInvoice;

      CalcPrepaymentToDeduct;
      }
    END;

    PROCEDURE ShowLineComments@61();
    VAR
      SalesCommentLine@1000 : Record 44;
      SalesCommentSheet@1001 : Page 67;
    BEGIN
      TESTFIELD("Document No.");
      TESTFIELD("Line No.");
      SalesCommentLine.SETRANGE("Document Type","Document Type");
      SalesCommentLine.SETRANGE("No.","Document No.");
      SalesCommentLine.SETRANGE("Document Line No.","Line No.");
      SalesCommentSheet.SETTABLEVIEW(SalesCommentLine);
      SalesCommentSheet.RUNMODAL;
    END;

    PROCEDURE SetDefaultQuantity@62();
    BEGIN
      GetSalesSetup;
      IF SalesSetup."Default Quantity to Ship" = SalesSetup."Default Quantity to Ship"::Blank THEN BEGIN
        IF ("Document Type" = "Document Type"::Order) OR ("Document Type" = "Document Type"::Quote) THEN BEGIN
          "Qty. to Ship" := 0;
          "Qty. to Ship (Base)" := 0;
          "Qty. to Invoice" := 0;
          "Qty. to Invoice (Base)" := 0;
        END;
        IF "Document Type" = "Document Type"::"Return Order" THEN BEGIN
          "Return Qty. to Receive" := 0;
          "Return Qty. to Receive (Base)" := 0;
          "Qty. to Invoice" := 0;
          "Qty. to Invoice (Base)" := 0;
        END;
      END;
    END;

    PROCEDURE UpdatePrePaymentAmounts@64();
    VAR
      ShipmentLine@1000 : Record 111;
      SalesOrderLine@1001 : Record 37;
      SalesOrderHeader@1002 : Record 36;
    BEGIN
      IF ("Document Type" <> "Document Type"::Invoice) OR ("Prepayment %" = 0) THEN
        EXIT;

      IF NOT ShipmentLine.GET("Shipment No.","Shipment Line No.") THEN BEGIN
        "Prepmt Amt to Deduct" := 0;
        "Prepmt VAT Diff. to Deduct" := 0;
      END ELSE BEGIN
        IF SalesOrderLine.GET(SalesOrderLine."Document Type"::Order,ShipmentLine."Order No.",ShipmentLine."Order Line No.") THEN BEGIN
          IF ("Prepayment %" = 100) AND (Quantity <> SalesOrderLine.Quantity - SalesOrderLine."Quantity Invoiced") THEN
            "Prepmt Amt to Deduct" := "Line Amount"
          ELSE
            "Prepmt Amt to Deduct" :=
              ROUND((SalesOrderLine."Prepmt. Amt. Inv." - SalesOrderLine."Prepmt Amt Deducted") *
                Quantity / (SalesOrderLine.Quantity - SalesOrderLine."Quantity Invoiced"),Currency."Amount Rounding Precision");
          "Prepmt VAT Diff. to Deduct" := "Prepayment VAT Difference" - "Prepmt VAT Diff. Deducted";
          SalesOrderHeader.GET(SalesOrderHeader."Document Type"::Order,SalesOrderLine."Document No.");
        END ELSE BEGIN
          "Prepmt Amt to Deduct" := 0;
          "Prepmt VAT Diff. to Deduct" := 0;
        END;
      END;

      GetSalesHeader;
      SalesHeader.TESTFIELD("Prices Including VAT",SalesOrderHeader."Prices Including VAT");
      IF SalesHeader."Prices Including VAT" THEN BEGIN
        "Prepmt. Amt. Incl. VAT" := "Prepmt Amt to Deduct";
        "Prepayment Amount" :=
          ROUND(
            "Prepmt Amt to Deduct" / (1 + ("Prepayment VAT %" / 100)),
            Currency."Amount Rounding Precision");
      END ELSE BEGIN
        "Prepmt. Amt. Incl. VAT" :=
          ROUND(
            "Prepmt Amt to Deduct" * (1 + ("Prepayment VAT %" / 100)),
            Currency."Amount Rounding Precision");
        "Prepayment Amount" := "Prepmt Amt to Deduct";
      END;
      "Prepmt. Line Amount" := "Prepmt Amt to Deduct";
      "Prepmt. Amt. Inv." := "Prepmt. Line Amount";
      "Prepmt. VAT Base Amt." := "Prepayment Amount";
      "Prepmt. Amount Inv. Incl. VAT" := "Prepmt. Amt. Incl. VAT";
      "Prepmt Amt Deducted" := 0;
    END;

    PROCEDURE ZeroAmountLine@65(QtyType@1000 : 'General,Invoicing,Shipping') : Boolean;
    BEGIN
      IF Type = Type::" " THEN
        EXIT(TRUE);
      IF Quantity = 0 THEN
        EXIT(TRUE);
      IF "Unit Price" = 0 THEN
        EXIT(TRUE);
      IF QtyType = QtyType::Invoicing THEN
        IF "Qty. to Invoice" = 0 THEN
          EXIT(TRUE);
      EXIT(FALSE);
    END;

    PROCEDURE FilterLinesWithItemToPlan@69(VAR Item@1000 : Record 27;DocumentType@1001 : Option);
    BEGIN
      RESET;
      SETCURRENTKEY("Document Type",Type,"No.","Variant Code","Drop Shipment","Location Code","Shipment Date");
      SETRANGE("Document Type",DocumentType);
      SETRANGE(Type,Type::Item);
      SETRANGE("No.",Item."No.");
      SETFILTER("Variant Code",Item.GETFILTER("Variant Filter"));
      SETFILTER("Location Code",Item.GETFILTER("Location Filter"));
      SETFILTER("Drop Shipment",Item.GETFILTER("Drop Shipment Filter"));
      SETFILTER("Shortcut Dimension 1 Code",Item.GETFILTER("Global Dimension 1 Filter"));
      SETFILTER("Shortcut Dimension 2 Code",Item.GETFILTER("Global Dimension 2 Filter"));
      SETFILTER("Shipment Date",Item.GETFILTER("Date Filter"));
      SETFILTER("Outstanding Qty. (Base)",'<>0');
    END;

    PROCEDURE FindLinesWithItemToPlan@66(VAR Item@1000 : Record 27;DocumentType@1001 : Option) : Boolean;
    BEGIN
      FilterLinesWithItemToPlan(Item,DocumentType);
      EXIT(FIND('-'));
    END;

    PROCEDURE LinesWithItemToPlanExist@67(VAR Item@1000 : Record 27;DocumentType@1001 : Option) : Boolean;
    BEGIN
      FilterLinesWithItemToPlan(Item,DocumentType);
      EXIT(NOT ISEMPTY);
    END;

    LOCAL PROCEDURE DateFormularZero@73(VAR DateFormularValue@1001 : DateFormula;CalledByFieldNo@1002 : Integer;CalledByFieldCaption@1003 : Text[250]);
    VAR
      DateFormularZero@1000 : DateFormula;
    BEGIN
      EVALUATE(DateFormularZero,'<0D>');
      IF (DateFormularValue <> DateFormularZero) AND (CalledByFieldNo = CurrFieldNo) THEN
        ERROR(Text051,CalledByFieldCaption,FIELDCAPTION("Drop Shipment"));
      EVALUATE(DateFormularValue,'<0D>');
    END;

    LOCAL PROCEDURE InitQtyToAsm@76();
    BEGIN
      IF NOT IsAsmToOrderAllowed THEN BEGIN
        "Qty. to Assemble to Order" := 0;
        "Qty. to Asm. to Order (Base)" := 0;
        EXIT;
      END;

      IF ((xRec."Qty. to Asm. to Order (Base)" = 0) AND IsAsmToOrderRequired AND ("Qty. Shipped (Base)" = 0)) OR
         ((xRec."Qty. to Asm. to Order (Base)" <> 0) AND
          (xRec."Qty. to Asm. to Order (Base)" = xRec."Quantity (Base)")) OR
         ("Qty. to Asm. to Order (Base)" > "Quantity (Base)")
      THEN BEGIN
        "Qty. to Assemble to Order" := Quantity;
        "Qty. to Asm. to Order (Base)" := "Quantity (Base)";
      END;
    END;

    PROCEDURE AsmToOrderExists@72(VAR AsmHeader@1000 : Record 900) : Boolean;
    VAR
      ATOLink@1001 : Record 904;
    BEGIN
      {
      IF NOT ATOLink.AsmExistsForSalesLine(Rec) THEN
        EXIT(FALSE);
      EXIT(AsmHeader.GET(ATOLink."Assembly Document Type",ATOLink."Assembly Document No."));
       }
    END;

    PROCEDURE FullQtyIsForAsmToOrder@74() : Boolean;
    BEGIN
      IF "Qty. to Asm. to Order (Base)" = 0 THEN
        EXIT(FALSE);
      EXIT("Quantity (Base)" = "Qty. to Asm. to Order (Base)");
    END;

    LOCAL PROCEDURE FullReservedQtyIsForAsmToOrder@75() : Boolean;
    BEGIN
      IF "Qty. to Asm. to Order (Base)" = 0 THEN
        EXIT(FALSE);
      CALCFIELDS("Reserved Qty. (Base)");
      EXIT("Reserved Qty. (Base)" = "Qty. to Asm. to Order (Base)");
    END;

    PROCEDURE QtyBaseOnATO@86() : Decimal;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF AsmToOrderExists(AsmHeader) THEN
        EXIT(AsmHeader."Quantity (Base)");
      EXIT(0);
    END;

    PROCEDURE QtyAsmRemainingBaseOnATO@90() : Decimal;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF AsmToOrderExists(AsmHeader) THEN
        EXIT(AsmHeader."Remaining Quantity (Base)");
      EXIT(0);
    END;

    PROCEDURE QtyToAsmBaseOnATO@88() : Decimal;
    VAR
      AsmHeader@1000 : Record 900;
    BEGIN
      IF AsmToOrderExists(AsmHeader) THEN
        EXIT(AsmHeader."Quantity to Assemble (Base)");
      EXIT(0);
    END;

    PROCEDURE IsAsmToOrderAllowed@77() : Boolean;
    BEGIN
      IF NOT ("Document Type" IN ["Document Type"::Quote,"Document Type"::"Blanket Order","Document Type"::Order]) THEN
        EXIT(FALSE);
      IF Quantity < 0 THEN
        EXIT(FALSE);
      IF Type <> Type::Item THEN
        EXIT(FALSE);
      IF "No." = '' THEN
        EXIT(FALSE);
      IF "Drop Shipment" OR "Special Order" THEN
        EXIT(FALSE);
      EXIT(TRUE)
    END;

    PROCEDURE IsAsmToOrderRequired@81() : Boolean;
    BEGIN
      IF (Type <> Type::Item) OR ("No." = '') THEN
        EXIT(FALSE);
      GetItem;
      IF GetSKU THEN
        EXIT(SKU."Assembly Policy" = SKU."Assembly Policy"::"Assemble-to-Order");
      EXIT(Item."Assembly Policy" = Item."Assembly Policy"::"Assemble-to-Order");
    END;

    PROCEDURE CheckAsmToOrder@85(AsmHeader@1001 : Record 900);
    BEGIN
      TESTFIELD("Qty. to Assemble to Order",AsmHeader.Quantity);
      TESTFIELD("Document Type",AsmHeader."Document Type");
      TESTFIELD(Type,Type::Item);
      TESTFIELD("No.",AsmHeader."Item No.");
      TESTFIELD("Location Code",AsmHeader."Location Code");
      TESTFIELD("Unit of Measure Code",AsmHeader."Unit of Measure Code");
      TESTFIELD("Variant Code",AsmHeader."Variant Code");
      TESTFIELD("Shipment Date",AsmHeader."Due Date");
      IF "Document Type" = "Document Type"::Order THEN BEGIN
        AsmHeader.CALCFIELDS("Reserved Qty. (Base)");
        AsmHeader.TESTFIELD("Reserved Qty. (Base)",AsmHeader."Remaining Quantity (Base)");
      END;
      TESTFIELD("Qty. to Asm. to Order (Base)",AsmHeader."Quantity (Base)");
      IF "Outstanding Qty. (Base)" < AsmHeader."Remaining Quantity (Base)" THEN
        AsmHeader.FIELDERROR("Remaining Quantity (Base)",STRSUBSTNO(Text045,AsmHeader."Remaining Quantity (Base)"));
    END;

    PROCEDURE ShowAsmToOrder@79();
    VAR
      ATOLink@1000 : Record 904;
    BEGIN
      //ATOLink.ShowAsm(Rec);
    END;

    PROCEDURE ShowAsmToOrderLines@80();
    VAR
      ATOLink@1000 : Record 904;
    BEGIN
      //ATOLink.ShowAsmToOrderLines(Rec);
    END;

    PROCEDURE FindOpenATOEntry@96(LotNo@1003 : Code[20];SerialNo@1004 : Code[20]) : Integer;
    VAR
      PostedATOLink@1002 : Record 914;
      ItemLedgEntry@1001 : Record 32;
    BEGIN
      {
      TESTFIELD("Document Type","Document Type"::Order);
      IF PostedATOLink.FindLinksFromSalesLine(Rec) THEN
        REPEAT
          ItemLedgEntry.SETRANGE("Document Type",ItemLedgEntry."Document Type"::"Posted Assembly");
          ItemLedgEntry.SETRANGE("Document No.",PostedATOLink."Assembly Document No.");
          ItemLedgEntry.SETRANGE("Document Line No.",0);
          ItemLedgEntry.SETRANGE("Serial No.",SerialNo);
          ItemLedgEntry.SETRANGE("Lot No.",LotNo);
          ItemLedgEntry.SETRANGE(Open,TRUE);
          IF ItemLedgEntry.FINDFIRST THEN
            EXIT(ItemLedgEntry."Entry No.");
        UNTIL PostedATOLink.NEXT = 0;
      }
    END;

    PROCEDURE RollUpAsmCost@83();
    BEGIN
      //ATOLink.RollUpCost(Rec);
    END;

    PROCEDURE RollupAsmPrice@84();
    BEGIN
      {GetSalesHeader;
      ATOLink.RollUpPrice(SalesHeader,Rec);
       }
    END;

    LOCAL PROCEDURE UpdateICPartner@78();
    VAR
      ICPartner@1000 : Record 413;
      ItemCrossReference@1001 : Record 5717;
    BEGIN
      IF SalesHeader."Send IC Document" AND
         (SalesHeader."IC Direction" = SalesHeader."IC Direction"::Outgoing) AND
         (SalesHeader."Bill-to IC Partner Code" <> '')
      THEN
        CASE Type OF
          Type::" ",Type::"Charge (Item)":
            BEGIN
              "IC Partner Ref. Type" := Type;
              "IC Partner Reference" := "No.";
            END;
          Type::"G/L Account":
            BEGIN
              "IC Partner Ref. Type" := Type;
              "IC Partner Reference" := GLAcc."Default IC Partner G/L Acc. No";
            END;
          Type::Item:
            BEGIN
              IF SalesHeader."Sell-to IC Partner Code" <> '' THEN
                ICPartner.GET(SalesHeader."Sell-to IC Partner Code")
              ELSE
                ICPartner.GET(SalesHeader."Bill-to IC Partner Code");
              CASE ICPartner."Outbound Sales Item No. Type" OF
                ICPartner."Outbound Sales Item No. Type"::"Common Item No.":
                  VALIDATE("IC Partner Ref. Type","IC Partner Ref. Type"::"Common Item No.");
                ICPartner."Outbound Sales Item No. Type"::"Internal No.",
                ICPartner."Outbound Sales Item No. Type"::"Cross Reference":
                  BEGIN
                    ItemCrossReference.SETRANGE("Cross-Reference Type",ItemCrossReference."Cross-Reference Type"::Customer);
                    ItemCrossReference.SETRANGE("Cross-Reference Type No.","Sell-to Customer No.");
                    ItemCrossReference.SETRANGE("Item No.","No.");
                    ItemCrossReference.SETRANGE("Variant Code","Variant Code");
                    ItemCrossReference.SETRANGE("Unit of Measure","Unit of Measure Code");
                    IF ItemCrossReference.FINDFIRST THEN BEGIN
                      VALIDATE("IC Partner Ref. Type","IC Partner Ref. Type"::"Cross Reference");
                      "IC Partner Reference" := ItemCrossReference."Cross-Reference No.";
                    END ELSE BEGIN
                      "IC Partner Ref. Type" := "IC Partner Ref. Type"::Item;
                      "IC Partner Reference" := "No.";
                    END;
                  END;
              END;
            END;
          Type::"Fixed Asset":
            BEGIN
              "IC Partner Ref. Type" := "IC Partner Ref. Type"::" ";
              "IC Partner Reference" := '';
            END;
          Type::Resource:
            BEGIN
              Resource.GET("No.");
              "IC Partner Ref. Type" := "IC Partner Ref. Type"::"G/L Account";
              "IC Partner Reference" := Resource."IC Partner Purch. G/L Acc. No.";
            END;
        END;
    END;

    PROCEDURE OutstandingInvoiceAmountFromShipment@12(SellToCustomerNo@1000 : Code[20]) : Decimal;
    VAR
      SalesLine@1001 : Record 37;
    BEGIN
      SalesLine.SETCURRENTKEY("Document Type","Sell-to Customer No.","Shipment No.");
      SalesLine.SETRANGE("Document Type",SalesLine."Document Type"::Invoice);
      SalesLine.SETRANGE("Sell-to Customer No.",SellToCustomerNo);
      SalesLine.SETFILTER("Shipment No.",'<>%1','');
      SalesLine.CALCSUMS("Outstanding Amount (LCY)");
      EXIT(SalesLine."Outstanding Amount (LCY)");
    END;

    LOCAL PROCEDURE CheckShipmentRelation@94();
    VAR
      SalesShptLine@1001 : Record 111;
    BEGIN
      SalesShptLine.GET("Shipment No.","Shipment Line No.");
      IF (Quantity * SalesShptLine."Qty. Shipped Not Invoiced") < 0 THEN
        FIELDERROR("Qty. to Invoice",Text057);
      IF ABS(Quantity) > ABS(SalesShptLine."Qty. Shipped Not Invoiced") THEN
        ERROR(Text058,SalesShptLine."Document No.");
    END;

    LOCAL PROCEDURE CheckRetRcptRelation@95();
    VAR
      ReturnRcptLine@1000 : Record 6661;
    BEGIN
      ReturnRcptLine.GET("Return Receipt No.","Return Receipt Line No.");
      IF (Quantity * (ReturnRcptLine.Quantity - ReturnRcptLine."Quantity Invoiced")) < 0 THEN
        FIELDERROR("Qty. to Invoice",Text059);
      IF ABS(Quantity) > ABS(ReturnRcptLine.Quantity - ReturnRcptLine."Quantity Invoiced") THEN
        ERROR(Text060,ReturnRcptLine."Document No.");
    END;

    LOCAL PROCEDURE VerifyItemLineDim@87();
    BEGIN
      IF ("Dimension Set ID" <> xRec."Dimension Set ID") AND (Type = Type::Item) THEN
        IF ("Qty. Shipped Not Invoiced" <> 0) OR ("Return Rcd. Not Invd." <> 0) THEN
          IF NOT CONFIRM(Text053,TRUE,TABLECAPTION) THEN
            ERROR(Text054);
    END;

    PROCEDURE InitType@91();
    BEGIN
      IF "Document No." <> '' THEN BEGIN
        SalesHeader.GET("Document Type","Document No.");
        IF (SalesHeader.Status = SalesHeader.Status::Released) AND
           (xRec.Type IN [xRec.Type::Item,xRec.Type::"Fixed Asset"])
        THEN
          Type := Type::" "
        ELSE
          // <TPZ145>
          IF SalesHeader."Document Type" IN [
                                             SalesHeader."Document Type"::Quote,
                                             SalesHeader."Document Type"::Order,
                                             SalesHeader."Document Type"::"Return Order"]
          THEN
            Type := Type::Item
          ELSE
            Type := xRec.Type;
          // </TPZ145>
      END;
    END;

    PROCEDURE CalcSalesTaxLines@1020000(VAR SalesHeader@1020001 : Record 36;VAR SalesLine@1020000 : Record 37);
    VAR
      TaxArea@1020002 : Record 318;
    BEGIN
      IF SalesHeader."Tax Area Code" = '' THEN
        EXIT;
      TaxArea.GET(SalesHeader."Tax Area Code");
      SalesTaxCalculate.StartSalesTaxCalculation; // clear temp table

      IF TaxArea."Use External Tax Engine" THEN
        SalesTaxCalculate.CallExternalTaxEngineForSales(SalesHeader,TRUE)
      ELSE BEGIN
        WITH SalesLine DO BEGIN
          SETRANGE("Document Type",SalesHeader."Document Type");
          SETRANGE("Document No.",SalesHeader."No.");
          IF FINDSET THEN
            REPEAT
              IF Type <> 0 THEN
                SalesTaxCalculate.AddSalesLine(SalesLine);
            UNTIL NEXT = 0;
        END;
        SalesTaxCalculate.EndSalesTaxCalculation(SalesHeader."Posting Date");
      END;
      SalesLine2.COPYFILTERS(SalesLine);
      SalesTaxCalculate.DistTaxOverSalesLines(SalesLine);
      SalesLine.COPYFILTERS(SalesLine2);
    END;

    LOCAL PROCEDURE CheckWMS@98();
    BEGIN
      IF CurrFieldNo <> 0 THEN
        CheckLocationOnWMS;
    END;

    PROCEDURE CheckLocationOnWMS@101();
    VAR
      DialogText@1001 : Text;
    BEGIN
      IF Type = Type::Item THEN BEGIN
        DialogText := Text035;
        IF "Quantity (Base)" <> 0 THEN
          CASE "Document Type" OF
            "Document Type"::Invoice:
              IF "Shipment No." = '' THEN
                IF Location.GET("Location Code") AND Location."Directed Put-away and Pick" THEN BEGIN
                  DialogText += Location.GetRequirementText(Location.FIELDNO("Require Shipment"));
                  ERROR(Text016,DialogText,FIELDCAPTION("Line No."),"Line No.");
                END;
            "Document Type"::"Credit Memo":
              IF "Return Receipt No." = '' THEN
                IF Location.GET("Location Code") AND Location."Directed Put-away and Pick" THEN BEGIN
                  DialogText += Location.GetRequirementText(Location.FIELDNO("Require Receive"));
                  ERROR(Text016,DialogText,FIELDCAPTION("Line No."),"Line No.");
                END;
          END;
      END;
    END;

    PROCEDURE IsServiceItem@68() : Boolean;
    BEGIN
      IF Type <> Type::Item THEN
        EXIT(FALSE);
      IF "No." = '' THEN
        EXIT(FALSE);
      GetItem;
      EXIT(Item.Type = Item.Type::Service);
    END;

    PROCEDURE CalcAmountIncludingTax@1020003(BaseAmount@1020000 : Decimal) : Decimal;
    BEGIN
      GetSalesHeader;
      EXIT(ROUND(BaseAmount * (1 + "VAT %" / 100),Currency."Amount Rounding Precision"));
    END;

    LOCAL PROCEDURE ValidateReturnReasonCode@99(CallingFieldNo@1000 : Integer);
    BEGIN
      IF CallingFieldNo = 0 THEN
        EXIT;
      IF "Return Reason Code" = '' THEN
        UpdateUnitPrice(FIELDNO("Return Reason Code"));

      IF ReturnReason.GET("Return Reason Code") THEN BEGIN
        IF (CallingFieldNo <> FIELDNO("Location Code")) AND (ReturnReason."Default Location Code" <> '') THEN
          VALIDATE("Location Code",ReturnReason."Default Location Code");
        IF ReturnReason."Inventory Value Zero" THEN BEGIN
          VALIDATE("Unit Cost (LCY)",0);
          VALIDATE("Unit Price",0);
        END ELSE
          IF "Unit Price" = 0 THEN
            UpdateUnitPrice(FIELDNO("Return Reason Code"));
      END;
    END;

    LOCAL PROCEDURE CalcStdPackQty@14000701(Qty@14000700 : Decimal) : Decimal;
    BEGIN
      IF "Qty. per Std. Pack" <> 0 THEN
        EXIT(ROUND(Qty / "Qty. per Std. Pack",0.00001))
      ELSE
        EXIT(0);
    END;

    LOCAL PROCEDURE CalcPackageQty@14000702(Qty@14000700 : Decimal) : Decimal;
    BEGIN
      IF "Std. Packs per Package" <> 0 THEN
        EXIT(ROUND(Qty / "Std. Packs per Package",0.00001))
      ELSE
        EXIT(0);
    END;

    PROCEDURE CalcEShipWhseOutstQtyBase@14000703(LocationPacking@14000701 : Boolean;LocationCode@14000702 : Code[10]) QtyBase@14000700 : Decimal;
    VAR
      SalesLine@14000703 : Record 37;
    BEGIN
      QtyBase := 0;

      SalesLine.COPY(Rec);
      IF LocationPacking THEN
        SalesLine.SETRANGE("Location Code",LocationCode);
      IF SalesLine.FIND('-') THEN
        REPEAT
          SalesLine.CALCFIELDS("E-Ship Invt. Outst. Qty (Base)");
          IF (SalesLine."Qty. to Ship (Base)" = 0) OR (SalesLine."E-Ship Invt. Outst. Qty (Base)"<> 0)
          THEN BEGIN
            SalesLine.CALCFIELDS(
              "E-Ship Whse. Outst. Qty (Base)","E-Ship Whse. Ship. Qty (Base)");
            QtyBase :=
              QtyBase +
              SalesLine."E-Ship Whse. Outst. Qty (Base)" + SalesLine."E-Ship Whse. Ship. Qty (Base)" +
              SalesLine."E-Ship Invt. Outst. Qty (Base)";
          END;
        UNTIL SalesLine.NEXT = 0;
    END;

    LOCAL PROCEDURE UpdateRequiredShippingAgent@14000704();
    VAR
      RequiredShippingAgent@14000701 : Record 14000722;
      ShippingAgent@14000702 : Record 291;
      EShipAgentService@14000703 : Record 14000708;
    BEGIN
      IF NOT Pack THEN
        EXIT;

      CLEAR(RequiredShippingAgent);
      IF NOT RequiredShippingAgent.GET(Type,"No.",SalesHeader."Shipping Agent Code")
      THEN BEGIN
        RequiredShippingAgent.RESET;
        RequiredShippingAgent.SETRANGE(Type,Type);
        RequiredShippingAgent.SETRANGE(Code,"No.");
        RequiredShippingAgent.SETRANGE("Use for All Shipping Agents",TRUE);
        IF NOT RequiredShippingAgent.FIND('-') THEN
          ;
      END;

      IF RequiredShippingAgent."Shipping Agent Code" <> '' THEN BEGIN
        GetSalesHeader;

        VALIDATE("Required Shipping Agent Code",RequiredShippingAgent."Shipping Agent Code");
        ShippingAgent.GET("Required Shipping Agent Code");
        CASE TRUE OF
          EShipAgentService.InternationalShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code"):
            VALIDATE("Required E-Ship Agent Service",RequiredShippingAgent."Required Int. Ship. Agent Serv");
          EShipAgentService.UPSCanadianShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code"):
            VALIDATE("Required E-Ship Agent Service",RequiredShippingAgent."Req. UPS CA Ship. Agent Serv.");
          EShipAgentService.UPSPuertoRicoShipment(ShippingAgent,SalesHeader."Ship-to Country/Region Code"):
            VALIDATE("Required E-Ship Agent Service",RequiredShippingAgent."Req. UPS PR Ship. Agent Serv.");
          ELSE
            VALIDATE("Required E-Ship Agent Service",RequiredShippingAgent."Required Dom. Ship. Agent Serv");
        END;
        VALIDATE("Allow Other Ship. Agent/Serv.",RequiredShippingAgent."Allow Other Service");
      END;
    END;

    PROCEDURE SetRunFromEDI@14000351(EDI@14000351 : Boolean);
    BEGIN
      // >> EDI
      IF EDI THEN
        RunFromEDI := TRUE
       ELSE
         RunFromEDI := FALSE;
      // << EDI
    END;

    PROCEDURE SetEDITemp@14000352(EDI@14000353 : Boolean);
    BEGIN
      // >> EDI
      IF EDI THEN
        EDITemp := TRUE
      ELSE
        EDITemp := FALSE;
      // << EDI
    END;

    PROCEDURE AllowInWarehousePosting@14000705() : Boolean;
    BEGIN
      EXIT("Shipping Charge" OR ((Type = Type::Resource) AND Pack));
    END;

    LOCAL PROCEDURE GetLocationDivHdlgPct@1000000007(LocationCode@1000 : Code[10];ShortcutDim5Code@1000000001 : Code[20]);
    BEGIN
      // <TPZ92>
      IF LocationCode <> '' THEN BEGIN
        IF LocationCode <> LocationDivHdlgPct."Location Code" THEN
          IF NOT LocationDivHdlgPct.GET(LocationCode,ShortcutDim5Code) THEN
            CLEAR(LocationDivHdlgPct);
      END ELSE
        CLEAR(LocationDivHdlgPct);
      // </TPZ92>
    END;

    PROCEDURE SetDoNotUpdateUnitPrice@11123302(UpdateUnitPrice@11123302 : Boolean);
    BEGIN
      DoNotUpdateUnitPrice := UpdateUnitPrice;
    END;

    PROCEDURE SetDoNotCheckItmeAvailability@11123303(CheckItemAvailability@11123302 : Boolean);
    BEGIN
      DoNotCheckItemAvailability := CheckItemAvailability;
    END;

    PROCEDURE SanaDeleteRelatedData@11123306(SalesLine@11123302 : Record 37);
    VAR
      SalesDocLine@11123303 : Record 11123325;
    BEGIN
      IF SalesDocLine.GET(SalesLine."Document No.",SalesLine."Document Type",SalesLine."Line No.") THEN
        SalesDocLine.DELETE(TRUE);
    END;

    PROCEDURE SanaRenameRelatedData@11123307(OldSalesLine@11123302 : Record 37;NewSalesLIne@11123303 : Record 37);
    VAR
      SalesDocLine@11123304 : Record 11123325;
    BEGIN
      IF SalesDocLine.GET(OldSalesLine."Document No.",OldSalesLine."Document Type",OldSalesLine."Line No.") THEN
        SalesDocLine.RENAME(NewSalesLIne."Document No.",NewSalesLIne."Document Type",NewSalesLIne."Line No.");
    END;

    PROCEDURE "****ABCSI Functions****"@1000000000();
    BEGIN
    END;

    PROCEDURE UpdateLostOpportunity@1000000009();
    VAR
      LostOpporunity@1000000000 : Record 50002;
    BEGIN
      //TOP030B KT ABCSI Lost Opportunities 03092015
      IF ("Document Type" = "Document Type"::Order) OR ("Document Type" = "Document Type"::Quote) THEN BEGIN
        IF ("Lost Opportunity") THEN BEGIN
          IF NOT LostOpporunity.GET("Document Type","Document No.","Line No.") THEN BEGIN
            LostOpporunity.INIT;
            LostOpporunity."Document Type" := "Document Type";
            LostOpporunity."Document No." := "Document No.";
            LostOpporunity."Line No." := "Line No.";
            LostOpporunity.INSERT;
          END;
          LostOpporunity."Sell-to Customer No." := "Sell-to Customer No.";
          LostOpporunity.Type := LostOpporunity.Type::Item;
          LostOpporunity."No." := "No.";
          LostOpporunity."Location Code" := "Location Code";
          LostOpporunity."Shipment Date" := "Shipment Date";
          LostOpporunity."Unit of Measure Code" := "Unit of Measure Code";
          IF (LostOpporunity.Quantity = 0) AND ("Outstanding Quantity" <> 0) THEN
            LostOpporunity.Quantity := "Outstanding Quantity";
          LostOpporunity."Quantity(Base)" := "Outstanding Qty. (Base)";
          LostOpporunity."Unit Cost" := "Unit Cost (LCY)";
          LostOpporunity."Actual Unit Price" := "Actual Unit Price";
          LostOpporunity."Reason Code" := "Reason Code";
          IF "Reason Code Comment" <> '' THEN
            LostOpporunity."Reason Code Comment" := "Reason Code Comment"
          ELSE BEGIN
            IF "Document Type" = "Document Type"::Quote THEN
              LostOpporunity."Reason Code Comment":= SalesHeader."Your Reference";

          END;
          LostOpporunity."Lost Date" := TODAY;
          LostOpporunity."User ID" := USERID;
          LostOpporunity.MODIFY;
        END;
      END;
      //TOP030B KT ABCSI Lost Opportunities 03092015
    END;

    LOCAL PROCEDURE CalcAltUOMQty@1000000001(Qty@14000700 : Decimal) : Decimal;
    BEGIN
      //TOP050 KT ABCSI Modification to Item Cards 01212015
      IF "Qty. per Alt. UOM" <> 0 THEN BEGIN
        IF "Qty. per Alt. UOM" <> "Qty. per Unit of Measure" THEN BEGIN
          IF "Qty. per Alt. UOM" > "Qty. per Unit of Measure" THEN
            EXIT(ROUND(Qty / "Qty. per Alt. UOM",0.00001))
          ELSE
            EXIT(ROUND(Qty * "Qty. per Unit of Measure",0.00001));
        END ELSE
          EXIT(Qty);
      END ELSE
        EXIT(0);
      //TOP050 KT ABCSI Modification to Item Cards 01212015
    END;

    PROCEDURE CalcQtyFromAltUOMQty@1000000005(Qty@1000000001 : Decimal) : Decimal;
    BEGIN
      //TOP050 KT ABCSI Modification to Item Cards 01212015
      IF "Qty. per Alt. UOM" <> 0 THEN BEGIN
        IF "Qty. per Alt. UOM" <> "Qty. per Unit of Measure" THEN BEGIN
          IF "Qty. per Alt. UOM" > "Qty. per Unit of Measure" THEN
            EXIT(ROUND(Qty * "Qty. per Alt. UOM",0.00001))
          ELSE
            EXIT(ROUND(Qty / "Qty. per Unit of Measure",0.00001));
        END ELSE
          EXIT(Qty);
      END ELSE
        EXIT(0);
      //TOP050 KT ABCSI Modification to Item Cards 01212015
    END;

    PROCEDURE CalcAltUOMUnitPrice@1000000016(UnitPrice@1000000001 : Decimal) : Decimal;
    BEGIN
      //TOP050 KT ABCSI Modification to Item Cards 01212015
      IF "Qty. per Alt. UOM" <> 0 THEN BEGIN
        IF "Qty. per Alt. UOM" <> "Qty. per Unit of Measure" THEN BEGIN
          IF "Qty. per Alt. UOM" > "Qty. per Unit of Measure" THEN
            EXIT(ROUND(UnitPrice * "Qty. per Alt. UOM",0.0001)) //TOP230 KT ABCSI Go Live Fixes 11092015
          ELSE
            EXIT(ROUND(UnitPrice / "Qty. per Unit of Measure",0.0001)) //TOP230 KT ABCSI Go Live Fixes 11092015
        END ELSE
          EXIT(UnitPrice);
      END ELSE
        EXIT(0);

      //TOP050 KT ABCSI Modification to Item Cards 01212015
    END;

    PROCEDURE CalcUnitPriceFromAltUOMUnitPrice@1000000017(UnitPrice@1000000001 : Decimal) : Decimal;
    BEGIN
      //TOP050 KT ABCSI Modification to Item Cards 01212015
      IF "Qty. per Alt. UOM" <> 0 THEN BEGIN
        IF "Qty. per Alt. UOM" <> "Qty. per Unit of Measure" THEN BEGIN
          IF "Qty. per Alt. UOM" > "Qty. per Unit of Measure" THEN
            EXIT(ROUND(UnitPrice / "Qty. per Alt. UOM",0.0001)) //TOP230 KT ABCSI Go Live Fixes 11092015
          ELSE
            EXIT(ROUND(UnitPrice * "Qty. per Unit of Measure",0.0001)); //TOP230 KT ABCSI Go Live Fixes 11092015
        END ELSE
          EXIT(UnitPrice);
      END ELSE
        EXIT(0);

      //TOP050 KT ABCSI Modification to Item Cards 01212015
    END;

    PROCEDURE AutoFillQtyToOrder@1000000002(LocalSalesLine@1000000000 : Record 37);
    BEGIN
      //TOP030A KT ABCSI Sales Quotes 02132015
      IF "Document Type" = "Document Type"::Quote THEN BEGIN
        SETRANGE("Document Type",LocalSalesLine."Document Type");
        SETRANGE("Document No.",LocalSalesLine."Document No.");
        SETFILTER(Type,'<>%1',LocalSalesLine.Type::" ");
        // <TPZ1067>
        IF FIND('-') THEN REPEAT
          CALCFIELDS("Qty. Ordered","Qte. Qty. Invoiced");
          "Qty. to Order" := Quantity - "Qty. Ordered" - "Qte. Qty. Invoiced";
          MODIFY;
        UNTIL NEXT = 0;
        // </TPZ1067>
      END;
      //TOP030A KT ABCSI Sales Quotes 02132015
    END;

    PROCEDURE DeleteQtyToOrder@1000000003(LocalSalesLine@1000000000 : Record 37);
    BEGIN
      //TOP030A KT ABCSI Sales Quotes 02132015
      IF "Document Type" = "Document Type"::Quote THEN BEGIN
        SETRANGE("Document Type",LocalSalesLine."Document Type");
        SETRANGE("Document No.",LocalSalesLine."Document No.");
        SETFILTER(Type,'<>%1',LocalSalesLine.Type::" ");
        IF FINDFIRST THEN REPEAT
          "Qty. to Order" := 0;
          MODIFY;
        UNTIL NEXT = 0;
      END;
      //TOP030A KT ABCSI Sales Quotes 02132015
    END;

    PROCEDURE SetStyle@1000000004() : Text;
    BEGIN
        IF (Type = Type::Item) AND ("No." <> '')  AND (NOT Sample) THEN BEGIN //EBAGIM Took of qty TPZ1125
         Item.GET("No.");
          IF ("Actual Unit Price" <> "Recomm. Unit Price") AND ("Actual Unit Price"> Item."Unit Cost") THEN  //TOP230 KT ABCSI CRP 2 Fixes 05012015
            EXIT('Favorable')
          ELSE IF ("Actual Unit Price" < Item."Unit Cost") THEN
            EXIT('unFavorable')
          ELSE EXIT('');
        END ELSE
          EXIT('');



      {SalesSetup.GET;// EBAGIM COMMENT OUT TPZ1125
      IF (SalesSetup."Sales Line Max. Margin %" <> 0) AND (SalesSetup."Sales Line Min. Margin %" <> 0) THEN BEGIN //TOP230 KT ABCSI CRP 2 Fixes 05012015
        IF (Type = Type::Item) AND ("No." <> '')  AND (NOT Sample) THEN BEGIN //EB Tool of qty
          Item.GET("No.");
          IF ("Actual Unit Price" < (Item."Unit Cost" + ((Item."Unit Cost" * SalesSetup."Sales Line Min. Margin %")/100))) THEN  //TOP230 KT ABCSI CRP 2 Fixes 05012015
            EXIT('Unfavorable')
          ELSE IF ("Actual Unit Price" > (Item."Unit Cost" + ((Item."Unit Cost" * SalesSetup."Sales Line Max. Margin %")/100))) THEN
            EXIT('Favorable')
          ELSE EXIT('');
        END ELSE
          EXIT('');
      END ELSE
        EXIT('');
       }
    END;

    PROCEDURE UpdateLastSalesPrice@1000000006(VAR InRec@1000000000 : Record 37);
    VAR
      NewLastSalesPrice@1000000001 : Record 50004;
      SalesHeaderLoc@1000000002 : Record 36;
    BEGIN
      IF InRec.Type <> InRec.Type::Item THEN
        EXIT;
      GetSalesHeader;
      IF InRec."Unit Price" = 0 THEN
        EXIT;
      NewLastSalesPrice.RESET;
      NewLastSalesPrice.SETRANGE("Document Type",InRec."Document Type");
      NewLastSalesPrice.SETRANGE("Document No.",InRec."Document No.");
      NewLastSalesPrice.SETRANGE("Sell-to Customer No.",InRec."Sell-to Customer No.");
      NewLastSalesPrice.SETRANGE("Item No.",InRec."No.");
      NewLastSalesPrice.SETRANGE("Unit of Measure Code",InRec."Unit of Measure Code");
      IF NewLastSalesPrice.FINDFIRST THEN BEGIN
        NewLastSalesPrice."Document Date" := SalesHeader."Document Date";
        NewLastSalesPrice."Last Unit Price" := InRec."Actual Unit Price";
        NewLastSalesPrice."Last Price UOM" := InRec."Unit of Measure Code";
        NewLastSalesPrice."Last Price Qty." := InRec.Quantity;
        NewLastSalesPrice."Last Price Date" :=TODAY;
        NewLastSalesPrice."Last Price User ID" := USERID;
        NewLastSalesPrice.MODIFY;
      END ELSE BEGIN
        NewLastSalesPrice.INIT;
        NewLastSalesPrice."Document Type" := InRec."Document Type";
        NewLastSalesPrice."Document No." := InRec."Document No.";
        // <TPZ1014>
        NewLastSalesPrice.VALIDATE("Sell-to Customer No.",InRec."Sell-to Customer No.");
        // </TPZ1014>
        NewLastSalesPrice."Item No." := InRec."No.";
        NewLastSalesPrice."Unit of Measure Code" := InRec."Unit of Measure Code";
        NewLastSalesPrice."Document Date" := SalesHeader."Document Date";
        NewLastSalesPrice."Last Unit Price" := InRec."Actual Unit Price";
        NewLastSalesPrice."Last Price UOM" := InRec."Unit of Measure Code";
        NewLastSalesPrice."Last Price Qty." := InRec.Quantity;
        NewLastSalesPrice."Last Price Date" := TODAY;
        NewLastSalesPrice."Last Price User ID" := USERID;

        // <TPZ449>
        //IF SalesHeaderLoc.GET(InRec."Document Type",InRec."No.") THEN BEGIN
        IF SalesHeaderLoc.GET(InRec."Document Type",InRec."Document No.") THEN BEGIN //<TPZ1603
          NewLastSalesPrice."Shortcut Dimension 5 Code" := SalesHeaderLoc."Shortcut Dimension 5 Code";
          NewLastSalesPrice."Country/Region Code" := SalesHeaderLoc."Sell-to Country/Region Code";
        END;
        // </TPZ449>
        NewLastSalesPrice.INSERT;
      END;
    END;

    PROCEDURE GetLastSalesPrice@1000000010(VAR ToSalesLine@1000000000 : Record 50021);
    VAR
      LastSalesPrice@1000000001 : Record 50004;
    BEGIN
      IF ToSalesLine.Type <> ToSalesLine.Type::Item THEN
        EXIT;
      LastSalesPrice.RESET;
      LastSalesPrice.ASCENDING;
      LastSalesPrice.SETCURRENTKEY("Sell-to Customer No.","Item No.","Document Date");
      LastSalesPrice.SETRANGE("Sell-to Customer No.",ToSalesLine."Sell-to Customer No.");
      LastSalesPrice.SETRANGE("Item No.",ToSalesLine."No.");

      //<TPZ1081,TPZ8666>
      GetSalesHeader;
      IF (SalesHeader."Shortcut Dimension 5 Code" = 'I') OR (SalesHeader."Shortcut Dimension 5 Code" = 'E') THEN
        LastSalesPrice.SETRANGE("Document Type",LastSalesPrice."Document Type"::"Posted Sales Invoice");
      //</TPZ1081,TPZ8666>

      IF LastSalesPrice.FINDLAST THEN BEGIN
        "Last Unit Price" := LastSalesPrice."Last Unit Price";
        "Last Price UOM" := LastSalesPrice."Last Price UOM";
        "Last Price Qty." := LastSalesPrice."Last Price Qty.";
        "Last Price Date" := LastSalesPrice."Last Price Date";
      END ELSE BEGIN
        "Last Unit Price" := 0;
        "Last Price UOM" := '';
        "Last Price Qty." := 0;
        "Last Price Date" := 0D;
      END;
    END;

    PROCEDURE UpdateMarginPercent@1000000011();
    BEGIN
      //TOP230 KT ABCSI CRP 2 Fixes 05282015
      IF (Quantity <> 0) AND ("Unit Cost" <> 0) AND ("Actual Unit Price" <> 0) THEN BEGIN
        "Gross Margin %" := ROUND(((Quantity * "Actual Unit Price") - (Quantity * "Unit Cost")) * 100 / (Quantity * "Actual Unit Price"),0.1);

      END ELSE
        "Gross Margin %" := 0;
      //TOP230 KT ABCSI CRP 2 Fixes 05282015
    END;

    PROCEDURE CalcWhseMinQtyAllowToChangeTo@1000000019() : Decimal;
    VAR
      PickedQty@1000000000 : Decimal;
      PickQty@1000000001 : Decimal;
      OutboundReqMgt@1000000002 : Codeunit 14002863;
      PickedQtyBase@1000000003 : Decimal;
      PickQtyBase@1000000004 : Decimal;
    BEGIN
      //TM BEG 070215
      OutboundReqMgt.CaclTotalPickedQty(DATABASE::"Sales Line", "Document Type", "Document No.", "Line No.",
                                        PickedQty, PickedQtyBase);

      OutboundReqMgt.CaclTotalPickQty(DATABASE::"Sales Line", "Document Type", "Document No.", "Line No.",
                                      PickQty, PickQtyBase, FALSE);

      //MESSAGE('%1,%2,%3',PickedQty,PickQty,"Qty. in Cross Dock");

      EXIT(PickedQty + PickQty);
      //TM END 070215
    END;

    PROCEDURE CopyLastUnitPriceToActualUnitPrice@1000000008(SalesLineLoc@1000000000 : Record 37);
    BEGIN
      // <TPZ929>
      SalesLineLoc.RESET;
      SalesLineLoc.SETRANGE("Document Type",SalesLineLoc."Document Type");
      SalesLineLoc.SETRANGE("Document No.",SalesLineLoc."Document No.");
      SalesLineLoc.SETFILTER(Type,'<>%1',SalesLineLoc.Type::" ");
      IF SalesLineLoc.FIND('-') THEN
        REPEAT
          SalesLineLoc.VALIDATE("Actual Unit Price",SalesLineLoc."Last Unit Price");
          //<TPZ1125>//EBAGIM
          SalesLineLoc."Unit Price Color":=SetStyle;
          //<TPZ1125>
          SalesLineLoc.MODIFY;
        UNTIL SalesLineLoc.NEXT = 0;
      // </TPZ929>
    END;

    PROCEDURE ClearActualUnitPrice@1000000012(SalesLineLoc@1000000000 : Record 37);
    BEGIN
      // <TPZ929>
      SalesLineLoc.RESET;
      SalesLineLoc.SETRANGE("Document Type",SalesLineLoc."Document Type");
      SalesLineLoc.SETRANGE("Document No.",SalesLineLoc."Document No.");
      SalesLineLoc.SETFILTER(Type,'<>%1',SalesLineLoc.Type::" ");
      IF SalesLineLoc.FIND('-') THEN
        REPEAT
          SalesLineLoc.VALIDATE("Actual Unit Price",0);
          SalesLineLoc.MODIFY;
        UNTIL SalesLineLoc.NEXT = 0;
      // </TPZ929>
    END;

    PROCEDURE CheckQtyRounding@1000000014(VAR SalesLine@1000000001 : Record 50021);
    VAR
      RoundedUpQty@1000000000 : Decimal;
    BEGIN
      // <TPZ69>

      IF GUIALLOWED THEN
       WITH SalesLine DO BEGIN
        IF ("Document Type" IN ["Document Type"::Quote,"Document Type"::Order]) AND
         (Type = Type::Item) AND
        // (CurrFieldNo = FIELDNO(Quantity)) AND
         (Quantity <> 0) AND
         Item.GET("No.") AND
         (Item."Sales Order Multiple" <> 0)
      THEN
        IF Quantity MOD Item."Sales Order Multiple" <> 0 THEN BEGIN
          RoundedUpQty := Item."Sales Order Multiple" * (Quantity DIV Item."Sales Order Multiple" + 1);
          IF CONFIRM(Text51078,TRUE,RoundedUpQty,"Unit of Measure Code") THEN
            Quantity := RoundedUpQty
            //<TPZ9429>
            ELSE
             ERROR(TextRNDERROR,Item."No.");  //EB
           //</TPZ9429>
        END;
       END;
      // </TPZ69>
    END;

    PROCEDURE GetGLSetup@1000000015();
    BEGIN
      //<TPZ1682>
      TPZGenLedgSetup.GET;
      //</TPZ1682>
    END;

    PROCEDURE SetGPPG_DIMForSampleLines@1000000018(VAR pSampleSalesLine@1000000000 : Record 37);
    BEGIN
      //<TPZ1682>
      IF pSampleSalesLine.Type <> pSampleSalesLine.Type::Item THEN
        EXIT;

      IF pSampleSalesLine.Sample THEN BEGIN
        GetGLSetup;
        TPZGenLedgSetup.TESTFIELD("Sample Items GPPG Code");
        TPZGenLedgSetup.TESTFIELD("Sample Items Expense G/L Acct.");
        TPZGenLedgSetup.TESTFIELD("Sample Items GPPG Code");
        TPZGenLedgSetup.TESTFIELD("Sample Department Code");
        TPZGenLedgSetup.TESTFIELD("Sample Site Code");
        pSampleSalesLine.VALIDATE("Gen. Prod. Posting Group",TPZGenLedgSetup."Sample Items GPPG Code");
        pSampleSalesLine.VALIDATE("Shortcut Dimension 1 Code",TPZGenLedgSetup."Sample Department Code");
        pSampleSalesLine.VALIDATE("Shortcut Dimension 2 Code",TPZGenLedgSetup."Sample Site Code");
      END ELSE BEGIN
        GetItem;
        Item.TESTFIELD("Gen. Prod. Posting Group");
        pSampleSalesLine.VALIDATE("Gen. Prod. Posting Group",Item."Gen. Prod. Posting Group");
        pSampleSalesLine.VALIDATE("Shortcut Dimension 1 Code",SalesHeader."Shortcut Dimension 1 Code");
        pSampleSalesLine.VALIDATE("Shortcut Dimension 2 Code",SalesHeader."Shortcut Dimension 2 Code");
      END;
      //</TPZ1682>
    END;

    PROCEDURE FindSalesLineSalesPrice@1000000013(SalesHeader@1001 : Record 36;VAR SalesLine@1000 : Record 50021;CalledByFieldNo@1002 : Integer);
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Start
      WITH SalesLine DO BEGIN
        SetCurrency(
          SalesHeader."Currency Code",SalesHeader."Currency Factor",SalesHeaderExchDate(SalesHeader));
        SetVAT(SalesHeader."Prices Including VAT","VAT %","VAT Calculation Type","VAT Bus. Posting Group");
        SetUoM(ABS(Quantity),"Qty. per Unit of Measure");
        SetLineDisc("Line Discount %","Allow Line Disc.","Allow Invoice Disc.");


          TESTFIELD("Qty. per Unit of Measure");
        IF PricesInCurrency THEN
          SalesHeader.TESTFIELD("Currency Factor");

        CASE Type OF
          Type::Item:
            BEGIN
              Item.GET("No.");
              SalesLinePriceExists(SalesHeader,SalesLine,FALSE);
              CalcBestSalesPrice(TempSalesPrice);

              IF FoundSalesPrice OR
                 NOT ((CalledByFieldNo = FIELDNO(Quantity)) OR
                      (CalledByFieldNo = FIELDNO("Variant Code")))
              THEN BEGIN
                "Allow Line Disc." := TempSalesPrice."Allow Line Disc.";
                "Allow Invoice Disc." := TempSalesPrice."Allow Invoice Disc.";
                "Unit Price" := TempSalesPrice."Unit Price";
                IF "Unit Price" <> 0  THEN
                  "Pricing Logic" := "Pricing Logic"::"Sales Price"; //TOP230 KT ABCSI CRP 2 Fixes 06092015
                "Alt. UOM Unit Price" := TempSalesPrice."Unit Price" * "Qty. per Alt. UOM";  //TOP050 KT ABCSI Modification to Item Cards 01202015
                "Line Discount %" := 0;
                Multiplier := 0;
                "Recomm. Multiplier" := 0;
              END;
              //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Start
              {
              IF NOT "Allow Line Disc." THEN BEGIN
                "Line Discount %" := 0;
                Multiplier := 0;
                "Recomm. Multiplier" := 0;
              END;
              }
              //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
            END;
          Type::Resource:
            BEGIN
              SetResPrice("No.","Work Type Code","Currency Code");
              ResFindUnitPrice.RUN(ResPrice);

              ConvertPriceToVAT(FALSE,'','',ResPrice."Unit Price");
              ConvertPriceLCYToFCY(ResPrice."Currency Code",ResPrice."Unit Price");
              "Unit Price" := ResPrice."Unit Price" * "Qty. per Unit of Measure";
            END;
        END;
      END;
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
    END;

    PROCEDURE FindSalesLineLineDisc@1000000020(SalesHeader@1001 : Record 36;VAR SalesLine@1000 : Record 50021);
    VAR
      HotSheetPrice@1000000000 : Record 50017;
      StartingDate@1000000001 : Date;
    BEGIN
      WITH SalesLine DO BEGIN
        SetCurrency(SalesHeader."Currency Code",0,0D);
        SetUoM(ABS(Quantity),"Qty. per Unit of Measure");

        TESTFIELD("Qty. per Unit of Measure");
        IF CustDivision.GET(SalesHeader."Sell-to Customer No.",SalesHeader."Shortcut Dimension 5 Code") THEN BEGIN END; //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015
        IF Type = Type::Item THEN BEGIN
          SalesLineLineDiscExists(SalesHeader,SalesLine,FALSE);
          CalcBestLineDisc(TempSalesLineDisc);
          //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 Start
          //TOP230 KT ABCSI CRP 2 Fixes 05282015 - Comment Start
          {
          IF TempSalesLineDisc."Line Discount %" = 0 THEN BEGIN
            IF CustDivision.Multiplier <> 0 THEN BEGIN
              "Line Discount %" := (1 - CustDivision.Multiplier) * 100;
              "Recomm. Multiplier" := CustDivision.Multiplier;
              Multiplier := CustDivision.Multiplier;
            END;
          END ELSE BEGIN
            "Line Discount %" := TempSalesLineDisc."Line Discount %";
            "Recomm. Multiplier" := TempSalesLineDisc.Multiplier; //TOP100A KT ABCSI Multipliers 02182015
            Multiplier := TempSalesLineDisc.Multiplier; //TOP100A KT ABCSI Multipliers 02182015
          END;
          }
          //TOP230 KT ABCSI CRP 2 Fixes 05282015 - Comment End
          //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04142015 End
          "Line Discount %" := TempSalesLineDisc."Line Discount %";
          "Recomm. Multiplier" := TempSalesLineDisc.Multiplier; //TOP100A KT ABCSI Multipliers 02182015
          Multiplier := TempSalesLineDisc.Multiplier; //TOP100A KT ABCSI Multipliers 02182015
          //TOP230 KT ABCSI CRP 2 Fixes 06042015
          IF NOT TempSalesLineDisc.ISEMPTY THEN BEGIN
            IF TempSalesLineDisc."Hot Sheet Code" <> '' THEN BEGIN
              StartingDate := 0D;
              IF SalesHeader."Document Type" IN [SalesHeader."Document Type"::Invoice,SalesHeader."Document Type"::"Credit Memo"] THEN
                StartingDate := SalesHeader."Posting Date"
              ELSE
                StartingDate := SalesHeader."Order Date";

              HotSheetPrice.RESET;
              HotSheetPrice.SETRANGE(Code,TempSalesLineDisc."Hot Sheet Code");
              IF (TempSalesLineDisc.Type = TempSalesLineDisc.Type::Item) AND (TempSalesLineDisc.Code <> '') THEN
                HotSheetPrice.SETRANGE("Item No.",TempSalesLineDisc.Code)
              ELSE IF (SalesLine.Type = SalesLine.Type::Item) THEN
                HotSheetPrice.SETRANGE("Item No.",SalesLine."No.");
              IF "Unit of Measure Code" <> '' THEN
                HotSheetPrice.SETFILTER("Unit of Measure Code",'%1|%2',"Unit of Measure Code",'');
              HotSheetPrice.SETFILTER("Ending Date",'%1|>=%2',0D,StartingDate);
              HotSheetPrice.SETRANGE("Starting Date",0D,StartingDate);
              IF HotSheetPrice.FINDFIRST THEN BEGIN
                "Unit Price" := HotSheetPrice."Unit Price";
                "Alt. UOM Unit Price" := HotSheetPrice."Unit Price" * "Qty. per Alt. UOM";  //TOP050 KT ABCSI Modification to Item Cards 01202015
                "Pricing Logic" := "Pricing Logic"::"Hot Sheet";
              END;
            END ELSE BEGIN
              IF TempSalesLineDisc."Sales Type" = TempSalesLineDisc."Sales Type"::Customer THEN
                "Pricing Logic" := "Pricing Logic"::"Sales Line Multiplier(Cust.)"
              ELSE IF TempSalesLineDisc."Sales Type" = TempSalesLineDisc."Sales Type"::"Customer Disc. Group" THEN
                "Pricing Logic" := "Pricing Logic"::"Sales Line Multiplier(Cust. Mult. Grp.)";
            END;
          END;
          //TOP230 KT ABCSI CRP 2 Fixes 06042015
        END;
      END;
    END;

    PROCEDURE FindSalesLinePrice@1000000021(SalesHeader@1001 : Record 36;VAR SalesLine@1000 : Record 50021;CalledByFieldNo@1002 : Integer);
    BEGIN
      WITH SalesLine DO BEGIN
        SetCurrency(
          SalesHeader."Currency Code",SalesHeader."Currency Factor",SalesHeaderExchDate(SalesHeader));
        SetVAT(SalesHeader."Prices Including VAT","VAT %","VAT Calculation Type","VAT Bus. Posting Group");
        SetUoM(ABS(Quantity),"Qty. per Unit of Measure");
        SetLineDisc("Line Discount %","Allow Line Disc.","Allow Invoice Disc.");

        TESTFIELD("Qty. per Unit of Measure");
        IF PricesInCurrency THEN
          SalesHeader.TESTFIELD("Currency Factor");

        CASE Type OF
          Type::Item:
            BEGIN
              Item.GET("No.");
              SalesLinePriceExists(SalesHeader,SalesLine,FALSE);
              CalcBestUnitPrice(TempSalesPrice);

              IF FoundSalesPrice OR
                 NOT ((CalledByFieldNo = FIELDNO(Quantity)) OR
                      (CalledByFieldNo = FIELDNO("Variant Code")))
              THEN BEGIN
                "Allow Line Disc." := TempSalesPrice."Allow Line Disc.";
                "Allow Invoice Disc." := TempSalesPrice."Allow Invoice Disc.";
                "Unit Price" := TempSalesPrice."Unit Price";
                IF Multiplier = 0 THEN
                  "Pricing Logic" := "Pricing Logic"::"Item Unit Price"; //TOP230 KT ABCSI CRP 2 Fixes 06092015
                "Alt. UOM Unit Price" := TempSalesPrice."Unit Price" * "Qty. per Alt. UOM";  //TOP050 KT ABCSI Modification to Item Cards 01202015
              END;
              //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Comment Start
              {
              IF NOT "Allow Line Disc." THEN BEGIN
                "Line Discount %" := 0;
                Multiplier := 0;
                "Recomm. Multiplier" := 0;
              END;
              }
              //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Comment End
            END;
          Type::Resource:
            BEGIN
              SetResPrice("No.","Work Type Code","Currency Code");
              ResFindUnitPrice.RUN(ResPrice);

              ConvertPriceToVAT(FALSE,'','',ResPrice."Unit Price");
              ConvertPriceLCYToFCY(ResPrice."Currency Code",ResPrice."Unit Price");
              "Unit Price" := ResPrice."Unit Price" * "Qty. per Unit of Measure";
            END;
        END;
      END;
    END;

    PROCEDURE SalesLinePriceExists@1000000022(SalesHeader@1001 : Record 36;VAR SalesLine@1000 : Record 50021;ShowAll@1002 : Boolean) : Boolean;
    BEGIN
      WITH SalesLine DO
        IF (Type = Type::Item) AND Item.GET("No.") THEN BEGIN
          FindSalesPrice(
            //TempSalesPrice,"Bill-to Customer No.",SalesHeader."Bill-to Contact No.",
            TempSalesPrice,"Sell-to Customer No.",SalesHeader."Bill-to Contact No.",
            "Customer Price Group",'',"No.","Variant Code","Unit of Measure Code",
            SalesHeader."Currency Code",SalesHeaderStartDate(SalesHeader,DateCaption),ShowAll);
          EXIT(TempSalesPrice.FINDFIRST);
        END;
      EXIT(FALSE);
    END;

    PROCEDURE SalesLineHotSheetPriceExists@1000000024(SalesHeader@1001 : Record 36;VAR SalesLine@1000 : Record 50021) : Boolean;
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Start
      WITH SalesLine DO
        IF (Type = Type::Item) AND Item.GET("No.") THEN BEGIN
          FindHotSheetPrice(
            TempHotSheetPrice,
            "No.","Unit of Measure Code",
            SalesHeaderStartDate(SalesHeader,DateCaption));
          EXIT(TempHotSheetPrice.FINDFIRST);
        END;
      EXIT(FALSE);
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
    END;

    PROCEDURE SalesLineLineDiscExists@1000000023(SalesHeader@1001 : Record 36;VAR SalesLine@1000 : Record 50021;ShowAll@1002 : Boolean) : Boolean;
    BEGIN
      WITH SalesLine DO
        IF (Type = Type::Item) AND Item.GET("No.") THEN BEGIN
          //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04152015 Start
          {
          FindSalesLineDisc(
            TempSalesLineDisc,"Bill-to Customer No.",SalesHeader."Bill-to Contact No.",
            "Customer Disc. Group",'',"No.",Item."Item Disc. Group","Variant Code","Unit of Measure Code",
            SalesHeader."Currency Code",SalesHeaderStartDate(SalesHeader,DateCaption),ShowAll);
          }
          FindSalesLineDiscCustom(
            //TempSalesLineDisc,"Bill-to Customer No.",SalesHeader."Bill-to Contact No.",
            TempSalesLineDisc,"Sell-to Customer No.",SalesHeader."Bill-to Contact No.",
            "Customer Disc. Group",'',"No.",Item."Item Disc. Group","Variant Code","Unit of Measure Code",
            SalesHeader."Currency Code","Hot Sheet Code",SalesHeaderStartDate(SalesHeader,DateCaption),ShowAll);
          //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04152015 End
          EXIT(TempSalesLineDisc.FINDFIRST);
        END;
      EXIT(FALSE);
    END;

    LOCAL PROCEDURE CalcBestSalesPrice@1000000025(VAR SalesPrice@1000 : Record 7002);
    VAR
      BestSalesPrice@1002 : Record 7002;
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Start
      WITH SalesPrice DO BEGIN
        FoundSalesPrice := FINDSET;
        IF FoundSalesPrice THEN
          REPEAT
            IF IsInMinQty("Unit of Measure Code","Minimum Quantity") THEN BEGIN
              ConvertPriceToVAT(
                "Price Includes VAT",Item."VAT Prod. Posting Group",
                "VAT Bus. Posting Gr. (Price)","Unit Price");
              ConvertPriceToUoM("Unit of Measure Code","Unit Price");
              ConvertPriceLCYToFCY("Currency Code","Unit Price");

              CASE TRUE OF
                ((BestSalesPrice."Currency Code" = '') AND ("Currency Code" <> '')) OR
                ((BestSalesPrice."Variant Code" = '') AND ("Variant Code" <> '')):
                  BestSalesPrice := SalesPrice;
                ((BestSalesPrice."Currency Code" = '') OR ("Currency Code" <> '')) AND
                ((BestSalesPrice."Variant Code" = '') OR ("Variant Code" <> '')):
                  IF (BestSalesPrice."Unit Price" = 0) OR
                     (CalcLineAmount(BestSalesPrice) > CalcLineAmount(SalesPrice))
                  THEN
                    BestSalesPrice := SalesPrice;
              END;
            END;
          UNTIL NEXT = 0;
      END;


      {

      // No price found in agreement
      IF BestSalesPrice."Unit Price" = 0 THEN BEGIN
        ConvertPriceToVAT(
          Item."Price Includes VAT",Item."VAT Prod. Posting Group",
          Item."VAT Bus. Posting Gr. (Price)",Item."Unit Price");
        ConvertPriceToUoM('',Item."Unit Price");
        ConvertPriceLCYToFCY('',Item."Unit Price");

        CLEAR(BestSalesPrice);
        BestSalesPrice."Unit Price" := Item."Unit Price";
        BestSalesPrice."Allow Line Disc." := AllowLineDisc;
        BestSalesPrice."Allow Invoice Disc." := AllowInvDisc;
      END;
      }
      SalesPrice := BestSalesPrice;
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
    END;

    PROCEDURE SetResPrice@1000000031(Code2@1006 : Code[20];WorkTypeCode@1005 : Code[10];CurrencyCode@1003 : Code[10]);
    BEGIN
      WITH ResPrice DO BEGIN
        INIT;
        Code := Code2;
        "Work Type Code" := WorkTypeCode;
        "Currency Code" := CurrencyCode;
      END;
    END;

    LOCAL PROCEDURE SetCurrency@1000000030(CurrencyCode2@1003 : Code[10];CurrencyFactor2@1001 : Decimal;ExchRateDate2@1002 : Date);
    BEGIN
      PricesInCurrency := CurrencyCode2 <> '';
      IF PricesInCurrency THEN BEGIN
        Currency.GET(CurrencyCode2);
        Currency.TESTFIELD("Unit-Amount Rounding Precision");
        CurrencyFactor := CurrencyFactor2;
        ExchRateDate := ExchRateDate2;
      END ELSE
        GLSetup.GET;
    END;

    LOCAL PROCEDURE SetVAT@1000000029(PriceInclVAT2@1003 : Boolean;VATPerCent2@1002 : Decimal;VATCalcType2@1001 : Option;VATBusPostingGr2@1000 : Code[10]);
    BEGIN
      PricesInclVAT := PriceInclVAT2;
      VATPerCent := VATPerCent2;
      VATCalcType := VATCalcType2;
      VATBusPostingGr := VATBusPostingGr2;
    END;

    LOCAL PROCEDURE SetUoM@1000000028(Qty2@1000 : Decimal;QtyPerUoM2@1001 : Decimal);
    BEGIN
      Qty := Qty2;
      QtyPerUOM := QtyPerUoM2;
    END;

    LOCAL PROCEDURE SetLineDisc@1000000027(LineDiscPerCent2@1000 : Decimal;AllowLineDisc2@1001 : Boolean;AllowInvDisc2@1002 : Boolean);
    BEGIN
      LineDiscPerCent := LineDiscPerCent2;
      AllowLineDisc := AllowLineDisc2;
      AllowInvDisc := AllowInvDisc2;
    END;

    LOCAL PROCEDURE IsInMinQty@1000000026(UnitofMeasureCode@1003 : Code[10];MinQty@1000 : Decimal) : Boolean;
    BEGIN
      IF UnitofMeasureCode = '' THEN
        EXIT(MinQty <= QtyPerUOM * Qty);
      EXIT(MinQty <= Qty);
    END;

    LOCAL PROCEDURE SalesHeaderExchDate@1000000032(SalesHeader@1000 : Record 36) : Date;
    BEGIN
      WITH SalesHeader DO BEGIN
        IF "Posting Date" <> 0D THEN
          EXIT("Posting Date");
        EXIT(WORKDATE);
      END;
    END;

    LOCAL PROCEDURE ConvertPriceToVAT@1000000036(FromPricesInclVAT@1006 : Boolean;FromVATProdPostingGr@1000 : Code[10];FromVATBusPostingGr@1002 : Code[10];VAR UnitPrice@1004 : Decimal);
    VAR
      VATPostingSetup@1007 : Record 325;
    BEGIN
      IF FromPricesInclVAT THEN BEGIN
        VATPostingSetup.GET(FromVATBusPostingGr,FromVATProdPostingGr);

        CASE VATPostingSetup."VAT Calculation Type" OF
          VATPostingSetup."VAT Calculation Type"::"Reverse Charge VAT":
            VATPostingSetup."VAT %" := 0;
          VATPostingSetup."VAT Calculation Type"::"Sales Tax":
            ERROR(
              Text010,
              VATPostingSetup.FIELDCAPTION("VAT Calculation Type"),
              VATPostingSetup."VAT Calculation Type");
        END;

        CASE VATCalcType OF
          VATCalcType::"Normal VAT",
          VATCalcType::"Full VAT",
          VATCalcType::"Sales Tax":
            BEGIN
              IF PricesInclVAT THEN BEGIN
                IF VATBusPostingGr <> FromVATBusPostingGr THEN
                  UnitPrice := UnitPrice * (100 + VATPerCent) / (100 + VATPostingSetup."VAT %");
              END ELSE
                UnitPrice := UnitPrice / (1 + VATPostingSetup."VAT %" / 100);
            END;
          VATCalcType::"Reverse Charge VAT":
            UnitPrice := UnitPrice / (1 + VATPostingSetup."VAT %" / 100);
        END;
      END ELSE
        IF PricesInclVAT THEN
          UnitPrice := UnitPrice * (1 + VATPerCent / 100);
    END;

    LOCAL PROCEDURE ConvertPriceToUoM@1000000035(UnitOfMeasureCode@1002 : Code[10];VAR UnitPrice@1001 : Decimal);
    BEGIN
      IF UnitOfMeasureCode = '' THEN
        UnitPrice := UnitPrice * QtyPerUOM;
    END;

    LOCAL PROCEDURE ConvertPriceLCYToFCY@1000000034(CurrencyCode@1005 : Code[10];VAR UnitPrice@1001 : Decimal);
    VAR
      CurrExchRate@1000 : Record 330;
    BEGIN
      IF PricesInCurrency THEN BEGIN
        IF CurrencyCode = '' THEN
          UnitPrice :=
            CurrExchRate.ExchangeAmtLCYToFCY(ExchRateDate,Currency.Code,UnitPrice,CurrencyFactor);
        UnitPrice := ROUND(UnitPrice,Currency."Unit-Amount Rounding Precision");
      END ELSE
        UnitPrice := ROUND(UnitPrice,GLSetup."Unit-Amount Rounding Precision");
    END;

    LOCAL PROCEDURE CalcBestUnitPrice@1000000040(VAR SalesPrice@1000 : Record 7002);
    VAR
      BestSalesPrice@1002 : Record 7002;
    BEGIN
      WITH SalesPrice DO BEGIN
        FoundSalesPrice := FINDSET;
        IF FoundSalesPrice THEN
          REPEAT
            IF IsInMinQty("Unit of Measure Code","Minimum Quantity") THEN BEGIN
              ConvertPriceToVAT(
                "Price Includes VAT",Item."VAT Prod. Posting Group",
                "VAT Bus. Posting Gr. (Price)","Unit Price");
              ConvertPriceToUoM("Unit of Measure Code","Unit Price");
              ConvertPriceLCYToFCY("Currency Code","Unit Price");

              CASE TRUE OF
                ((BestSalesPrice."Currency Code" = '') AND ("Currency Code" <> '')) OR
                ((BestSalesPrice."Variant Code" = '') AND ("Variant Code" <> '')):
                  BestSalesPrice := SalesPrice;
                ((BestSalesPrice."Currency Code" = '') OR ("Currency Code" <> '')) AND
                ((BestSalesPrice."Variant Code" = '') OR ("Variant Code" <> '')):
                  IF (BestSalesPrice."Unit Price" = 0) OR
                     (CalcLineAmount(BestSalesPrice) > CalcLineAmount(SalesPrice))
                  THEN
                    BestSalesPrice := SalesPrice;
              END;
            END;
          UNTIL NEXT = 0;
      END;

      // No price found in agreement
      IF BestSalesPrice."Unit Price" = 0 THEN BEGIN
        ConvertPriceToVAT(
          Item."Price Includes VAT",Item."VAT Prod. Posting Group",
          Item."VAT Bus. Posting Gr. (Price)",Item."Unit Price");
        ConvertPriceToUoM('',Item."Unit Price");
        ConvertPriceLCYToFCY('',Item."Unit Price");

        CLEAR(BestSalesPrice);
        BestSalesPrice."Unit Price" := Item."Unit Price";
        BestSalesPrice."Allow Line Disc." := AllowLineDisc;
        BestSalesPrice."Allow Invoice Disc." := AllowInvDisc;
      END;

      SalesPrice := BestSalesPrice;
    END;

    LOCAL PROCEDURE CalcBestHotSheetPrice@1000000038(VAR HotSheetPrice@1000 : Record 50017);
    VAR
      BestHotSheetPrice@1002 : Record 50017;
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Start
      WITH HotSheetPrice DO BEGIN
        FoundHotSheetPrice := FINDSET;
        IF FoundHotSheetPrice THEN
          REPEAT
            //IF IsInMinQty("Unit of Measure Code","Minimum Quantity") THEN BEGIN
              ConvertPriceToUoM("Unit of Measure Code","Unit Price");
              //ConvertPriceLCYToFCY("Currency Code","Unit Price");
              IF (BestHotSheetPrice."Unit Price" = 0) OR (BestHotSheetPrice."Unit Price" > HotSheetPrice."Unit Price") THEN
              BestHotSheetPrice := HotSheetPrice;
            //END;
          UNTIL NEXT = 0;
      END;


      HotSheetPrice := BestHotSheetPrice;
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
    END;

    LOCAL PROCEDURE CalcBestLineDisc@1000000037(VAR SalesLineDisc@1000 : Record 7004);
    VAR
      BestSalesLineDisc@1002 : Record 7004;
    BEGIN
      WITH SalesLineDisc DO BEGIN
        IF FINDSET THEN
          REPEAT
            IF IsInMinQty("Unit of Measure Code","Minimum Quantity") THEN
              CASE TRUE OF
                ((BestSalesLineDisc."Currency Code" = '') AND ("Currency Code" <> '')) OR
                ((BestSalesLineDisc."Variant Code" = '') AND ("Variant Code" <> '')) OR
                ((BestSalesLineDisc."Hot Sheet Code" = '') AND ("Hot Sheet Code" <> '')): //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
                  BestSalesLineDisc := SalesLineDisc;
                ((BestSalesLineDisc."Currency Code" = '') OR ("Currency Code" <> '')) AND
                ((BestSalesLineDisc."Variant Code" = '') OR ("Variant Code" <> '')) AND
                ((BestSalesLineDisc."Hot Sheet Code" = '') OR ("Hot Sheet Code" <> '')): //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
                  IF BestSalesLineDisc."Line Discount %" < "Line Discount %" THEN
                    BestSalesLineDisc := SalesLineDisc;
              END;
          UNTIL NEXT = 0;
      END;

      SalesLineDisc := BestSalesLineDisc;
    END;

    PROCEDURE FindSalesPrice@1000000041(VAR ToSalesPrice@1003 : Record 7002;CustNo@1000 : Code[20];ContNo@1006 : Code[20];CustPriceGrCode@1001 : Code[10];CampaignNo@1007 : Code[20];ItemNo@1012 : Code[20];VariantCode@1011 : Code[10];UOM@1010 : Code[10];CurrencyCode@1009 : Code[10];StartingDate@1008 : Date;ShowAll@1004 : Boolean);
    VAR
      FromSalesPrice@1002 : Record 7002;
      TempTargetCampaignGr@1005 : TEMPORARY Record 7030;
    BEGIN
      WITH FromSalesPrice DO BEGIN
        SETRANGE("Item No.",ItemNo);
        SETFILTER("Variant Code",'%1|%2',VariantCode,'');
        SETFILTER("Ending Date",'%1|>=%2',0D,StartingDate);
        IF NOT ShowAll THEN BEGIN
          SETFILTER("Currency Code",'%1|%2',CurrencyCode,'');
          IF UOM <> '' THEN
            SETFILTER("Unit of Measure Code",'%1|%2',UOM,'');
          SETRANGE("Starting Date",0D,StartingDate);
        END;

        ToSalesPrice.RESET;
        ToSalesPrice.DELETEALL;

        SETRANGE("Sales Type","Sales Type"::"All Customers");
        SETRANGE("Sales Code");
        CopySalesPriceToSalesPrice(FromSalesPrice,ToSalesPrice);

        IF CustNo <> '' THEN BEGIN
          SETRANGE("Sales Type","Sales Type"::Customer);
          SETRANGE("Sales Code",CustNo);
          CopySalesPriceToSalesPrice(FromSalesPrice,ToSalesPrice);
        END;

        IF CustPriceGrCode <> '' THEN BEGIN
          SETRANGE("Sales Type","Sales Type"::"Customer Price Group");
          SETRANGE("Sales Code",CustPriceGrCode);
          CopySalesPriceToSalesPrice(FromSalesPrice,ToSalesPrice);
        END;

        IF NOT ((CustNo = '') AND (ContNo = '') AND (CampaignNo = '')) THEN BEGIN
          SETRANGE("Sales Type","Sales Type"::Campaign);
          IF ActivatedCampaignExists(TempTargetCampaignGr,CustNo,ContNo,CampaignNo) THEN
            REPEAT
              SETRANGE("Sales Code",TempTargetCampaignGr."Campaign No.");
              CopySalesPriceToSalesPrice(FromSalesPrice,ToSalesPrice);
            UNTIL TempTargetCampaignGr.NEXT = 0;
        END;
      END;
    END;

    LOCAL PROCEDURE SalesHeaderStartDate@1000000042(SalesHeader@1000 : Record 36;VAR DateCaption@1001 : Text[30]) : Date;
    BEGIN
      WITH SalesHeader DO
        IF "Document Type" IN ["Document Type"::Invoice,"Document Type"::"Credit Memo"] THEN BEGIN
          DateCaption := FIELDCAPTION("Posting Date");
          EXIT("Posting Date")
        END ELSE BEGIN
          DateCaption := FIELDCAPTION("Order Date");
          EXIT("Order Date");
        END;
    END;

    PROCEDURE FindHotSheetPrice@1000000043(VAR ToHotSheetPrice@1003 : Record 50017;ItemNo@1012 : Code[20];UOM@1010 : Code[10];StartingDate@1008 : Date);
    VAR
      FromHotSheetPrice@1002 : Record 50017;
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Start
      WITH FromHotSheetPrice DO BEGIN
        SETRANGE("Item No.",ItemNo);
        //SETFILTER("Variant Code",'%1|%2',VariantCode,'');
        SETFILTER("Ending Date",'%1|>=%2',0D,StartingDate);
        IF UOM <> '' THEN
          SETFILTER("Unit of Measure Code",'%1|%2',UOM,'');
        SETRANGE("Starting Date",0D,StartingDate);

        ToHotSheetPrice.RESET;
        ToHotSheetPrice.DELETEALL;

        //SETRANGE("Sales Type","Sales Type"::"All Customers");
        //SETRANGE("Sales Code");
        CopyHotSheetPriceToHotSheetPrice(FromHotSheetPrice,ToHotSheetPrice);

      END;
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
    END;

    PROCEDURE FindSalesLineDiscCustom@1000000044(VAR ToSalesLineDisc@1006 : Record 7004;CustNo@1003 : Code[20];ContNo@1001 : Code[20];CustDiscGrCode@1002 : Code[20];CampaignNo@1010 : Code[20];ItemNo@1004 : Code[20];ItemDiscGrCode@1005 : Code[20];VariantCode@1014 : Code[10];UOM@1013 : Code[10];CurrencyCode@1012 : Code[10];HotSheetCode@1000000000 : Code[10];StartingDate@1011 : Date;ShowAll@1000 : Boolean);
    VAR
      FromSalesLineDisc@1007 : Record 7004;
      TempCampaignTargetGr@1009 : TEMPORARY Record 7030;
      InclCampaigns@1008 : Boolean;
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04152015 Start
      WITH FromSalesLineDisc DO BEGIN
        SETFILTER("Ending Date",'%1|>=%2',0D,StartingDate);
        SETFILTER("Variant Code",'%1|%2',VariantCode,'');
        IF NOT ShowAll THEN BEGIN
          SETRANGE("Starting Date",0D,StartingDate);
          SETFILTER("Currency Code",'%1|%2',CurrencyCode,'');
          IF UOM <> '' THEN
            SETFILTER("Unit of Measure Code",'%1|%2',UOM,'');
        END;
        IF HotSheetCode <> '' THEN
          SETFILTER("Hot Sheet Code",'%1|%2',HotSheetCode,'');
        ToSalesLineDisc.RESET;
        ToSalesLineDisc.DELETEALL;
        FOR "Sales Type" := "Sales Type"::Customer TO "Sales Type"::Campaign DO
          IF ("Sales Type" = "Sales Type"::"All Customers") OR
             (("Sales Type" = "Sales Type"::Customer) AND (CustNo <> '')) OR
             (("Sales Type" = "Sales Type"::"Customer Disc. Group") AND (CustDiscGrCode <> '')) OR
             (("Sales Type" = "Sales Type"::Campaign) AND
              NOT ((CustNo = '') AND (ContNo = '') AND (CampaignNo = '')))
          THEN BEGIN
            InclCampaigns := FALSE;

            SETRANGE("Sales Type","Sales Type");
            CASE "Sales Type" OF
              "Sales Type"::"All Customers":
                SETRANGE("Sales Code");
              "Sales Type"::Customer:
                SETRANGE("Sales Code",CustNo);
              "Sales Type"::"Customer Disc. Group":
                SETRANGE("Sales Code",CustDiscGrCode);
              "Sales Type"::Campaign:
                BEGIN
                  InclCampaigns := ActivatedCampaignExists(TempCampaignTargetGr,CustNo,ContNo,CampaignNo);
                  SETRANGE("Sales Code",TempCampaignTargetGr."Campaign No.");
                END;
            END;

            REPEAT
              SETRANGE(Type,Type::Item);
              SETRANGE(Code,ItemNo);
              //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 Start
              //CopySalesDiscToSalesDisc(FromSalesLineDisc,ToSalesLineDisc);
              CopySalesDiscToSalesDiscCustom(FromSalesLineDisc,ToSalesLineDisc,"Hot Sheet Code",ItemNo,UOM,StartingDate);
              //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 Start

              IF ItemDiscGrCode <> '' THEN BEGIN
                SETRANGE(Type,Type::"Item Disc. Group");
                SETRANGE(Code,ItemDiscGrCode);
                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 Start
                //CopySalesDiscToSalesDisc(FromSalesLineDisc,ToSalesLineDisc);
                CopySalesDiscToSalesDiscCustom(FromSalesLineDisc,ToSalesLineDisc,"Hot Sheet Code",ItemNo,UOM,StartingDate);
                //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 Start
              END;

              IF InclCampaigns THEN BEGIN
                InclCampaigns := TempCampaignTargetGr.NEXT <> 0;
                SETRANGE("Sales Code",TempCampaignTargetGr."Campaign No.");
              END;
            UNTIL NOT InclCampaigns;
          END;
      END;
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04152015 End
    END;

    LOCAL PROCEDURE CalcLineAmount@1000000045(SalesPrice@1000 : Record 7002) : Decimal;
    BEGIN
      WITH SalesPrice DO BEGIN
        IF "Allow Line Disc." THEN
          EXIT("Unit Price" * (1 - LineDiscPerCent / 100));
        EXIT("Unit Price");
      END;
    END;

    PROCEDURE CopySalesPrice@1000000051(VAR SalesPrice@1000 : Record 7002);
    BEGIN
      SalesPrice.DELETEALL;
      CopySalesPriceToSalesPrice(TempSalesPrice,SalesPrice);
    END;

    LOCAL PROCEDURE CopySalesPriceToSalesPrice@1000000050(VAR FromSalesPrice@1000 : Record 7002;VAR ToSalesPrice@1001 : Record 7002);
    BEGIN
      WITH ToSalesPrice DO BEGIN
        IF FromSalesPrice.FINDSET THEN
          REPEAT
            IF FromSalesPrice."Unit Price" <> 0 THEN BEGIN
              ToSalesPrice := FromSalesPrice;
              INSERT;
            END;
          UNTIL FromSalesPrice.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE CopyHotSheetPriceToHotSheetPrice@1000000049(VAR FromHotSheetPrice@1000 : Record 50017;VAR ToHotSheetPrice@1001 : Record 50017);
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 Start
      WITH ToHotSheetPrice DO BEGIN
        IF FromHotSheetPrice.FINDSET THEN
          REPEAT
            IF FromHotSheetPrice."Unit Price" <> 0 THEN BEGIN
              ToHotSheetPrice := FromHotSheetPrice;
              INSERT;
            END;
          UNTIL FromHotSheetPrice.NEXT = 0;
      END;
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 04132015 End
    END;

    LOCAL PROCEDURE CopySalesDiscToSalesDisc@1000000048(VAR FromSalesLineDisc@1000 : Record 7004;VAR ToSalesLineDisc@1001 : Record 7004);
    BEGIN
      WITH ToSalesLineDisc DO BEGIN
        IF FromSalesLineDisc.FINDSET THEN
          REPEAT
            //TOP180 KT ABCSI Customer Pricing - Hot Sheets 06112015
            IF FromSalesLineDisc."Hot Sheet Code" <> '' THEN BEGIN
              ToSalesLineDisc := FromSalesLineDisc;
              INSERT;
            END ELSE BEGIN
            //TOP180 KT ABCSI Customer Pricing - Hot Sheets 06112015
              IF FromSalesLineDisc."Line Discount %" <> 0 THEN BEGIN
                ToSalesLineDisc := FromSalesLineDisc;
                INSERT;
              END;
            END; //TOP180 KT ABCSI Customer Pricing - Hot Sheets 06112015
          UNTIL FromSalesLineDisc.NEXT = 0;
      END;
    END;

    LOCAL PROCEDURE CopySalesDiscToSalesDiscCustom@1000000047(VAR FromSalesLineDisc@1000 : Record 7004;VAR ToSalesLineDisc@1001 : Record 7004;HotSheetCode@1000000003 : Code[10];ItemNo@1000000002 : Code[20];UOM@1000000001 : Code[10];StartingDate@1000000000 : Date);
    BEGIN
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 Start
      WITH ToSalesLineDisc DO BEGIN
        IF FromSalesLineDisc.FINDSET THEN
          REPEAT
            IF FromSalesLineDisc."Hot Sheet Code" <> '' THEN BEGIN
              IF IsItemNoInHotSheet(FromSalesLineDisc."Hot Sheet Code",ItemNo,UOM,StartingDate) THEN BEGIN
                ToSalesLineDisc := FromSalesLineDisc;
                INSERT;
              END;
            END ELSE BEGIN
              IF FromSalesLineDisc."Line Discount %" <> 0 THEN BEGIN
                ToSalesLineDisc := FromSalesLineDisc;
                INSERT;
              END;
            END;
          UNTIL FromSalesLineDisc.NEXT = 0;
      END;
      //TOP180 KT ABCSI Customer Pricing - Hot Sheets 07202015 Start
    END;

    PROCEDURE SetGPPG_DIMForPromoLines@1000000033(VAR pPromoSalesLine@1000000000 : Record 37);
    BEGIN
      //<TPZ2368>
      IF pPromoSalesLine.Type <> pPromoSalesLine.Type::Item THEN
        EXIT;

      IF pPromoSalesLine.Sample THEN BEGIN
        GetGLSetup;
        TPZGenLedgSetup.TESTFIELD("Sample Items GPPG Code");
        TPZGenLedgSetup.TESTFIELD("Sample Items Expense G/L Acct.");
        TPZGenLedgSetup.TESTFIELD("Sample Items GPPG Code");
        TPZGenLedgSetup.TESTFIELD("Sample Department Code");
        TPZGenLedgSetup.TESTFIELD("Sample Site Code");
        pPromoSalesLine.VALIDATE("Gen. Prod. Posting Group",TPZGenLedgSetup."Sample Items GPPG Code");
        pPromoSalesLine.VALIDATE("Shortcut Dimension 1 Code",TPZGenLedgSetup."Sample Department Code");
        pPromoSalesLine.VALIDATE("Shortcut Dimension 2 Code",TPZGenLedgSetup."Sample Site Code");
      END ELSE BEGIN
        GetItem;
        Item.TESTFIELD("Gen. Prod. Posting Group");
        pPromoSalesLine.VALIDATE("Gen. Prod. Posting Group",Item."Gen. Prod. Posting Group");
        pPromoSalesLine.VALIDATE("Shortcut Dimension 1 Code",SalesHeader."Shortcut Dimension 1 Code");
        pPromoSalesLine.VALIDATE("Shortcut Dimension 2 Code",SalesHeader."Shortcut Dimension 2 Code");
      END;
      //</TPZ2368>
    END;

    BEGIN
    {
      --------------------------------------------------------------------------------
      2017-06-22 TPZ1887 EBAGIM
        This table is used for the Customer price book report (51014)
      2018-07-31 TPZ2368 UCHOUHAN
        Added promo field and code

      TPZ2785 05112020 GGUPTA Remove Item blocking Topaz Customization
    }
    END.
  }
}

