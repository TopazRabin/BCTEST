OBJECT Report 14002412 Create Price Catalog Entries
{
  OBJECT-PROPERTIES
  {
    Date=07/13/20;
    Time=12:00:00 PM;
    Version List=SE0.62;
  }
  PROPERTIES
  {
    CaptionML=ENU=Create Sales Price Catalog Entries;
    ProcessingOnly=Yes;
    OnPostReport=BEGIN
                   TmpItem.RESET;
                   TmpItem.DELETEALL;
                 END;

  }
  DATASET
  {
    { 8437;    ;DataItem;                    ;
               DataItemTable=Table14002413;
               ReqFilterHeadingML=ENU=Sales Price Catalog;
               OnAfterGetRecord=BEGIN
                                  InventoryAdviceHdr.GET(
                                    "E.D.I. Inventory Advice Header"."No.","E.D.I. Inventory Advice Header".Type);
                                  TradePartner := InventoryAdviceHdr."Trade Partner No.";

                                  InventoryAdviceLine.RESET;
                                  InventoryAdviceLine.SETRANGE("Inventory Advice No.",InventoryAdviceHdr."No.");
                                  InventoryAdviceLine.SETRANGE(Type,InventoryAdviceHdr.Type);
                                  InventoryAdviceLine.DELETEALL;

                                  DocumentNo := 'E_PRICAT';

                                  EDIDocument.SETRANGE("Trade Partner No.",TradePartner);
                                  EDIDocument.SETFILTER(
                                    Status,'%1|%2',EDIDocument.Status::Test,EDIDocument.Status::Production);
                                  EDIDocument.SETRANGE("Navision Document",DocumentNo);
                                  EDIDocument.SETRANGE(Type,EDIDocument.Type::Export);
                                  IF NOT EDIDocument.FIND('-') THEN
                                    ERROR(
                                      Text001,
                                      DocumentNo,TradePartner);

                                  EDITemplate.GET(EDIDocument."EDI Template Code");

                                  CreateInventoryAdvice.GetCatalogSequence(InventoryAdviceHdr,EDIDocument);

                                  IF InventoryAdviceHdr.Released THEN
                                    IF (EDIDocument."Reuse Existing InventoryAdvice") AND
                                       (EDIDocument."Auto. Reopen on Recreate")
                                    THEN
                                      CreateInventoryAdvice.ReopenInventoryAdvice(InventoryAdviceHdr);
                                END;

               ReqFilterFields=No. }

    { 8129;    ;DataItem;                    ;
               DataItemTable=Table27;
               OnPreDataItem=BEGIN
                               CLEAR(CreateInventoryAdvice);

                               TmpItem.RESET;
                               TmpItem.DELETEALL;
                             END;

               OnAfterGetRecord=BEGIN
                                  IF EDIDocument."Auto. Create Item Filter" =
                                     EDIDocument."Auto. Create Item Filter"::"EDI Item Cross Reference"
                                  THEN BEGIN
                                    IF (ExceptionCatalogType = ExceptionCatalogType::Add) OR
                                       (ExceptionCatalogType = ExceptionCatalogType::Delete)
                                    THEN BEGIN
                                      IF (ExceptionCatalogType = ExceptionCatalogType::Add) THEN
                                        CatalogAdditionEntry := TRUE
                                      ELSE
                                        CatalogDeletionEntry := TRUE;
                                    END;

                                    EDITradePtnrItem.RESET;
                                    EDITradePtnrItem.SETRANGE("Trade Partner No.",TradePartner);
                                     EDITradePtnrItem.SETFILTER("Partner Item No.",'<>%1','');
                                    EDITradePtnrItem.SETRANGE(Discontinue,FALSE);
                                    IF CatalogAdditionEntry THEN
                                      EDITradePtnrItem.SETRANGE("Update Price Catalog",EDITradePtnrItem."Update Price Catalog"::Add);
                                    IF CatalogDeletionEntry THEN
                                      EDITradePtnrItem.SETRANGE("Update Price Catalog",EDITradePtnrItem."Update Price Catalog"::Delete);
                                    IF EDITradePtnrItem.FIND('-') THEN BEGIN
                                      REPEAT
                                        TmpEDITradePtnrItem.RESET;
                                        TmpEDITradePtnrItem.SETRANGE("Trade Partner No.",EDITradePtnrItem."Trade Partner No.");
                                        TmpEDITradePtnrItem.SETRANGE("Partner Item No.",EDITradePtnrItem."Partner Item No.");
                                        TmpEDITradePtnrItem.SETRANGE("Partner Variant Code",EDITradePtnrItem."Partner Variant Code");
                                        IF NOT TmpEDITradePtnrItem.FIND('-') THEN BEGIN
                                          TmpEDITradePtnrItem.COPY(EDITradePtnrItem);
                                          TmpEDITradePtnrItem.INSERT;
                                        END;

                                        IF Item2.GET(EDITradePtnrItem."Navision Item No.") THEN BEGIN
                                          IF (EDIDocument."Exclude Blocked Item" AND Item2.Blocked = FALSE) OR
                                             (EDIDocument."Exclude Blocked Item" = FALSE)
                                          THEN BEGIN
                                            IF Item.GETFILTER("Location Filter") = '' THEN BEGIN
                                              IF EDIDocument."Location Override" <> '' THEN
                                                Item.SETFILTER("Location Filter",EDIDocument."Location Override")
                                              ELSE
                                                Item.SETFILTER("Location Filter",InventoryAdviceHdr."Location Code");
                                            END;
                                            Item2.COPYFILTERS(Item);

                                            CatalogCreated :=
                                              CreateInventoryAdvice.InsertItem(
                                                Item2,EDIDocument,InventoryAdviceHdr."No.",ExpectedDate,AvailableQty,
                                                ExpectedReceiptQty,EDITradePtnrItem."Partner Variant Code");
                                          END;
                                        END;
                                      UNTIL EDITradePtnrItem.NEXT = 0;
                                      COMMIT;
                                      CurrReport.BREAK;
                                    END ELSE
                                      CurrReport.QUIT;
                                  END ELSE BEGIN
                                    ItemNoFilter := GETFILTER(Item."No.");
                                    CASE EDIDocument."Auto. Create Item Filter" OF
                                      EDIDocument."Auto. Create Item Filter"::"Cross-Reference Type No. (Customer)":
                                        BEGIN
                                          AutoFilterICRTypeNo := AutoFilterICRTypeNo::Customer;
                                          CLEAR(ItemCrossReference);
                                          WITH ItemCrossReference DO BEGIN
                                            RESET;
                                            SETFILTER("Cross-Reference Type",'<> %1',"Cross-Reference Type"::Vendor);
                                            SETRANGE("Cross-Reference Type No.","E.D.I. Inventory Advice Header"."Sell-to Customer No.");
                                            SETFILTER("Variant Code",Item."Variant Filter");
                                            SETFILTER("Item No.",ItemNoFilter);
                                            SETRANGE("Discontinue Bar Code",FALSE);
                                            IF FIND('-') THEN BEGIN
                                              REPEAT
                                                Item2.GET(ItemCrossReference."Item No.");
                                                IF (EDIDocument."Exclude Blocked Item" AND Item2.Blocked = FALSE) OR
                                                   (EDIDocument."Exclude Blocked Item" = FALSE)
                                                THEN BEGIN
                                                  TmpItem.RESET;
                                                  TmpItem.SETRANGE("No.",Item2."No.");
                                                  IF NOT TmpItem.FIND('-') THEN BEGIN
                                                    TmpItem."No." := Item2."No.";
                                                    TmpItem.INSERT;
                                                    IF Item.GETFILTER("Location Filter") = '' THEN BEGIN
                                                      IF EDIDocument."Location Override" <> '' THEN
                                                        Item.SETFILTER("Location Filter",EDIDocument."Location Override")
                                                      ELSE
                                                        Item.SETFILTER("Location Filter",InventoryAdviceHdr."Location Code");
                                                    END;
                                                    Item2.COPYFILTERS(Item);

                                                    CatalogCreated :=
                                                      CreateInventoryAdvice.ICRLookupItem(
                                                        Item2,EDIDocument,InventoryAdviceHdr."No.",AutoFilterICRTypeNo,ExpectedDate,
                                                        AvailableQty,ExpectedReceiptQty);
                                                  END;
                                                END;
                                              UNTIL NEXT = 0;
                                            END;
                                          END;
                                          COMMIT;
                                          CurrReport.BREAK;
                                        END;
                                      EDIDocument."Auto. Create Item Filter"::"Cross-Reference Type No. (Blank)":
                                        BEGIN
                                          AutoFilterICRTypeNo := AutoFilterICRTypeNo::Blank;
                                          CLEAR(ItemCrossReference);
                                          WITH ItemCrossReference DO BEGIN
                                            RESET;
                                            SETFILTER("Cross-Reference Type",'<> %1',"Cross-Reference Type"::Vendor);
                                            SETRANGE("Cross-Reference Type No.",'');
                                            SETFILTER("Variant Code",Item."Variant Filter");
                                            SETFILTER("Item No.",ItemNoFilter);
                                            SETRANGE("Discontinue Bar Code",FALSE);
                                            IF FIND('-') THEN BEGIN
                                              REPEAT
                                                Item2.GET(ItemCrossReference."Item No.");
                                                IF (EDIDocument."Exclude Blocked Item" AND Item2.Blocked = FALSE) OR
                                                   (EDIDocument."Exclude Blocked Item" = FALSE)
                                                THEN BEGIN
                                                  TmpItem.RESET;
                                                  TmpItem.SETRANGE("No.",Item2."No.");
                                                  IF NOT TmpItem.FIND('-') THEN BEGIN
                                                    TmpItem."No." := Item2."No.";
                                                    TmpItem.INSERT;
                                                    IF Item.GETFILTER("Location Filter") = '' THEN BEGIN
                                                      IF EDIDocument."Location Override" <> '' THEN
                                                        Item.SETFILTER("Location Filter",EDIDocument."Location Override")
                                                      ELSE
                                                        Item.SETFILTER("Location Filter",InventoryAdviceHdr."Location Code");
                                                    END;
                                                    Item2.COPYFILTERS(Item);

                                                    CatalogCreated :=
                                                      CreateInventoryAdvice.ICRLookupItem(
                                                        Item2,EDIDocument,InventoryAdviceHdr."No.",AutoFilterICRTypeNo,ExpectedDate,
                                                        AvailableQty,ExpectedReceiptQty);
                                                  END;
                                                END;
                                              UNTIL NEXT = 0;
                                            END;
                                          END;
                                          COMMIT;
                                          CurrReport.BREAK;
                                        END;
                                      ELSE
                                        CASE IncludeCrossRefTypeNo OF
                                          IncludeCrossRefTypeNo::" ":
                                            BEGIN
                                              IF Item.GETFILTER("Location Filter") = '' THEN BEGIN
                                                IF EDIDocument."Location Override" <> '' THEN
                                                  Item.SETFILTER("Location Filter",EDIDocument."Location Override")
                                                ELSE
                                                  Item.SETFILTER("Location Filter",InventoryAdviceHdr."Location Code");
                                              END;
                                              IF (EDIDocument."Exclude Blocked Item" AND Item2.Blocked = FALSE) OR
                                                 (EDIDocument."Exclude Blocked Item" = FALSE)
                                              THEN BEGIN
                                                CatalogCreated :=
                                                  CreateInventoryAdvice.InsertItem(
                                                    Item,EDIDocument,InventoryAdviceHdr."No.",ExpectedDate,AvailableQty,
                                                    ExpectedReceiptQty,' ');
                                                COMMIT;
                                              END;
                                            END;
                                          IncludeCrossRefTypeNo::Customer:
                                            BEGIN
                                              AutoFilterICRTypeNo := AutoFilterICRTypeNo::Customer;
                                              WITH ItemCrossReference DO BEGIN
                                                RESET;
                                                SETFILTER("Cross-Reference Type",'<> %1',"Cross-Reference Type"::Vendor);
                                                SETRANGE(
                                                  "Cross-Reference Type No.","E.D.I. Inventory Advice Header"."Sell-to Customer No.");
                                                SETFILTER("Variant Code",Item."Variant Filter");
                                                SETFILTER("Item No.",ItemNoFilter);
                                                SETRANGE("Discontinue Bar Code",FALSE);
                                                IF FIND('-') THEN BEGIN
                                                  REPEAT
                                                    Item2.GET(ItemCrossReference."Item No.");
                                                    IF (EDIDocument."Exclude Blocked Item" AND Item2.Blocked = FALSE) OR
                                                       (EDIDocument."Exclude Blocked Item" = FALSE)
                                                    THEN BEGIN
                                                      TmpItem.RESET;
                                                      TmpItem.SETRANGE("No.",Item2."No.");
                                                      IF NOT TmpItem.FIND('-') THEN BEGIN
                                                        TmpItem."No." := Item2."No.";
                                                        TmpItem.INSERT;
                                                        IF Item.GETFILTER("Location Filter") = '' THEN BEGIN
                                                          IF EDIDocument."Location Override" <> '' THEN
                                                            Item.SETFILTER("Location Filter",EDIDocument."Location Override")
                                                          ELSE
                                                            Item.SETFILTER("Location Filter",InventoryAdviceHdr."Location Code");
                                                        END;
                                                        Item2.COPYFILTERS(Item);

                                                        CatalogCreated :=
                                                          CreateInventoryAdvice.ICRLookupItem(
                                                            Item2,EDIDocument,InventoryAdviceHdr."No.",AutoFilterICRTypeNo,
                                                            ExpectedDate,AvailableQty,ExpectedReceiptQty);
                                                      END;
                                                    END;
                                                  UNTIL NEXT = 0;
                                                END;
                                              END;
                                              COMMIT;
                                              CurrReport.BREAK;
                                            END;
                                          IncludeCrossRefTypeNo::Blank:
                                            BEGIN
                                              AutoFilterICRTypeNo := AutoFilterICRTypeNo::Blank;
                                              WITH ItemCrossReference DO BEGIN
                                                RESET;
                                                SETFILTER("Cross-Reference Type",'<> %1',"Cross-Reference Type"::Vendor);
                                                SETRANGE("Cross-Reference Type No.",'');
                                                SETFILTER("Variant Code",Item."Variant Filter");
                                                SETFILTER("Item No.",ItemNoFilter);
                                                SETRANGE("Discontinue Bar Code",FALSE);
                                                IF FIND('-') THEN BEGIN
                                                  REPEAT
                                                    Item2.GET(ItemCrossReference."Item No.");
                                                    IF (EDIDocument."Exclude Blocked Item" AND Item2.Blocked = FALSE) OR
                                                       (EDIDocument."Exclude Blocked Item" = FALSE)
                                                    THEN BEGIN
                                                      TmpItem.RESET;
                                                      TmpItem.SETRANGE("No.",Item2."No.");
                                                      IF NOT TmpItem.FIND('-') THEN BEGIN
                                                        TmpItem."No." := Item2."No.";
                                                        TmpItem.INSERT;
                                                        IF Item.GETFILTER("Location Filter") = '' THEN BEGIN
                                                          IF EDIDocument."Location Override" <> '' THEN
                                                            Item.SETFILTER("Location Filter",EDIDocument."Location Override")
                                                          ELSE
                                                            Item.SETFILTER("Location Filter",InventoryAdviceHdr."Location Code");
                                                        END;
                                                        Item2.COPYFILTERS(Item);

                                                        CatalogCreated :=
                                                          CreateInventoryAdvice.ICRLookupItem(
                                                           Item2,EDIDocument,InventoryAdviceHdr."No.",AutoFilterICRTypeNo,
                                                           ExpectedDate,AvailableQty,ExpectedReceiptQty);
                                                      END;
                                                    END;
                                                  UNTIL NEXT = 0;
                                                END;
                                              END;
                                              COMMIT;
                                              CurrReport.BREAK;
                                            END;
                                        END;
                                    END;
                                  END;

                                  COMMIT;
                                END;

               OnPostDataItem=VAR
                                EDISetup@1240020000 : Record 14002367;
                              BEGIN
                                EDISetup.GET;

                                IF (EDIDocument."Auto. Create Item Filter" =
                                     EDIDocument."Auto. Create Item Filter"::"EDI Item Cross Reference") AND
                                   ((CatalogAdditionEntry = TRUE) OR (CatalogDeletionEntry = TRUE))
                                THEN BEGIN
                                  TmpEDITradePtnrItem.RESET;
                                  TmpEDITradePtnrItem.SETRANGE("Trade Partner No.",TradePartner);
                                  IF CatalogAdditionEntry THEN
                                    TmpEDITradePtnrItem.SETRANGE("Update Price Catalog",EDITradePtnrItem."Update Price Catalog"::Add);
                                  IF CatalogDeletionEntry THEN
                                    TmpEDITradePtnrItem.SETRANGE("Update Price Catalog",EDITradePtnrItem."Update Price Catalog"::Delete);
                                  IF TmpEDITradePtnrItem.FIND('-') THEN BEGIN
                                    REPEAT
                                      IF EDITradePtnrItem.GET(
                                        TmpEDITradePtnrItem."Trade Partner No.",TmpEDITradePtnrItem."Partner Item No.",
                                        TmpEDITradePtnrItem."Partner Variant Code")
                                      THEN BEGIN
                                        EDITradePtnrItem.VALIDATE("Update Price Catalog",EDITradePtnrItem."Update Price Catalog"::" ");
                                        EDITradePtnrItem."Exception Price Catalog No." := InventoryAdviceHdr."No.";
                                        IF CatalogAdditionEntry THEN
                                          EDITradePtnrItem."Exception Price Catalog Type" := EDITradePtnrItem."Update Price Catalog"::Add;
                                        IF CatalogDeletionEntry THEN
                                          EDITradePtnrItem."Exception Price Catalog Type" := EDITradePtnrItem."Update Price Catalog"::Delete;
                                        EDITradePtnrItem.MODIFY;
                                      END;
                                    UNTIL TmpEDITradePtnrItem.NEXT = 0;
                                  COMMIT;
                                  END;
                                END;

                                TmpEDITradePtnrItem.RESET;
                                TmpEDITradePtnrItem.DELETEALL;

                                IF (Release) OR (EDITemplate."Auto. Release Price Catalog") THEN
                                  CreateInventoryAdvice.ReleaseInventoryAdvice(InventoryAdviceHdr);
                              END;

               ReqFilterFields=No. }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
      { 1900000001;0;Container;
                  ContainerType=ContentArea }

      { 1900000002;1;Group  ;
                  CaptionML=ENU=Options }

      { 1240020001;2;Field  ;
                  CaptionML=ENU=Exception Catalog Type;
                  SourceExpr=ExceptionCatalogType }

      { 1240030008;2;Field  ;
                  CaptionML=ENU=Cross-Reference Type No.;
                  SourceExpr=IncludeCrossRefTypeNo }

    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      EDIDocument@1240030000 : Record 14002353;
      InventoryAdviceHdr@1240030010 : Record 14002413;
      InventoryAdviceLine@1240030011 : Record 14002414;
      EDITradePtnrItem@1240030003 : Record 14002364;
      TmpEDITradePtnrItem@1240020013 : TEMPORARY Record 14002364;
      ItemCrossReference@1240030012 : Record 5717;
      Item2@1240020009 : Record 27;
      EDITemplate@1240020010 : Record 14002350;
      TmpItem@1240020012 : TEMPORARY Record 27;
      CreateInventoryAdvice@1240030002 : Codeunit 14002416;
      TradePartner@1240030004 : Code[20];
      Text001@1240030001 : TextConst 'ENU=An active EDI Document %1 was not found for Trading Partner %2.;ENC=An active EDI Document %1 was not found for Trading Partner %2.';
      AvailableQty@1240030005 : Decimal;
      ExpectedReceiptQty@1240030006 : Decimal;
      ExpectedDate@1240030007 : Date;
      Release@1240030009 : Boolean;
      AutoFilterICRTypeNo@1240030013 : ' ,Customer,Blank';
      IncludeCrossRefTypeNo@1240030015 : ' ,Customer,Blank';
      DocumentNo@1240020005 : Code[10];
      CatalogCreated@1240020011 : Boolean;
      ExceptionCatalogType@1240020008 : ' ,Add,Delete';
      CatalogAdditionEntry@1240020007 : Boolean;
      CatalogDeletionEntry@1240020006 : Boolean;
      ItemNoFilter@1240020000 : Text;

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}

