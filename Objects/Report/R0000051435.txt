OBJECT Report 51435 Send Invoices
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=;
  }
  PROPERTIES
  {
    ProcessingOnly=Yes;
  }
  DATASET
  {
    { 1000000000;;DataItem;                  ;
               DataItemTable=Table112;
               DataItemTableView=WHERE(E-Mail Invoice Notice Handled=FILTER(No));
               OnAfterGetRecord=BEGIN
                                      //IF "Sales Invoice Header"."E-Mail Invoice Notice Handled" = FALSE THEN
                                        GlobalTPZ_SendNotifications("Sales Invoice Header"."No.");
                                END;
                                 }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      InvoiceNotificationHandling@1000000000 : Codeunit 50043;
      salessetup@1000000001 : Record 311;
      Codeunit82EventSubscriber@1000000002 : Codeunit 51877;

    PROCEDURE GlobalTPZ_SendNotifications@1000000000(InvoiceNo@1000000000 : Code[20]);
    VAR
      EMailMgt@1000000001 : Codeunit 50058;
      FaxMgmt@1000000005 : Codeunit 50010;
      SalesPostPrint@1000000006 : Codeunit 82;
      EmailInvoice@1000000007 : Boolean;
      PrintInvoice@1000000008 : Boolean;
      FaxInvoice@1000000009 : Boolean;
      EmailCredit@1000000010 : Boolean;
      EmailShipment@1000000011 : Boolean;
      JobQueueCat@1000000012 : Record 471;
      JobQueueEntry@1000000013 : Record 472;
      PostDescription@1000000014 : Text;
      SalesInvHeader@1000000002 : Record 112;
    BEGIN
      //<TPZ2242>
      salessetup.GET;
      SalesInvHeader.GET(InvoiceNo);
      WITH SalesInvHeader DO BEGIN
        IF salessetup."Enable E-Mail" AND NOT "EDI Invoice" THEN
             EMailMgt.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);

      {
          IF salessetup."Enable Fax" AND Fax AND NOT "EDI Invoice" THEN
              SalesInvoice(SalesInvHeader);
         }
          IF salessetup."Enable Mail" AND Mail AND NOT "EDI Invoice" THEN
                 //   SalesPostPrint.GetInvoiceReport(SalesInvHeader);
                 Codeunit82EventSubscriber.CU82_GetInvoiceReport(SalesInvHeader);//<TPZ2829> Event Conversion
      END;
      {
      SalesSetup.GET;
      SalesInvHeader.GET(InvoiceNo);
      WITH SalesInvHeader DO BEGIN
        IF SalesSetup."Enable E-Mail" AND NOT "EDI Invoice" THEN
              EMailMgt.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);

          IF SalesSetup."Enable Fax" AND Fax THEN
              FaxMgmt.SalesInvoice(SalesInvHeader);

          IF SalesSetup."Enable Mail" AND Mail THEN
                    SalesPostPrint.GetInvoiceReport(SalesInvHeader);
      END;
      //</TPZ2242>
      }
    END;

    PROCEDURE SalesInvoice@1000000002(SalesInvHeader2@1000000000 : Record 112);
    VAR
      SalesSetup@1000000001 : Record 311;
      Printer@1000000002 : Record 2000000039;
      SalesInvHeader@1000000005 : Record 112;
      PrinterMgmt@1000000003 : Codeunit 50009;
      SalesInvoice@1000000004 : Report 10074;
      EmailManagement@1000000006 : Codeunit 50058;
      Customer@1000000008 : Record 18;
      FaxText@1000000009 : Text[250];
      EmailListEntry@1000000010 : Record 14000908;
      txtFaxEmail@1000000007 : TextConst 'ENU=@egoldfax.com';
    BEGIN

      IF SalesInvHeader2."No." = '' THEN
        EXIT;

      SalesSetup.GET;

      SalesInvHeader."No." := SalesInvHeader2."No.";
      SalesInvHeader.SETRECFILTER;
      //<TPZ1888>
      EmailListEntry.INIT();
      EmailListEntry."Table ID":=112;
      EmailListEntry.Code:= SalesInvHeader2."No.";
      Customer.GET(SalesInvHeader2."Sell-to Customer No.");
      IF Customer."Invoice Fax No." <> '' THEN
         FaxText :=Customer."Invoice Fax No."
        ELSE IF Customer."Fax No." <> '' THEN
         FaxText := Customer."Fax No."
         ELSE
       EXIT;
      EmailListEntry."E-Mail":=FaxText+txtFaxEmail;
      EmailListEntry."Sales Invoice E-Mail":=EmailListEntry."Sales Invoice E-Mail"::"To";
      EmailListEntry.INSERT();
      EmailManagement.SendSalesInvoiceNotice(SalesInvHeader,FALSE,FALSE);
      //</TPZ1888>
      UpdateFaxNoticeHandled(SalesInvHeader."No.");
    END;

    PROCEDURE UpdateFaxNoticeHandled@1000000001(DocNo@1000000000 : Code[20]);
    VAR
      SalesInvHeader@1000000002 : Record 112;
      ShipmentHeaderEdit@1000000001 : Codeunit 391;
    BEGIN
      SalesInvHeader.GET(DocNo);
      SalesInvHeader."Fax Invoice Notice Handled" := TRUE;

      ShipmentHeaderEdit.SalesInvoiceHeaderEdit(SalesInvHeader);
      COMMIT;
    END;

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}

