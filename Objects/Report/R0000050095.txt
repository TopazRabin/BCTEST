OBJECT Report 50095 AR Traffic Inv Procesed BtchJb
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    ProcessingOnly=Yes;
  }
  DATASET
  {
    { 1000000000;;DataItem;                  ;
               DataItemTable=Table2000000026;
               DataItemTableView=WHERE(Number=CONST(1));
               OnPostDataItem=VAR
                                TextDate@1000000000 : Text;
                              BEGIN
                                //FileLocation := 'U:\AR Traffic Invoice Processed\';
                                TextDate := DELCHR(FORMAT(TODAY),'=','/');
                                ARTrafficInvoicesProcessed.SAVEASEXCEL(TEMPORARYPATH + 'AR Traffic Invoice Processed - ' + TextDate + '.xlsx');
                                IF SMTPMailSetup.GET THEN;

                                SMTPMail.CreateMessage(SMTPMailSetup."From Name",SMTPMailSetup."From Address",'topazitreports@topaz-USA.com','AR TRaffic Invoice Processed - '+ FORMAT(TODAY,5),'',TRUE);
                                SMTPMail.AddCC('shailesh.nagpal@topaz-usa.com');
                                SMTPMail.AddCC('victoria.strong@topaz-usa.com');
                                SMTPMail.AddCC('tom.dunleavy@topaz-usa.com');
                                SMTPMail.AppendBody('Dear Sir/Madam,');
                                SMTPMail.AppendBody('<br><br>');
                                SMTPMail.AppendBody(Text50000);
                                IF EXISTS(TEMPORARYPATH + 'AR Traffic Invoice Processed - '+ TextDate + '.xlsx') THEN BEGIN
                                  SMTPMail.AddAttachment(TEMPORARYPATH + 'AR Traffic Invoice Processed - '+ TextDate + '.xlsx','AR Traffic Invoice Processed - ' + FORMAT(TODAY,5)+ '.xlsx');
                                  SMTPMail.Send;
                                  MESSAGE('Mail sent successfully');
                                END;
                              END;
                               }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      ARTrafficInvoicesProcessed@1000000000 : Report 50078;
      SMTPMailSetup@1000000001 : Record 409;
      SMTPMail@1000000002 : Codeunit 400;
      Filename@1000000003 : Text;
      FileLocation@1000000004 : Text;
      Text50000@1000000005 : TextConst 'ENU=Please find attached excel sheet having list of  AR Traffic Invoices Processed/Skipped.';

    BEGIN
    {
      Mail to VIctoria, Tom, Ben, Joe, Doug, Eran, Pat
    }
    END.
  }
  RDLDATA
  {
  }
}

