OBJECT Report 50043 Fix EDI Invoice for Xref
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    ProcessingOnly=Yes;
  }
  DATASET
  {
    { 1000000000;;DataItem;                  ;
               DataItemTable=Table112;
               DataItemTableView=SORTING(EDI Order,EDI Invoice Generated,EDI Trade Partner,EDI Internal Doc. No.);
               OnAfterGetRecord=BEGIN
                                  CustomerRec.GET("Sell-to Customer No.");
                                  "EDI Trade Partner" := CustomerRec."EDI Trade Partner";

                                  EDICustXRefRec.RESET;
                                  EDICustXRefRec.SETCURRENTKEY("Trade Partner No.","Navision Sell To Code","Navision Ship To Code","Effective Date");
                                  EDICustXRefRec.SETRANGE("Trade Partner No.", CustomerRec."EDI Trade Partner");
                                  EDICustXRefRec.SETRANGE("Navision Sell To Code",CustomerRec."No.");
                                  EDICustXRefRec.SETRANGE("Navision Ship To Code","Sales Invoice Header"."Ship-to Code");
                                  IF NOT EDICustXRefRec.FINDFIRST THEN
                                    CurrReport.SKIP;

                                  "EDI Sell-to Code"  := EDICustXRefRec."EDI Sell To Code";
                                  "EDI Ship-to Code"  := EDICustXRefRec."EDI Ship To Code";
                                  MODIFY;
                                END;

               ReqFilterFields=EDI Trade Partner,No.,Sell-to Customer No. }

    { 1000000001;1;DataItem;                 ;
               DataItemTable=Table14002369;
               DataItemTableView=SORTING(Internal Doc No.,Navision Document,Document No.,Version,Shortcut Dimension 5 Code);
               PrintOnlyIfDetail=Yes;
               OnPreDataItem=BEGIN
                               SETRANGE("Trade Partner No.",CustomerRec."EDI Trade Partner");
                               IF "Sales Invoice Header"."EDI Internal Doc. No." <> '' THEN
                                 SETRANGE("Internal Doc No.","Sales Invoice Header"."EDI Internal Doc. No.")
                               ELSE
                                 CurrReport.SKIP;
                             END;

               OnAfterGetRecord=BEGIN
                                  EDICustXRefRec.RESET;
                                  EDICustXRefRec.SETCURRENTKEY("Trade Partner No.","Navision Sell To Code","Navision Ship To Code","Effective Date");
                                  EDICustXRefRec.SETRANGE("Trade Partner No.",CustomerRec."EDI Trade Partner");
                                  EDICustXRefRec.SETRANGE("Navision Sell To Code","Sales Invoice Header"."Sell-to Customer No.");
                                  EDICustXRefRec.SETRANGE("Navision Ship To Code","Sales Invoice Header"."Ship-to Code");
                                  EDICustXRefRec.FINDFIRST;
                                  "Sales Invoice Header"."EDI Trade Partner" := "E.D.I. Send Document Hdr."."Trade Partner No.";
                                  "Sales Invoice Header"."EDI Sell-to Code"  := EDICustXRefRec."EDI Sell To Code";
                                  "Sales Invoice Header"."EDI Ship-to Code"  := EDICustXRefRec."EDI Ship To Code";
                                  "Sales Invoice Header".MODIFY;
                                END;

               DataItemLink=Document No.=FIELD(No.) }

    { 1000000002;2;DataItem;                 ;
               DataItemTable=Table14002370;
               PrintOnlyIfDetail=Yes;
               OnPreDataItem=BEGIN
                               SETFILTER(Segment,'%1|%2','N1-BT','N1-ST');
                               SETRANGE(Element, '04');
                             END;

               OnAfterGetRecord=BEGIN
                                  CASE Segment OF
                                    'N1-BT':
                                      BEGIN
                                        IF "Field Name" = 'EDI_Sell-to_Code' THEN
                                          IF ("Field Text Value" = '') AND (EDICustXRefRec."EDI Sell To Code" <> '') THEN BEGIN
                                            "Field Text Value" := EDICustXRefRec."EDI Sell To Code";
                                            "Data Error" := FALSE;
                                          END;
                                      END;

                                    'N1-ST':
                                      BEGIN
                                        IF "Field Name" = 'EDI_Ship-to_Code' THEN
                                          IF ("Field Text Value" = '') AND ( EDICustXRefRec."EDI Ship To Code" <> '') THEN BEGIN
                                            "Field Text Value" := EDICustXRefRec."EDI Ship To Code";
                                            "Data Error" := FALSE;
                                          END;
                                      END;
                                  END;
                                  MODIFY;
                                END;

               DataItemLink=No.=FIELD(No.) }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
      { 1000000000;;Container;
                  Name=Options;
                  ContainerType=ContentArea }

      { 1000000001;1;Field  ;
                  CaptionML=ENU=Execute 1st Step;
                  SourceExpr=FirstStep }

    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      EDICustXRefRec@1000000000 : Record 14002362;
      CustomerRec@1000000001 : Record 18;
      FirstStep@1000000002 : Boolean;

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}

