OBJECT Report 23044312 IWX Update Next Count Period
{
  OBJECT-PROPERTIES
  {
    Date=05/19/17;
    Time=[ 8:59:49 AM];
    Version List=IWX2.4.7684.0;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Update Next Count Period;
               ESM=Per¡odo siguiente de actualizaci¢n de cuenta;
               FRC=Mise … jour de la prochaine p‚riode de d‚compte;
               ENC=Update Next Count Period];
    ProcessingOnly=Yes;
  }
  DATASET
  {
    { 9698;    ;DataItem;diCountLine         ;
               DataItemTable=Table23044301;
               OnPreDataItem=BEGIN
                               recCountHeader.GET(GETFILTER("Count No."));

                               dlgProgress.OPEN(tcProgress);
                               dlgProgress.UPDATE(1, tcSummarizing);
                             END;

               OnAfterGetRecord=BEGIN

                                  trecInvBuf."Item No." := "Item No.";
                                  trecInvBuf."Location Code" := "Location Code";
                                  trecInvBuf."Variant Code" :=  "Variant Code";
                                  IF trecInvBuf.INSERT THEN ;
                                END;

               OnPostDataItem=BEGIN
                                updateNextCountPeriod;

                                dlgProgress.CLOSE;
                              END;

               ReqFilterFields=Count No.,Sheet Name,Item No.,Location Code,Counted }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      trecInvBuf@1000000001 : TEMPORARY Record 307;
      recCountHeader@1000000000 : Record 23044304;
      dlgProgress@1000000002 : Dialog;
      tcProgress@1000000003 : TextConst 'ENC=Updating Next Counting Period: #1##############';
      tcSummarizing@1000000004 : TextConst 'ENC=Summarizing...';
      cuPhysCountMgmt@1000000005 : Codeunit 7380;
      recItem@1000000006 : Record 27;
      recSKU@1000000007 : Record 5700;

    PROCEDURE updateNextCountPeriod@1000000002();
    BEGIN
      // Updates SKU or item card with new count period

      IF trecInvBuf.FINDSET THEN BEGIN
        cuPhysCountMgmt.SetHideValidationDialog(TRUE);
        REPEAT
          dlgProgress.UPDATE(1, trecInvBuf."Item No.");
          recSKU.RESET;
          IF recSKU.GET(trecInvBuf."Location Code", trecInvBuf."Item No.", trecInvBuf."Variant Code") THEN
            cuPhysCountMgmt.UpdateSKUPhysInvtCount(recSKU)
          ELSE BEGIN
            recItem.RESET; //<IW author="MH" date="10/9/2015" issue="TFS2019" /> for NAV2015
            recItem.GET(trecInvBuf."Item No.");
            IF (recItem."Last Counting Period Update"<>TODAY) AND (recItem."Phys Invt Counting Period Code"<>'') THEN
              cuPhysCountMgmt.UpdateItemPhysInvtCount(recItem);
          END;//if
        UNTIL trecInvBuf.NEXT = 0;
      END;//if
    END;

    BEGIN
    {
      ************************
      Copyright Notice
      This objects content is copyright of Insight Works 2011.  All rights reserved.
      Any redistribution or reproduction of part or all of the contents in any form is prohibited.
      ************************
    }
    END.
  }
  RDLDATA
  {
  }
}

