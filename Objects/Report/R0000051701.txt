OBJECT Report 51701 Suggest Location Payments
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=TPZ000.00.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Suggest Location Payments;
    ProcessingOnly=Yes;
    OnInitReport=BEGIN
                   CommSetup.GET;
                 END;

    OnPreReport=BEGIN
                  //CommLedgEntryTemp.DELETEALL;
                  ShowPostingDateWarning := FALSE;
                END;

    OnPostReport=BEGIN
                   COMMIT;
                 END;

  }
  DATASET
  {
    { 1000000000;;DataItem;Location          ;
               DataItemTable=Table14;
               DataItemTableView=WHERE(Type=FILTER(Stocking Rep.));
               OnPreDataItem=BEGIN
                               IF ShortcutDim5Code = '' THEN
                                 ERROR(Text027);

                               IF (StartingDate = 0D) THEN
                                 ERROR(Text000);

                               IF (EndingDate = 0D) THEN
                                 ERROR(Text001);

                               CommJnlLineInserted := FALSE;
                               MessageText := '';

                               Location2.COPYFILTERS(Location);

                               Window.OPEN(Text006);

                               NextEntryNo := 1;
                             END;

               OnAfterGetRecord=BEGIN
                                  Window.UPDATE(1,Code);

                                  GetSalesInvoice;
                                  GetSalesCrMemo;
                                END;

               OnPostDataItem=BEGIN
                                CommJnlLine.LOCKTABLE;
                                CommJnlTemplate.GET(CommJnlLine."Journal Template Name");
                                CommJnlBatch.GET(CommJnlLine."Journal Template Name",CommJnlLine."Journal Batch Name");
                                CommJnlLine.SETRANGE("Journal Template Name",CommJnlLine."Journal Template Name");
                                CommJnlLine.SETRANGE("Journal Batch Name",CommJnlLine."Journal Batch Name");
                                IF CommJnlLine.FINDLAST THEN BEGIN
                                  FirstLineNo := CommJnlLine."Line No.";
                                  LastLineNo := CommJnlLine."Line No.";
                                  CommJnlLine.INIT;
                                END;

                                Window2.OPEN(Text008);

                                PayableCommLedgEntry.RESET;
                                MakeCommJnlLines;
                                PayableCommLedgEntry.RESET;
                                PayableCommLedgEntry.DELETEALL;

                                Window2.CLOSE;
                                Window.CLOSE;
                                ShowMessage(MessageText);
                              END;
                               }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
      SaveValues=Yes;
      OnOpenPage=BEGIN
                   IF PostingDate = 0D THEN
                     PostingDate := WORKDATE;
                   ValidatePostingDate;
                 END;

    }
    CONTROLS
    {
      { 1900000001;0;Container;
                  ContainerType=ContentArea }

      { 1900000002;1;Group  ;
                  CaptionML=[ENU=Options;
                             ESM=Opciones;
                             FRC=Options;
                             ENC=Options];
                  GroupType=Group }

      { 8   ;2   ;Group     ;
                  CaptionML=[ENU=Fill in Journal Lines;
                             ESM=Rellenar l¡neas de diario;
                             FRC=Renseigner les lignes journal;
                             ENC=Fill in Journal Lines];
                  GroupType=Group }

      { 1000000003;3;Field  ;
                  CaptionML=ENU=Division;
                  SourceExpr=ShortcutDim5Code;
                  OnValidate=BEGIN
                               ValidateShortcutDimCode(5,ShortcutDim5Code);
                             END;

                  OnLookup=BEGIN
                             LookupShortcutDimCode(5,ShortcutDim5Code);
                           END;
                            }

      { 5   ;3   ;Field     ;
                  Name=PostingDate;
                  CaptionML=[ENU=Posting Date;
                             ESM=Fecha registro;
                             FRC=Date de report;
                             ENC=Posting Date];
                  SourceExpr=PostingDate;
                  OnValidate=BEGIN
                               ValidatePostingDate;
                             END;
                              }

      { 1000000001;3;Field  ;
                  CaptionML=ENU=Starting Date;
                  SourceExpr=StartingDate }

      { 1000000002;3;Field  ;
                  CaptionML=ENU=Ending Date;
                  SourceExpr=EndingDate }

    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU="In the Starting Date field, specify the starting date ... ";ESM=En el campo élt. fecha pago, especifique la £ltima fecha posible en la que se deben realizar los pagos.;FRC=Dans le champ DerniŠre date ‚ch‚ance, sp‚cifiez la date … laquelle les paiements doivent ˆtre effectu‚s au plus tard.;ENC=In the Last Payment Date field, specify the last possible date that payments must be made.';
      Text001@1001 : TextConst 'ENU="In the Ending Date field, specify the ending date ... ";ESM=En el campo Fecha registro, especifique la fecha que se usar  como fecha de registro para los movimientos del diario.;FRC=Dans le champ Date de report, sp‚cifiez la date qui sera utilis‚e comme date de report pour les ‚critures du journal.;ENC=In the Posting Date field, specify the date that will be used as the posting date for the journal entries.';
      Text002@1002 : TextConst 'ENU=In the Starting Document No. field, specify the first document number to be used.;ESM=En el campo N§ documento inicial, especifique el primer n£mero de documento que se debe usar.;FRC=Dans le champ Nø document d‚but, sp‚cifiez le premier num‚ro de document … utiliser.;ENC=In the Starting Document No. field, specify the first document number to be used.';
      Text003@1003 : TextConst '@@@=%1 is a date;ENU=The payment date is earlier than %1.\\Do you still want to run the batch job?;ESM=La fecha de pago es anterior a %1\.\¨Desea ejecutar el trabajo por lotes?;FRC=La date de paiement est ant‚rieure … %1.\\Voulez-vous toujours ex‚cuter le traitement en lot?;ENC=The payment date is earlier than %1.\\Do you still want to run the batch job?';
      Text005@1005 : TextConst 'ENU=The batch job was interrupted.;ESM=El proceso se ha interrumpido.;FRC=Le traitement en lot a ‚t‚ interrompu.;ENC=The batch job was interrupted.';
      Text006@1006 : TextConst 'ENU=Processing                        #1##########;ESM=Procesando proveedores                   #1##########;FRC=Traitement des fournisseurs                        #1##########;ENC=Processing vendors                       #1##########';
      Text007@1007 : TextConst 'ENU=Processing vendors for payment discounts #1##########;ESM=Procesando proveedores para dto. P.P.    #1##########;FRC=Traitement des fournisseurs pour escompte paiement #1##########;ENC=Processing vendors for payment discounts #1##########';
      Text008@1008 : TextConst 'ENU=Inserting payment journal lines          #1##########;ESM=Insertando l¡ns. diario pagos            #1##########;FRC=Ins‚rer lignes journal paiement                    #1##########;ENC=Inserting payment journal lines          #1##########';
      Text009@1009 : TextConst 'ENU=%1 must be G/L Account or Bank Account.;ESM=%1 deber¡a ser una cuenta o banco.;FRC=%1 doit ˆtre un compte GL ou un compte bancaire.;ENC=%1 must be G/L Account or Bank Account.';
      Text010@1010 : TextConst 'ENU=%1 must be filled only when %2 is Bank Account.;ESM=S¢lo se debe completar %1 si %2 es un banco.;FRC=%1 doit ˆtre compl‚t‚ seulement lorsque %2 est un compte bancaire.;ENC=%1 must be filled only when %2 is Bank Account.';
      Text011@1011 : TextConst 'ENU=Use Vendor Priority must be activated when the value in the Amount Available field is not 0.;ESM=Se debe activar utilizar prioridad prov. si el valor en el campo importe disponible no es igual a cero.;FRC=Priorit‚ par fournisseur doit ˆtre activ‚e lorsque la valeur dans le champ montant disponible n''est pas 0.;ENC=Use Vendor Priority must be activated when the value in the Amount Available field is not 0.';
      Text012@1012 : TextConst 'ENU=Starting Document No. must contain a number.;ESM=N§ documento incial debe contener un n£mero.;FRC=Nø document de d‚part doit contenir un num‚ro.;ENC=Starting Document No. must contain a number.';
      Text013@1013 : TextConst 'ENU=Use Vendor Priority must be activated when the value in the Amount Available Amount ($) field is not 0.;ESM=Se debe activar Utilizar prioridad prov. si el valor en el campo Importe disponible ($) es distinto de cero;FRC=Priorit‚ par fournisseur doit ˆtre activ‚e lorsque la valeur dans le champ montant disponible montant($) n''est pas 0.;ENC=Use Vendor Priority must be activated when the value in the Amount Available Amount ($) field is not 0.';
      Text014@1014 : TextConst 'ENU=Payment to vendor %1;ESM=Pago a proveedor %1;FRC=Paiement au fournisseur %1;ENC=Payment to vendor %1';
      Text015@1015 : TextConst 'ENU=Payment of %1 %2;ESM=Pago de %1 %2;FRC=Paiement de %1 %2;ENC=Payment of %1 %2';
      Text016@1016 : TextConst 'ENU=" is already applied to %1 %2 for vendor %3.";ESM=" ya se ha liquidado a %1 %2 para el proveedor %3.";FRC=" est d‚j… appliqu‚ … %1 %2 pour le fournisseur %3.";ENC=" is already applied to %1 %2 for vendor %3."';
      Text017@1017 : TextConst '@@@="If Bank Payment Type = Computer Check and you have not selected the Summarize per Vendor field,\ then you must select the New Doc. No. per Line.";ENU="If %1 = %2 and you have not selected the Summarize per Vendor field,\ then you must select the New Doc. No. per Line.";ESM="Si %1 = %2 y no ha seleccionado el campo Resumir por proveedor,\ debe seleccionar Nuevo n§ doc. por l¡nea.";FRC="Si %1 = %2 et si vous n''avez pas s‚lectionn‚ le champ Totaliser par fournisseur,\vous devez s‚lectionner Nouveau nø document par ligne.";ENC="If %1 = %2 and you have not selected the Summarize per Vendor field,\ then you must select the New Doc. No. per Line."';
      Text020@1020 : TextConst '@@@=You have only created suggested vendor payment lines for the Currency Code EUR.\ However, there are other open vendor ledger entries in currencies other than EUR.;ENU=You have only created suggested vendor payment lines for the %1 %2.\ However, there are other open vendor ledger entries in currencies other than %2.\\;ESM=Solo ha creado l¡neas de pago de proveedor sugeridas para el %1 %2.\ Hay, sin embargo, otros movimientos de proveedor abiertos en divisas diferentes que %2.\\;FRC=Vous n''avez cr‚‚ que les lignes de paiement fournisseur sugg‚r‚es pour  %1 %2.\Il existe toutefois d''autres ‚critures fournisseur ouvertes dans d''autres devises que %2.\\;ENC=You have only created suggested vendor payment lines for the %1 %2.\ However, there are other open vendor ledger entries in currencies other than %2.\\';
      Text021@1021 : TextConst '@@@=You have only created suggested vendor payment lines for the Currency Code EUR\ There are no other open vendor ledger entries in other currencies.\\;ENU=You have only created suggested vendor payment lines for the %1 %2.\ There are no other open vendor ledger entries in other currencies.\\;ESM=Solo ha creado l¡neas de pago de proveedor sugeridas para el %1 %2.\ No hay otros movimientos de proveedor abiertos en otras divisas.\\;FRC=Vous n''avez cr‚‚ que les lignes de paiement fournisseur sugg‚r‚es pour  %1 %2.\Il n''existe aucune autre ‚criture fournisseur ouverte dans d''autres devises.\\;ENC=You have only created suggested vendor payment lines for the %1 %2.\ There are no other open vendor ledger entries in other currencies.\\';
      Text022@1022 : TextConst 'ENU=You have created suggested vendor payment lines for all currencies.\\;ESM=Ha creado l¡neas pago proveedor sugeridas para todas las divisas.\\;FRC=Vous avez cr‚‚ des lignes de paiement fournisseur sugg‚r‚es pour toutes les devises.\\;ENC=You have created suggested vendor payment lines for all currencies.\\';
      CommSetup@1000000004 : Record 51700;
      MfrRep2@1023 : Record 50027;
      MfrRepCommExcp@1000000005 : Record 51701;
      Location2@1000000007 : Record 14;
      Customer@1000000010 : Record 18;
      CommJnlTemplate@1024 : Record 51703;
      CommJnlBatch@1025 : Record 51704;
      CommJnlLine@1026 : Record 51705;
      DimSetEntry@1027 : Record 480;
      CommJnlLine2@1028 : Record 51705;
      CommLedgEntry@1029 : Record 51709;
      CustLedgEntry@1000000000 : Record 21;
      PayableCommLedgEntry@1032 : TEMPORARY Record 51706;
      TempPaymentBuffer@1033 : TEMPORARY Record 372;
      OldTempPaymentBuffer@1034 : TEMPORARY Record 372;
      SelectedDim@1035 : Record 369;
      CommLedgEntryTemp@1102601000 : TEMPORARY Record 51707;
      NoSeriesMgt@1036 : Codeunit 396;
      VendEntryEdit@1037 : Codeunit 113;
      DimMgt@1038 : Codeunit 408;
      DimBufMgt@1018 : Codeunit 411;
      Window@1039 : Dialog;
      Window2@1004 : Dialog;
      UsePaymentDisc@1040 : Boolean;
      UsePastDue@1000000003 : Boolean;
      PostingDate@1041 : Date;
      LastDueDateToPayReq@1042 : Date;
      NextDocNo@1043 : Code[20];
      ShortcutDim5Code@1000000008 : Code[20];
      AmountAvailable@1044 : Decimal;
      OriginalAmtAvailable@1045 : Decimal;
      UsePriority@1046 : Boolean;
      SummarizePerVend@1047 : Boolean;
      SummarizePerDim@1048 : Boolean;
      SummarizePerDimText@1049 : Text[250];
      FirstLineNo@1050 : Integer;
      LastLineNo@1051 : Integer;
      NextEntryNo@1052 : Integer;
      DocNoPerLine@1054 : Boolean;
      MessageText@1058 : Text;
      CommJnlLineInserted@1059 : Boolean;
      Text023@1061 : TextConst 'ENU=" ,Computer Check,Manual Check";ESM=" ,Cheque autom tico,Cheque manual";FRC=" ,Informatique,Manuel";ENC=" ,Computer Cheque,Manual Cheque"';
      Text024@1102601001 : TextConst 'ENU=There are one or more entries for which no payment suggestions have been made because the posting dates of the entries are later than the requested posting date. Do you want to see the entries?;ESM=Existen uno o m s movimientos para los que se realizaron sugerencias de pago porque las fechas de registro de dichos movimientos son posteriores a la fecha de registro solicitada. ¨Desea ver los movimientos?;FRC=Il existe une ou plusieurs ‚critures pour lesquelles aucune suggestion de paiement n''a ‚t‚ faite car les dates de report de ces ‚critures sont post‚rieures … celle demand‚e. Voulez-vous visualiser ces ‚critures?;ENC=There are one or more entries for which no payment suggestions have been made because the posting dates of the entries are later than the requested posting date. Do you want to see the entries?';
      Text025@1063 : TextConst 'ENU=The %1 with the number %2 has a %3 with the number %4.;ESM=El %1 con el n£mero %2 tiene un %3 con el n£mero %4.;FRC=Le %1 avec le num‚ro %2 a un %3 avec le num‚ro %4.;ENC=The %1 with the number %2 has a %3 with the number %4.';
      ShowPostingDateWarning@1119 : Boolean;
      MfrRepBalance@1065 : Decimal;
      Text026@1000000006 : TextConst 'ENU=Processing locations                       #1##########;ESM=Procesando proveedores                   #1##########;FRC=Traitement des fournisseurs                        #1##########;ENC=Processing vendors                       #1##########';
      Text027@1000000009 : TextConst 'ENU=Divison must be specified.';
      ReplacePostingDateMsg@1064 : TextConst 'ENU=For one or more entries, the requested posting date is before the work date.\\These posting dates will use the work date.;ESM=Para uno o m s movimientos, la fecha de registro solicitada es anterior a la fecha de trabajo.\\Estas fechas de registro usar n la fecha de trabajo.;FRC=Pour une ou plusieurs ‚critures, la date de report demand‚e est ant‚rieure … la date de travail.\\Ces dates de report utiliseront la date de travail.;ENC=For one or more entries, the requested posting date is before the work date.\\These posting dates will use the work date.';
      PmtDiscUnavailableErr@1067 : TextConst 'ENU=You cannot use Find Payment Discounts or Summarize per Vendor together with Calculate Posting Date from Applies-to-Doc. Due Date, because the resulting posting date might not match the payment discount date.;ESM=No se puede usar Buscar dtos. P.P. o Una l¡nea por proveedor con Calcular fecha de registro a partir de fecha de vencimiento de documento de aplicaci¢n porque es posible que la fecha de registro resultante no coincida con la fecha de descuento por pronto pago.;FRC=Vous ne pouvez pas utiliser Trouver escompte de paiement ou Sommaire par fournisseur avec Calculer la date de report … partir de la date d''‚ch‚ance du doc. d''affectation, car la date de report r‚sultante pourrait ne pas correspondre … la date d''escompte de paiement.;ENC=You cannot use Find Payment Discounts or Summarize per Vendor together with Calculate Posting Date from Applies-to-Doc. Due Date, because the resulting posting date might not match the payment discount date.';
      StartingDate@1000000001 : Date;
      EndingDate@1000000002 : Date;

    PROCEDURE SetCommJnlLine@1(NewCommJnlLine@1000 : Record 51705);
    BEGIN
      CommJnlLine := NewCommJnlLine;
    END;

    LOCAL PROCEDURE ValidatePostingDate@7();
    BEGIN
      CommJnlBatch.GET(CommJnlLine."Journal Template Name",CommJnlLine."Journal Batch Name");
      IF CommJnlBatch."No. Series" = '' THEN BEGIN
        NextDocNo := NoSeriesMgt.GetNextNo(CommSetup."Nos.",PostingDate,FALSE);
        CLEAR(NoSeriesMgt);
      END ELSE BEGIN
        NextDocNo := NoSeriesMgt.GetNextNo(CommJnlBatch."No. Series",PostingDate,FALSE);
        CLEAR(NoSeriesMgt);
      END;
    END;

    PROCEDURE InitializeRequest@3(LastPmtDate@1000 : Date;FindPmtDisc@1001 : Boolean;NewAvailableAmount@1002 : Decimal;NewPostingDate@1003 : Date;NewStartDocNo@1004 : Code[20];NewSummarizePerVend@1005 : Boolean;BalAccType@1006 : 'G/L Account,Customer,Vendor,Bank Account';BalAccNo@1007 : Code[20];BankPmtType@1008 : ' ,Computer Check,Manual Check');
    BEGIN
      UsePaymentDisc := FindPmtDisc;
      PostingDate := NewPostingDate;
    END;

    PROCEDURE GetSalesInvoice@1000000010();
    VAR
      SalesInvHeader@1000000000 : Record 112;
      SalesInvLine@1000000004 : Record 113;
      PayableCommLedgEntry@1000000001 : Record 51706;
      CommAmount@1000000002 : Decimal;
      Type@1000000003 : ' ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund';
    BEGIN
      //<TPZ1949>
      Type := Type::Invoice;

      WITH SalesInvHeader DO BEGIN
        RESET;
        SETRANGE("Location Code",Location.Code);
        SETRANGE("Posting Date",StartingDate,EndingDate);
        SETRANGE("Shortcut Dimension 5 Code",ShortcutDim5Code);
        IF FINDSET THEN
          REPEAT
            CALCFIELDS("Item Amount");
            CALCFIELDS("G/L Comm. Payable Amount");
           // IF "Use Location Hdlg. Amount" <> 0 THEN
             // CommAmount := ""
            //ELSE BEGIN
              CALCFIELDS("Location Hdlg. Amount");
              CommAmount := "Location Hdlg. Amount";
            //END;

            IF CommAmount <> 0 THEN BEGIN
              InitPayableCommLedgEntry(PayableCommLedgEntry);

              PayableCommLedgEntry."Location Code" := Location.Code;

              PayableCommLedgEntry.Amount := CommAmount;
              PayableCommLedgEntry."Base Amount" := "Item Amount" + "G/L Comm. Payable Amount";
              PayableCommLedgEntry."Commission %" := "Location Hdlg. %";
              PayableCommLedgEntry."Reason Type" := PayableCommLedgEntry."Reason Type"::Invoice;
              PayableCommLedgEntry."Cust. Ledg. Entry No." := GetCustLedgEntryNo(Type,"No.","Posting Date");
              PayableCommLedgEntry."Source Document Type" := PayableCommLedgEntry."Source Document Type"::Invoice;
              PayableCommLedgEntry."Source Document No." := "No.";
              PayableCommLedgEntry."Source Document Posting Date" := "Posting Date";
              PayableCommLedgEntry."Location Code" := "Location Code";

              SaveAmount(PayableCommLedgEntry);
            END;

        UNTIL NEXT = 0;
      END;
      //</TPZ1949>
    END;

    PROCEDURE GetSalesCrMemo@1000000005();
    VAR
      SalesCrMemoHeader@1000000003 : Record 114;
      SalesCrMemoLine@1000000004 : Record 115;
      PayableCommLedgEntry@1000000002 : Record 51706;
      CommAmount@1000000001 : Decimal;
      Type@1000000000 : ' ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund';
    BEGIN
      Type := Type::"Credit Memo";

      SalesCrMemoLine.RESET;
      SalesCrMemoLine.SETRANGE("Location Code",Location.Code);
      SalesCrMemoLine.SETRANGE("Posting Date",StartingDate,EndingDate);
      SalesCrMemoLine.SETRANGE("Shortcut Dimension 5 Code",ShortcutDim5Code);
      IF SalesCrMemoLine.FINDSET THEN
        REPEAT
          IF SalesCrMemoLine."Use Location Hdlg. Amount" <> 0 THEN
            CommAmount := SalesCrMemoLine."Use Location Hdlg. Amount"
          ELSE
            CommAmount := SalesCrMemoLine."Location Hdlg. Amount";

          IF CommAmount <> 0 THEN BEGIN
            PayableCommLedgEntry.RESET;
            PayableCommLedgEntry.SETRANGE("Source Document Type",Type);
            PayableCommLedgEntry.SETRANGE("Source Document No.",SalesCrMemoLine."Document No.");
            IF PayableCommLedgEntry.FINDFIRST THEN BEGIN
              PayableCommLedgEntry.Amount := PayableCommLedgEntry.Amount - CommAmount;
              PayableCommLedgEntry."Base Amount" := PayableCommLedgEntry."Base Amount" - SalesCrMemoLine."Line Amount";
              PayableCommLedgEntry.MODIFY;
            END ELSE BEGIN
              InitPayableCommLedgEntry(PayableCommLedgEntry);

              PayableCommLedgEntry."Location Code" := Location.Code;
              PayableCommLedgEntry.Amount := -CommAmount;
              PayableCommLedgEntry."Base Amount" := -SalesCrMemoLine."Line Amount";
              PayableCommLedgEntry."Commission %" := -SalesCrMemoLine."Location Hdlg. %";
              PayableCommLedgEntry."Reason Type" := PayableCommLedgEntry."Reason Type"::"Credit Memo";
              PayableCommLedgEntry."Cust. Ledg. Entry No." := GetCustLedgEntryNo(Type,SalesCrMemoLine."Document No.",SalesCrMemoLine."Posting Date");
              PayableCommLedgEntry."Source Document Type" := PayableCommLedgEntry."Source Document Type"::"Credit Memo";
              PayableCommLedgEntry."Source Document No." := SalesCrMemoLine."Document No.";
              PayableCommLedgEntry."Source Document Posting Date" := SalesCrMemoLine."Posting Date";

              SaveAmount(PayableCommLedgEntry);
            END;
          END;
        UNTIL SalesCrMemoLine.NEXT = 0;
    END;

    PROCEDURE InitPayableCommLedgEntry@1000000000(VAR PayableCommLedgEntry@1000000000 : Record 51706);
    BEGIN
      PayableCommLedgEntry.INIT;
      PayableCommLedgEntry."Entry No." := NextEntryNo;
    END;

    LOCAL PROCEDURE SaveAmount@6(PayableCommLedgEntry@1000000000 : Record 51706);
    VAR
      PaymentToleranceMgt@1000 : Codeunit 426;
    BEGIN
      IF PayableCommLedgEntry.Amount > 0 THEN
        PayableCommLedgEntry.Positive := TRUE
      ELSE
        PayableCommLedgEntry.Positive := FALSE;

      PayableCommLedgEntry.INSERT;

      NextEntryNo := NextEntryNo + 1;
    END;

    LOCAL PROCEDURE MakeCommJnlLines@2();
    VAR
      MfrRep2@1001 : Record 50027;
      PayableCommLedgEntry@1000000000 : Record 51706;
    BEGIN
      PayableCommLedgEntry.RESET;
      IF PayableCommLedgEntry.FINDSET THEN
        REPEAT
          PayableCommLedgEntry.SETRANGE("Location Code",PayableCommLedgEntry."Location Code");
          PayableCommLedgEntry.FINDSET;
          NextDocNo := INCSTR(NextDocNo);
          REPEAT
            WITH CommJnlLine DO BEGIN
              INIT;
              Window2.UPDATE(1,PayableCommLedgEntry."Location Code");
              LastLineNo := LastLineNo + 10000;
              "Line No." := LastLineNo;
              "Posting Date" := PostingDate;
              "Account Type" := "Account Type"::Location;
              VALIDATE("Account No.",PayableCommLedgEntry."Location Code");
              "Posting No. Series" := CommJnlBatch."Posting No. Series";
              IF PayableCommLedgEntry.Amount < 0 THEN
                "Document Type" := "Document Type"::Deduction
              ELSE
                "Document Type" := "Document Type"::Payment;
              "Document No." := NextDocNo;
              "Shortcut Dimension 5 Code" := ShortcutDim5Code;
              //NextDocNo := INCSTR(NextDocNo);
              IF CustLedgEntry.GET(PayableCommLedgEntry."Cust. Ledg. Entry No.") THEN BEGIN
                "Shortcut Dimension 1 Code" := CustLedgEntry."Global Dimension 1 Code";
                "Shortcut Dimension 2 Code" := CustLedgEntry."Global Dimension 2 Code";
                "Shortcut Dimension 5 Code" := CustLedgEntry."Shortcut Dimension 5 Code";
                "External Document No." := CustLedgEntry."External Document No.";
                "Customer No." := CustLedgEntry."Sell-to Customer No.";  //TPZ2045
                IF Customer.GET("Customer No.") THEN
                  "Customer Name" := Customer.Name;
              END;
              VALIDATE(Amount,PayableCommLedgEntry.Amount);
              "Base Amount" := PayableCommLedgEntry."Base Amount";
              "Comm./Hdlg. %" := PayableCommLedgEntry."Commission %";
              "Source Document Type" := PayableCommLedgEntry."Source Document Type";
              "Source Document No." := PayableCommLedgEntry."Source Document No.";
              "Source Document Posting Date" := PayableCommLedgEntry."Source Document Posting Date";
              "Document Date" := WORKDATE;
              "Period Starting Date" := StartingDate;
              "Period Ending Date" := EndingDate;
              "External Document No." := CustLedgEntry."External Document No.";
              "Reason Type" := PayableCommLedgEntry."Reason Type";
              Description :=
                STRSUBSTNO(
                  Text015,
                  "Source Document Type",
                  "Source Document No.");

              INSERT;
              CommJnlLineInserted := TRUE;
            END;

          UNTIL PayableCommLedgEntry.NEXT = 0;
          PayableCommLedgEntry.DELETEALL;
          PayableCommLedgEntry.SETRANGE("Location Code");
        UNTIL NOT PayableCommLedgEntry.FINDSET;

      NoSeriesMgt.UpdateLastNoSeriesLine(CommSetup."Nos.",NextDocNo);
      NoSeriesMgt.SaveNoSeries;
    END;

    LOCAL PROCEDURE ShowMessage@15(Text@1000 : Text);
    BEGIN
      IF CommJnlLineInserted THEN BEGIN
        IF ShowPostingDateWarning THEN
          Text += ReplacePostingDateMsg;
        IF Text <> '' THEN
          MESSAGE(Text);
      END;
    END;

    PROCEDURE GetCustLedgEntryNo@1000000004(DocType@1000000000 : Option;DocNo@1000000001 : Code[20];PostingDate@1000000002 : Date) : Integer;
    BEGIN
      CustLedgEntry.RESET;
      CustLedgEntry.SETRANGE("Document Type",DocType);
      CustLedgEntry.SETRANGE("Document No.",DocNo);
      CustLedgEntry.SETRANGE("Posting Date",PostingDate);
      IF CustLedgEntry.FINDFIRST THEN
        EXIT(CustLedgEntry."Entry No.");

      EXIT(0);
    END;

    PROCEDURE CheckCommPaid@1000000006(DocType@1000000000 : Option;DocNo@1000000001 : Code[20];PostingDate@1000000002 : Date;Type@1000000003 : Option) : Boolean;
    VAR
      CommLedgerEntry@1000000004 : Record 51709;
    BEGIN
      CommLedgerEntry.RESET;
      CommLedgerEntry.SETRANGE("Source Document Type",DocType);
      CommLedgerEntry.SETRANGE("Source Document No.",DocNo);
      CommLedgerEntry.SETRANGE("Source Document Posting Date",PostingDate);
      CommLedgerEntry.SETRANGE("Reason Type",Type);
      IF CommLedgerEntry.FINDFIRST THEN
        EXIT(TRUE);

      EXIT(FALSE);
    END;

    PROCEDURE LookupShortcutDimCode@18(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      DimMgt.LookupDimValueCode(FieldNumber,ShortcutDimCode);
    END;

    PROCEDURE ValidateShortcutDimCode@1000000001(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      DimMgt.ValidateDimValueCode(FieldNumber,ShortcutDimCode);
    END;

    BEGIN
    {
      2015-05-11 TPZ92 TAKHMETO
        Report has been created
      2017-08-01 TPZ1976 EBAGIM
        Recalcualte commission sales amount to match Mfr Rep
      2017-10-23 TPZ2045 EBAGIM
        Change bill-to to Sell-to for Location Rep statments
    }
    END.
  }
  RDLDATA
  {
  }
}

