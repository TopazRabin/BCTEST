OBJECT Report 14050308 Export E.D.I. Send Docs. Job
{
  OBJECT-PROPERTIES
  {
    Date=03/06/15;
    Time=12:00:00 PM;
    Version List=SE0.60.06;
  }
  PROPERTIES
  {
    CaptionML=ENU=Export E.D.I. Send Documents Job;
    ProcessingOnly=Yes;
    OnPreReport=BEGIN
                  CompanyInformation.GET;
                END;

    UseRequestPage=No;
  }
  DATASET
  {
    { 2284;    ;DataItem;                    ;
               DataItemTable=Table14050305 }

    { 1529;    ;DataItem;                    ;
               DataItemTable=Table14002360;
               OnPreDataItem=BEGIN
                               "E.D.I. Trade Partner".SETFILTER("No.","E.D.I. Job Routine"."Trade Partner Filter");
                               "E.D.I. Trade Partner".SETFILTER("Company Name","E.D.I. Job Routine"."Company Filter");
                             END;

               ReqFilterFields=No. }

    { 1534;1   ;DataItem;                    ;
               DataItemTable=Table14002353;
               DataItemTableView=SORTING(Trade Partner No.,Navision Document,EDI Document No.,Version,Type)
                                 WHERE(Type=CONST(Export),
                                       Status=FILTER(<>Inactive));
               OnPreDataItem=BEGIN
                               "E.D.I. Document".SETFILTER("EDI Document No.","E.D.I. Job Routine"."EDI Document No. Filter");
                               "E.D.I. Document".SETFILTER("Navision Document","E.D.I. Job Routine"."Navision Document Filter");
                             END;

               OnAfterGetRecord=BEGIN
                                  EDIManagement.CreateOutboundLogEntry(Text001,LogEntryNo,'SEND DOCUMENT','',"E.D.I. Trade Partner"."No.",
                                  "E.D.I. Document"."Navision Document","E.D.I. Document"."EDI Document No.");
                                  COMMIT;

                                  CLEARLASTERROR;
                                  IF EDISend.RUN("E.D.I. Document") THEN
                                    DeleteLog := TRUE
                                  ELSE
                                   DeleteLog := FALSE;
                                  COMMIT;

                                  IF DeleteLog THEN
                                    EDIManagement.DeleteOutboundLogEntry(LogEntryNo)
                                  ELSE BEGIN
                                    ErrorText := '';
                                    ErrorText := COPYSTR(GETLASTERRORTEXT,1,250);
                                    EDIManagement.CloseOutboundLogEntry(LogEntryNo,ErrorText);
                                  END;
                                  COMMIT;
                                END;

               ReqFilterFields=Navision Document;
               DataItemLink=Trade Partner No.=FIELD(No.) }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      CompanyInformation@1240030000 : Record 79;
      EDIManagement@1240020002 : Codeunit 14002379;
      EDISend@1240030001 : Codeunit 14002356;
      Text001@1001 : TextConst 'ENU=Send Document Export';
      DeleteLog@1240020000 : Boolean;
      LogEntryNo@1240020001 : Integer;
      ErrorText@1240020003 : Text[250];

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}

