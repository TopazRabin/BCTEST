OBJECT Report 14050319 Send E.D.I. Transfer Ship Job
{
  OBJECT-PROPERTIES
  {
    Date=04/28/17;
    Time=12:00:00 PM;
    Version List=SE0.60.13.02;
  }
  PROPERTIES
  {
    CaptionML=ENU=Send E.D.I. Transfer Ship Job;
    ShowPrintStatus=Yes;
    ProcessingOnly=Yes;
    OnInitReport=BEGIN
                   CLEARALL;
                 END;

    OnPreReport=BEGIN
                  CompanyInformation.GET;
                  EDISetup.GET;
                END;

    UseRequestPage=No;
  }
  DATASET
  {
    { 6030;    ;DataItem;                    ;
               DataItemTable=Table5744;
               DataItemTableView=SORTING(EDI Order,EDI Trade Partner,EDI Internal Doc. No.)
                                 WHERE(EDI Order=CONST(Yes),
                                       EDI Transfer Shipment Gen.=CONST(No));
               OnAfterGetRecord=BEGIN
                                  EDITradePartner.INIT;
                                  NavisionDocument := 'E_TFRSHP';

                                  IF Location.GET("Transfer-from Code") THEN
                                    IF EDITradePartner.GET(Location."EDI Transfer Trade Partner") THEN BEGIN
                                      EDIDocument.RESET;
                                      EDIDocument.SETRANGE("Trade Partner No.",EDITradePartner."No.");
                                      EDIDocument.SETFILTER(Status,'%1|%2',EDIDocument.Status::Test,EDIDocument.Status::Production);
                                      EDIDocument.SETRANGE(EDIDocument."Navision Document",'E_TFRSHP');
                                      IF EDIDocument.FIND THEN
                                        NavisionDocument := EDIDocument."Navision Document"
                                    END;

                                  EDIManagement.CreateOutboundLogEntry(
                                    Text001,LogEntryNo,'TRANSFER SHIPMENT',"Transfer Shipment Header"."No.",EDITradePartner."No.",
                                    NavisionDocument,EDIDocument."EDI Document No.");
                                  COMMIT;

                                  CLEARLASTERROR;
                                  CLEAR(EDISendTransferShipment);
                                  IF EDISendTransferShipment.RUN("Transfer Shipment Header") THEN
                                    DeleteLog := TRUE
                                  ELSE
                                    DeleteLog := FALSE;
                                  COMMIT;

                                  IF DeleteLog THEN
                                    EDIManagement.DeleteOutboundLogEntry(LogEntryNo)
                                  ELSE BEGIN
                                    ErrorText := '';
                                    ErrorText := COPYSTR(GETLASTERRORTEXT,1,250);
                                    EDIManagement.CloseOutboundLogEntry(LogEntryNo,ErrorText);
                                  END;
                                  COMMIT;

                                  CLEAR(Range);
                                  IF EDISetup."Auto Export Send Doc." THEN BEGIN
                                    IF Location.GET("Transfer-from Code") THEN BEGIN
                                      IF EDITradePartner.GET(Location."EDI Transfer Trade Partner") THEN BEGIN
                                        TransferfromTP := Location."EDI Transfer Trade Partner";
                                        Range := Range + EDITradePartner."No." + '|';
                                      END;
                                    END;
                                    IF "Transfer-from Code" <> "Transfer-to Code" THEN BEGIN
                                      IF Location.GET("Transfer-to Code") THEN
                                        IF EDITradePartner.GET(Location."EDI Transfer Trade Partner") THEN BEGIN
                                          TransfertoTP := Location."EDI Transfer Trade Partner";
                                          Range := Range + EDITradePartner."No." + '|';
                                        END;
                                    END;
                                    IF STRLEN(Range) > 0 THEN
                                      Range := COPYSTR(Range,1,STRLEN(Range) - 1)
                                    ELSE
                                      CurrReport.SKIP;

                                    EDITradePartner.RESET;
                                    EDITradePartner.SETFILTER("No.",Range);
                                    IF EDITradePartner.FIND('-') THEN
                                      REPEAT
                                        EDIDocument.RESET;
                                        EDIDocument.SETRANGE("Trade Partner No.",EDITradePartner."No.");
                                        EDIDocument.SETRANGE("Navision Document",'E_TFRSHP');
                                        IF EDIDocument.FIND('-') THEN BEGIN
                                          EDIManagement.CreateOutboundLogEntry(Text002,LogEntryNo,'SEND DOCUMENT','',EDITradePartner."No.",
                                            EDIDocument."Navision Document",EDIDocument."EDI Document No.");
                                          COMMIT;

                                          CLEARLASTERROR;
                                          IF EDISend.RUN(EDIDocument) THEN
                                            DeleteLog := TRUE
                                          ELSE
                                            DeleteLog := FALSE;
                                          COMMIT;

                                          IF DeleteLog THEN
                                            EDIManagement.DeleteOutboundLogEntry(LogEntryNo)
                                          ELSE BEGIN
                                            ErrorText := '';
                                            ErrorText := COPYSTR(GETLASTERRORTEXT,1,250);
                                            EDIManagement.CloseOutboundLogEntry(LogEntryNo,ErrorText);
                                          END;
                                          COMMIT;
                                        END;
                                      UNTIL EDITradePartner.NEXT = 0;
                                  END;
                                END;

               ReqFilterFields=No. }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      CompanyInformation@1240030000 : Record 79;
      EDISetup@1240030004 : Record 14002367;
      EDIDocument@1240030006 : Record 14002353;
      EDITradePartner@1240030005 : Record 14002360;
      Location@1240020002 : Record 14;
      EDISendTransferShipment@1240030001 : Codeunit 14050911;
      EDISend@1240030007 : Codeunit 14002356;
      EDIManagement@1240020007 : Codeunit 14002379;
      DeleteLog@1240030002 : Boolean;
      LogEntryNo@1240030003 : Integer;
      Text001@1001 : TextConst 'ENU=Create EDI Transfer Shipment';
      TransferfromTP@1240020004 : Code[20];
      TransfertoTP@1240020005 : Code[20];
      ErrorText@1240030008 : Text[250];
      Text002@1004 : TextConst 'ENU=Send EDI Transfer Shipment';
      Range@1240020003 : Text[40];
      NavisionDocument@1240020000 : Code[10];

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}

