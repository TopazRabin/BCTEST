OBJECT XMLport 50008 ImportItemJnl-Bins
{
  OBJECT-PROPERTIES
  {
    Date=01/26/21;
    Time=[ 9:52:43 AM];
    Modified=Yes;
    Version List=TOP190;
  }
  PROPERTIES
  {
    PreserveWhiteSpace=Yes;
    OnInitXMLport=BEGIN
                    LineNo:=0;
                    ItemTemplate:='ITEM';
                    ItemBatch:='DEFAULT';
                    PostingDate:=TODAY;
                  END;

    Format=Variable Text;
    FieldDelimiter=<None>;
    FieldSeparator=<TAB>;
  }
  ELEMENTS
  {
    { [{2E685AC5-1B3E-47E6-B065-93C6E719DDC8}];  ;ROOT                ;Element ;Text     }

    { [{38669EDA-EFB4-4FBF-A3AE-3077FF9FC79F}];1 ;ItemJnl             ;Element ;Table   ;
                                                  SourceTable=Table83;
                                                  Import::OnAfterInitRecord=BEGIN
                                                                                "Item Journal Line"."Journal Template Name":=ItemTemplate;
                                                                                "Item Journal Line"."Journal Batch Name":= ItemBatch;
                                                                                LineNo+=1000;
                                                                                "Item Journal Line"."Line No.":=LineNo;
                                                                                "Item Journal Line"."Entry Type":="Item Journal Line"."Entry Type"::"Positive Adjmt.";
                                                                                "Item Journal Line"."Document No.":=DocumentNo;
                                                                            END;

                                                  Import::OnBeforeInsertRecord=BEGIN
                                                                                 //IF "Item Journal Line".Quantity <= 0 THEN
                                                                                 //  currXMLport.SKIP;
                                                                                 "Item Journal Line".VALIDATE("Posting Date",PostingDate);

                                                                                 //"Item Journal Line".VALIDATE("Item No.");
                                                                                 IF LocRec.GET(LocationCode) THEN BEGIN
                                                                                   IF LocationMapping.GET(LocationCode) AND (LocationMapping."No." <> '') THEN
                                                                                     "Item Journal Line".VALIDATE("Location Code",LocationMapping."No.")
                                                                                   ELSE
                                                                                     "Item Journal Line".VALIDATE("Location Code",LocationCode);
                                                                                 END ELSE BEGIN
                                                                                   IF LocationMapping.GET(LocationCode) AND (LocationMapping."No." <> '') THEN
                                                                                     "Item Journal Line".VALIDATE("Location Code",LocationMapping."No.")
                                                                                   ELSE
                                                                                     "Item Journal Line"."Location Code" := LocationCode
                                                                                 END;

                                                                                 IF IgnoreAdjBin THEN
                                                                                   IF BinCode = 'ADJ' THEN
                                                                                     currXMLport.SKIP;

                                                                                 IF BinCode <> '' THEN BEGIN
                                                                                   //IF ("Item Journal Line"."Entry Type" = "Item Journal Line"."Entry Type"::"Positive Adjmt.") OR ("Item Journal Line".Quantity > 0) THEN BEGIN
                                                                                   IF ("Item Journal Line".Quantity > 0) THEN BEGIN
                                                                                     IF NOT BinRec.GET("Item Journal Line"."Location Code",BinCode) THEN BEGIN
                                                                                       BinRec1.INIT;
                                                                                       BinRec1."Location Code" := "Item Journal Line"."Location Code";
                                                                                       BinRec1.Code := BinCode;
                                                                                       BinRec1.Description := 'On The Fly';
                                                                                       BinRec1.INSERT;
                                                                                     END;
                                                                                   //END ELSE IF ("Item Journal Line"."Entry Type" = "Item Journal Line"."Entry Type"::"Negative Adjmt.") OR ("Item Journal Line".Quantity < 0) THEN BEGIN
                                                                                   END ELSE IF ("Item Journal Line".Quantity < 0) THEN BEGIN
                                                                                     IF NOT BinContent.GET("Item Journal Line"."Location Code",BinCode,"Item Journal Line"."Item No.",'',BaseUOM) THEN BEGIN
                                                                                       IF NOT BinRec.GET("Item Journal Line"."Location Code",BinCode) THEN BEGIN
                                                                                         BinRec1.INIT;
                                                                                         BinRec1."Location Code" := "Item Journal Line"."Location Code";
                                                                                         BinRec1.Code := BinCode;
                                                                                         BinRec1.Description := 'On The Fly';
                                                                                         BinRec1.INSERT;
                                                                                       END;
                                                                                       BinContent1.INIT;
                                                                                       BinContent1."Location Code" := "Item Journal Line"."Location Code";
                                                                                       BinContent1."Bin Code" := BinCode;
                                                                                       BinContent1."Item No." := "Item Journal Line"."Item No.";
                                                                                       BinContent1."Unit of Measure Code" := BaseUOM;
                                                                                       BinContent1."Zone Code" := 'PICKPUT';
                                                                                       BinContent1."Bin Type Code" := 'PICKPUT';
                                                                                       BinContent1."Bin Ranking" := 150;
                                                                                       BinContent1.INSERT;
                                                                                     END;
                                                                                   END;

                                                                                   "Item Journal Line".VALIDATE("Bin Code",BinCode);
                                                                                 END;

                                                                                 IF AssignDefBin AND (BinCode = '') THEN BEGIN
                                                                                   IF ("Item Journal Line".Quantity > 0) THEN BEGIN
                                                                                     IF NOT BinRec.GET("Item Journal Line"."Location Code",'ADJ1') THEN BEGIN
                                                                                       BinRec1.INIT;
                                                                                       BinRec1."Location Code" := "Item Journal Line"."Location Code";
                                                                                       BinRec1.Code := 'ADJ1';
                                                                                       BinRec1.Description := 'On The Fly';
                                                                                       BinRec1.INSERT;
                                                                                     END;
                                                                                   //END ELSE IF ("Item Journal Line"."Entry Type" = "Item Journal Line"."Entry Type"::"Negative Adjmt.") OR ("Item Journal Line".Quantity < 0) THEN BEGIN
                                                                                   END ELSE IF ("Item Journal Line".Quantity < 0) THEN BEGIN
                                                                                     IF NOT BinContent.GET("Item Journal Line"."Location Code",'ADJ1',"Item Journal Line"."Item No.",'',BaseUOM) THEN BEGIN
                                                                                       IF NOT BinRec.GET("Item Journal Line"."Location Code",'ADJ1') THEN BEGIN
                                                                                         BinRec1.INIT;
                                                                                         BinRec1."Location Code" := "Item Journal Line"."Location Code";
                                                                                         BinRec1.Code := 'ADJ1';
                                                                                         BinRec1.Description := 'On The Fly';
                                                                                         BinRec1.INSERT;
                                                                                       END;
                                                                                       BinContent1.INIT;
                                                                                       BinContent1."Location Code" := "Item Journal Line"."Location Code";
                                                                                       BinContent1."Bin Code" := 'ADJ1';
                                                                                       BinContent1."Item No." := "Item Journal Line"."Item No.";
                                                                                       BinContent1."Unit of Measure Code" := BaseUOM;
                                                                                       BinContent1."Zone Code" := 'PICKPUT';
                                                                                       BinContent1."Bin Type Code" := 'PICKPUT';
                                                                                       BinContent1."Bin Ranking" := 140;
                                                                                       BinContent1.INSERT;
                                                                                     END;
                                                                                   END;


                                                                                   "Item Journal Line".VALIDATE("Bin Code",'ADJ1');

                                                                                 END;


                                                                                 EvalUnitCost := 0;
                                                                                 IF UnitCost <> '' THEN BEGIN
                                                                                   IF EVALUATE(EvalUnitCost,UnitCost) THEN BEGIN
                                                                                     "Item Journal Line"."Unit Cost" := EvalUnitCost;
                                                                                     "Item Journal Line"."Unit Amount" := EvalUnitCost;
                                                                                     //"Item Journal Line".UpdateAmount;  //PKS commented line and added new code to update amount, since the updateamount is local function in table
                                                                                     "Item Journal Line".Amount := ROUND("Item Journal Line".Quantity * "Item Journal Line"."Unit Amount");  //PKS
                                                                                   END;
                                                                                 END;
                                                                               END;
                                                                                }

    { [{E96BC882-6EFE-49E2-872D-7C4DD2003672}];2 ;LocationCode        ;Element ;Text    ;
                                                  DataType=Code }

    { [{1D932EB0-E54D-4D98-92FD-A0C915B26AE5}];2 ;ItemNo              ;Element ;Field   ;
                                                  DataType=Code;
                                                  SourceField=Item Journal Line::Item No. }

    { [{430DD5F6-CB7E-44BD-B20E-38B2B94D8F52}];2 ;BaseUOM             ;Element ;Text     }

    { [{064EBA48-5E43-4365-AEE4-4736DD36361C}];2 ;UnitCost            ;Element ;Text    ;
                                                  DataType=Decimal }

    { [{BB0DB15F-1632-4F51-ACAA-7C39DFE1BA6E}];2 ;BinCode             ;Element ;Text     }

    { [{1AD85154-8C4A-49C0-B580-3FD7A5577F49}];2 ;Qty                 ;Element ;Field   ;
                                                  DataType=Decimal;
                                                  SourceField=Item Journal Line::Quantity }

  }
  EVENTS
  {
  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
      { 1000000000;;Container;
                  Name=options;
                  ContainerType=ContentArea }

      { 1000000001;1;Field  ;
                  CaptionML=ENU=Item Jnl. Batch Name;
                  SourceExpr=ItemBatch;
                  TableRelation="Item Journal Batch".Name WHERE (Journal Template Name=FILTER(ITEM)) }

      { 1000000002;1;Field  ;
                  CaptionML=ENU=Posting Date;
                  SourceExpr=PostingDate }

      { 1000000003;1;Field  ;
                  CaptionML=ENU=Document No.;
                  SourceExpr=DocumentNo }

      { 1000000004;1;Field  ;
                  CaptionML=ENU=Assign Default Bin when Blank;
                  SourceExpr=AssignDefBin }

      { 1000000006;1;Field  ;
                  CaptionML=ENU=Ignore Adj Bin Lines;
                  SourceExpr=IgnoreAdjBin }

    }
  }
  CODE
  {
    VAR
      LineNo@1000000000 : Integer;
      ItemTemplate@1000000001 : Code[10];
      ItemBatch@1000000002 : Code[10];
      PostingDate@1000000003 : Date;
      DocumentNo@1000000004 : Code[20];
      LocRec@1000000005 : Record 14;
      ItemJnlLine@1000000006 : Record 83;
      LocationMapping@1000000007 : Record 50009;
      IJB@1000000008 : Record 233;
      EvalUnitCost@1000000009 : Decimal;
      AssignDefBin@1000000010 : Boolean;
      BinRec@1000000011 : Record 7354;
      BinRec1@1000000012 : Record 7354;
      BinContent@1000000013 : Record 7302;
      BinContent1@1000000014 : Record 7302;
      IgnoreAdjBin@1000000015 : Boolean;

    BEGIN
    END.
  }
}

