OBJECT Page 346 Item Picture
{
  OBJECT-PROPERTIES
  {
    Date=10/22/20;
    Time=[ 4:57:39 AM];
    Version List=NAVW111.00.00.33015;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Item Picture;
               ESM=Imagen prod.;
               FRC=Image de l'article;
               ENC=Item Picture];
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    SourceTable=Table27;
    PageType=CardPart;
    OnOpenPage=BEGIN
                 //{=======} MODIFIED
                 //{=======} TARGET
                 CameraAvailable := CameraProvider.IsAvailable;
                 IF CameraAvailable THEN
                   CameraProvider := CameraProvider.Create;
                 {<<<<<<<}
                 ;ESACC_EasySecurity(TRUE);
               END;

    OnAfterGetCurrRecord=BEGIN
                           SetEditableOnPictureActions;
                         END;

    ActionList=ACTIONS
    {
      { 2       ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 3       ;1   ;Action    ;
                      Name=TakePicture;
                      CaptionML=[ENU=Take;
                                 ESM=Hacer;
                                 FRC=Pr‚lever;
                                 ENC=Take];
                      ToolTipML=[ENU=Activate the camera on the device.;
                                 ESM=Activa la c mara en el dispositivo.;
                                 FRC=Activez la cam‚ra sur l'appareil.;
                                 ENC=Activate the camera on the device.];
                      ApplicationArea=#All;
                      Promoted=Yes;
                      Visible=ESACC_C3_Visible AND (CameraAvailable AND (HideActions = FALSE));
                      Enabled=ESACC_C3_Enabled;
                      PromotedIsBig=Yes;
                      Image=Camera;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 TakeNewPicture;
                               END;
                                }
      { 4       ;1   ;Action    ;
                      Name=ImportPicture;
                      CaptionML=[ENU=Import;
                                 ESM=Importar;
                                 FRC=Importer;
                                 ENC=Import];
                      ToolTipML=[ENU=Import a picture file.;
                                 ESM=Importa un archivo de imagen.;
                                 FRC=Importez un fichier image.;
                                 ENC=Import a picture file.];
                      ApplicationArea=#All;
                      Visible=ESACC_C4_Visible AND (HideActions = FALSE);
                      Enabled=ESACC_C4_Enabled;
                      Image=Import;
                      OnAction=BEGIN
                                 ImportFromDevice;
                               END;
                                }
      { 6       ;1   ;Action    ;
                      Name=ExportFile;
                      CaptionML=[ENU=Export;
                                 ESM=Exportar;
                                 FRC=Exporter;
                                 ENC=Export];
                      ToolTipML=[ENU=Export the picture to a file.;
                                 ESM=Exporta la imagen a un archivo.;
                                 FRC=Exportez l'image vers un fichier.;
                                 ENC=Export the picture to a file.];
                      ApplicationArea=#All;
                      Visible=ESACC_C6_Visible AND ((CameraAvailable = FALSE) AND (HideActions = FALSE));
                      Enabled=ESACC_C6_Enabled AND (DeleteExportEnabled);
                      Image=Export;
                      OnAction=VAR
                                 NameValueBuffer@1002 : Record 823;
                                 TempNameValueBuffer@1004 : TEMPORARY Record 823;
                                 FileManagement@1001 : Codeunit 419;
                                 ToFile@1003 : Text;
                                 ExportPath@1005 : Text;
                               BEGIN
                                 TESTFIELD("No.");
                                 TESTFIELD(Description);

                                 NameValueBuffer.DELETEALL;
                                 ExportPath := TEMPORARYPATH + "No." + FORMAT(Picture.MEDIAID);
                                 Picture.EXPORTFILE(ExportPath + '.jpg');
                                 FileManagement.GetServerDirectoryFilesList(TempNameValueBuffer,TEMPORARYPATH);
                                 TempNameValueBuffer.SETFILTER(Name,STRSUBSTNO('%1*',ExportPath));
                                 TempNameValueBuffer.FINDFIRST;
                                 ToFile := STRSUBSTNO('%1 %2.jpg',"No.",CONVERTSTR(Description,'"/\','___'));
                                 DOWNLOAD(TempNameValueBuffer.Name,DownloadImageTxt,'','',ToFile);
                                 IF FileManagement.DeleteServerFile(TempNameValueBuffer.Name) THEN;
                               END;
                                }
      { 7       ;1   ;Action    ;
                      Name=DeletePicture;
                      CaptionML=[ENU=Delete;
                                 ESM=Eliminar;
                                 FRC=Supprimer;
                                 ENC=Delete];
                      ToolTipML=[ENU=Delete the record.;
                                 ESM=Elimina el registro.;
                                 FRC=Supprimez l'enregistrement.;
                                 ENC=Delete the record.];
                      ApplicationArea=#All;
                      Visible=ESACC_C7_Visible AND (HideActions = FALSE);
                      Enabled=ESACC_C7_Enabled AND (DeleteExportEnabled);
                      Image=Delete;
                      OnAction=BEGIN
                                 DeleteItemPicture;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Field     ;
                ToolTipML=[ENU=Specifies the picture that has been inserted for the item.;
                           ESM=Especifica la imagen insertada para el producto.;
                           FRC=Sp‚cifie l'image qui a ‚t‚ ins‚r‚e pour cet article.;
                           ENC=Specifies the picture that has been inserted for the item.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=Picture;
                Visible=ESACC_F92_Visible;
                Editable=ESACC_F92_Editable;
                HideValue=ESACC_F92_HideValue;
                ShowCaption=No }

  }
  CODE
  {
    VAR
      ESACC_ESFLADSMgt@14123801 : Codeunit 14123801;
      ESACC_C3_Visible@905000030 : Boolean INDATASET;
      ESACC_C3_Enabled@905000033 : Boolean INDATASET;
      ESACC_C4_Visible@905000040 : Boolean INDATASET;
      ESACC_C4_Enabled@905000043 : Boolean INDATASET;
      ESACC_C6_Visible@905000060 : Boolean INDATASET;
      ESACC_C6_Enabled@905000063 : Boolean INDATASET;
      ESACC_C7_Visible@905000070 : Boolean INDATASET;
      ESACC_C7_Enabled@905000073 : Boolean INDATASET;
      ESACC_F92_Visible@900000920 : Boolean INDATASET;
      ESACC_F92_Editable@900000921 : Boolean INDATASET;
      ESACC_F92_HideValue@900000922 : Boolean INDATASET;
      CameraProvider@1000 : DotNet "'Microsoft.Dynamics.Nav.ClientExtensions, Version=11.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Client.Capabilities.CameraProvider" WITHEVENTS RUNONCLIENT;
      CameraAvailable@1002 : Boolean;
      OverrideImageQst@1007 : TextConst 'ENU=The existing picture will be replaced. Do you want to continue?;ESM=Se sustituir  la imagen existente. ¨Quiere continuar?;FRC=L''image existante sera remplac‚e. Voulez-vous continuerÿ?;ENC=The existing picture will be replaced. Do you want to continue?';
      DeleteImageQst@1003 : TextConst 'ENU=Are you sure you want to delete the picture?;ESM=¨Est  seguro de que desea eliminar la imagen?;FRC=Voulez-vous vraiment supprimer l''imageÿ?;ENC=Are you sure you want to delete the picture?';
      SelectPictureTxt@1001 : TextConst 'ENU=Select a picture to upload;ESM=Seleccionar una imagen para cargar;FRC=S‚lectionner une image … charger;ENC=Select a picture to upload';
      DeleteExportEnabled@1005 : Boolean;
      DownloadImageTxt@1006 : TextConst 'ENU=Download image;ESM=Descargar imagen;FRC=T‚l‚charger image;ENC=Download image';
      HideActions@1008 : Boolean;

    LOCAL PROCEDURE ESACC_EasySecurity@14123801(OpenObject@14123801 : Boolean);
    VAR
      SetFilters@14123802 : Codeunit 14123812;
      TempBoolean@14123803 : Boolean;
    BEGIN
      IF OpenObject THEN BEGIN
        SetFilters.Filter27(Rec,8,346);

        TempBoolean := CurrPage.EDITABLE;
        IF ESACC_ESFLADSMgt.PageGeneral(27,346,TempBoolean) THEN
          CurrPage.EDITABLE := TempBoolean;
      END;

      ESACC_ESFLADSMgt.PageControl(
        27,346,1,3,
        ESACC_C3_Visible,ESACC_C3_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        27,346,1,4,
        ESACC_C4_Visible,ESACC_C4_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        27,346,1,6,
        ESACC_C6_Visible,ESACC_C6_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        27,346,1,7,
        ESACC_C7_Visible,ESACC_C7_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        27,346,0,92,
        ESACC_F92_Visible,ESACC_F92_Editable,ESACC_F92_HideValue);

      ESACC_EasySecurityManual(OpenObject);
    END;

    LOCAL PROCEDURE ESACC_EasySecurityManual@14123811(OpenObject@14123811 : Boolean);
    BEGIN
    END;

    [External]
    PROCEDURE TakeNewPicture@2();
    VAR
      CameraOptions@1000 : DotNet "'Microsoft.Dynamics.Nav.ClientExtensions, Version=11.0.0.0, Culture=neutral, PublicKeyToken=31bf3856ad364e35'.Microsoft.Dynamics.Nav.Client.Capabilities.CameraOptions";
    BEGIN
      FIND;
      TESTFIELD("No.");
      TESTFIELD(Description);

      IF NOT CameraAvailable THEN
        EXIT;

      CameraOptions := CameraOptions.CameraOptions;
      CameraOptions.Quality := 50;
      CameraProvider.RequestPictureAsync(CameraOptions);
    END;

    [External]
    PROCEDURE ImportFromDevice@4();
    VAR
      FileManagement@1002 : Codeunit 419;
      FileName@1001 : Text;
      ClientFileName@1000 : Text;
    BEGIN
      FIND;
      TESTFIELD("No.");
      TESTFIELD(Description);

      IF Picture.COUNT > 0 THEN
        IF NOT CONFIRM(OverrideImageQst) THEN
          ERROR('');

      ClientFileName := '';
      FileName := FileManagement.UploadFile(SelectPictureTxt,ClientFileName);
      IF FileName = '' THEN
        ERROR('');

      CLEAR(Picture);
      Picture.IMPORTFILE(FileName,ClientFileName);
      MODIFY(TRUE);

      IF FileManagement.DeleteServerFile(FileName) THEN;
    END;

    LOCAL PROCEDURE SetEditableOnPictureActions@1();
    BEGIN
      DeleteExportEnabled := Picture.COUNT <> 0;
    END;

    [External]
    PROCEDURE IsCameraAvailable@3() : Boolean;
    BEGIN
      EXIT(CameraProvider.IsAvailable);
    END;

    [External]
    PROCEDURE SetHideActions@1010();
    BEGIN
      HideActions := TRUE;
    END;

    PROCEDURE DeleteItemPicture@5();
    BEGIN
      TESTFIELD("No.");

      IF NOT CONFIRM(DeleteImageQst) THEN
        EXIT;

      CLEAR(Picture);
      MODIFY(TRUE);
    END;

    EVENT CameraProvider@1000::PictureAvailable@10(PictureName@1001 : Text;PictureFilePath@1000 : Text);
    VAR
      File@1003 : File;
      Instream@1004 : InStream;
    BEGIN
      IF (PictureName = '') OR (PictureFilePath = '') THEN
        EXIT;

      IF Picture.COUNT > 0 THEN
        IF NOT CONFIRM(OverrideImageQst) THEN BEGIN
          IF ERASE(PictureFilePath) THEN;
          EXIT;
        END;

      File.OPEN(PictureFilePath);
      File.CREATEINSTREAM(Instream);

      CLEAR(Picture);
      Picture.IMPORTSTREAM(Instream,PictureName);
      IF NOT MODIFY(TRUE) THEN
        INSERT(TRUE);

      File.CLOSE;
      IF ERASE(PictureFilePath) THEN;
    END;

    BEGIN
    END.
  }
}

