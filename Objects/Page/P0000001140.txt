OBJECT Page 1140 OAuth 2.0 Setup
{
  OBJECT-PROPERTIES
  {
    Date=07/26/19;
    Time=12:00:00 PM;
    Version List=NAVW111.00.00.34561;
  }
  PROPERTIES
  {
    CaptionML=[ENU=OAuth 2.0 Setup;
               ESM=Configuraci¢n de OAuth 2.0;
               FRC=Configuration OAuth 2.0;
               ENC=OAuth 2.0 Setup];
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    SourceTable=Table1140;
    ShowFilter=No;
    OnOpenPage=BEGIN
                 ClientID := "Client ID";
                 ClientSecret := "Client Secret";
               END;

    ActionList=ACTIONS
    {
      { 7       ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 11      ;1   ;Action    ;
                      Name=RequestAuthorizationCode;
                      CaptionML=[ENU=Request Authorization Code;
                                 ESM=C¢digo de autorizaci¢n de solicitud;
                                 FRC=Demander le code d'autorisation;
                                 ENC=Request Authorization Code];
                      ToolTipML=[ENU=Open the service authorization web page. Login credentials will be prompted. The authorization code must be copied into the Enter Authorization Code field.;
                                 ESM=Permite abrir la p gina web de autorizaci¢n de servicio. Se pedir n las credenciales de inicio de sesi¢n. Debe copiar el c¢digo de autorizaci¢n en el campo Introduzca el c¢digo de autorizaci¢n.;
                                 FRC=Ouvrez la page web du service d'autorisation. Vous serez invit‚ … entrer les informations d'identification. Le code d'autorisation doit ˆtre copi‚ dans le champ Entrer le code d'autorisation.;
                                 ENC=Open the service authorization web page. Login credentials will be prompted. The authorization code must be copied into the Enter Authorization Code field.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=EncryptionKeys;
                      PromotedCategory=Process;
                      PromotedOnly=Yes;
                      OnAction=BEGIN
                                 RequestAuthorizationCode;
                                 RequestAuthorizationCodeInvoked := TRUE;
                               END;
                                }
      { 17      ;1   ;Action    ;
                      Name=RefreshAccessToken;
                      CaptionML=[ENU=Refresh Access Token;
                                 ESM=Actualizar el token de acceso;
                                 FRC=Actualiser le jeton d'accŠs;
                                 ENC=Refresh Access Token];
                      ToolTipML=[ENU=Refresh the access and refresh tokens.;
                                 ESM=Permite actualizar los tokens de actualizaci¢n y acceso.;
                                 FRC=Actualisez les jetons d'accŠs et d'actualisation.;
                                 ENC=Refresh the access and refresh tokens.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=Refresh;
                      PromotedCategory=Process;
                      PromotedOnly=Yes;
                      OnAction=VAR
                                 MessageText@1003 : Text;
                               BEGIN
                                 IF NOT RefreshAccessToken(MessageText) THEN BEGIN
                                   COMMIT; // save new "Status" value
                                   ERROR(MessageText);
                                 END;

                                 MESSAGE(MessageText);
                               END;
                                }
      { 8       ;0   ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 10      ;1   ;Action    ;
                      Name=EncryptionManagement;
                      CaptionML=[ENU=Encryption Management;
                                 ESM=Administraci¢n del cifrado;
                                 FRC=Gestion du chiffrement;
                                 ENC=Encryption Management];
                      ToolTipML=[ENU=Enable or disable data encryption. Data encryption helps make sure that unauthorized users cannot read business data.;
                                 ESM=Permite habilitar o deshabilitar el cifrado de datos. Esto le permitir  asegurarse de que los usuarios no autorizados no puedan leer los datos de la empresa.;
                                 FRC=Activez ou d‚sactivez le chiffrement des donn‚es. Le chiffrement des donn‚es garantit que les utilisateurs non autoris‚s ne peuvent pas avoir accŠs aux donn‚es professionnelles.;
                                 ENC=Enable or disable data encryption. Data encryption helps make sure that unauthorized users cannot read business data.];
                      ApplicationArea=#Basic,#Suite;
                      RunObject=Page 9905;
                      Image=EncryptionKeys;
                      RunPageMode=View }
      { 9       ;1   ;Action    ;
                      Name=HttpLog;
                      CaptionML=[ENU=Http Log;
                                 ESM=Registro de http;
                                 FRC=Journal http;
                                 ENC=Http Log];
                      ToolTipML=[ENU=See the http request/response history log entries for the current OAuth endpoint setup.;
                                 ESM=Permite ver las entradas del registro de historial de solicitudes/respuestas http para la configuraci¢n de extremos OAuth actual.;
                                 FRC=Consultez les ‚critures du journal de l'historique des demandes/r‚ponses http pour la configuration du point de terminaison OAuth actuel.;
                                 ENC=See the http request/response history log entries for the current OAuth endpoint setup.];
                      ApplicationArea=#Basic,#Suite;
                      Image=Log;
                      OnAction=VAR
                                 ActivityLog@1002 : Record 710;
                               BEGIN
                                 ActivityLog.ShowEntries(Rec);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1   ;    ;Container ;
                ContainerType=ContentArea }

    { 19  ;1   ;Group     ;
                Name=General;
                CaptionML=[ENU=General;
                           ESM=General;
                           FRC=G‚n‚ral;
                           ENC=General];
                Editable=FALSE;
                GroupType=Group }

    { 23  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the description.;
                           ESM=Especifica la descripci¢n.;
                           FRC=Sp‚cifie la description.;
                           ENC=Specifies the description.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Description }

    { 6   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the service URL.;
                           ESM=Especifica la direcci¢n URL del servicio.;
                           FRC=Sp‚cifie l'URL du service.;
                           ENC=Specifies the service URL.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Service URL" }

    { 2   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the redirect URL.;
                           ESM=Especifica la direcci¢n URL de redireccionamiento.;
                           FRC=Sp‚cifie l'URL de redirection.;
                           ENC=Specifies the redirect URL.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Redirect URL" }

    { 26  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the scope.;
                           ESM=Especifica el  mbito.;
                           FRC=Sp‚cifie la port‚e.;
                           ENC=Specifies the scope.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Scope }

    { 20  ;1   ;Group     ;
                Name=Request URL Paths;
                CaptionML=[ENU=Request URL Paths;
                           ESM=Rutas de direcciones URL de solicitud;
                           FRC=Demander les chemins d'accŠs de l'URL;
                           ENC=Request URL Paths];
                Editable=FALSE;
                GroupType=Group }

    { 18  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the authorization URL path.;
                           ESM=Especifica la ruta de acceso de direcci¢n URL de autorizaci¢n.;
                           FRC=Sp‚cifie le chemin d'accŠs de l'URL d'autorisation.;
                           ENC=Specifies the authorization URL path.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Authorization URL Path" }

    { 21  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the access token URL path.;
                           ESM=Especifica la ruta de acceso de direcci¢n URL token de acceso.;
                           FRC=Sp‚cifie le chemin d'accŠs de l'URL du jeton d'accŠs.;
                           ENC=Specifies the access token URL path.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Access Token URL Path" }

    { 25  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the refresh token URL path.;
                           ESM=Especifica la ruta de acceso de direcci¢n URL token de actualizaci¢n.;
                           FRC=Sp‚cifie le chemin d'accŠs de l'URL du jeton d'actualisation.;
                           ENC=Specifies the refresh token URL path.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Refresh Token URL Path" }

    { 3   ;1   ;Group     ;
                Name=Client Tokens;
                CaptionML=[ENU=Client Tokens;
                           ESM=Tokens de cliente;
                           FRC=Jetons client;
                           ENC=Client Tokens];
                GroupType=Group }

    { 4   ;2   ;Field     ;
                Name=Client ID;
                ExtendedDatatype=Masked;
                CaptionML=[ENU=Client ID;
                           ESM=Id. de cliente;
                           FRC=Code client;
                           ENC=Client ID];
                ToolTipML=[ENU=Specifies the client ID token.;
                           ESM=Especifica el Id. del token del cliente.;
                           FRC=Sp‚cifie le jeton code client.;
                           ENC=Specifies the client ID token.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ClientID;
                OnValidate=BEGIN
                             SetToken("Client ID",ClientID);
                             ClientID := "Client ID";
                             CurrPage.UPDATE(TRUE);
                           END;
                            }

    { 5   ;2   ;Field     ;
                Name=Client Secret;
                ExtendedDatatype=Masked;
                CaptionML=[ENU=Client Secret;
                           ESM=Secreto de cliente;
                           FRC=Cl‚ secrŠte client;
                           ENC=Client Secret];
                ToolTipML=[ENU=Specifies the client secret token.;
                           ESM=Especifica el token secreto del cliente.;
                           FRC=Sp‚cifie le jeton secret du client.;
                           ENC=Specifies the client secret token.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ClientSecret;
                OnValidate=BEGIN
                             SetToken("Client Secret",ClientSecret);
                             ClientSecret := "Client Secret";
                             CurrPage.UPDATE(TRUE);
                           END;
                            }

    { 12  ;1   ;Group     ;
                Name=Request Authorization Code;
                CaptionML=[ENU=Request Authorization Code;
                           ESM=C¢digo de autorizaci¢n de solicitud;
                           FRC=Demander le code d'autorisation;
                           ENC=Request Authorization Code];
                Visible=RequestAuthorizationCodeInvoked OR (Status = Status::Disabled) OR (Status = Status::Error);
                GroupType=Group }

    { 14  ;2   ;Field     ;
                Name=Enter Authorization Code;
                CaptionML=[ENU=Enter Authorization Code;
                           ESM=Escriba el c¢digo de autorizaci¢n;
                           FRC=Entrer le code d'autorisation;
                           ENC=Enter Authorization Code];
                ToolTipML=[ENU=Specifies the received authorization code from the request authorization action.;
                           ESM=Especifica el c¢digo de autorizaci¢n recibido desde la acci¢n de autorizaci¢n de la solicitud.;
                           FRC=Sp‚cifie le code d'autorisation re‡u … partir de l'action Demander le code d'autorisation.;
                           ENC=Specifies the received authorization code from the request authorization action.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ReceivedAuthorizationCode;
                OnValidate=BEGIN
                             ValidateAuthorizationCode;
                           END;
                            }

  }
  CODE
  {
    VAR
      ReceivedAuthorizationCode@1004 : Text;
      RequestAuthorizationCodeInvoked@1000 : Boolean;
      ClientID@1020 : Text;
      ClientSecret@1021 : Text;

    LOCAL PROCEDURE ValidateAuthorizationCode@3();
    VAR
      MessageText@1000 : Text;
    BEGIN
      IF ReceivedAuthorizationCode = '' THEN
        EXIT;

      IF NOT RequestAccessToken(MessageText,ReceivedAuthorizationCode) THEN
        ERROR(MessageText);

      ReceivedAuthorizationCode := '';
      RequestAuthorizationCodeInvoked := FALSE;
      IF MessageText <> '' THEN
        MESSAGE(MessageText);

      CurrPage.UPDATE; // force OnAfterGetCurrRecord() to refresh notification
    END;

    BEGIN
    END.
  }
}

