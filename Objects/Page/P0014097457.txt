OBJECT Page 14097457 Item Usage FB
{
  OBJECT-PROPERTIES
  {
    Date=11/01/20;
    Time=12:00:00 PM;
    Version List=UBP3.03;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=ENU=Item Usage;
    SourceTable=Table14000557;
    DelayedInsert=Yes;
    SourceTableView=SORTING(Location Code,Item No.,Variant Code,Starting Date,Ending Date)
                    ORDER(Descending);
    PageType=ListPart;
    OnOpenPage=BEGIN
                 InvMgtSetup.GET;
               END;

    OnFindRecord=BEGIN
                   FILTERGROUP(4);
                   SETRANGE("Location Code", GETFILTER("Location Code"));
                   SETRANGE("Item No.", GETFILTER("Item No."));
                   SETRANGE("Variant Code", GETFILTER("Variant Code"));
                   SETFILTER("Source No.",'=%1','');
                   GetLocationPeriodDates(GETFILTER("Location Code"));
                   SETRANGE("Starting Date", LCPStartDateBegin, LCPStartDateEnd);
                   FILTERGROUP(0);
                   EXIT(FIND(Which));
                 END;

    OnAfterGetRecord=BEGIN
                       OnAfterRecord;
                     END;

    ActionList=ACTIONS
    {
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 5       ;1   ;Action    ;
                      CaptionML=ENU=Show &Actual Usage;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=ProdBOMMatrixPerVersion;
                      OnAction=BEGIN
                                 ShowActualUsage := TRUE;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 3       ;1   ;Action    ;
                      CaptionML=ENU=Show &Calculated Usage;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=CalculateWIP;
                      OnAction=BEGIN
                                 ShowActualUsage := FALSE;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 23      ;1   ;Action    ;
                      CaptionML=ENU=&Adjust Usage;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=AdjustEntries;
                      OnAction=VAR
                                 ItemUsageAdj@1000 : Record 14000558;
                                 AdjQty@1001 : Decimal;
                               BEGIN
                                 ItemUsageAdj.RESET;
                                 ItemUsageAdj.SETRANGE("Location Code","Location Code");
                                 ItemUsageAdj.SETRANGE("Item No.","Item No.");
                                 ItemUsageAdj.SETRANGE("Variant Code","Variant Code");
                                 ItemUsageAdj.SETRANGE("Starting Date","Starting Date");
                                 ItemUsageAdj.SETRANGE("Ending Date","Ending Date");
                                 AdjQty := "Adjustment Quantity";
                                 PAGE.RUNMODAL(PAGE::"Item Usage Adjustment",ItemUsageAdj);
                                 CALCFIELDS("Adjustment Quantity");
                                 IF AdjQty <> "Adjustment Quantity" THEN BEGIN
                                   "Adj. After Close" := TRUE;
                                   CurrPage.UPDATE(TRUE);
                                 END;
                               END;
                                }
      { 10      ;1   ;Action    ;
                      ShortCutKey=Shift+F11;
                      CaptionML=ENU=View &Forecast;
                      ApplicationArea=#All;
                      Image=CalculateRegenerativePlan;
                      OnAction=VAR
                                 ForecastView@1000 : Page 14002661;
                                 ProcUnit@1001 : Record 14000555;
                               BEGIN
                                 ProcUnit.GET("Location Code","Item No.","Variant Code");
                                 CLEAR(ForecastView);
                                 ForecastView.SetProcUnitandSourceNo(ProcUnit,'');
                                 ForecastView.RUN;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                Editable=FALSE;
                GroupType=Repeater }

    { 2   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Location Code";
                Visible=FALSE }

    { 4   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Item No.";
                Visible=FALSE }

    { 33  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Variant Code";
                Visible=FALSE }

    { 6   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Starting Date" }

    { 8   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Ending Date";
                Visible=FALSE }

    { 16  ;2   ;Field     ;
                CaptionML=ENU=Adjusted Usage;
                ApplicationArea=#All;
                DecimalPlaces=0:1;
                SourceExpr=AdjustedUsage }

    { 7   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Usage Hits";
                Visible=FALSE }

    { 1240030019;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Ranking Code";
                Visible=FALSE;
                Enabled=FALSE }

  }
  CODE
  {
    VAR
      InvMgtSetup@1240030004 : Record 14000551;
      Location@1000 : Record 14;
      UBP@1240030007 : Codeunit 14000564;
      ShowActualUsage@1240030008 : Boolean;
      LCPStartDateBegin@1002 : Date;
      LCPStartDateEnd@1001 : Date;

    LOCAL PROCEDURE OnAfterRecord@19077479();
    BEGIN
      IF ShowActualUsage THEN
        SETFILTER("Location Filter","Location Code")
      ELSE
        SETFILTER(
          "Location Filter",UBP.GetUsageLocationFilter(
             "Location Code","Item No.","Variant Code",ShowActualUsage));
      SETFILTER("Date Filter",'%1..%2',"Starting Date","Ending Date");
      CALCFIELDS(
        "Usage Quantity","Exclude Usage Quantity","Adjustment Quantity",
        "Transfer Usage","Drop Ship Usage Quantity",
        "Usage Hits");
    END;

    PROCEDURE GetLocationPeriodDates@1(CurrLocCode@1000 : Code[50]);
    VAR
      LocInvPeriod@1001 : Record 14000553;
    BEGIN
      IF CurrLocCode = '' THEN BEGIN
        LCPStartDateBegin := 0D;
        LCPStartDateEnd := 0D;
        EXIT;
      END ELSE BEGIN
        IF (CurrLocCode <> Location.Code) THEN BEGIN
          LCPStartDateBegin := 0D;
          LCPStartDateEnd := 0D;
          IF NOT Location.GET(CurrLocCode) THEN
            EXIT;
          Location.GET(CurrLocCode);
          LocInvPeriod.SETRANGE(LocInvPeriod."Location Code", Location.Code);
          LocInvPeriod.SETRANGE("Period End Closed", TRUE);
          IF LocInvPeriod.FIND('+') THEN BEGIN
            LCPStartDateEnd := LocInvPeriod."Starting Date";
            IF (LocInvPeriod.COUNT > 12) THEN BEGIN
              IF (LocInvPeriod.NEXT(-(12)) <> 0) THEN
                 LCPStartDateBegin := LocInvPeriod."Starting Date";
            END ELSE BEGIN
              LocInvPeriod.FIND('-');
              LCPStartDateBegin := LocInvPeriod."Starting Date";
            END;
          END;
        END;
      END;
    END;

    BEGIN
    END.
  }
}

