OBJECT Page 14123577 ES Roles and Logins FactBox
{
  OBJECT-PROPERTIES
  {
    Date=04/14/15;
    Time=12:00:00 PM;
    Version List=ES1.41;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=ENU=Logins and Permissions;
    PageType=CardPart;
    OnOpenPage=BEGIN
                 UpdateData;
                   OnActivateForm;
               END;

  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1240520016;1;Field  ;
                CaptionML=ENU=Database Name;
                SourceExpr=ActiveSessionRec."Database Name";
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Active Sessions",ActiveSessionRec);
                            END;
                             }

    { 1240520018;1;Field  ;
                CaptionML=ENU=Server Computer Name;
                SourceExpr=ActiveSessionRec."Server Computer Name";
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Active Sessions",ActiveSessionRec);
                            END;
                             }

    { 2   ;1   ;Field     ;
                CaptionML=ENU=Server Instance Name;
                SourceExpr=ActiveSessionRec."Server Instance Name";
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Active Sessions",ActiveSessionRec);
                            END;
                             }

    { 1   ;1   ;Field     ;
                CaptionML=ENU=Client Computer Name;
                SourceExpr=ActiveSessionRec."Client Computer Name";
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Active Sessions",ActiveSessionRec);
                            END;
                             }

    { 1240520020;1;Field  ;
                CaptionML=ENU=Logins;
                SourceExpr=ESCue.Logins;
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Logins");
                            END;
                             }

    { 1240520022;1;Field  ;
                CaptionML=ENU=Permission Sets;
                SourceExpr=ESCue.Roles;
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Roles");
                            END;
                             }

    { 1240520024;1;Field  ;
                CaptionML=ENU=Permission Groups;
                SourceExpr=ESCue."Role Groups";
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Role Groups");
                            END;
                             }

    { 1240520026;1;Field  ;
                CaptionML=ENU=Company Groups;
                SourceExpr=ESCue."Company Groups";
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Company Groups");
                            END;
                             }

    { 1240520028;1;Field  ;
                CaptionML=ENU=Recordings;
                SourceExpr=ESCue.Recordings;
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Recordings");
                            END;
                             }

    { 1240520030;1;Field  ;
                CaptionML=ENU=Restore Points;
                SourceExpr=ESCue."Restore Points";
                OnDrillDown=BEGIN
                              PAGE.RUN(PAGE::"ES Restore Points");
                            END;
                             }

    { 1240520001;1;Field  ;
                CaptionML=ENU=Last Restore Point;
                SourceExpr=ESRestorePointLast.Code;
                OnDrillDown=BEGIN
                              ESRestorePoint := ESRestorePointLast;
                              PAGE.RUN(PAGE::"ES Restore Points",ESRestorePoint);
                            END;
                             }

    { 1240520005;1;Field  ;
                CaptionML=ENU=Created By User;
                SourceExpr=ESRestorePointLast."Created By User" }

    { 1240520003;1;Field  ;
                CaptionML=ENU=Created Date Time;
                SourceExpr=ESRestorePointLast."Created Date Time" }

    { 1240520011;1;Field  ;
                CaptionML=ENU=Publish Restore Point;
                SourceExpr=ESRestorePointWrite.Code;
                OnDrillDown=BEGIN
                              ESRestorePoint := ESRestorePointWrite;
                              PAGE.RUN(PAGE::"ES Restore Points",ESRestorePoint);
                            END;
                             }

    { 1240520007;1;Field  ;
                CaptionML=ENU=Created By User;
                SourceExpr=ESRestorePointWrite."Created By User" }

    { 1240520009;1;Field  ;
                CaptionML=ENU=Created Date Time;
                SourceExpr=ESRestorePointWrite."Created Date Time" }

    { 1240520013;1;Field  ;
                CaptionML=ENU=Duration (Seconds);
                DecimalPlaces=0:5;
                SourceExpr=PublishDuration }

  }
  CODE
  {
    VAR
      ESRestorePoint@1240520003 : Record 14123523;
      ESRestorePointLast@1240520001 : Record 14123523;
      ESRestorePointWrite@1240520002 : Record 14123523;
      ESCue@1240520006 : Record 14123532;
      ActiveSessionRec@1000 : Record 2000000110;
      PublishDuration@1240520004 : Decimal;

    PROCEDURE UpdateData@1240520001();
    BEGIN
      ESRestorePointLast.RESET;
      ESRestorePointLast.SETCURRENTKEY("Created Date Time");
      IF NOT ESRestorePointLast.FIND('+') THEN
        CLEAR(ESRestorePointLast);

      ESRestorePointWrite.RESET;
      ESRestorePointWrite.SETCURRENTKEY("Created Date Time");
      ESRestorePointWrite.SETRANGE("Write to Live",TRUE);
      IF NOT ESRestorePointWrite.FIND('+') THEN
        CLEAR(ESRestorePointWrite);

      IF (ESRestorePointWrite."Write Start Date Time" <> 0DT) AND
         (ESRestorePointWrite."Write Start Date Time" <> 0DT)
      THEN
        PublishDuration :=
          ROUND(
            (ESRestorePointWrite."Write End Date Time" - ESRestorePointWrite."Write Start Date Time") /
            1000,0.1)
      ELSE
        PublishDuration := 0;

      ActiveSessionRec.RESET;
      ActiveSessionRec.SETRANGE("Server Instance ID",SERVICEINSTANCEID);
      ActiveSessionRec.SETRANGE("User SID",USERSECURITYID);
      ActiveSessionRec.SETRANGE("Session ID",SESSIONID);
      IF NOT ActiveSessionRec.FIND('-') THEN
        CLEAR(ActiveSessionRec);

      ESCue.CALCFIELDS(Logins,Roles,"Role Groups","Company Groups",Recordings,"Restore Points");
    END;

    LOCAL PROCEDURE OnActivateForm@19002417();
    BEGIN
      UpdateData;
    END;

    BEGIN
    END.
  }
}

