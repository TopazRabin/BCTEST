OBJECT Page 14123818 ES FLADS User Statistics
{
  OBJECT-PROPERTIES
  {
    Date=06/02/14;
    Time=12:00:00 PM;
    Version List=ES1.40.24;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=ENU=Field Level and Data Security User Statistics;
    SourceTable=Table14123805;
    PageType=List;
    SourceTableTemporary=Yes;
    OnOpenPage=VAR
                 FLADSGroupID@1240520001 : Code[50];
               BEGIN
                 ESFLADSSetup.GET;
                 ESFLADSSetup.TESTFIELD("Lookup Live Windows Groups",FALSE);
                 ESFLADSSetup.TESTFIELD("Use Stored Windows Groups",FALSE);

                 WindowsLogin.RESET;

                 IF GETFILTER("User ID") <> '' THEN BEGIN
                   IF WindowsLogin.FIND('-') THEN
                     REPEAT
                       IF UPPERCASE(WindowsLogin."User Name") = GETFILTER("User ID") THEN
                         WindowsLoginUserSecurityID := WindowsLogin."User Security ID";
                     UNTIL WindowsLogin.NEXT = 0;

                   WindowsLogin.SETRANGE("User Security ID",WindowsLoginUserSecurityID);
                 END;

                 IF WindowsLogin.FIND('-') THEN
                   REPEAT
                     FLADSGroupID := GetFLADSGroup(WindowsLogin."User Name");

                     ESSourceTableSetup.RESET;
                     IF ESSourceTableSetup.FIND('-') THEN
                       REPEAT
                         IF ESUserSecuritySetup.GET(
                              WindowsLogin."User Name",ESSourceTableSetup."Source Table ID")
                         THEN BEGIN
                           Rec := ESUserSecuritySetup;
                           "Direct User Security Setup" := TRUE;
                           IF NOT INSERT THEN
                             ;
                         END ELSE
                           IF ESFLADSSetup."Use FLADS Groups" AND (FLADSGroupID <> '') AND
                              ESUserSecuritySetup.GET(FLADSGroupID,ESSourceTableSetup."Source Table ID")
                           THEN BEGIN
                             Rec := ESUserSecuritySetup;
                             "User ID" := WindowsLogin."User Name";
                             "By Group User Security Setup" := TRUE;
                             IF NOT INSERT THEN
                               ;
                           END ELSE
                             IF ESUserSecuritySetup.GET('',ESSourceTableSetup."Source Table ID") THEN BEGIN
                               Rec := ESUserSecuritySetup;
                               "User ID" := WindowsLogin."User Name";
                               "Default User Security Setup" := TRUE;
                               IF NOT INSERT THEN
                                 ;
                             END ELSE BEGIN
                               INIT;
                               "User ID" := WindowsLogin."User Name";
                               "Source Table ID" := ESSourceTableSetup."Source Table ID";
                               IF NOT INSERT THEN
                                 ;
                             END;
                       UNTIL ESSourceTableSetup.NEXT = 0;
                   UNTIL WindowsLogin.NEXT = 0;
               END;

  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1240520008;1;Group  ;
                GroupType=Repeater }

    { 1240520009;2;Field  ;
                SourceExpr="User ID" }

    { 1240520011;2;Field  ;
                SourceExpr="Source Table ID" }

    { 1240520022;2;Field  ;
                SourceExpr="Source Table Caption" }

    { 1240520028;2;Field  ;
                SourceExpr="User Security Setup Exists";
                Visible=FALSE }

    { 1240520013;2;Field  ;
                SourceExpr="Field Level Security Code" }

    { 1240520024;2;Field  ;
                SourceExpr="Field Level Security Objects";
                Visible=FALSE }

    { 1240520017;2;Field  ;
                SourceExpr="Data Security Code" }

    { 1240520026;2;Field  ;
                SourceExpr="Data Security Objects";
                Visible=FALSE }

    { 1240520001;2;Field  ;
                SourceExpr="Direct User Security Setup" }

    { 1240520003;2;Field  ;
                SourceExpr="By Group User Security Setup" }

    { 1240520005;2;Field  ;
                SourceExpr="Default User Security Setup" }

    { 1900000007;0;Container;
                ContainerType=FactBoxArea }

    { 1901096707;1;Part   ;
                SubPageLink=Member User ID=FIELD(User ID);
                PagePartID=Page14123840;
                Visible=TRUE;
                PartType=Page }

    { 1904802607;1;Part   ;
                SubPageLink=Group User ID=FIELD(User ID);
                PagePartID=Page14123839;
                Visible=TRUE;
                PartType=Page }

    { 1900014407;1;Part   ;
                SubPageLink=Source Table ID=FIELD(Source Table ID),
                            Field Level Security Code=FIELD(Field Level Security Code);
                PagePartID=Page14123819;
                Visible=TRUE;
                PartType=Page }

    { 1902002107;1;Part   ;
                SubPageLink=Source Table ID=FIELD(Source Table ID),
                            Data Security Code=FIELD(Data Security Code);
                PagePartID=Page14123820;
                Visible=TRUE;
                PartType=Page }

  }
  CODE
  {
    VAR
      ESUserSecuritySetup@1240520008 : Record 14123805;
      ESSourceTableSetup@1240520011 : Record 14123802;
      WindowsLogin@1240520010 : Record 2000000120;
      ESFLADSSetup@1240520001 : Record 14123801;
      WindowsLoginUserSecurityID@1240520012 : GUID;

    PROCEDURE GetFLADSGroup@1240520001(CurrentUserID@1240520001 : Code[50]) WindowsGroupID : Code[50];
    VAR
      ESFLADSGroupMember@1240520002 : Record 14123817;
    BEGIN
      ESFLADSGroupMember.RESET;
      ESFLADSGroupMember.SETCURRENTKEY("Member User ID",Priority);
      ESFLADSGroupMember.SETRANGE("Member User ID",CurrentUserID);
      ESFLADSGroupMember.SETFILTER(Priority,'>0');
      ESFLADSGroupMember.SETRANGE("Do Not Use",FALSE);
      IF NOT ESFLADSGroupMember.FIND('-') THEN BEGIN
        ESFLADSGroupMember.SETRANGE(Priority,0);
        IF NOT ESFLADSGroupMember.FIND('-') THEN
          EXIT('');
      END;
      EXIT(ESFLADSGroupMember."Group User ID");
    END;

    BEGIN
    END.
  }
}

