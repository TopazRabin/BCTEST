OBJECT Page 8615 Config. Packages
{
  OBJECT-PROPERTIES
  {
    Date=07/27/18;
    Time=12:00:00 PM;
    Version List=NAVW111.00.00.23572;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=[ENU=Config. Packages;
               ESM=Configurar paquetes;
               FRC=Packages config.;
               ENC=Config. Packages];
    SourceTable=Table8623;
    PageType=List;
    CardPageID=Config. Package Card;
    PromotedActionCategoriesML=[ENU=New,Process,Report,Manage,Package;
                                ESM=Nuevo,Procesar,Informe,Administrar, Paquete;
                                FRC=Nouveau,Traiter,Rapport,G‚rer,Package;
                                ENC=New,Process,Report,Manage,Package];
    OnInit=BEGIN
             SetActionVisibility;
           END;

    OnOpenPage=VAR
                 PermissionManager@1001 : Codeunit 9002;
                 OriginalFilterGroup@1000 : Integer;
               BEGIN
                 IF PermissionManager.SoftwareAsAService THEN BEGIN
                   CheckSaaSPackage;
                   OriginalFilterGroup := FILTERGROUP;
                   FILTERGROUP(25);
                   SETFILTER(Code,SaaSPackageCodeTxt);
                   FILTERGROUP(OriginalFilterGroup);
                 END;
               END;

    OnNewRecord=BEGIN
                  IF NOT ActionVisible THEN
                    ERROR(UnsupportedNewErr);
                END;

    OnInsertRecord=BEGIN
                     IF NOT ActionVisible THEN
                       ERROR(UnsupportedEditErr);
                   END;

    OnModifyRecord=BEGIN
                     IF NOT ActionVisible THEN
                       ERROR(UnsupportedEditErr);
                   END;

    OnDeleteRecord=BEGIN
                     IF NOT ActionVisible THEN
                       ERROR(UnsupportedDeleteErr);
                   END;

    ActionList=ACTIONS
    {
      { 9       ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 20      ;1   ;ActionGroup;
                      CaptionML=[ENU=Package;
                                 ESM=Paquete;
                                 FRC=Package;
                                 ENC=Package] }
      { 22      ;2   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Export Package;
                                 ESM=Exportar paquete;
                                 FRC=Exporter package;
                                 ENC=Export Package];
                      ToolTipML=[ENU=Create a .rapidstart file that which delivers the package contents in a compressed format. Configuration questionnaires, configuration templates, and the configuration worksheet are added to the package automatically unless you specifically decide to exclude them.;
                                 ESM=Permite crear un archivo .rapidstart que entrega el contenido del paquete en un formato comprimido. Los cuestionarios de configuraci¢n, las plantillas de configuraci¢n y la hoja de trabajo de configuraci¢n se agregan al paquete de forma autom tica, a menos que decida excluirlos espec¡ficamente.;
                                 FRC=Cr‚ez un fichier .rapidstart qui fournit le contenu du package dans un format compress‚. Les questionnaires de configuration, les modŠles de configuration ainsi que la feuille de configuration sont ajout‚s automatiquement au package, sauf si vous d‚cidez de les exclure.;
                                 ENC=Create a .rapidstart file that which delivers the package contents in a compressed format. Configuration questionnaires, configuration templates, and the configuration worksheet are added to the package automatically unless you specifically decide to exclude them.];
                      ApplicationArea=#Advanced;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Export;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 TESTFIELD(Code);
                                 ConfigXMLExchange.ExportPackage(Rec);
                               END;
                                }
      { 13      ;2   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Import Package;
                                 ESM=Importar paquete;
                                 FRC=Importer package;
                                 ENC=Import Package];
                      ToolTipML=[ENU=Import a .rapidstart package file.;
                                 ESM=Importa un archivo de paquete .rapidstart.;
                                 FRC=Importez un fichier de package .rapidstart.;
                                 ENC=Import a .rapidstart package file.];
                      ApplicationArea=#Advanced;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Import;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 ConfigXMLExchange.ImportPackageXMLFromClient;
                               END;
                                }
      { 11      ;2   ;Action    ;
                      CaptionML=[ENU=Export to Excel;
                                 ESM=Exportar a Excel;
                                 FRC=Exporter dans Excel;
                                 ENC=Export to Excel];
                      ToolTipML=[ENU=Export the data in the package to Excel.;
                                 ESM=Exporta los datos del paquete a Excel.;
                                 FRC=Exportez les donn‚es du package vers Excel.;
                                 ENC=Export the data in the package to Excel.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=ExportToExcel;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ConfigPackageTable@1000 : Record 8613;
                                 ConfigExcelExchange@1001 : Codeunit 8618;
                               BEGIN
                                 TESTFIELD(Code);

                                 ConfigPackageTable.SETRANGE("Package Code",Code);
                                 IF CONFIRM(Text004,TRUE,Code) THEN
                                   ConfigExcelExchange.ExportExcelFromTables(ConfigPackageTable);
                               END;
                                }
      { 15      ;2   ;Action    ;
                      CaptionML=[ENU=Import from Excel;
                                 ESM=Importar desde Excel;
                                 FRC=Importer d'Excel;
                                 ENC=Import from Excel];
                      ToolTipML=[ENU=Begin the migration of legacy data.;
                                 ESM=Inicia la migraci¢n de los datos heredados.;
                                 FRC=Commencez la migration des anciennes donn‚es.;
                                 ENC=Begin the migration of legacy data.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=ImportExcel;
                      PromotedCategory=Category5;
                      OnAction=VAR
                                 ConfigExcelExchange@1000 : Codeunit 8618;
                               BEGIN
                                 ConfigExcelExchange.ImportExcelFromPackage;
                               END;
                                }
      { 16      ;1   ;ActionGroup;
                      CaptionML=[ENU=F&unctions;
                                 ESM=Acci&ones;
                                 FRC=Fonction&s;
                                 ENC=F&unctions] }
      { 19      ;2   ;Action    ;
                      Ellipsis=Yes;
                      CaptionML=[ENU=Get Tables;
                                 ESM=Obtener tablas;
                                 FRC=Extraire tables;
                                 ENC=Get Tables];
                      ToolTipML=[ENU=Select tables that you want to add to the configuration package.;
                                 ESM=Permite seleccionar las tablas que desea agregar al paquete de configuraci¢n.;
                                 FRC=S‚lectionnez les tables que vous souhaitez ajouter au package de configuration.;
                                 ENC=Select tables that you want to add to the configuration package.];
                      ApplicationArea=#Advanced;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=GetLines;
                      PromotedCategory=New;
                      OnAction=VAR
                                 GetPackageTables@1000 : Report 8616;
                               BEGIN
                                 CurrPage.SAVERECORD;
                                 GetPackageTables.Set(Code);
                                 GetPackageTables.RUNMODAL;
                                 CLEAR(GetPackageTables);
                               END;
                                }
      { 3       ;2   ;Action    ;
                      CaptionML=[ENU=Apply Package;
                                 ESM=Aplicar paquete;
                                 FRC=Appliquer package;
                                 ENC=Apply Package];
                      ToolTipML=[ENU=Import the configuration package and apply the package database data at the same time.;
                                 ESM=Importa el paquete de configuraci¢n y aplica los datos de base de datos del paquete al mismo tiempo.;
                                 FRC=Importez le package de configuration et appliquez simultan‚ment toutes les donn‚es de base de donn‚es du package.;
                                 ENC=Import the configuration package and apply the package database data at the same time.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Apply;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 ConfigPackageTable@1002 : Record 8613;
                                 ConfigPackageMgt@1000 : Codeunit 8611;
                               BEGIN
                                 TESTFIELD(Code);
                                 IF CONFIRM(Text003,TRUE,Code) THEN BEGIN
                                   ConfigPackageTable.SETRANGE("Package Code",Code);
                                   ConfigPackageMgt.ApplyPackage(Rec,ConfigPackageTable,TRUE);
                                 END;
                               END;
                                }
      { 14      ;2   ;Action    ;
                      CaptionML=[ENU=Copy Package;
                                 ESM=Copiar paquete;
                                 FRC=Copier package;
                                 ENC=Copy Package];
                      ToolTipML=[ENU=Copy an existing configuration package to create a new package based on the same content.;
                                 ESM=Copia un paquete de configuraci¢n existente para crear uno nuevo basado en el mismo contenido.;
                                 FRC=Copiez un package de configuration existant afin de cr‚er un nouveau package selon le mˆme contenu.;
                                 ENC=Copy an existing configuration package to create a new package based on the same content.];
                      ApplicationArea=#Advanced;
                      Image=CopyWorksheet;
                      OnAction=VAR
                                 CopyPackage@1000 : Report 8615;
                               BEGIN
                                 TESTFIELD(Code);
                                 CopyPackage.Set(Rec);
                                 CopyPackage.RUNMODAL;
                                 CLEAR(CopyPackage);
                               END;
                                }
      { 17      ;2   ;Action    ;
                      Name=ValidatePackage;
                      CaptionML=[ENU=Validate Package;
                                 ESM=Validar paquete;
                                 FRC=Valider package;
                                 ENC=Validate Package];
                      ToolTipML=[ENU=Determine if you have introduced errors, such as not including tables that the configuration relies on.;
                                 ESM=Permite determinar si ha cometido errores, como no incluir las tablas de las que depende la configuraci¢n.;
                                 FRC=D‚terminez si vous avez introduit des erreurs, telles que le fait de ne pas inclure les tables sur lesquelles la configuration compte.;
                                 ENC=Determine if you have introduced errors, such as not including tables that the configuration relies on.];
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=CheckRulesSyntax;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 ConfigPackageTable@1000 : Record 8613;
                                 ActiveSession@1004 : Record 2000000110;
                                 SessionEvent@1005 : Record 2000000111;
                                 ConfigProgressBar@1001 : Codeunit 8615;
                                 Canceled@1002 : Boolean;
                               BEGIN
                                 IF CONFIRM(Text002,TRUE,"Package Name") THEN BEGIN
                                   ConfigPackageTable.SETRANGE("Package Code",Code);
                                   ConfigProgressBar.Init(ConfigPackageTable.COUNT,1,ValidatingTableRelationsMsg);

                                   BackgroundSessionId := 0;
                                   STARTSESSION(BackgroundSessionId,CODEUNIT::"Config. Validate Package",COMPANYNAME,ConfigPackageTable);

                                   ConfigPackageTable.SETRANGE(Validated,FALSE);
                                   ConfigPackageTable.SETCURRENTKEY("Package Processing Order","Processing Order");

                                   SLEEP(1000);
                                   WHILE NOT Canceled AND ActiveSession.GET(SERVICEINSTANCEID,BackgroundSessionId) AND ConfigPackageTable.FINDFIRST DO BEGIN
                                     ConfigPackageTable.CALCFIELDS("Table Name");
                                     Canceled := NOT ConfigProgressBar.UpdateCount(ConfigPackageTable."Table Name",ConfigPackageTable.COUNT);
                                     SLEEP(1000);
                                   END;

                                   IF ActiveSession.GET(SERVICEINSTANCEID,BackgroundSessionId) THEN
                                     STOPSESSION(BackgroundSessionId,ValidationCanceledMsg);

                                   IF NOT Canceled AND ConfigPackageTable.FINDFIRST THEN BEGIN
                                     SessionEvent.SETASCENDING("Event Datetime",TRUE);
                                     SessionEvent.SETRANGE("User ID",USERID);
                                     SessionEvent.SETRANGE("Server Instance ID",SERVICEINSTANCEID);
                                     SessionEvent.SETRANGE("Session ID",BackgroundSessionId);
                                     SessionEvent.FINDLAST;
                                     MESSAGE(SessionEvent.Comment);
                                   END;

                                   ConfigProgressBar.Close;
                                 END;
                               END;
                                }
      { 12      ;2   ;Separator  }
      { 21      ;2   ;Action    ;
                      CaptionML=[ENU=Export to Translation;
                                 ESM=Exportar a traducci¢n;
                                 FRC=Exporter vers la traduction;
                                 ENC=Export to Translation];
                      ToolTipML=[ENU=Export the data to a file that is suited translation.;
                                 ESM=Exporta los datos a un archivo de traducci¢n apropiado.;
                                 FRC=Exporter les donn‚es vers un fichier adapt‚ … la traduction.;
                                 ENC=Export the data to a file that is suited translation.];
                      ApplicationArea=#Advanced;
                      Visible=FALSE;
                      Image=Export;
                      OnAction=VAR
                                 ConfigPackageTable@1001 : Record 8613;
                               BEGIN
                                 TESTFIELD(Code);
                                 ConfigXMLExchange.SetAdvanced(TRUE);
                                 ConfigPackageTable.SETRANGE("Package Code",Code);
                                 IF CONFIRM(Text004,TRUE,Code) THEN
                                   ConfigXMLExchange.ExportPackageXML(ConfigPackageTable,'');
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1   ;0   ;Container ;
                ContainerType=ContentArea }

    { 2   ;1   ;Group     ;
                GroupType=Repeater }

    { 31  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies a code for the configuration package.;
                           ESM=Especifica un c¢digo para el paquete de configuraci¢n.;
                           FRC=Sp‚cifie un code pour le package configuration.;
                           ENC=Specifies a code for the configuration package.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr=Code }

    { 4   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the name of the package.;
                           ESM=Especifica el nombre del paquete.;
                           FRC=Sp‚cifie le nom du package.;
                           ENC=Specifies the name of the package.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Package Name" }

    { 5   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the ID of the Windows language to use for the configuration package. Choose the field and select a language ID from the list.;
                           ESM=Especifica el id. de idioma de Windows que se debe usar para el paquete de configuraci¢n. Elija el campo y seleccione un id. de idioma de la lista.;
                           FRC=Sp‚cifie le code de la langue Windows … utiliser pour le package de configuration. Choisissez le champ et s‚lectionnez un Code de langue dans la liste.;
                           ENC=Specifies the ID of the Windows language to use for the configuration package. Choose the field and select a language ID from the list.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Language ID" }

    { 32  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the version of the product that you are configuring. You can use this field to help differentiate among various versions of a solution.;
                           ESM=Especifica la versi¢n del producto que est  configurando. Puede usar este campo para ayudar a distinguir entre las distintas versiones de una soluci¢n.;
                           FRC=Sp‚cifie la version du produit que vous configurez. Vous pouvez utiliser ce champ pour aider … diff‚rencier diff‚rentes versions d'une solution.;
                           ENC=Specifies the version of the product that you are configuring. You can use this field to help differentiate among various versions of a solution.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Product Version" }

    { 23  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the order in which the package is to be processed.;
                           ESM=Especifica el orden en el que se procesar  el paquete.;
                           FRC=Sp‚cifie l'ordre dans lequel le package doit ˆtre trait‚.;
                           ENC=Specifies the order in which the package is to be processed.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Processing Order" }

    { 6   ;2   ;Field     ;
                ToolTipML=[ENU=Specifies whether to exclude configuration tables from the package. Select the check box to exclude these types of tables.;
                           ESM=Especifica si se deben excluir tablas de configuraci¢n del paquete. Active la casilla para excluir estos tipos de tablas.;
                           FRC=Sp‚cifie si les tables de configuration doivent ˆtre exclues ou non du package. Activez la case … cocher pour exclure ces types de tables.;
                           ENC=Specifies whether to exclude configuration tables from the package. Select the check box to exclude these types of tables.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Exclude Config. Tables" }

    { 33  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of tables that the package contains.;
                           ESM=Especifica el n£mero de tablas que contiene el paquete.;
                           FRC=Indique le nombre de tables contenues dans le package.;
                           ENC=Specifies the number of tables that the package contains.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="No. of Tables" }

    { 34  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of records in the package.;
                           ESM=Especifica el n£mero de registros que contiene el paquete.;
                           FRC=Sp‚cifie le nombre d'enregistrements dans le package.;
                           ENC=Specifies the number of records in the package.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="No. of Records" }

    { 27  ;2   ;Field     ;
                ToolTipML=[ENU=Specifies the number of errors that the package contains.;
                           ESM=Especifica el n£mero de errores que contiene el paquete.;
                           FRC=Indique le nombre d'erreurs contenues dans le package.;
                           ENC=Specifies the number of errors that the package contains.];
                ApplicationArea=#Basic,#Suite;
                SourceExpr="No. of Errors" }

  }
  CODE
  {
    VAR
      ConfigXMLExchange@1000 : Codeunit 8614;
      Text002@1002 : TextConst 'ENU=Validate package %1?;ESM=¨Validar paquete %1?;FRC=Valider package %1ÿ?;ENC=Validate package %1?';
      Text003@1003 : TextConst 'ENU=Apply data from package %1?;ESM=¨Aplicar datos del paquete %1?;FRC=Appliquer donn‚es du package %1ÿ?;ENC=Apply data from package %1?';
      Text004@1005 : TextConst 'ENU=Export package %1?;ESM=¨Exportar paquete %1?;FRC=Exporter package %1ÿ?;ENC=Export package %1?';
      ValidatingTableRelationsMsg@1004 : TextConst 'ENU=Validating table relations;ESM=Validando relaciones de tabla;FRC=Validation des relations de table;ENC=Validating table relations';
      ValidationCanceledMsg@1001 : TextConst 'ENU=Validation canceled.;ESM=Validaci¢n cancelada.;FRC=Validation annul‚e.;ENC=Validation cancelled.';
      BackgroundSessionId@1007 : Integer;
      ActionVisible@1006 : Boolean;
      UnsupportedNewErr@1008 : TextConst 'ENU=You cannot create new Config. Packages.;ESM=No puede crear nuevos paquetes de configuraci¢n.;FRC=Vous ne pouvez pas cr‚er de nouveaux Packages config.;ENC=You cannot create new Config. Packages.';
      UnsupportedEditErr@1009 : TextConst 'ENU=You cannot edit Config. Packages.;ESM=No puede editar paquetes de configuraci¢n.;FRC=Vous ne pouvez pas modifier les Packages config.;ENC=You cannot edit Config. Packages.';
      UnsupportedDeleteErr@1010 : TextConst 'ENU=You cannot delete Config. Packages.;ESM=No puede eliminar paquetes de configuraci¢n.;FRC=Vous ne pouvez pas supprimer les Packages config.;ENC=You cannot delete Config. Packages.';
      SaaSPackageCodeTxt@1011 : TextConst '@@@={Locked};ENU=DYNAMICS365;ESM=DYNAMICS365;FRC=DYNAMICS365;ENC=DYNAMICS365';
      PackageUpdateQst@1013 : TextConst 'ENU=Update the Dynamics NAV Package?;ESM=¨Desea actualizar el paquete de Dynamics NAV?;FRC=Mettre … jour le package Dynamics NAVÿ?;ENC=Update the Dynamics NAV Package?';
      UpdateErrorMsg@1012 : TextConst 'ENU=Unable to update the Dynamics NAV package.;ESM=No se puede actualizar el paquete de Dynamics NAV.;FRC=Impossible de mettre … jour le package Dynamics NAV.;ENC=Unable to update the Dynamics NAV package.';
      OldSaaSPackageCodeTxt@1014 : TextConst '@@@={Locked};ENU=D365;ESM=D365;FRC=D365;ENC=D365';

    LOCAL PROCEDURE SetActionVisibility@1();
    VAR
      ApplicationAreaSetup@1001 : Record 9178;
    BEGIN
      ActionVisible := NOT ApplicationAreaSetup.IsFoundationEnabled;  // Only hide for Basic and Suite
    END;

    LOCAL PROCEDURE CheckSaaSPackage@2();
    VAR
      ConfigPackage@1001 : Record 8623;
    BEGIN
      IF NOT ConfigPackage.WRITEPERMISSION THEN
        EXIT;

      DeleteOldSaaSPackage;

      IF NOT ConfigPackage.GET(SaaSPackageCodeTxt) THEN BEGIN
        CODEUNIT.RUN(CODEUNIT::"Create D365 RapidStart Package");
        EXIT;
      END;

      IF IsNewerSaaSPackage THEN
        IF CONFIRM(PackageUpdateQst,FALSE) THEN
          IF ConfigPackage.DELETE(TRUE) THEN
            CODEUNIT.RUN(CODEUNIT::"Create D365 RapidStart Package")
          ELSE
            MESSAGE(UpdateErrorMsg);
    END;

    LOCAL PROCEDURE IsNewerSaaSPackage@3() : Boolean;
    VAR
      ConfigPackageField@1000 : Record 8616;
    BEGIN
      IF ConfigPackageField.GET(SaaSPackageCodeTxt,3,8) THEN
        IF ConfigPackageField."Include Field" = FALSE THEN
          EXIT(FALSE);

      EXIT(TRUE);
    END;

    LOCAL PROCEDURE DeleteOldSaaSPackage@5();
    VAR
      ConfigPackage@1000 : Record 8623;
    BEGIN
      IF ConfigPackage.GET(OldSaaSPackageCodeTxt) THEN
        ConfigPackage.DELETE(TRUE);
    END;

    BEGIN
    END.
  }
}

