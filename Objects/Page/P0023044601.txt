OBJECT Page 23044601 DSHIP Order Packaging
{
  OBJECT-PROPERTIES
  {
    Date=07/01/20;
    Time=12:00:00 AM;
    Modified=Yes;
    Version List=DSHIP2.2.3;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=[ENU=Dynamic Ship Order Packaging;
               ESM=Dynamic Ship pedido embalaje;
               FRC=Dynamic Ship l'Empaquetage de Commande;
               ENC=Dynamic Ship Order Packaging];
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    LinksAllowed=No;
    SourceTable=Table23044601;
    PageType=List;
    SourceTableTemporary=Yes;
    PromotedActionCategoriesML=[ENU=New,Process,Report,Print,Page;
                                ESM=Nuevo, procesar, informar, impresi¢n, Page;
                                FRC=Nouveau, Traitement, Rapport, Imprimer, Page;
                                ENC=New,Process,Report,Print,Page];
    OnInit=BEGIN
             loadDocuments();
           END;

    OnOpenPage=VAR
                 UserSetupMgt@1000000000 : Codeunit 5700;
               BEGIN
                 // <TPZ2719>
                 WITH Rec DO BEGIN
                   IF UserSetupMgt.GetLocationFilter <> '' THEN BEGIN
                     FILTERGROUP(2);
                     SETFILTER("Location Code",UserSetupMgt.GetLocationFilter);
                     FILTERGROUP(0);
                   END;
                 END;
                 // </TPZ2719>
               END;

    ActionList=ACTIONS
    {
      { 1000000027;  ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 1000000025;1 ;ActionGroup;
                      CaptionML=[ENU=Documents;
                                 ESM=Documentos;
                                 FRC=Documents;
                                 ENC=Documents];
                      Image=Shipment }
      { 1000000026;2 ;Action    ;
                      Name=acShowDocument;
                      ShortCutKey=Shift+F7;
                      CaptionML=[ENU=Show D&ocument;
                                 ESM=Muestra documento;
                                 FRC=Afficher le document;
                                 ENC=Show D&ocument];
                      Image=View;
                      OnAction=BEGIN
                                 cuPackListMgmt.showOrderDocument(Rec);
                               END;
                                }
      { 1000000024;2 ;Action    ;
                      Name=acComments;
                      CaptionML=[ENU=Co&mments;
                                 ESM=Comentarios;
                                 FRC=Commentaires;
                                 ENC=Co&mments];
                      Image=ViewComments;
                      OnAction=BEGIN
                                 cuPackListMgmt.showOrderComments(Rec);
                               END;
                                }
      { 1000000004;  ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1000000037;1 ;ActionGroup;
                      CaptionML=[ENU=F&unctions;
                                 ESM=Funciones;
                                 FRC=Fonctions;
                                 ENC=F&unctions];
                      Image=Action }
      { 1000000006;2 ;Action    ;
                      Name=acPackageWorksheet;
                      ShortCutKey=Shift+Ctrl+E;
                      CaptionML=[ENU=Package &Worksheet;
                                 ESM=Hoja de trabajo de paquete;
                                 FRC=Feuille de Travail package;
                                 ENC=Package &Worksheet];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Inventory;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 cuPackLineMgmt.showOrderPackages(Rec);
                               END;
                                }
      { 1000000007;2 ;Separator  }
      { 1000000005;2 ;Action    ;
                      Name=acGetLabel;
                      CaptionML=[ENU=Get &Label;
                                 ESM=Obtener etiqueta;
                                 FRC=Extraire êtiquette;
                                 ENC=Get &Label];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=SuggestItemPrice;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 cuRateMgmt.getShippingLabel(Rec);
                               END;
                                }
      { 1000000046;2 ;Action    ;
                      Name=acShpOptions;
                      CaptionML=[ENU=Shipment Options;
                                 ESM=Opciones de env°o;
                                 FRC=Options de livraison;
                                 ENC=Shipment Options];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Shipment;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 lpgDShipPkgWorksheet@1000000000 : Page 23044602;
                               BEGIN
                                 lpgDShipPkgWorksheet.doShipOptions("Document Type", "Document No.", "Document Subtype");
                               END;
                                }
      { 1000000041;2 ;Action    ;
                      Name=acCustoms;
                      CaptionML=[ENU=Customs;
                                 ESM=Aduana;
                                 FRC=Aupräs des administrations douaniäres;
                                 ENC=Customs];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Voucher;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 doCustoms;
                               END;
                                }
      { 1000000048;2 ;Action    ;
                      Name=acGetReturnLabel;
                      CaptionML=[ENU=Get Return Label;
                                 ESM=Obtener etiqueta devoluci¢n;
                                 FRC=Extraire êtiquette de Retour;
                                 ENC=Get Return Label];
                      Image=ReturnShipment;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 getReturnLabel("Document Type", "Document No.");
                               END;
                                }
      { 1000000045;2 ;Action    ;
                      Name=acGetTracking;
                      CaptionML=[ENU=Show Tracking;
                                 ESM=Mostrar seguimiento;
                                 FRC=Afficher la TraáabilitÇ;
                                 ENC=Show Tracking];
                      Image=OrderTracking;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 showTrackingURLs;
                               END;
                                }
      { 1000000043;1 ;ActionGroup;
                      CaptionML=[ENU=&Page;
                                 ESM=P†gina;
                                 FRC=Page;
                                 ENC=&Page] }
      { 1000000047;2 ;Action    ;
                      Name=acReload;
                      ShortCutKey=Shift+F5;
                      CaptionML=[ENU=Refresh;
                                 ESM=Actualizar;
                                 FRC=Actualiser;
                                 ENC=Refresh];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Refresh;
                      PromotedCategory=Category5;
                      OnAction=BEGIN
                                 loadDocuments;
                               END;
                                }
      { 1000000034;1 ;ActionGroup;
                      CaptionML=[ENU=&Print;
                                 ESM=Imprimir;
                                 FRC=Imprimer;
                                 ENC=&Print];
                      Image=Print }
      { 1000000036;2 ;Action    ;
                      Name=acPrintIntPackageLabel;
                      CaptionML=[ENU=Internal Package Label;
                                 ESM=Etiqueta de paquete interno;
                                 FRC=êtiquette de Package. internes;
                                 ENC=Internal Package Label];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Print;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 printInternalPackLabel;
                               END;
                                }
      { 1000000042;2 ;Action    ;
                      Name=acPrintCarrierLabel;
                      CaptionML=[ENU=Carrier Label;
                                 ESM=Etiqueta de soporte;
                                 FRC=êtiquette carrier;
                                 ENC=Carrier Label];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=PrintCover;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 printCarrierLabel;
                               END;
                                }
      { 1000000035;2 ;Action    ;
                      Name=acPrintBillOfLading;
                      CaptionML=[ENU=Bill of Lading;
                                 ESM=Facturaci¢n de Lading;
                                 FRC=Lading de de facturation;
                                 ENC=Bill of Lading];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=PrintDocument;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 printBillOfLading;
                               END;
                                }
      { 1000000044;2 ;Action    ;
                      Name=acCommInv;
                      CaptionML=[ENU=Commercial Invoice;
                                 ESM=Factura comercial;
                                 FRC=Facture commercial;
                                 ENC=Commercial Invoice];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=Invoice;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 printCommercialInvoice;
                               END;
                                }
      { 1000000049;2 ;Action    ;
                      Name=acPrintReturnLabel;
                      CaptionML=[ENU=Return Label;
                                 ESM=Etiqueta de devoluci¢n;
                                 FRC=êtiquette de retour;
                                 ENC=Return Label];
                      Image=PrintCheck;
                      PromotedCategory=Category4;
                      OnAction=BEGIN
                                 printReturnLabel("Document Type", "Document No.", TRUE);
                               END;
                                }
      { 1000000040;1 ;ActionGroup;
                      CaptionML=[ENU=P&osting;
                                 ESM=Registro;
                                 FRC=Report;
                                 ENC=P&osting];
                      Image=Post }
      { 1000000039;2 ;Action    ;
                      Name=Post;
                      ShortCutKey=F9;
                      Ellipsis=Yes;
                      CaptionML=[ENU=P&ost;
                                 ESM=Registrar;
                                 FRC=Reporter;
                                 ENC=P&ost];
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=PostOrder;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 doPost;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1000000000;;Container;
                ContainerType=ContentArea }

    { 1000000003;1;Group  ;
                GroupType=Repeater }

    { 1000000001;2;Field  ;
                SourceExpr="Document Type" }

    { 1000000002;2;Field  ;
                SourceExpr="Document No." }

    { 1000000023;2;Field  ;
                SourceExpr="Location Code" }

    { 100000000;2;Field   ;
                SourceExpr="Source No." }

    { 1000000008;2;Field  ;
                SourceExpr="Ship-to Name" }

    { 1000000009;2;Field  ;
                SourceExpr="Ship-to Name 2";
                Visible=FALSE }

    { 1000000010;2;Field  ;
                SourceExpr="Ship-to Address" }

    { 1000000011;2;Field  ;
                SourceExpr="Ship-to Address 2";
                Visible=FALSE }

    { 1000000012;2;Field  ;
                SourceExpr="Ship-to City" }

    { 1000000013;2;Field  ;
                SourceExpr="Ship-to County" }

    { 1000000038;2;Field  ;
                SourceExpr="Ship-to Post Code" }

    { 1000000014;2;Field  ;
                SourceExpr="Ship-to Country/Region Code" }

    { 1000000015;2;Field  ;
                SourceExpr="Ship-to Phone No." }

    { 1000000016;2;Field  ;
                SourceExpr="Shipping Agent Code";
                Visible=FALSE }

    { 1000000017;2;Field  ;
                SourceExpr="Shipping Agent Service Code";
                Visible=FALSE }

    { 1000000018;2;Field  ;
                SourceExpr="Shipment Method Code";
                Visible=FALSE }

    { 1000000022;2;Field  ;
                SourceExpr="Sell-to Customer No.";
                Visible=FALSE }

    { 1000000028;2;Field  ;
                SourceExpr="Has Shipment Label" }

    { 1000000029;2;Field  ;
                SourceExpr="Labelled Status" }

    { 1000000030;2;Field  ;
                SourceExpr="No. of Labels" }

    { 1000000031;2;Field  ;
                SourceExpr="No. of Packages" }

    { 1000000032;2;Field  ;
                SourceExpr="Total Package Weight" }

    { 1000000033;2;Field  ;
                SourceExpr="Weight Unit of Measure Code" }

    { 1000000052;2;Field  ;
                SourceExpr="Document Status" }

    { 1000000051;2;Field  ;
                SourceExpr="Warehouse Shipment Status" }

    { 1000000050;2;Field  ;
                SourceExpr="Document Assigned User ID" }

    { 1000000053;2;Field  ;
                SourceExpr="Total Item Quantity" }

    { 1000000021;0;Container;
                ContainerType=FactBoxArea }

    { 1000000020;1;Part   ;
                SubPageLink=No.=FIELD(Sell-to Customer No.);
                PagePartID=Page9080;
                Visible=TRUE;
                PartType=Page }

    { 1000000019;1;Part   ;
                SubPageLink=No.=FIELD(Sell-to Customer No.);
                PagePartID=Page9084;
                Visible=TRUE;
                PartType=Page }

  }
  CODE
  {
    VAR
      cuPackListMgmt@1000000000 : Codeunit 23044600;
      cuPackLineMgmt@1000000001 : Codeunit 23044601;
      cuRateMgmt@1000000002 : Codeunit 23044602;
      cuCustomsMgmt@1000000003 : Codeunit 23044603;
      tcNotPacked@1000000004 : TextConst 'ENU=This order hasn''t been packed yet.;ESM=Este pedido se ha hasn''t embalado a£n.;FRC=Cette commande hasn''t encore ÇtÇ emballÇ.;ENC=This order hasn''t been packed yet.';

    LOCAL PROCEDURE printInternalPackLabel@1000000001();
    VAR
      lrecLPHeader@1000000000 : Record 23044505;
    BEGIN
      //<FUNC>
      //  Description: Prints the License Plate label for the shipping document
      //  Called From: This page
      //  Side Effect: None
      //</FUNC>

      filterLPHeader(lrecLPHeader);
      cuPackLineMgmt.printInternalPackageLabel(lrecLPHeader, 2);
    END;

    LOCAL PROCEDURE printCarrierLabel@1000000002();
    VAR
      lrecLPHeader@1000000000 : Record 23044505;
    BEGIN
      //<FUNC>
      //  Description: Prints the Carrier shipping label for the shipping document
      //  Called From: This page
      //  Side Effect: None
      //</FUNC>

      filterLPHeader(lrecLPHeader);
      cuRateMgmt.printCarrierLabel(lrecLPHeader,TRUE);
    END;

    LOCAL PROCEDURE doPost@1000000000();
    BEGIN
      //<FUNC>
      //  Description: Posts the shipping document
      //  Called From: This page
      //  Side Effect: None
      //</FUNC>

      cuPackListMgmt.postOrder(Rec);

      Rec.DELETE;
      Rec.RESET;

      //loadDocuments();
    END;

    LOCAL PROCEDURE doCustoms@1000000013();
    VAR
      lrecCustomsInfo@1000000000 : Record 23044605;
    BEGIN
      //<FUNC>
      //  Description: Displays the Customs record for the shipping document
      //  Called From: This page
      //  Side Effect: None
      //</FUNC>

      CASE "Document Type" OF
        "Document Type"::"Warehouse Shipment": cuCustomsMgmt.showCustomsPage(lrecCustomsInfo."Document Type"::"Warehouse Shipment","Document No.");
        "Document Type"::"Sales Order": cuCustomsMgmt.showCustomsPage(lrecCustomsInfo."Document Type"::"Sales Order","Document No.");
        "Document Type"::"Outbound Transfer": cuCustomsMgmt.showCustomsPage(lrecCustomsInfo."Document Type"::"Outbound Transfer","Document No.");
      END;
    END;

    LOCAL PROCEDURE printBillOfLading@1000000026();
    BEGIN
      //<FUNC>
      //  Description: Prints the bill of lading
      //  Called From: This page
      //  Side Effect: None
      //</FUNC>

      cuPackLineMgmt.printBillOfLading("Document Type", "Document No.", TRUE);
    END;

    LOCAL PROCEDURE loadDocuments@1000000003();
    VAR
      loptDocType@1000000000 : Option;
      lcodDocNo@1000000001 : Code[20];
      liDocSub@1000000002 : Integer;
    BEGIN
      //<FUNC>
      //  Description: Load documents to this page
      //  Called From: This page
      //  Side Effect: None
      //</FUNC>

      //  store information regarding currently selected document
      loptDocType := "Document Type";
      lcodDocNo := "Document No.";
      liDocSub := "Document Subtype";

      Rec.RESET;
      Rec.DELETEALL;
      cuPackListMgmt.getPackageOrders(Rec);
      Rec.RESET;

      //  Find all valid, then get the specific one to jump the selection
      IF Rec.FINDSET THEN
        IF Rec.GET(loptDocType,lcodDocNo,liDocSub) THEN ;
    END;

    LOCAL PROCEDURE filterLPHeader@1000000008(VAR precLPHeader@1000000000 : Record 23044505);
    BEGIN
      //<FUNC>
      //  Description: Sets ranges on LP Header based on selected document
      //  Called From: This page (23044601)
      //  Side Effect:
      //</FUNC>

      precLPHeader.RESET;
      precLPHeader.SETFILTER("No.", cuPackLineMgmt.CreateLPNoFilterWithDShipDocType(Rec."Document Type", Rec."Document No."));
    END;

    LOCAL PROCEDURE printCommercialInvoice@1000000011();
    VAR
      lrecLPHeader@1000000000 : Record 23044505;
    BEGIN
      //<FUNC>
      //  Description: Opens the commercial invoice (if it exists)
      //  Called From: This page (23044601)
      //  Side Effect: None
      //</FUNC>

      cuPackLineMgmt.printCommercialInvoice(Rec."Document Type", Rec."Document No.", TRUE);
    END;

    LOCAL PROCEDURE showTrackingURLs@1000000004();
    VAR
      lrecLPHeader@1000000002 : Record 23044505;
      lpgTrackingInfo@1000000000 : Page 23044621;
      loptSrcDocType@1000000001 : Option;
    BEGIN
      //<FUNC>
      //  Description: Displays the tracking URLs (if they exist)
      //  Called From: This page (23044601)
      //  Side Effect: None
      //</FUNC>

      CASE "Document Type" OF
        "Document Type"::"Sales Order":
          BEGIN
            loptSrcDocType := lrecLPHeader."Source Document"::"Sales Order";
          END;
        "Document Type"::"Outbound Transfer":
          BEGIN
            loptSrcDocType := lrecLPHeader."Source Document"::"Outbound Transfer";
          END;
        "Document Type"::"Warehouse Shipment":
          BEGIN
            loptSrcDocType := lrecLPHeader."Source Document"::Shipment;
          END;
      END; // case document type

      IF ( lpgTrackingInfo.initPage(loptSrcDocType, "Document No.") ) THEN BEGIN
        lpgTrackingInfo.RUNMODAL;
      END ELSE BEGIN
        MESSAGE(tcNotPacked);
      END;
    END;

    PROCEDURE getReturnLabel@1000000006(poptDocType@1000000002 : Option;pcodDocNo@1000000003 : Code[20]);
    VAR
      lrecShipOptions@1000000001 : Record 23044616;
      lrecLPHeader@1000000000 : Record 23044505;
      lrecDShipSetup@1000000004 : Record 23044600;
    BEGIN
      //<FUNC>
      //  Description: Makes a request for a return label
      //  Called From: This page (P23044601)
      //  Side Effect: None
      //</FUNC>

      IF ( cuRateMgmt.getReturnLabel(poptDocType, pcodDocNo) ) THEN BEGIN
        lrecDShipSetup.GET;
        IF ( lrecDShipSetup."Carrier Label Print Behaviour" <> lrecDShipSetup."Carrier Label Print Behaviour"::Manual ) THEN
          printReturnLabel(poptDocType, pcodDocNo, FALSE);
      END;
    END;

    PROCEDURE printReturnLabel@1000000007(poptDocType@1000000004 : Option;pcodDocNo@1000000003 : Code[20];pbShowRequestPage@1000000002 : Boolean);
    VAR
      lrecShipOptions@1000000001 : Record 23044616;
      lrecLPHeader@1000000000 : Record 23044505;
      lrecLabelData@1000000005 : Record 23044622;
    BEGIN
      //<FUNC>
      //  Description: Prints the return label
      //  Called From: This page (P23044601)
      //  Side Effect: None
      //</FUNC>

      IF ( NOT lrecShipOptions.GET(poptDocType, pcodDocNo) ) THEN EXIT;
      lrecLPHeader.SETRANGE("Package Order ID", lrecShipOptions."Order ID");
      IF ( lrecLPHeader.FINDSET(FALSE) ) THEN
        cuRateMgmt.printReturnLabel(lrecLPHeader, pbShowRequestPage);
    END;

    BEGIN
    {
      ************************
      Copyright Notice
      This objects content is copyright of Insight Works 2011.  All rights reserved.
      Any redistribution or reproduction of part or all of the contents in any form is prohibited.
      ************************
      2019-25-11 TPZ2719 VAHAMAD
       Code added on OnOpenPage trigger to apply filter from user setup to Order Packagin Page
    }
    END.
  }
}

