OBJECT Page 14000564 Item Usage List
{
  OBJECT-PROPERTIES
  {
    Date=11/01/20;
    Time=12:00:00 PM;
    Version List=UBP3.03;
  }
  PROPERTIES
  {
    Editable=No;
    CaptionML=ENU=Item Usage List;
    ApplicationArea=#All;
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    LinksAllowed=No;
    SourceTable=Table14000557;
    DelayedInsert=No;
    SourceTableView=SORTING(Item No.,Location Code,Variant Code,Starting Date,Ending Date);
    PageType=List;
    OnInit=BEGIN
             SporadicTargetStockLevelVisibl := TRUE;
             StatusVisible := TRUE;
             "Re-For. FormulaVisible" := TRUE;
             "Forecast UsageVisible" := TRUE;
           END;

    OnOpenPage=BEGIN
                 InvMgtSetup.GET;
                 IF GETFILTER("Source No.") = '' THEN
                   SETRANGE("Source No.",'');
                 IF GETFILTER("Starting Date") = '' THEN
                   SETFILTER("Starting Date", '%1..', CALCDATE('<-CM-2Y>', WORKDATE));
                 Formula.SETRANGE(Released,TRUE);
                 IF Formula.ISEMPTY THEN BEGIN
                   "Forecast UsageVisible" := FALSE;
                   "Re-For. FormulaVisible" := FALSE;
                   StatusVisible := FALSE;
                   SporadicTargetStockLevelVisibl := FALSE;
                 END ELSE BEGIN
                   "Forecast UsageVisible" := TRUE;
                   "Re-For. FormulaVisible" := TRUE;
                   StatusVisible := TRUE;
                   SporadicTargetStockLevelVisibl := TRUE;
                 END;
               END;

    OnAfterGetRecord=BEGIN
                       OnAfterRecord;

                       IF "Variant Code" <> '' THEN
                         ItemVariantDesc := "Variant Description"
                       ELSE
                         ItemVariantDesc := "Item Description";

                       ForecastUsageOnFormat(FORMAT("Forecast Usage"));
                       ForecastUsagePerDayOnFormat(FORMAT("Forecast Usage Per Day"));
                       SporadicTargetStockLevelOnForm(FORMAT("Sporadic Target Stock Level"));
                       AverageUsagePerDayOnFormat(FORMAT("Average Usage Per Day"));
                       TotalUsagetoAverageOnFormat(FORMAT("Total Usage to Average"));
                     END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 1240030002;1 ;Action    ;
                      ShortCutKey=Shift+F7;
                      CaptionML=ENU=&Procurement Unit;
                      ApplicationArea=#All;
                      RunObject=Page 14000558;
                      RunPageLink=Location Code=FIELD(Location Code),
                                  Item No.=FIELD(Item No.),
                                  Variant Code=FIELD(Variant Code);
                      Promoted=Yes;
                      PromotedIsBig=Yes;
                      Image=BankAccountRec;
                      PromotedCategory=Process }
      { 1240030003;1 ;Action    ;
                      ShortCutKey=Ctrl+F7;
                      CaptionML=ENU=Usage &Ledger Entries;
                      ApplicationArea=#All;
                      RunObject=Page 14000562;
                      RunPageView=SORTING(Location Code,Item No.,Variant Code,Entry Type,Exclude from Usage,Drop Shipment,Nonstock,Usage Date,Transfer Out,Replenishment Path Transfer,Source No.)
                                  ORDER(Ascending);
                      RunPageLink=Location Code=FIELD(Location Filter),
                                  Item No.=FIELD(Item No.),
                                  Variant Code=FIELD(Variant Code),
                                  Usage Date=FIELD(Date Filter);
                      Promoted=No;
                      Image=ItemLedger;
                      PromotedCategory=Process }
      { 1240030029;1 ;Action    ;
                      CaptionML=ENU=&Unusual Usage Adj.;
                      ApplicationArea=#All;
                      RunObject=Page 14002657;
                      RunPageView=SORTING(Location Code,Item No.,Variant Code,Starting Date,Ending Date)
                                  ORDER(Ascending);
                      RunPageLink=Location Code=FIELD(Location Code),
                                  Item No.=FIELD(Item No.),
                                  Variant Code=FIELD(Variant Code);
                      Promoted=No;
                      Image=CalculateDepreciation;
                      PromotedCategory=Process }
      { 1240020008;1 ;Action    ;
                      CaptionML=ENU=Location Inventory &Roll Up;
                      ApplicationArea=#All;
                      Image=BOMVersions;
                      OnAction=BEGIN
                                 ProcUnit.GET("Location Code","Item No.","Variant Code");
                                 UBP.DisplayLocInvRollup(ProcUnit);
                               END;
                                }
      { 1240030028;1 ;Action    ;
                      CaptionML=ENU=View &Forecast;
                      ApplicationArea=#All;
                      Image=CalculateRegenerativePlan;
                      OnAction=BEGIN
                                 ProcUnit.GET("Location Code","Item No.","Variant Code");
                                 CLEAR(ForecastView);
                                 ForecastView.SetProcUnitandSourceNo(ProcUnit,"Source No.");
                                 ForecastView.RUN;
                               END;
                                }
      { 1240020003;1 ;Action    ;
                      CaptionML=ENU=Replenishment Path;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=RoutingVersions;
                      OnAction=BEGIN
                                 ProcUnit.GET(
                                   "Location Code","Item No.","Variant Code");
                                 UBP.DisplayReplenishmentPath(ProcUnit);
                               END;
                                }
      { 1240030027;1 ;Separator  }
      { 1240020007;1 ;Action    ;
                      CaptionML=ENU=Formula &Detail;
                      ApplicationArea=#All;
                      RunObject=Page 14002658;
                      RunPageLink=Location Code=FIELD(Location Code),
                                  Item No.=FIELD(Item No.),
                                  Variant Code=FIELD(Variant Code);
                      Image=ItemWorksheet }
      { 1240020015;1 ;Action    ;
                      CaptionML=ENU=External Time Series;
                      ApplicationArea=#All;
                      RunObject=Page 14000563;
                      RunPageLink=Location Code=FIELD(Location Code),
                                  Item No.=FIELD(Item No.),
                                  Variant Code=FIELD(Variant Code);
                      Image=Timesheet }
      { 1240030036;1 ;Separator  }
      { 1240030037;1 ;Action    ;
                      CaptionML=ENU=Show &Actual Usage;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=ProdBOMMatrixPerVersion;
                      OnAction=BEGIN
                                 ShowActualUsage := TRUE;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1240030038;1 ;Action    ;
                      CaptionML=ENU=Show &Calculated Usage;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=CalculateWIP;
                      OnAction=BEGIN
                                 ShowActualUsage := FALSE;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1240020014;1 ;Action    ;
                      CaptionML=ENU=Show Item Usage Adjustments;
                      ApplicationArea=#All;
                      RunObject=Page 14000567;
                      RunPageView=SORTING(Item No.,Location Code,Variant Code,Starting Date,Ending Date,Line No.);
                      RunPageLink=Location Code=FIELD(Location Code),
                                  Item No.=FIELD(Item No.),
                                  Variant Code=FIELD(Variant Code),
                                  Starting Date=FIELD(Starting Date);
                      Image=EntriesList;
                      OnAction=BEGIN
                                 ShowActualUsage := TRUE;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1900000004;0 ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1240030022;1 ;Action    ;
                      CaptionML=ENU=&Adjust Usage;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=AdjustEntries;
                      OnAction=BEGIN
                                 ItemUsageAdj.RESET;
                                 ItemUsageAdj.SETRANGE("Location Code","Location Code");
                                 ItemUsageAdj.SETRANGE("Item No.","Item No.");
                                 ItemUsageAdj.SETRANGE("Variant Code","Variant Code");
                                 ItemUsageAdj.SETRANGE("Starting Date","Starting Date");
                                 ItemUsageAdj.SETRANGE("Ending Date","Ending Date");
                                 AdjQty := "Adjustment Quantity";
                                 PAGE.RUNMODAL(PAGE::"Item Usage Adjustment",ItemUsageAdj);
                                 CALCFIELDS("Adjustment Quantity");
                                 IF AdjQty <> "Adjustment Quantity" THEN BEGIN
                                   ItemUsage.GET("Entry No.");
                                   ItemUsage."Adj. After Close" := TRUE;
                                   ItemUsage.MODIFY;
                                   CurrPage.UPDATE(FALSE);
                                 END;
                               END;
                                }
      { 1240030039;1 ;Action    ;
                      CaptionML=ENU=&Delete Cloned Usage;
                      ApplicationArea=#All;
                      Promoted=No;
                      Image=Copy;
                      OnAction=BEGIN
                                 RemoveClonedUsage;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1   ;1   ;Group     ;
                Editable=FALSE;
                GroupType=Repeater }

    { 2   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Location Code" }

    { 4   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Item No." }

    { 33  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Variant Code";
                Visible=FALSE }

    { 1240030030;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Source No." }

    { 1240020005;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Item Description";
                Visible=FALSE }

    { 1240020009;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Variant Description";
                Visible=FALSE }

    { 6   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Starting Date" }

    { 8   ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Ending Date";
                Visible=FALSE }

    { 1240030025;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Usage Hits";
                OnDrillDown=BEGIN
                              DrillDown(FIELDNO("Usage Hits"),ShowActualUsage);
                            END;
                             }

    { 10  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Usage Quantity";
                OnDrillDown=BEGIN
                              DrillDown(FIELDNO("Usage Quantity"),ShowActualUsage);
                            END;
                             }

    { 26  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Exclude Usage Quantity";
                Visible=FALSE;
                OnDrillDown=BEGIN
                              DrillDown(FIELDNO("Exclude Usage Quantity"),ShowActualUsage);
                            END;
                             }

    { 24  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Adjustment Quantity";
                Visible=FALSE;
                OnDrillDown=BEGIN
                              DrillDown(FIELDNO("Adjustment Quantity"),ShowActualUsage);
                            END;
                             }

    { 1240030023;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Drop Ship Usage Quantity";
                Visible=FALSE;
                OnDrillDown=BEGIN
                              DrillDown(FIELDNO("Drop Ship Usage Quantity"),ShowActualUsage);
                            END;
                             }

    { 16  ;2   ;Field     ;
                CaptionML=ENU=Adjusted Usage;
                ApplicationArea=#All;
                DecimalPlaces=0:1;
                SourceExpr=AdjustedUsage }

    { 1240020013;2;Field  ;
                Name=Consumption;
                DecimalPlaces=0:5;
                SourceExpr=GetConsumption;
                Visible=false;
                Editable=false;
                OnDrillDown=BEGIN
                              DrillDownConsumption;
                            END;
                             }

    { 66  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Periods to Average";
                Visible=FALSE }

    { 1240020000;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Net Average Usage";
                Visible=FALSE }

    { 1240020010;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Single Loc. Avg Usage Per Day";
                Visible=FALSE }

    { 1240020002;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Average Usage";
                Visible=FALSE }

    { 1240020001;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Safety Allowance Qty." }

    { 1240020012;2;Field  ;
                SourceExpr="Mean Deviation Units";
                Visible=FALSE }

    { 1240020011;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Average Order Qty." }

    { 1240030009;2;Field  ;
                ApplicationArea=#All;
                SourceExpr=Status;
                Visible=StatusVisible }

    { 1240030007;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Re-For. Formula";
                Visible="Re-For. FormulaVisible";
                OnLookup=BEGIN
                           IF Formula.GET("Re-For. Formula") THEN
                             PAGE.RUN(PAGE::"Formula Card",Formula);
                         END;
                          }

    { 3   ;2   ;Field     ;
                SourceExpr="Re-For. Non Seasonal Trend %";
                Visible=FALSE }

    { 5   ;2   ;Field     ;
                SourceExpr="Re-For. Seasonal Trend %";
                Visible=FALSE }

    { 1240030000;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Forecast Usage";
                Visible="Forecast UsageVisible" }

    { 1240030005;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Forecast Usage Per Day";
                Visible=FALSE }

    { 1240030011;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Sporadic Target Stock Level";
                Visible=SporadicTargetStockLevelVisibl }

    { 1240030032;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Item Class Description" }

    { 1240030034;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Ranking Code";
                Visible=TRUE }

    { 37  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Total Stockout Days";
                Visible=FALSE }

    { 1000000000;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Average Usage Per Day";
                Visible=FALSE }

    { 39  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Total Usage to Average";
                Visible=FALSE }

    { 49  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Annualized COGS";
                Visible=FALSE }

    { 61  ;2   ;Field     ;
                ApplicationArea=#All;
                SourceExpr="Open Review";
                Visible=FALSE }

    { 1240030013;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Forecast Cust. Actual Usage";
                Visible=FALSE }

    { 1240030015;2;Field  ;
                ApplicationArea=#All;
                SourceExpr="Customer Forecast";
                Visible=FALSE }

    { 1000000001;2;Field  ;
                DecimalPlaces=0:1;
                SourceExpr="Re-For. Median Error %";
                Visible=false }

    { 1240020004;1;Group  ;
                Name=Item Usage;
                CaptionML=ENU=Item Usage;
                GroupType=Group }

    { 1240020006;2;Field  ;
                CaptionML=ENU=Description;
                ApplicationArea=#All;
                SourceExpr=ItemVariantDesc;
                Importance=Promoted;
                Editable=FALSE }

  }
  CODE
  {
    VAR
      ForecastCustomer@1240030002 : Record 14002601;
      Formula@1240030001 : Record 14002652;
      ItemUsageAdj@14000500 : Record 14000558;
      Location@14000501 : Record 14;
      InvMgtSetup@1240030000 : Record 14000551;
      ItemUsage@14000504 : Record 14000557;
      ProcUnit@1240030004 : Record 14000555;
      UBP@1240030006 : Codeunit 14000564;
      ForecastView@1240030005 : Page 14002661;
      LocationCode@14000505 : Code[10];
      StartingDateFilter@14000506 : Code[20];
      StartingDate@14000507 : Date;
      AdjQty@1240030003 : Decimal;
      ShowActualUsage@1240030007 : Boolean;
      ItemVariantDesc@1240020000 : Text[100];
      "Forecast UsageVisible"@19015247 : Boolean INDATASET;
      "Re-For. FormulaVisible"@19031464 : Boolean INDATASET;
      StatusVisible@19025579 : Boolean INDATASET;
      SporadicTargetStockLevelVisibl@19049589 : Boolean INDATASET;
      LCPStartDateBegin@1240020002 : Date;
      LCPStartDateEnd@1240020001 : Date;

    LOCAL PROCEDURE OnAfterRecord@19077479();
    BEGIN
      IF ShowActualUsage THEN
        SETFILTER("Location Filter","Location Code")
      ELSE
        SETFILTER(
          "Location Filter",UBP.GetUsageLocationFilter(
             "Location Code","Item No.","Variant Code",ShowActualUsage));
      SETFILTER("Date Filter",'%1..%2',"Starting Date","Ending Date");
      CALCFIELDS(
        "Usage Quantity","Exclude Usage Quantity","Adjustment Quantity",
        "Drop Ship Usage Quantity","Usage Hits",
        "Forecast Cust. Actual Usage","Customer Forecast",
        "Item Description","Variant Description");
    END;

    LOCAL PROCEDURE ForecastUsageOnFormat@19028132(Text@19024435 : Text[1024]);
    BEGIN
      InvMgtSetup.FormatField(Text);
    END;

    LOCAL PROCEDURE ForecastUsagePerDayOnFormat@19072691(Text@19069530 : Text[1024]);
    BEGIN
      InvMgtSetup.FormatField(Text);
    END;

    LOCAL PROCEDURE SporadicTargetStockLevelOnForm@19005933(Text@19063773 : Text[1024]);
    BEGIN
      InvMgtSetup.FormatField(Text);
    END;

    LOCAL PROCEDURE AverageUsagePerDayOnFormat@19004574(Text@19060508 : Text[1024]);
    BEGIN
      InvMgtSetup.FormatField(Text);
    END;

    LOCAL PROCEDURE TotalUsagetoAverageOnFormat@19058573(Text@19066428 : Text[1024]);
    BEGIN
      InvMgtSetup.FormatField(Text);
    END;

    LOCAL PROCEDURE GetConsumption@1240020000() : Decimal;
    VAR
      ItemLedgEntry@1240020000 : Record 32;
    BEGIN
      IF NOT InvMgtSetup."Consider Comp. Cons. as Usage" THEN BEGIN
        ItemLedgEntry.SETFILTER("Entry Type", '%1|%2', ItemLedgEntry."Entry Type"::"Assembly Consumption", ItemLedgEntry."Entry Type"::Consumption);
        ItemLedgEntry.SETRANGE("Item No.", "Item No.");
        ItemLedgEntry.SETRANGE("Variant Code", "Variant Code");
        ItemLedgEntry.SETRANGE("Location Code", "Location Code");
        ItemLedgEntry.SETRANGE("Posting Date", "Starting Date", "Ending Date");
        ItemLedgEntry.CALCSUMS("Invoiced Quantity");
        EXIT(-ItemLedgEntry."Invoiced Quantity");
      END;
    END;

    LOCAL PROCEDURE DrillDownConsumption@1240020001();
    VAR
      ItemLedgEntry@1240020000 : Record 32;
    BEGIN
      ItemLedgEntry.SETFILTER("Entry Type", '%1|%2', ItemLedgEntry."Entry Type"::"Assembly Consumption", ItemLedgEntry."Entry Type"::Consumption);
      ItemLedgEntry.SETRANGE("Item No.", "Item No.");
      ItemLedgEntry.SETRANGE("Variant Code", "Variant Code");
      ItemLedgEntry.SETRANGE("Location Code", "Location Code");
      ItemLedgEntry.SETRANGE("Posting Date", "Starting Date", "Ending Date");
      PAGE.RUN(0, ItemLedgEntry);
    END;

    BEGIN
    END.
  }
}

