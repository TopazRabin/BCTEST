OBJECT Page 11123338 SC - Webshop Orders Overview
{
  OBJECT-PROPERTIES
  {
    Date=04/18/17;
    Time=[ 1:00:00 PM];
    Version List=SCW19.2.0;
  }
  PROPERTIES
  {
    CaptionML=ENU=Webshop Orders Overview;
    InsertAllowed=No;
    DeleteAllowed=No;
    ModifyAllowed=No;
    SourceTable=Table11123323;
    PageType=Worksheet;
    OnOpenPage=BEGIN
                 CountOfRecords := COUNT;
                 ApplyBasketFilter;
               END;

    OnAfterGetRecord=BEGIN
                       OnAfterGetCurrRec;
                       DocumentNoOnFormat;
                       OriginDocumentNoOnFormat;
                       DateReceivedOnFormat;
                       TimeReceivedOnFormat;
                       ShopAccountEMailOnFormat;
                       SelltoCustomerNoOnFormat;
                       SelltoContactNoOnFormat;
                       PaymentMethodNameOnFormat;
                       PaymentStatusOnFormat;
                       WebshopIDOnFormat;
                     END;

    OnNewRecord=BEGIN
                  OnAfterGetCurrRec;
                END;

    OnAfterGetCurrRecord=BEGIN
                           OnAfterGetCurrRec;
                         END;

    ActionList=ACTIONS
    {
      { 11123310;0   ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 11123308;1   ;ActionGroup;
                      CaptionML=ENU=&Document }
      { 11123306;2   ;Action    ;
                      CaptionML=ENU=Sana Commerce &Fields;
                      ApplicationArea=#Basic,#Suite;
                      Promoted=Yes;
                      Image=ElectronicDoc;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 ShowSanaFields;
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 11123323;0;Container;
                ContainerType=ContentArea }

    { 11123322;1;Group    ;
                CaptionML=ENU=General }

    { 11123321;2;Field    ;
                CaptionML=ENU=Document No. Filter;
                ApplicationArea=#Basic,#Suite;
                SourceExpr=DocNoFilter;
                OnValidate=BEGIN
                             ApplyDocNoFilter;
                               DocNoFilterOnAfterValidate;
                           END;
                            }

    { 11123320;2;Field    ;
                CaptionML=ENU=Payment Status Filter;
                ApplicationArea=#Basic,#Suite;
                SourceExpr=IsValidFilter;
                OnValidate=BEGIN
                             ApplyIsValidFilter;
                               IsValidFilterOnAfterValidate;
                           END;
                            }

    { 11123319;2;Field    ;
                CaptionML=ENU=Webshop Filter;
                ApplicationArea=#Basic,#Suite;
                SourceExpr=WebshopFilter;
                OnValidate=BEGIN
                             ApplyWebshopFilter;
                               WebshopFilterOnAfterValidate;
                           END;

                OnLookup=VAR
                           Webshop@11123303 : Record 11123313;
                           WebshopsForm@11123302 : Page 11123312;
                         BEGIN
                           CLEAR(WebshopsForm);
                           IF Text <> '' THEN
                             Webshop.GET(Text)
                           ELSE
                             Webshop.FINDFIRST;

                           WebshopsForm.LOOKUPMODE(TRUE);
                           WebshopsForm.SETTABLEVIEW(Webshop);
                           WebshopsForm.SETRECORD(Webshop);
                           IF WebshopsForm.RUNMODAL = ACTION::LookupOK THEN BEGIN
                             WebshopsForm.GETRECORD(Webshop);
                             Text := Webshop.ID;
                             EXIT(TRUE);
                           END;
                         END;
                          }

    { 11123318;2;Field    ;
                CaptionML=ENU=No. of Orders;
                ApplicationArea=#Basic,#Suite;
                SourceExpr=CountOfRecords;
                Editable=FALSE }

    { 11123317;2;Field    ;
                CaptionML=ENU=Show Draft Documents;
                ApplicationArea=#Basic,#Suite;
                SourceExpr=ShowBasketDoc;
                OnValidate=BEGIN
                             ApplyBasketFilter;
                             ShowBasketDocOnAfterValidate;
                           END;
                            }

    { 11123316;1;Group    ;
                GroupType=Repeater }

    { 11123315;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Document No.";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123314;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Origin. Document No.";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123313;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Date Received";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123312;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Time Received";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123311;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Shop Account E-Mail";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123309;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Sell-to Customer No.";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123307;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Sell-to Contact No.";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123305;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Payment Method Name";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123304;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Payment Method Status";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123303;2;Field    ;
                ApplicationArea=#Basic,#Suite;
                SourceExpr="Webshop ID";
                Style=Unfavorable;
                StyleExpr=IsValid }

    { 11123302;1;Part     ;
                Name=WebOrdersOverviewLines;
                ApplicationArea=#Basic,#Suite;
                SubPageLink=Unique Webshop Document Id=FIELD(Unique Webshop Document Id);
                PagePartID=Page11123339;
                PartType=Page }

  }
  CODE
  {
    VAR
      CurrentDocNo@11123306 : Code[20];
      DocNoFilter@11123302 : Text[80];
      PaymentNameFilter@11123303 : Text[80];
      PaymentStatusFilter@11123304 : Text[80];
      WebshopFilter@11123305 : Text[80];
      IsValidFilter@11123307 : 'All,Valid Only,Invalid Only';
      CountOfRecords@11123308 : Integer;
      IsValid@19037655 : Boolean INDATASET;
      ShowBasketDoc@11123309 : Boolean;

    PROCEDURE RefreshSubform@11123302();
    BEGIN
      CurrPage.WebOrdersOverviewLines.PAGE.SetValues(Rec);
      CurrentDocNo := "Document No.";
    END;

    LOCAL PROCEDURE PaymentStatusIsValid@11123303() : Boolean;
    BEGIN
      EXIT(("Payment Method Status" <> 'new') AND ("Payment Method Status" <> 'cancelled'));
    END;

    LOCAL PROCEDURE ApplyWebshopFilter@11123304();
    BEGIN
      IF WebshopFilter = '' THEN
        SETRANGE("Webshop ID")
      ELSE
        SETFILTER("Webshop ID",WebshopFilter);
    END;

    LOCAL PROCEDURE ApplyDocNoFilter@11123305();
    VAR
      SalesDocHeader@11123302 : Record 11123323;
    BEGIN
      IF DocNoFilter = '' THEN BEGIN
        SETRANGE("Document No.");
        SETRANGE("Origin. Document No.");
      END ELSE BEGIN
        SalesDocHeader.COPYFILTERS(Rec);
        SalesDocHeader.SETFILTER("Document No.",DocNoFilter);
        IF SalesDocHeader.FINDFIRST THEN
          SETFILTER("Document No.",DocNoFilter)
        ELSE BEGIN
          SalesDocHeader.SETRANGE("Document No.");
          SalesDocHeader.SETFILTER("Origin. Document No.",DocNoFilter);
          IF SalesDocHeader.FINDFIRST THEN
            SETFILTER("Origin. Document No.",DocNoFilter);
        END;
      END;
    END;

    LOCAL PROCEDURE ApplyIsValidFilter@11123308();
    BEGIN
      CASE IsValidFilter OF
        IsValidFilter::All : SETRANGE("Payment Method Status");
        IsValidFilter::"Valid Only" : SETFILTER("Payment Method Status",'<>%1&<>%2','new','cancelled');
        IsValidFilter::"Invalid Only" : SETFILTER("Payment Method Status",'%1|%2','new','cancelled');
      END;
    END;

    LOCAL PROCEDURE UpdateForm@11123319(SaveChanges@11123302 : Boolean);
    BEGIN
      CountOfRecords := COUNT;
      CurrPage.UPDATE(SaveChanges);
    END;

    PROCEDURE ShowDocument@11123306();
    BEGIN
      CurrPage.WebOrdersOverviewLines.PAGE.ShowDocument;
    END;

    PROCEDURE ShowSanaFields@11123307();
    VAR
      TempSalesDocHeader@11123302 : TEMPORARY Record 11123323;
      OrderFunc@11123303 : Codeunit 11123319;
    BEGIN
      TempSalesDocHeader.INIT;
      TempSalesDocHeader := Rec;
      TempSalesDocHeader.INSERT;
      IF PAGE.RUNMODAL(PAGE::"SC - Sales Document Fields",TempSalesDocHeader) = ACTION::LookupOK THEN
        IF NOT OrderFunc.RecordsEqual11123323(Rec,TempSalesDocHeader) THEN BEGIN
          Rec := TempSalesDocHeader;
          MODIFY(TRUE);
        END;
    END;

    LOCAL PROCEDURE WebshopFilterOnAfterValidate@19018875();
    BEGIN
      UpdateForm(FALSE);
    END;

    LOCAL PROCEDURE DocNoFilterOnAfterValidate@19079756();
    BEGIN
      UpdateForm(FALSE);
    END;

    LOCAL PROCEDURE IsValidFilterOnAfterValidate@19056347();
    BEGIN
      UpdateForm(FALSE);
    END;

    LOCAL PROCEDURE OnAfterGetCurrRec@19077479();
    BEGIN
      xRec := Rec;
      RefreshSubform;
    END;

    LOCAL PROCEDURE DocumentNoOnFormat@19001080();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE OriginDocumentNoOnFormat@19044471();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE DateReceivedOnFormat@19006447();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE TimeReceivedOnFormat@19036577();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE ShopAccountEMailOnFormat@19028089();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE SelltoCustomerNoOnFormat@19056208();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE SelltoContactNoOnFormat@19050057();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE PaymentMethodNameOnFormat@19048737();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE PaymentStatusOnFormat@19028228();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    LOCAL PROCEDURE WebshopIDOnFormat@19068056();
    BEGIN
      IsValid := NOT PaymentStatusIsValid;
    END;

    PROCEDURE ApplyBasketFilter@11123309();
    BEGIN
      IF ShowBasketDoc THEN
        SETRANGE("Document State","Document State"::Basket)
      ELSE
        SETFILTER("Document State",'<>%1',"Document State"::Basket);
    END;

    LOCAL PROCEDURE ShowBasketDocOnAfterValidate@11123313();
    BEGIN
      UpdateForm(FALSE);
    END;

    BEGIN
    END.
  }
}

