OBJECT Page 14000532 Surplus Available
{
  OBJECT-PROPERTIES
  {
    Date=06/01/19;
    Time=12:00:00 PM;
    Version List=UBP3.01;
  }
  PROPERTIES
  {
    CaptionML=ENU=Surplus Available;
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    SourceTable=Table14000584;
    PageType=List;
    RefreshOnActivate=Yes;
    OnOpenPage=BEGIN
                 SurplusInvValue.SETCURRENTKEY("Item No.","Variant Code","Suggested Order No.");
                 IF (SourceType = SourceType::"Sug. Order") THEN
                   QtyToTransferEdit := TRUE;
               END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 1240020001;1 ;Action    ;
                      CaptionML=ENU=Location Inventory &Roll Up;
                      Image=BOMVersions;
                      OnAction=BEGIN
                                 ShowLocInvRollUp;
                               END;
                                }
      { 1240030023;1 ;Action    ;
                      ShortCutKey=Shift+F11;
                      CaptionML=ENU=View &Forecast;
                      ToolTipML=ENU=Demand and supply plan;
                      Image=CalculateRegenerativePlan;
                      OnAction=BEGIN
                                 ShowForecast;
                               END;
                                }
      { 1240030021;1 ;Action    ;
                      CaptionML=ENU=Procurement Unit;
                      ToolTipML=ENU=Procurement unit card;
                      RunObject=Page 14000559;
                      RunPageLink=Location Code=FIELD(Location Code),
                                  Item No.=FIELD(Item No.),
                                  Variant Code=FIELD(Variant Code);
                      Image=BankAccountRec;
                      PromotedCategory=Process }
      { 1240030022;1 ;Action    ;
                      CaptionML=ENU=Item Usage;
                      ToolTipML=ENU=Summarized usage by month.;
                      Image=ItemTrackingLedger;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 ItemUsage.RESET;
                                 ItemUsage.SETCURRENTKEY(
                                   "Location Code","Item No.","Variant Code","Starting Date","Ending Date");
                                 ItemUsage.SETRANGE("Location Code","Location Code");
                                 ItemUsage.SETRANGE("Item No.","Item No.");
                                 PAGE.RUNMODAL(PAGE::"Item Usage List",ItemUsage);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                ContainerType=ContentArea }

    { 1240030000;1;Group  ;
                GroupType=Repeater }

    { 1240030001;2;Field  ;
                ToolTipML=ENU=Specifies a location code for the warehouse or distribution center where your items are handled and stored before being sold.;
                SourceExpr="Location Code";
                Editable=FALSE }

    { 1240030003;2;Field  ;
                ToolTipML=ENU=Item number;
                SourceExpr="Item No.";
                Editable=FALSE }

    { 1240030005;2;Field  ;
                SourceExpr="Variant Code";
                Visible=FALSE;
                Editable=FALSE }

    { 1240030007;2;Field  ;
                ToolTipML=ENU=Purchasing unit of measure;
                SourceExpr="Unit of Measure Code";
                Editable=FALSE }

    { 1240030024;2;Field  ;
                ToolTipML=ENU=Nonstock and no forecast;
                SourceExpr="Nonstock Item";
                Editable=FALSE }

    { 1240030033;2;Field  ;
                ToolTipML=ENU=Surplus inventory quantity;
                SourceExpr="Outstanding Surplus Qty (Base)" }

    { 1240030016;2;Field  ;
                ToolTipML=ENU=Quantity to be transferred from this location;
                SourceExpr="Quantity To Transfer";
                Editable=QtyToTransferEdit;
                OnValidate=BEGIN
                             IF "Quantity To Transfer" <> xRec."Quantity To Transfer" THEN BEGIN
                               ProcurementUnit.GET(TransferToLocation,"Item No.","Variant Code");
                               IF ProcurementUnit."Order Multiple" = 0 THEN
                                 ProcurementUnit."Order Multiple" := 1;
                               IF "Quantity To Transfer" MOD ProcurementUnit."Order Multiple" <> 0 THEN
                                 MESSAGE(Text001,"Quantity To Transfer",ProcurementUnit."Order Multiple");
                               "Buy-from Vendor No." := BuyFromVendorNo;
                               "Suggested Order No." := SugOrderNo;
                               "Suggested Order Line No." := SugOrderLineNo;
                               "Transfer To Location Code" := TransferToLocation;
                               CalcSurplus.UpdateSurplusQty("Transfer To Location Code", SourceType, SugOrderNo,
                                 "Location Code","Item No.","Variant Code", "Quantity To Transfer");
                               CALCFIELDS("Outstanding Surplus Qty (Base)");
                             END;
                             IF "Quantity To Transfer" = 0 THEN BEGIN
                               "Buy-from Vendor No." := '';
                               "Suggested Order No." := '';
                               "Suggested Order Line No." := 0;
                               "Transfer To Location Code" := '';
                             END;
                           END;
                            }

    { 1240030018;2;Field  ;
                ToolTipML=ENU=Quantity transferred from this location;
                SourceExpr="Quantity Transferred";
                Editable=FALSE }

    { 1240030026;2;Field  ;
                ToolTipML=ENU=Surplus inventory available beyond LTH date;
                SourceExpr="Surplus Date";
                Editable=FALSE }

    { 1240020000;2;Field  ;
                ToolTipML=ENU=First date of sales order shipment;
                SourceExpr="First Stocked Date" }

    { 1240030014;2;Field  ;
                ToolTipML=ENU=Item class based on COGS or percentage of items;
                SourceExpr="Item Class Description" }

    { 1240030028;2;Field  ;
                ToolTipML=ENU=Ranking code based on sales order 'hits';
                SourceExpr="Ranking Code" }

    { 1240030030;1;Group   }

    { 1240030031;2;Field  ;
                CaptionML=ENU=Qty. Needed (Base);
                DecimalPlaces=0:5;
                SourceExpr=QuantityNeededBase;
                Editable=FALSE }

    { 1240020003;0;Container;
                ContainerType=FactBoxArea }

    { 1240020002;1;Part   ;
                SubPageLink=Location Code=FIELD(Location Code),
                            Item No.=FIELD(Item No.),
                            Variant Code=FIELD(Variant Code);
                PagePartID=Page14097479;
                PartType=Page }

  }
  CODE
  {
    VAR
      ProcurementUnit@1240030009 : Record 14000555;
      SurplusInvValue@1240030002 : Record 14000584;
      ItemUsage@1240030007 : Record 14000557;
      ForecastView@1240030008 : Page 14002661;
      CalcSurplus@1240020003 : Codeunit 14000577;
      UBP@1240020005 : Codeunit 14000564;
      BuyFromVendorNo@1240030004 : Code[20];
      SugOrderNo@1240030005 : Code[20];
      SugOrderLineNo@1240030006 : Integer;
      SourceType@1240020002 : 'Surplus Calc.,Sug. Order,Sug. Inv. Repl.,Sug. Inv. Bal.,Tran. Order';
      TransferToLocation@1240030003 : Code[10];
      QuantityNeededBase@1240030001 : Decimal;
      QtyNeededBase@1240030000 : Decimal;
      Text001@1240020000 : TextConst 'ENU=The Quantity to Transfer %1 is not a multiple of Transfer To Order Multiple %2.  The Order Quanity (Base) will be reduced by the Quantity to Transfer and rounded up to Order Multiple.';
      Text002@1240020001 : TextConst 'ENU=The Quantity to Transfer %1 is not a multiple of the Transfer From Order Multiple %2.  The transfer is not accepted.';
      QtyToTransferEdit@1240020004 : Boolean;

    PROCEDURE LoadInfo@1240030000(CurrItemNo@1240030002 : Code[20];CurrVariantCode@1240030003 : Code[10];CurrTransferToLocation@1240030000 : Code[10];CurrQtyNeededBase@1240030001 : Decimal;CurrBuyFromVendorNo@1240030004 : Code[20];CurrSourceType@1240020001 : 'Surplus Calc.,Sug. Order,Sug. Inv. Repl.,Sug. Inv. Bal.,Tran. Order';CurrSugOrderNo@1240030005 : Code[20];CurrSugOrderLineNo@1240030006 : Integer);
    BEGIN
      TransferToLocation := CurrTransferToLocation;
      QtyNeededBase := CurrQtyNeededBase;
      BuyFromVendorNo := CurrBuyFromVendorNo;
      SugOrderNo := CurrSugOrderNo;
      SugOrderLineNo := CurrSugOrderLineNo;
      SourceType := CurrSourceType;
      RESET;
      SETRANGE("Item No.",CurrItemNo);
      SETRANGE("Variant Code",CurrVariantCode);
      SETRANGE("Surplus Available",TRUE);
      SETFILTER("Suggested Order No.",'%1|%2',SugOrderNo,' ');
      SETFILTER("Buy-from Vendor No.",'%1|%2',BuyFromVendorNo,' ');
    END;

    BEGIN
    END.
  }
}

