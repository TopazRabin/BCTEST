OBJECT Page 2341 BC O365 Sales Quote
{
  OBJECT-PROPERTIES
  {
    Date=10/22/20;
    Time=[ 4:57:39 AM];
    Version List=NAVW111.00.00.20783,NAVNA11.00.00.20783;
  }
  PROPERTIES
  {
    CaptionML=[ENU=Estimate;
               ESM=Estimar;
               FRC=Estimer;
               ENC=Estimate];
    DeleteAllowed=No;
    SourceTable=Table36;
    DataCaptionExpr='';
    SourceTableView=WHERE(Document Type=CONST(Quote));
    PageType=Document;
    RefreshOnActivate=Yes;
    OnInit=BEGIN
             IsCanada := O365SalesInvoiceMgmt.IsCountryCanada;
           END;

    OnOpenPage=VAR
                 O365SalesInitialSetup@1001 : Record 2110;
                 CalendarEventMangement@1002 : Codeunit 2160;
               BEGIN
                 IsUsingVAT := O365SalesInitialSetup.IsUsingVAT;

                 CalendarEventMangement.CreateCalendarEventForCodeunit(TODAY,SyncBusinessInfoTxt,CODEUNIT::"Graph Sync. - Business Profile");
                 ;ESACC_EasySecurity(TRUE);
               END;

    OnNewRecord=BEGIN
                  CustomerName := '';
                  CustomerEmail := '';
                  WorkDescription := '';
                  SetDefaultPaymentServices;
                END;

    OnInsertRecord=BEGIN
                     "Document Type" := "Document Type"::Quote;
                   END;

    OnDeleteRecord=VAR
                     CustInvoiceDisc@1000 : Record 19;
                   BEGIN
                     ForceExit := TRUE;

                     IF CustInvoiceDisc.GET("Invoice Disc. Code","Currency Code",0) THEN
                       CustInvoiceDisc.DELETE;
                   END;

    OnQueryClosePage=BEGIN
                       EXIT(O365SalesInvoiceMgmt.OnQueryCloseForSalesHeader(Rec,ForceExit,CustomerName));
                     END;

    OnAfterGetCurrRecord=VAR
                           TaxArea@1003 : Record 318;
                           Currency@1000 : Record 4;
                           GLSetup@1001 : Record 98;
                           O365TaxSettingsManagement@1020000 : Codeunit 10150;
                           O365DocumentSendMgt@1004 : Codeunit 2158;
                           CurrencySymbol@1002 : Text[10];
                         BEGIN
                           O365SalesInvoiceMgmt.UpdateCustomerFields(Rec,CustomerName,CustomerEmail);
                           IsCompanyContact := O365SalesInvoiceMgmt.IsCustomerCompanyContact("Sell-to Customer No.");
                           WorkDescription := GetWorkDescription;
                           CurrPageEditable := CurrPage.EDITABLE;
                           GetTotalTaxRate;
                           IF ("Sell-to Customer Name" <> '') AND "Tax Liable" AND (NOT O365TaxSettingsManagement.IsTaxSet("Tax Area Code")) THEN
                             O365SalesInvoiceMgmt.NotifyTaxSetupNeeded("Tax Area Code");
                           O365SalesInvoiceMgmt.UpdateNoOfAttachmentsLabel(O365SalesAttachmentMgt.GetNoOfAttachments(Rec),NoOfAttachmentsValueTxt);
                           SetDefaultPaymentServices;
                           IF "Currency Code" = '' THEN BEGIN
                             GLSetup.GET;
                             CurrencySymbol := GLSetup.GetCurrencySymbol;
                           END ELSE BEGIN
                             IF Currency.GET("Currency Code") THEN;
                             CurrencySymbol := Currency.GetCurrencySymbol;
                           END;
                           CurrencyFormat := STRSUBSTNO('%1<precision, 2:2><standard format, 0>',CurrencySymbol);

                           IF ("Sell-to Customer No." = '') AND ("Quote Valid Until Date" < WORKDATE) THEN
                             "Quote Valid Until Date" := WORKDATE + 30;

                           O365SalesInvoiceMgmt.CalcInvoiceDiscountAmount(Rec,SubTotalAmount,DiscountTxt,InvoiceDiscountAmount,InvDiscAmountVisible);

                           TaxAreaDescription := '';
                           IF "Tax Area Code" <> '' THEN
                             IF TaxArea.GET("Tax Area Code") THEN
                               TaxAreaDescription := TaxArea.GetDescriptionInCurrentLanguage;

                           O365SalesInvoiceMgmt.NotifyOrWarnAboutCoupons(Rec);
                           O365SalesInvoiceMgmt.GetCouponCodesAndCouponsExists(Rec,CouponCodes,CouponsExistsForCustomer);
                           O365DocumentSendMgt.ShowEstimateFailedNotificationOnOpenPage(Rec);
                         END;

    ActionList=ACTIONS
    {
      { 22      ;    ;ActionContainer;
                      CaptionML=[ENU=Invoice;
                                 ESM=Facturar;
                                 FRC=Facturer;
                                 ENC=Invoice];
                      ActionContainerType=ActionItems }
      { 11      ;1   ;Action    ;
                      Name=EmailQuote;
                      CaptionML=[ENU=Send;
                                 ESM=Enviar;
                                 FRC=Envoyer;
                                 ENC=Send];
                      ApplicationArea=#Basic,#Suite,#Invoicing;
                      Promoted=Yes;
                      Visible=ESACC_C11_Visible;
                      Enabled=ESACC_C11_Enabled AND ("Sell-to Customer Name" <> '');
                      PromotedIsBig=Yes;
                      Image=Invoicing-MDL-Send;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 SETRECFILTER;

                                 IF NOT O365SendResendInvoice.SendSalesInvoiceOrQuoteFromBC(Rec) THEN
                                   EXIT;

                                 FIND;
                                 CurrPage.UPDATE;
                                 ForceExit := TRUE;
                                 CurrPage.CLOSE;
                               END;

                      Gesture=LeftSwipe }
      { 23      ;1   ;Action    ;
                      Name=Post;
                      CaptionML=[ENU=Send final invoice;
                                 ESM=Enviar factura final;
                                 FRC=Envoyer la facture finale;
                                 ENC=Send final invoice];
                      ToolTipML=[ENU=Finalize and send the invoice.;
                                 ESM=Permite finalizar y enviar la factura.;
                                 FRC=Finalisez et envoyez la facture.;
                                 ENC=Finalize and send the invoice.];
                      ApplicationArea=#Basic,#Suite,#Invoicing;
                      Promoted=Yes;
                      Visible=false;
                      Enabled=ESACC_C23_Enabled AND ("Sell-to Customer Name" <> '');
                      PromotedIsBig=Yes;
                      Image=PostSendTo;
                      PromotedCategory=Process;
                      PromotedOnly=Yes;
                      OnAction=BEGIN
                                 ForceExit := TRUE;
                                 COMMIT;
                                 IF NOT O365SendResendInvoice.SendInvoiceFromQuote(Rec,FALSE) THEN
                                   ForceExit := FALSE;
                               END;
                                }
      { 28      ;1   ;Action    ;
                      Name=MakeToInvoice;
                      CaptionML=[ENU=Make invoice;
                                 ESM=Generar factura;
                                 FRC=êtablir facture;
                                 ENC=Make invoice];
                      ApplicationArea=#Basic,#Suite,#Invoicing;
                      Promoted=Yes;
                      Visible=ESACC_C28_Visible;
                      Enabled=ESACC_C28_Enabled AND ("Sell-to Customer Name" <> '');
                      Image=Invoicing-MDL-Invoice;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 IF NOT O365SendResendInvoice.MakeInvoiceFromQuote(Rec,TRUE) THEN
                                   EXIT;

                                 ForceExit := TRUE;

                                 SETRECFILTER;
                                 PAGE.RUNMODAL(PAGE::"BC O365 Sales Invoice",Rec);
                                 CurrPage.CLOSE;
                               END;
                                }
      { 3       ;1   ;Action    ;
                      Name=ViewPdf;
                      CaptionML=[ENU=Preview;
                                 ESM=Vista previa;
                                 FRC=Aperáu;
                                 ENC=Preview];
                      ToolTipML=[ENU=View the preview of the estimate before sending.;
                                 ESM=Permite obtener una vista previa de la estimaci¢n antes de enviarla.;
                                 FRC=Affichez l'aperáu de l'estimation avant envoi.;
                                 ENC=View the preview of the estimate before sending.];
                      ApplicationArea=#Basic,#Suite,#Invoicing;
                      Promoted=Yes;
                      Visible=ESACC_C3_Visible;
                      Enabled=ESACC_C3_Enabled AND ("Sell-to Customer Name" <> '');
                      Image=Invoicing-MDL-PreviewDoc;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 ReportSelections@1001 : Record 77;
                                 DocumentPath@1000 : Text[250];
                               BEGIN
                                 SETRECFILTER;
                                 LOCKTABLE;
                                 FIND;
                                 ReportSelections.GetPdfReport(DocumentPath,ReportSelections.Usage::"S.Quote",Rec,"Sell-to Customer No.");
                                 DOWNLOAD(DocumentPath,'','','',DocumentPath);
                                 FIND;
                               END;
                                }
      { 24      ;1   ;Action    ;
                      Name=SaveForLater;
                      CaptionML=[ENU=Save for later;
                                 ESM=Guardar para m†s adelante;
                                 FRC=Enregistrer pour plus tard;
                                 ENC=Save for later];
                      ToolTipML=[ENU=Close the estimate and save it for later.;
                                 ESM=Permite cerrar la estimaci¢n y guardarla para m†s adelante.;
                                 FRC=Fermez l'estimation et enregistrez-la pour plus tard.;
                                 ENC=Close the estimate and save it for later.];
                      ApplicationArea=#Basic,#Suite,#Invoicing;
                      Promoted=Yes;
                      Visible=false;
                      Enabled=ESACC_C24_Enabled AND ("Sell-to Customer Name" <> '');
                      Image=Invoicing-Save;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 ForceExit := TRUE;
                                 CurrPage.CLOSE;
                               END;
                                }
      { 30      ;1   ;Action    ;
                      Name=DeleteAction;
                      CaptionML=[ENU=Discard;
                                 ESM=Descartar;
                                 FRC=Ignorer;
                                 ENC=Discard];
                      ToolTipML=[ENU=Discards the estimate;
                                 ESM=Eliminar la estimaci¢n;
                                 FRC=Ignore l'estimation;
                                 ENC=Discards the estimate];
                      ApplicationArea=#Basic,#Suite,#Invoicing;
                      Promoted=Yes;
                      Visible=ESACC_C30_Visible;
                      Enabled=ESACC_C30_Enabled AND (CustomerName <> '');
                      Image=Invoicing-MDL-Delete;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 CustInvoiceDisc@1000 : Record 19;
                               BEGIN
                                 IF NOT CONFIRM(DeleteQst) THEN
                                   EXIT;

                                 ForceExit := TRUE;

                                 IF CustInvoiceDisc.GET("Invoice Disc. Code","Currency Code",0) THEN
                                   CustInvoiceDisc.DELETE;
                                 DELETE(TRUE);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1   ;0   ;Container ;
                ContainerType=ContentArea }

    { 5   ;1   ;Group     ;
                CaptionML=[ENU=Sell to;
                           ESM=Direcci¢n venta;
                           FRC=Donneur d'ordre;
                           ENC=Sell to];
                GroupType=Group }

    { 9   ;2   ;Field     ;
                CaptionML=[ENU=Customer Name;
                           ESM=Nombre del cliente;
                           FRC=Nom du client;
                           ENC=Customer Name];
                ToolTipML=[ENU=Specifies the customer's name.;
                           ESM=Especifica el nombre del cliente.;
                           FRC=Indique le nom du client.;
                           ENC=Specifies the customer's name.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                NotBlank=Yes;
                SourceExpr="Sell-to Customer Name";
                Importance=Promoted;
                Visible=ESACC_F79_Visible;
                Editable=ESACC_F79_Editable;
                LookupPageID=BC O365 Contact Lookup;
                HideValue=ESACC_F79_HideValue;
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerName(Rec,CustomerName,CustomerEmail);
                             O365SalesInvoiceMgmt.UpdateAddress(Rec,FullAddress);
                             CurrPage.UPDATE(TRUE);
                             O365SalesInvoiceMgmt.CustomerChanged;
                             O365SalesInvoiceMgmt.NotifyOrWarnAboutCoupons(Rec);
                             O365SalesInvoiceMgmt.GetCouponCodesAndCouponsExists(Rec,CouponCodes,CouponsExistsForCustomer);
                           END;

                ShowMandatory=TRUE;
                QuickEntry=FALSE }

    { 18  ;2   ;Field     ;
                ExtendedDatatype=E-Mail;
                CaptionML=[ENU=Email Address;
                           ESM=Direcci¢n de correo elect.;
                           FRC=Adresse de courriel;
                           ENC=Email Address];
                ToolTipML=[ENU=Specifies the customer's email address.;
                           ESM=Especifica la direcci¢n de correo electr¢nico del cliente.;
                           FRC=SpÇcifie l'adresse de courriel du client.;
                           ENC=Specifies the customer's email address.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=CustomerEmail;
                Editable=CurrPageEditable AND (CustomerName <> '');
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerEmail(Rec,CustomerEmail);
                           END;
                            }

    { 29  ;2   ;Field     ;
                CaptionML=[ENU=Customer accepted;
                           ESM=Cliente aceptado;
                           FRC=Client acceptÇ;
                           ENC=Customer accepted];
                ToolTipML=[ENU=Specifies whether the customer has accepted the quote or not.;
                           ESM=Especifica si el cliente ha aceptado la cotizaci¢n o no.;
                           FRC=SpÇcifie si le client a acceptÇ le devis ou non.;
                           ENC=Specifies whether the customer has accepted the quote or not.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Quote Accepted";
                Visible=ESACC_F154_Visible;
                Editable=ESACC_F154_Editable AND (CurrPageEditable AND (CustomerName <> ''));
                HideValue=ESACC_F154_HideValue }

    { 10  ;2   ;Group     ;
                Visible=CustomerName <> '';
                GroupType=Group }

    { 7   ;3   ;Field     ;
                Name=ViewContactCard;
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=ViewContactDetailsLbl;
                Editable=FALSE;
                OnDrillDown=VAR
                              Customer@1000 : Record 18;
                            BEGIN
                              IF Customer.GET("Sell-to Customer No.") THEN
                                PAGE.RUNMODAL(PAGE::"BC O365 Sales Customer Card",Customer);
                            END;

                ShowCaption=No }

    { 58  ;2   ;Group     ;
                GroupType=Group }

    { 57  ;3   ;Field     ;
                CaptionML=[ENU=Address;
                           ESM=Direcci¢n;
                           FRC=Adresse;
                           ENC=Address];
                ToolTipML=[ENU=Specifies the address where the customer is located.;
                           ESM=Especifica la direcci¢n donde reside el cliente.;
                           FRC=SpÇcifie l'adresse oó se trouve le client.;
                           ENC=Specifies the address where the customer is located.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Sell-to Address";
                Visible=ESACC_F81_Visible;
                Editable=ESACC_F81_Editable AND (CustomerName <> '');
                HideValue=ESACC_F81_HideValue;
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerAddress("Sell-to Address","Sell-to Customer No.");
                             O365SalesInvoiceMgmt.UpdateAddress(Rec,FullAddress);
                           END;
                            }

    { 56  ;3   ;Field     ;
                CaptionML=[ENU=Address 2;
                           ESM=Colonia 2;
                           FRC=Adresseˇ2;
                           ENC=Address 2];
                ToolTipML=[ENU=Specifies additional address information.;
                           ESM=Especifica informaci¢n adicional de la direcci¢n.;
                           FRC=SpÇcifie des informations d'adresse supplÇmentaires.;
                           ENC=Specifies additional address information.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Sell-to Address 2";
                Visible=ESACC_F82_Visible;
                Editable=ESACC_F82_Editable AND (CustomerName <> '');
                HideValue=ESACC_F82_HideValue;
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerAddress2("Sell-to Address 2","Sell-to Customer No.");
                             O365SalesInvoiceMgmt.UpdateAddress(Rec,FullAddress);
                           END;
                            }

    { 55  ;3   ;Field     ;
                Lookup=No;
                CaptionML=[ENU=ZIP Code;
                           ESM=C¢digo postal;
                           FRC=Code postal;
                           ENC=Postal/ZIP Code];
                ToolTipML=[ENU=Specifies the ZIP Code.;
                           ESM=Especifica el c¢digo postal.;
                           FRC=SpÇcifie le code postal.;
                           ENC=Specifies the postal code.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Sell-to Post Code";
                Visible=ESACC_F88_Visible;
                Enabled=ESACC_F88_Editable;
                Editable=ESACC_F88_Editable AND (CustomerName <> '');
                HideValue=ESACC_F88_HideValue;
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerPostCode("Sell-to Post Code","Sell-to Customer No.");
                             O365SalesInvoiceMgmt.UpdateAddress(Rec,FullAddress);
                           END;
                            }

    { 54  ;3   ;Field     ;
                Lookup=No;
                CaptionML=[ENU=City;
                           ESM=Municipio/Ciudad;
                           FRC=Ville;
                           ENC=City];
                ToolTipML=[ENU=Specifies the address city.;
                           ESM=Especifica el Municipio/Ciudad de la direcci¢n.;
                           FRC=SpÇcifie la ville de l'adresse.;
                           ENC=Specifies the address city.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Sell-to City";
                Visible=ESACC_F83_Visible;
                Enabled=ESACC_F83_Editable;
                Editable=ESACC_F83_Editable AND (CustomerName <> '');
                HideValue=ESACC_F83_HideValue;
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerCity("Sell-to City","Sell-to Customer No.");
                             O365SalesInvoiceMgmt.UpdateAddress(Rec,FullAddress);
                           END;
                            }

    { 53  ;3   ;Field     ;
                Lookup=No;
                CaptionML=[ENU=State;
                           ESM=Provincia;
                           FRC=ComtÇ;
                           ENC=Province/State];
                ToolTipML=[ENU=Specifies the address state.;
                           ESM=Especifica la provincia de la direcci¢n.;
                           FRC=SpÇcifie le comtÇ de l'adresse.;
                           ENC=Specifies the address province/state.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Sell-to County";
                Visible=ESACC_F89_Visible;
                Editable=ESACC_F89_Editable AND (CustomerName <> '');
                HideValue=ESACC_F89_HideValue;
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerCounty("Sell-to County","Sell-to Customer No.");
                             O365SalesInvoiceMgmt.UpdateAddress(Rec,FullAddress);
                           END;
                            }

    { 52  ;3   ;Field     ;
                CaptionML=[ENU=Country/Region Code;
                           ESM=C¢digo pa°s/regi¢n;
                           FRC=Code pays/rÇgion;
                           ENC=Country/Region Code];
                ToolTipML=[ENU=Specifies the address country/region.;
                           ESM=Especifica el pa°s o la regi¢n de la direcci¢n.;
                           FRC=SpÇcifie le pays/la rÇgion de l'adresse.;
                           ENC=Specifies the address country/region.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Sell-to Country/Region Code";
                Visible=ESACC_F90_Visible;
                Editable=ESACC_F90_Editable AND (CustomerName <> '');
                LookupPageID=BC O365 Country/Region List;
                HideValue=ESACC_F90_HideValue;
                OnValidate=BEGIN
                             O365SalesInvoiceMgmt.ValidateCustomerCountryRegion("Sell-to Country/Region Code","Sell-to Customer No.");
                             O365SalesInvoiceMgmt.UpdateAddress(Rec,FullAddress);
                           END;
                            }

    { 2   ;1   ;Group     ;
                CaptionML=[ENU=Quote Details;
                           ESM=Detalles oferta;
                           FRC=DÇtails devis;
                           ENC=Quote Details];
                GroupType=Group }

    { 26  ;2   ;Field     ;
                CaptionML=[ENU=Valid until;
                           ESM=V†lido hasta;
                           FRC=Valide jusqu'au;
                           ENC=Valid until];
                ToolTipML=[ENU=Specifies how long the quote is valid.;
                           ESM=Especifica la duraci¢n de la validez de la cotizaci¢n.;
                           FRC=SpÇcifie la durÇe pendant laquelle le devis est valide.;
                           ENC=Specifies how long the quote is valid.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Quote Valid Until Date";
                Visible=ESACC_F152_Visible;
                Editable=ESACC_F152_Editable AND (CustomerName <> '');
                HideValue=ESACC_F152_HideValue }

    { 4   ;2   ;Field     ;
                CaptionML=[ENU=Sent;
                           ESM=Enviado;
                           FRC=EnvoyÇ;
                           ENC=Sent];
                ToolTipML=[ENU=Specifies date and time of when the quote was sent to the customer.;
                           ESM=Especifica la fecha y la hora en que se envi¢ la cotizaci¢n al cliente.;
                           FRC=SpÇcifie la date et l'heure auxquelles le devis a ÇtÇ envoyÇ au client.;
                           ENC=Specifies date and time of when the quote was sent to the customer.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Quote Sent to Customer";
                Visible=ESACC_F153_Visible;
                Editable=ESACC_F153_Editable;
                HideValue=ESACC_F153_HideValue }

    { 6   ;2   ;Field     ;
                CaptionML=[ENU=Accepted on;
                           ESM=Aceptada el;
                           FRC=AcceptÇ le;
                           ENC=Accepted on];
                ToolTipML=[ENU=Specifies when the client accepted the quote.;
                           ESM=Especifica cu†ndo acept¢ el cliente la cotizaci¢n.;
                           FRC=SpÇcifie la date Ö laquelle le client a acceptÇ le devis.;
                           ENC=Specifies when the client accepted the quote.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Quote Accepted Date";
                Visible=ESACC_F155_Visible;
                Editable=ESACC_F155_Editable;
                HideValue=ESACC_F155_HideValue }

    { 35  ;2   ;Field     ;
                CaptionML=[ENU=Customer is tax liable;
                           ESM=El cliente est† sujeto a impuestos;
                           FRC=Client imposable;
                           ENC=Customer is tax liable];
                ToolTipML=[ENU=Specifies if the sales invoice contains sales tax.;
                           ESM=Especifica si la factura de venta incluye el impuesto sobre las ventas.;
                           FRC=SpÇcifie si la facture vente contient la taxe de vente.;
                           ENC=Specifies if the sales invoice contains sales tax.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Tax Liable";
                Visible=ESACC_F115_Visible AND (NOT IsUsingVAT);
                Editable=ESACC_F115_Editable AND (CustomerName <> '');
                HideValue=ESACC_F115_HideValue;
                OnValidate=BEGIN
                             CurrPage.UPDATE;
                           END;
                            }

    { 34  ;2   ;Field     ;
                Name=TaxAreaDescription;
                CaptionML=[ENU=Customer tax rate;
                           ESM=Tasa de impuesto de cliente;
                           FRC=Taux de taxe client;
                           ENC=Customer tax rate];
                ToolTipML=[ENU=Specifies the customer's tax area.;
                           ESM=Especifica el †rea de impuesto del cliente.;
                           FRC=SpÇcifie la rÇgion fiscale du client.;
                           ENC=Specifies the customer's tax area.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                NotBlank=Yes;
                SourceExpr=TaxAreaDescription;
                Visible=NOT IsUsingVAT;
                Enabled=CustomerName <> '';
                Editable=FALSE;
                OnDrillDown=VAR
                              TaxArea@1020000 : Record 318;
                            BEGIN
                              IF NOT TaxArea.GET("Tax Area Code") THEN
                                EXIT;

                              PAGE.RUNMODAL(PAGE::"BC O365 Tax Settings Card",TaxArea);
                            END;

                OnAssistEdit=VAR
                               TaxArea@1000 : Record 318;
                             BEGIN
                               IF PAGE.RUNMODAL(PAGE::"O365 Tax Area List",TaxArea) = ACTION::LookupOK THEN BEGIN
                                 VALIDATE("Tax Area Code",TaxArea.Code);
                                 TaxAreaDescription := TaxArea.GetDescriptionInCurrentLanguage;
                                 CurrPage.UPDATE;
                               END;
                             END;

                QuickEntry=FALSE }

    { 1020001;2;Field     ;
                CaptionML=[ENU=Tax %;
                           ESM=% de impuesto;
                           FRC=% taxe;
                           ENC=Tax %];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=TotalTaxRate;
                Visible=IsCanada;
                Enabled=CustomerName <> '';
                Editable=FALSE }

    { 27  ;2   ;Field     ;
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="VAT Registration No.";
                Visible=ESACC_F70_Visible AND (IsUsingVAT);
                Editable=ESACC_F70_Editable AND ((IsUsingVAT AND IsCompanyContact));
                HideValue=ESACC_F70_HideValue }

    { 44  ;1   ;Part      ;
                Name=Lines;
                CaptionML=[ENU=Line Items;
                           ESM=Productos de l°nea;
                           FRC=Articles de la ligne;
                           ENC=Line Items];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SubPageLink=Document Type=FIELD(Document Type),
                            Document No.=FIELD(No.);
                PagePartID=Page2311;
                Enabled=CustomerName <> '';
                Editable=CustomerName <> '';
                PartType=Page }

    { 33  ;1   ;Group     ;
                CaptionML=[ENU=Totals;
                           ESM=Totales;
                           FRC=Totaux;
                           ENC=Totals];
                Visible=NOT InvDiscAmountVisible;
                GroupType=Group }

    { 32  ;2   ;Group     ;
                GroupType=Group }

    { 31  ;3   ;Field     ;
                Name=Amount;
                Lookup=No;
                DrillDown=No;
                CaptionML=[ENU=Net Total;
                           ESM=Total neto;
                           FRC=Total net;
                           ENC=Net Total];
                ToolTipML=[ENU=Specifies the total amount on the sales invoice excluding tax.;
                           ESM=Especifica el importe total de la factura de ventas sin IVA.;
                           FRC=SpÇcifie le montant total de la facture vente, sans la TVA.;
                           ENC=Specifies the total amount on the sales invoice excluding tax.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=Amount;
                AutoFormatType=10;
                AutoFormatExpr=CurrencyFormat;
                Visible=ESACC_F60_Visible;
                HideValue=ESACC_F60_HideValue }

    { 25  ;3   ;Field     ;
                Name=AmountInclVAT;
                Lookup=No;
                DrillDown=No;
                CaptionML=[ENU=Total Including tax;
                           ESM=Total con IVA;
                           FRC=Total TTC;
                           ENC=Total Including Tax];
                ToolTipML=[ENU=Specifies the total amount on the sales invoice including tax.;
                           ESM=Especifica el importe total de la factura de venta con IVA.;
                           FRC=SpÇcifie le montant total de la facture vente, avec la TVA.;
                           ENC=Specifies the total amount on the sales invoice including tax.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Amount Including VAT";
                AutoFormatType=10;
                AutoFormatExpr=CurrencyFormat;
                Importance=Promoted;
                Visible=ESACC_F61_Visible;
                HideValue=ESACC_F61_HideValue;
                Style=Strong;
                StyleExpr=TRUE }

    { 39  ;3   ;Group     ;
                Visible=CouponsExistsForCustomer;
                GroupType=Group }

    { 38  ;4   ;Field     ;
                Name=CouponCodes;
                CaptionML=[ENU=Coupons;
                           ESM=Cupones;
                           FRC=Coupons;
                           ENC=Coupons];
                ToolTipML=[ENU=Specifies the coupons that are used on this quote.;
                           ESM=Especifica los cupones empleados en esta cotizaci¢n.;
                           FRC=SpÇcifie les coupons utilisÇs pour ce devis.;
                           ENC=Specifies the coupons that are used on this quote.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=CouponCodes;
                Editable=FALSE;
                OnDrillDown=VAR
                              DisplayCoupons@1000 : Codeunit 2115;
                            BEGIN
                              DisplayCoupons.ShowCouponsForDocument("Document Type","No.");
                            END;
                             }

    { 21  ;3   ;Field     ;
                Name=DiscountLink;
                DrillDown=Yes;
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=DiscountTxt;
                Enabled=CustomerName <> '';
                Editable=FALSE;
                OnDrillDown=BEGIN
                              IF PAGE.RUNMODAL(PAGE::"O365 Sales Invoice Discount",Rec) = ACTION::LookupOK THEN
                                CurrPage.UPDATE;
                            END;

                ShowCaption=No }

    { 20  ;1   ;Group     ;
                CaptionML=[ENU=Totals;
                           ESM=Totales;
                           FRC=Totaux;
                           ENC=Totals];
                Visible=InvDiscAmountVisible;
                GroupType=Group }

    { 19  ;2   ;Group     ;
                GroupType=Group }

    { 17  ;3   ;Field     ;
                CaptionML=[ENU=Subtotal;
                           ESM=Subtotal;
                           FRC=Sous-total;
                           ENC=Subtotal];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=SubTotalAmount;
                AutoFormatType=10;
                AutoFormatExpr=CurrencyFormat;
                Importance=Promoted;
                Editable=FALSE }

    { 16  ;3   ;Field     ;
                Name=InvoiceDiscount;
                CaptionML=[ENU=Invoice Discount;
                           ESM=Descuento en factura;
                           FRC=Escompte de la facture;
                           ENC=Invoice Discount];
                ToolTipML=[ENU=Specifies the invoice discount amount. To edit the invoice discount, click on the amount.;
                           ESM=Especifica el importe de descuento en factura. Para editar este descuento, haga clic en el importe.;
                           FRC=SpÇcifie le montant d'escompte de la facture. Pour modifier l'escompte de la facture, cliquez sur le montant.;
                           ENC=Specifies the invoice discount amount. To edit the invoice discount, click on the amount.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=-InvoiceDiscountAmount;
                AutoFormatType=10;
                AutoFormatExpr=CurrencyFormat;
                CaptionClass=GetInvDiscountCaption;
                Importance=Promoted;
                Editable=FALSE;
                OnDrillDown=BEGIN
                              IF PAGE.RUNMODAL(PAGE::"O365 Sales Invoice Discount",Rec) = ACTION::LookupOK THEN
                                CurrPage.UPDATE;
                            END;
                             }

    { 15  ;3   ;Field     ;
                Name=Amount2;
                Lookup=No;
                DrillDown=No;
                CaptionML=[ENU=Net Total;
                           ESM=Neto total;
                           FRC=Total net;
                           ENC=Net Total];
                ToolTipML=[ENU=Specifies the total amount on the sales invoice excluding tax.;
                           ESM=Especifica el importe total de la factura de ventas sin IVA.;
                           FRC=SpÇcifie le montant total de la facture vente, sans la TVA.;
                           ENC=Specifies the total amount on the sales invoice excluding tax.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=Amount;
                AutoFormatType=10;
                AutoFormatExpr=CurrencyFormat;
                Visible=ESACC_F60_Visible;
                HideValue=ESACC_F60_HideValue }

    { 14  ;3   ;Field     ;
                Name=AmountInclVAT2;
                Lookup=No;
                DrillDown=No;
                CaptionML=[ENU=Total Including Tax;
                           ESM=Total con IVA;
                           FRC=Total TTC;
                           ENC=Total Including Tax];
                ToolTipML=[ENU=Specifies the total amount on the sales invoice including tax.;
                           ESM=Especifica el importe total de la factura de venta con IVA.;
                           FRC=SpÇcifie le montant total de la facture vente, avec la TVA.;
                           ENC=Specifies the total amount on the sales invoice including tax.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr="Amount Including VAT";
                AutoFormatType=10;
                AutoFormatExpr=CurrencyFormat;
                Importance=Promoted;
                Visible=ESACC_F61_Visible;
                HideValue=ESACC_F61_HideValue;
                Style=Strong;
                StyleExpr=TRUE }

    { 37  ;3   ;Group     ;
                Visible=CouponsExistsForCustomer;
                GroupType=Group }

    { 36  ;4   ;Field     ;
                Name=CouponCodes2;
                CaptionML=[ENU=Coupons;
                           ESM=Cupones;
                           FRC=Coupons;
                           ENC=Coupons];
                ToolTipML=[ENU=Specifies the coupons that are used on this quote.;
                           ESM=Especifica los cupones empleados en esta cotizaci¢n.;
                           FRC=SpÇcifie les coupons utilisÇs pour ce devis.;
                           ENC=Specifies the coupons that are used on this quote.];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=CouponCodes;
                Editable=FALSE;
                OnDrillDown=VAR
                              DisplayCoupons@1000 : Codeunit 2115;
                            BEGIN
                              DisplayCoupons.ShowCouponsForDocument("Document Type","No.");
                            END;
                             }

    { 12  ;1   ;Group     ;
                CaptionML=[ENU=Note for customer;
                           ESM=Nota para el cliente;
                           FRC=Note pour le client;
                           ENC=Note for customer];
                GroupType=Group }

    { 8   ;2   ;Field     ;
                CaptionML=[ENU=Note for customer;
                           ESM=Nota para el cliente;
                           FRC=Note pour le client;
                           ENC=Note for customer];
                ToolTipML=[ENU=Specifies the products or service being offered;
                           ESM=Especifica los productos o servicios que se ofrecen.;
                           FRC=SpÇcifie les produits ou services offerts;
                           ENC=Specifies the products or service being offered];
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=WorkDescription;
                Editable=CurrPageEditable AND (CustomerName <> '');
                MultiLine=Yes;
                OnValidate=BEGIN
                             SetWorkDescription(WorkDescription);
                           END;

                ShowCaption=No }

    { 13  ;1   ;Field     ;
                DrillDown=Yes;
                ApplicationArea=#Basic,#Suite,#Invoicing;
                SourceExpr=NoOfAttachmentsValueTxt;
                Enabled=CustomerName <> '';
                Editable=FALSE;
                OnDrillDown=BEGIN
                              O365SalesInvoiceMgmt.UpdateNoOfAttachmentsLabel(O365SalesAttachmentMgt.EditAttachments(Rec),NoOfAttachmentsValueTxt);
                              CurrPage.UPDATE(FALSE);
                            END;

                ShowCaption=No }

  }
  CODE
  {
    VAR
      ESACC_ESFLADSMgt@14123801 : Codeunit 14123801;
      ESACC_C3_Visible@905000030 : Boolean INDATASET;
      ESACC_C3_Enabled@905000033 : Boolean INDATASET;
      ESACC_C11_Visible@905000110 : Boolean INDATASET;
      ESACC_C11_Enabled@905000113 : Boolean INDATASET;
      ESACC_C23_Visible@905000230 : Boolean INDATASET;
      ESACC_C23_Enabled@905000233 : Boolean INDATASET;
      ESACC_C24_Visible@905000240 : Boolean INDATASET;
      ESACC_C24_Enabled@905000243 : Boolean INDATASET;
      ESACC_C28_Visible@905000280 : Boolean INDATASET;
      ESACC_C28_Enabled@905000283 : Boolean INDATASET;
      ESACC_C30_Visible@905000300 : Boolean INDATASET;
      ESACC_C30_Enabled@905000303 : Boolean INDATASET;
      ESACC_F60_Visible@900000620 : Boolean INDATASET;
      ESACC_F60_HideValue@900000622 : Boolean INDATASET;
      ESACC_F61_Visible@900000630 : Boolean INDATASET;
      ESACC_F61_HideValue@900000632 : Boolean INDATASET;
      ESACC_F70_Visible@900000700 : Boolean INDATASET;
      ESACC_F70_Editable@900000701 : Boolean INDATASET;
      ESACC_F70_HideValue@900000702 : Boolean INDATASET;
      ESACC_F79_Visible@900000790 : Boolean INDATASET;
      ESACC_F79_Editable@900000791 : Boolean INDATASET;
      ESACC_F79_HideValue@900000792 : Boolean INDATASET;
      ESACC_F81_Visible@900000810 : Boolean INDATASET;
      ESACC_F81_Editable@900000811 : Boolean INDATASET;
      ESACC_F81_HideValue@900000812 : Boolean INDATASET;
      ESACC_F82_Visible@900000820 : Boolean INDATASET;
      ESACC_F82_Editable@900000821 : Boolean INDATASET;
      ESACC_F82_HideValue@900000822 : Boolean INDATASET;
      ESACC_F83_Visible@900000830 : Boolean INDATASET;
      ESACC_F83_Editable@900000831 : Boolean INDATASET;
      ESACC_F83_HideValue@900000832 : Boolean INDATASET;
      ESACC_F88_Visible@900000880 : Boolean INDATASET;
      ESACC_F88_Editable@900000881 : Boolean INDATASET;
      ESACC_F88_HideValue@900000882 : Boolean INDATASET;
      ESACC_F89_Visible@900000890 : Boolean INDATASET;
      ESACC_F89_Editable@900000891 : Boolean INDATASET;
      ESACC_F89_HideValue@900000892 : Boolean INDATASET;
      ESACC_F90_Visible@900000900 : Boolean INDATASET;
      ESACC_F90_Editable@900000901 : Boolean INDATASET;
      ESACC_F90_HideValue@900000902 : Boolean INDATASET;
      ESACC_F115_Visible@900001150 : Boolean INDATASET;
      ESACC_F115_Editable@900001151 : Boolean INDATASET;
      ESACC_F115_HideValue@900001152 : Boolean INDATASET;
      ESACC_F152_Visible@900001520 : Boolean INDATASET;
      ESACC_F152_Editable@900001521 : Boolean INDATASET;
      ESACC_F152_HideValue@900001522 : Boolean INDATASET;
      ESACC_F153_Visible@900001530 : Boolean INDATASET;
      ESACC_F153_Editable@900001531 : Boolean INDATASET;
      ESACC_F153_HideValue@900001532 : Boolean INDATASET;
      ESACC_F154_Visible@900001540 : Boolean INDATASET;
      ESACC_F154_Editable@900001541 : Boolean INDATASET;
      ESACC_F154_HideValue@900001542 : Boolean INDATASET;
      ESACC_F155_Visible@900001550 : Boolean INDATASET;
      ESACC_F155_Editable@900001551 : Boolean INDATASET;
      ESACC_F155_HideValue@900001552 : Boolean INDATASET;
      O365SalesAttachmentMgt@1006 : Codeunit 2112;
      O365SendResendInvoice@1001 : Codeunit 2104;
      O365SalesInvoiceMgmt@1005 : Codeunit 2310;
      CustomerName@1000 : Text[50];
      CustomerEmail@1004 : Text[80];
      WorkDescription@1002 : Text;
      FullAddress@1008 : Text;
      CurrPageEditable@1003 : Boolean;
      IsUsingVAT@1010 : Boolean;
      IsCanada@1020000 : Boolean;
      ForceExit@1012 : Boolean;
      InvDiscAmountVisible@1022 : Boolean;
      IsCompanyContact@1015 : Boolean;
      CouponsExistsForCustomer@1018 : Boolean;
      InvoiceDiscountAmount@1037 : Decimal;
      SubTotalAmount@1020 : Decimal;
      DiscountTxt@1019 : Text;
      NoOfAttachmentsValueTxt@1011 : Text;
      CurrencyFormat@1013 : Text;
      DeleteQst@1009 : TextConst 'ENU=Are you sure?;ESM=®Est† seguro?;FRC=“tes-vous certainˇ?;ENC=Are you sure?';
      ViewContactDetailsLbl@1007 : TextConst 'ENU=Open contact details;ESM=Abrir detalles de contacto;FRC=Ouvrir les dÇtails du contact;ENC=Open contact details';
      TaxAreaDescription@1014 : Text[50];
      TotalTaxRate@1020001 : Text;
      PercentTxt@1020002 : TextConst 'ENU=%;ESM=%;FRC=%;ENC=%';
      CouponCodes@1017 : Text;
      SyncBusinessInfoTxt@1016 : TextConst 'ENU=Delta sync Business Information;ESM=Informaci¢n de la empresa con sincronizaci¢n delta;FRC=Synchro. Çcart informations professionnelles;ENC=Delta sync Business Information';

    LOCAL PROCEDURE ESACC_EasySecurity@14123801(OpenObject@14123801 : Boolean);
    VAR
      SetFilters@14123802 : Codeunit 14123812;
      TempBoolean@14123803 : Boolean;
    BEGIN
      IF OpenObject THEN BEGIN
        SetFilters.Filter36(Rec,8,2341);

        TempBoolean := CurrPage.EDITABLE;
        IF ESACC_ESFLADSMgt.PageGeneral(36,2341,TempBoolean) THEN
          CurrPage.EDITABLE := TempBoolean;
      END;

      ESACC_ESFLADSMgt.PageControl(
        36,2341,1,3,
        ESACC_C3_Visible,ESACC_C3_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,1,11,
        ESACC_C11_Visible,ESACC_C11_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,1,23,
        ESACC_C23_Visible,ESACC_C23_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,1,24,
        ESACC_C24_Visible,ESACC_C24_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,1,28,
        ESACC_C28_Visible,ESACC_C28_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,1,30,
        ESACC_C30_Visible,ESACC_C30_Enabled,TempBoolean);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,60,
        ESACC_F60_Visible,TempBoolean,ESACC_F60_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,60,
        ESACC_F60_Visible,TempBoolean,ESACC_F60_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,61,
        ESACC_F61_Visible,TempBoolean,ESACC_F61_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,61,
        ESACC_F61_Visible,TempBoolean,ESACC_F61_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,70,
        ESACC_F70_Visible,ESACC_F70_Editable,ESACC_F70_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,79,
        ESACC_F79_Visible,ESACC_F79_Editable,ESACC_F79_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,81,
        ESACC_F81_Visible,ESACC_F81_Editable,ESACC_F81_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,82,
        ESACC_F82_Visible,ESACC_F82_Editable,ESACC_F82_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,83,
        ESACC_F83_Visible,ESACC_F83_Editable,ESACC_F83_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,88,
        ESACC_F88_Visible,ESACC_F88_Editable,ESACC_F88_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,89,
        ESACC_F89_Visible,ESACC_F89_Editable,ESACC_F89_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,90,
        ESACC_F90_Visible,ESACC_F90_Editable,ESACC_F90_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,115,
        ESACC_F115_Visible,ESACC_F115_Editable,ESACC_F115_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,152,
        ESACC_F152_Visible,ESACC_F152_Editable,ESACC_F152_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,153,
        ESACC_F153_Visible,ESACC_F153_Editable,ESACC_F153_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,154,
        ESACC_F154_Visible,ESACC_F154_Editable,ESACC_F154_HideValue);

      ESACC_ESFLADSMgt.PageControl(
        36,2341,0,155,
        ESACC_F155_Visible,ESACC_F155_Editable,ESACC_F155_HideValue);

      ESACC_EasySecurityManual(OpenObject);
    END;

    LOCAL PROCEDURE ESACC_EasySecurityManual@14123811(OpenObject@14123811 : Boolean);
    BEGIN
    END;

    PROCEDURE SuppressExitPrompt@5();
    BEGIN
      ForceExit := TRUE;
    END;

    LOCAL PROCEDURE GetTotalTaxRate@1020001();
    VAR
      O365TaxSettingsManagement@1020000 : Codeunit 10150;
    BEGIN
      IF "Tax Area Code" <> '' THEN
        TotalTaxRate := FORMAT(O365TaxSettingsManagement.GetTotalTaxRate("Tax Area Code")) + PercentTxt
      ELSE
        TotalTaxRate := '';
    END;

    LOCAL PROCEDURE GetInvDiscountCaption@8() : Text;
    BEGIN
      EXIT(O365SalesInvoiceMgmt.GetInvoiceDiscountCaption(ROUND("Invoice Discount Value",0.1)));
    END;

    BEGIN
    END.
  }
}

