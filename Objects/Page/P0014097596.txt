OBJECT Page 14097596 DP Setup Wizard
{
  OBJECT-PROPERTIES
  {
    Date=06/01/19;
    Time=12:00:00 PM;
    Version List=UBP3.01;
  }
  PROPERTIES
  {
    CaptionML=ENU=Demand Planning Setup;
    InsertAllowed=No;
    DeleteAllowed=No;
    LinksAllowed=No;
    PageType=NavigatePage;
    ShowFilter=No;
    OnInit=BEGIN

             CLEAR(SetupMgt);
             CheckSetupProcesses;
             CurrWorkdate := WORKDATE;
             IntroText := DemandPlanningTitle;
           END;

    OnOpenPage=BEGIN
                 DoneMessageVisible := FALSE;
                 ShowIntroStep;
               END;

    ActionList=ACTIONS
    {
      { 9       ;    ;ActionContainer;
                      ActionContainerType=ActionItems }
      { 1240020008;1 ;Action    ;
                      Name=SimpleConfiguration;
                      CaptionML=ENU=Quick Configuration;
                      Visible=SetupMgtVisible;
                      InFooterBar=Yes;
                      Image=Setup;
                      OnAction=VAR
                                 DPSetupRunner@1240020000 : Codeunit 14098054;
                               BEGIN
                                 CLEAR(DPSetupRunner);
                                 DPSetupRunner.ProcessAll;
                                 NextEnabled := InventoryMgtIsSetup;
                               END;
                                }
      { 1240020030;1 ;Action    ;
                      Name=LocationSetup;
                      CaptionML=ENU=Quick Location Configuration;
                      Visible=LocationSetupVisible;
                      InFooterBar=Yes;
                      OnAction=VAR
                                 LocationInvPeriod@1240020000 : Record 14000553;
                               BEGIN
                                 SetupMgt.ShowLocationsToConfigure;
                                 NextEnabled := NOT LocationInvPeriod.ISEMPTY;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1240020031;1 ;Action    ;
                      Name=ProcessDemoDataSetup;
                      RunObject=Codeunit 14098056;
                      Visible=LocationSetupVisible;
                      Image=AdjustEntries;
                      OnAction=BEGIN
                                 CODEUNIT.RUN(CODEUNIT::"Create Historical Data");
                               END;
                                }
      { 1240020035;1 ;Action    ;
                      Name=UpdateExistingHistory;
                      CaptionML=ENU=Update Existing Item Ledger;
                      RunObject=Report 14000582;
                      Visible=UpdateExistingHistoryVisible;
                      InFooterBar=Yes;
                      OnAction=BEGIN
                                 REPORT.RUNMODAL(REPORT::"Initial ILE Update", TRUE);
                                 COMMIT;
                                 NextEnabled := CheckILENextEnabled;
                                 CurrPage.UPDATE(FALSE);
                               END;
                                }
      { 1240020036;1 ;Action    ;
                      Name=Period End Processing;
                      RunObject=Page 14000574;
                      Visible=DoneVisible;
                      InFooterBar=Yes;
                      Image=Period }
      { 12      ;1   ;Action    ;
                      Name=ActionBack;
                      CaptionML=ENU=Back;
                      Enabled=BackEnabled;
                      InFooterBar=Yes;
                      Image=PreviousRecord;
                      OnAction=BEGIN
                                 NextStep(TRUE);
                               END;
                                }
      { 11      ;1   ;Action    ;
                      Name=ActionNext;
                      CaptionML=ENU=Next;
                      Enabled=NextEnabled;
                      InFooterBar=Yes;
                      Image=NextRecord;
                      OnAction=VAR
                                 ExchangeAddinSetup@1000 : Codeunit 5323;
                               BEGIN
                                 NextStep(FALSE);
                               END;
                                }
      { 10      ;1   ;Action    ;
                      Name=ActionFinish;
                      CaptionML=ENU=Finish;
                      InFooterBar=Yes;
                      Image=Approve;
                      OnAction=VAR
                                 AssistedSetup@1004 : Record 1803;
                                 MarketingSetup@1000 : Record 5079;
                               BEGIN
                                 FinishPage;
                               END;
                                }
      { 1240020026;  ;ActionContainer;
                      ActionContainerType=RelatedInformation }
      { 1240020007;1 ;Action    ;
                      Name=Setup Processes;
                      RunObject=Page 14097597;
                      Image=Setup }
      { 1240020003;1 ;Action    ;
                      Name=Import Formulas;
                      CaptionML=ENU=Import Formulas;
                      RunObject=XMLport 14002701;
                      Image=Evaluate;
                      PromotedCategory=New }
      { 1240020006;1 ;Action    ;
                      Name=Import Historical Usage;
                      CaptionML=ENU=Import Historical Usage;
                      RunObject=XMLport 14002702;
                      Image=History;
                      PromotedCategory=New }
      { 1240020025;1 ;Action    ;
                      Name=Configuration Package;
                      Image=CheckRulesSyntax;
                      OnAction=BEGIN
                                 ViewConfiguration;
                               END;
                                }
      { 1240020020;1 ;Action    ;
                      Name=Formulas;
                      RunObject=Page 14002654;
                      Image=Evaluate }
      { 1240020014;1 ;Action    ;
                      Name=Locations;
                      RunObject=Page 15;
                      Image=Warehouse;
                      PromotedCategory=New }
      { 1240020022;1 ;Action    ;
                      Name=Inventory Management Setup;
                      RunObject=Page 14000552;
                      Image=InventorySetup;
                      PromotedCategory=New }
      { 1240020021;1 ;Action    ;
                      Name=Advanced Forecasting Setup;
                      RunObject=Page 14002651;
                      Image=Forecast;
                      PromotedCategory=New }
      { 1240020015;1 ;Action    ;
                      Name=Forecast User Setup;
                      RunObject=Page 14097453;
                      Image=UserSetup }
      { 1240020023;1 ;Action    ;
                      Name=Period End Processing2;
                      CaptionML=ENU=Period End Processing;
                      RunObject=Page 14000574;
                      Image=Period }
      { 1240020019;1 ;Action    ;
                      Name=Collaboartive Setup;
                      RunObject=Page 14002610;
                      Image=Customer }
      { 1240020018;1 ;Action    ;
                      Name=Production Setup;
                      RunObject=Page 14002677;
                      Image=ProductionSetup }
      { 1240020017;1 ;Action    ;
                      Name=Production Templates;
                      RunObject=Page 14002680;
                      Image=Production }
      { 1240020016;1 ;Action    ;
                      Name=Alert Setup;
                      RunObject=Page 14002716;
                      Image=Alerts }
      { 1240020012;1 ;Action    ;
                      Name=Item Class;
                      RunObject=Page 14000555;
                      Image=ItemInvoice }
      { 1240020011;1 ;Action    ;
                      Name=Item Ranking;
                      RunObject=Page 14002656;
                      Image=ItemRegisters }
      { 1240020010;1 ;Action    ;
                      Name=Sporadic Rules;
                      RunObject=Page 14002704;
                      Image=Allocate }
      { 1240020009;1 ;Action    ;
                      Name=Stocking Rule;
                      RunObject=Page 14000599;
                      Image=NonStockItemSetup }
      { 1240020005;  ;ActionContainer;
                      ActionContainerType=Reports }
      { 1240020004;1 ;Action    ;
                      Name=Create Forecast Inventory Period;
                      RunObject=Report 14000552;
                      Image=New;
                      PromotedCategory=New }
      { 1240020001;1 ;Action    ;
                      Name=Initialize Item Ledger Entry;
                      RunObject=Report 14000582;
                      Image=History;
                      PromotedCategory=New }
    }
  }
  CONTROLS
  {
    { 1   ;    ;Container ;
                Name=Control 1;
                ContainerType=ContentArea }

    { 1240020000;1;Field  ;
                Name=CurrWorkdate;
                CaptionML=ENU=Workdate;
                SourceExpr=CurrWorkdate;
                OnValidate=BEGIN
                             SetWorkdate(CurrWorkdate);
                             CurrPage.UPDATE(FALSE);
                           END;
                            }

    { 2   ;1   ;Group     ;
                Name=Step1;
                CaptionML=ENU=Step1;
                Visible=IntroVisible;
                GroupType=Group }

    { 3   ;2   ;Group     ;
                CaptionML=[ENU=Welcome Demand Planning Assisted Setup;
                           ESM=Configuraci¢n de registro de correo electr¢nico;
                           FRC=Bienvenue dans la configuration de la connexion … la messagerie;
                           ENC=Welcome to Email Logging Setup];
                GroupType=Group }

    { 1240020002;3;Field  ;
                Name=InstructionText;
                SourceExpr=IntroText;
                Editable=FALSE;
                MultiLine=Yes }

    { 5   ;1   ;Group     ;
                Name=Step2;
                CaptionML=ENU=Step2;
                Visible=SetupMgtVisible;
                GroupType=Group }

    { 6   ;2   ;Group     ;
                Name=SetupMgt;
                CaptionML=ENU=Configure Demand Planning;
                GroupType=Group }

    { 1240020013;3;Field  ;
                Name=InstructionText2;
                SourceExpr=InstructionText;
                MultiLine=Yes;
                ShowCaption=No }

    { 1240020029;1;Group  ;
                Name=Step3;
                CaptionML=ENU=Step3;
                Visible=LocationSetupVisible;
                GroupType=Group }

    { 1240020028;2;Group  ;
                Name=LocationsSetup;
                CaptionML=ENU=Configure Locations;
                GroupType=Group }

    { 1240020027;3;Field  ;
                Name=InstructionText3;
                SourceExpr=InstructionText;
                MultiLine=Yes;
                ShowCaption=No }

    { 1240020034;1;Group  ;
                Name=Step4;
                CaptionML=ENU=Step4;
                Visible=UpdateExistingHistoryVisible;
                GroupType=Group }

    { 1240020033;2;Group  ;
                Name=UpdateExistingSetup;
                CaptionML=ENU=Update Existing History;
                Visible=UpdateExistingHistoryVisible;
                GroupType=Group }

    { 1240020032;3;Field  ;
                Name=InstructionText4;
                SourceExpr=InstructionText;
                MultiLine=Yes;
                ShowCaption=No }

    { 14  ;1   ;Group     ;
                Name=Step6;
                CaptionML=ENU=Step6;
                Visible=DoneVisible;
                GroupType=Group }

    { 15  ;2   ;Group     ;
                Name=FinalStepDesc;
                CaptionML=ENU=That's it!;
                GroupType=Group }

    { 1240020024;3;Field  ;
                Name=InstructionText5;
                SourceExpr=InstructionText;
                MultiLine=Yes;
                ShowCaption=No }

    { 33  ;3   ;Group     ;
                GroupType=Group }

  }
  CODE
  {
    VAR
      CurrWorkdate@1240020001 : Date;
      IntroText@1240020002 : Text;
      InstructionText@1240020024 : Text;
      ClientTypeManagement@1039 : Codeunit 4;
      InvMgtSetup@1240020030 : Record 14000551;
      Step@1008 : 'Intro,SetupMgt,LocationSetup,UpdateExistingHistory,Done';
      BackEnabled@1002 : Boolean;
      NextEnabled@1003 : Boolean;
      FinishEnabled@1004 : Boolean;
      IntroVisible@1005 : Boolean;
      SetupMgtVisible@1006 : Boolean;
      DoneVisible@1007 : Boolean;
      NAVNotSetUpQst@1027 : TextConst 'ENU=Are you sure that you want to quit before completing setup?;ESM=" No se termin¢ la configuraci¢n del registro de correo electr¢nico\\¨Est  seguro de que desea salir?";FRC=La configuration de la connexion … la messagerie n''a pas ‚t‚ men‚e … bien. \\Òtes-vous s–r de vouloir quitterÿ?;ENC=Setup of Email Logging was not finished. \\Are you sure that you want to exit?';
      LocationSetupVisible@1240020004 : Boolean;
      SkipDeployment@1038 : Boolean;
      DoneMessageVisible@1240020029 : Boolean;
      DemandPlanningTitle@1240020000 : TextConst 'ENU=Welcome to Demand Planning by Lanham and Associates.  Please follow these steps to configure your system.';
      UpdateExistingHistoryVisible@1240020005 : Boolean;
      SetupMgt@1240020003 : Codeunit 14098053;

    LOCAL PROCEDURE NextStep@3(Backwards@1000 : Boolean);
    BEGIN
      IF Backwards THEN
        Step := Step - 1
      ELSE
        Step := Step + 1;

      CASE Step OF
        Step::Intro:
          ShowIntroStep;
        Step::SetupMgt:
          BEGIN
            ShowSetupMgtPassStep;
          END;
        Step::LocationSetup:
          BEGIN
            ShowLocationSetupStep;
          END;
        Step::UpdateExistingHistory:
          BEGIN
            ShowUpdateExistingHistoryStep;
          END;
        Step::Done:
          ShowDoneStep;
      END;
      CurrPage.UPDATE(TRUE);
    END;

    LOCAL PROCEDURE ShowIntroStep@1();
    BEGIN
      ResetWizardControls;
      IntroVisible := TRUE;
      BackEnabled := FALSE;
    END;

    LOCAL PROCEDURE ShowSetupMgtPassStep@9();
    BEGIN
      ResetWizardControls;
      InstructionText := 'Use the simple configuration button or configure using the advanced actions.';
      NextEnabled := InventoryMgtIsSetup;
      SetupMgtVisible := TRUE;
    END;

    LOCAL PROCEDURE ShowLocationSetupStep@1240020003();
    VAR
      LocationInvPeriod@1240020000 : Record 14000553;
    BEGIN
      ResetWizardControls;
      InstructionText := 'Use the location list to select the enabled locations.';
      NextEnabled := NOT LocationInvPeriod.ISEMPTY;
      LocationSetupVisible := TRUE;
    END;

    LOCAL PROCEDURE ShowUpdateExistingHistoryStep@1240020004();
    VAR
      ItemLedgerEntry@1240020000 : Record 32;
      MoveToNextStep@1240020001 : Boolean;
    BEGIN
      ResetWizardControls;
      InstructionText := 'This step updates previous item ledger entries.  Warning this could be take some time.';
      NextEnabled := CheckILENextEnabled;
      UpdateExistingHistoryVisible := TRUE;
    END;

    LOCAL PROCEDURE ShowDoneStep@11();
    BEGIN
      ResetWizardControls;
      DoneVisible := TRUE;
      NextEnabled := FALSE;
      FinishEnabled := TRUE;
      IF DoneVisible THEN BEGIN
        InstructionText := 'The final step is to run period end processing!' +
                           ' Afterwards the system will be ready to use.';
      END;
    END;

    LOCAL PROCEDURE ResetWizardControls@10();
    BEGIN
      // Buttons
      BackEnabled := TRUE;
      NextEnabled := TRUE;
      FinishEnabled := FALSE;

      // Tabs
      IntroVisible := FALSE;
      SetupMgtVisible := FALSE;
      LocationSetupVisible := FALSE;
      UpdateExistingHistoryVisible := FALSE;
      DoneVisible := FALSE;
    END;

    LOCAL PROCEDURE InventoryMgtIsSetup@53() SetupEnabled : Boolean;
    BEGIN
      SetupEnabled := FALSE;

      IF NOT InvMgtSetup.GET THEN
        EXIT(SetupEnabled);

      IF InvMgtSetup."Usage Start Date" = 0D THEN
        EXIT(SetupEnabled);

      SetupEnabled := TRUE;
    END;

    PROCEDURE SetWorkdate@1240020000(VAR CurrWorkdate@1000 : Date);
    BEGIN
      IF CurrWorkdate <> WORKDATE THEN
        WORKDATE(CurrWorkdate);
    END;

    PROCEDURE ViewConfiguration@2();
    BEGIN
      PAGE.RUN(PAGE::"Config. Packages");
    END;

    LOCAL PROCEDURE CheckSetupProcesses@1240020001();
    VAR
      SetupRunner@1240020000 : Codeunit 14098054;
      SetupProcessEntry@1000 : Record 14097491;
    BEGIN
      IF SetupProcessEntry.ISEMPTY THEN BEGIN
        SetupRunner.CreateProcesses;
      END;
    END;

    LOCAL PROCEDURE CheckILENextEnabled@1240020002() MoveToNextStep : Boolean;
    VAR
      ItemLedgerEntry@1240020000 : Record 32;
    BEGIN
      MoveToNextStep := FALSE;
      IF ItemLedgerEntry.ISEMPTY THEN
        MoveToNextStep := TRUE;
      IF NOT MoveToNextStep THEN BEGIN
        ItemLedgerEntry.SETRANGE("Entry Type", ItemLedgerEntry."Entry Type"::Sale);
        IF NOT ItemLedgerEntry.ISEMPTY THEN BEGIN
          ItemLedgerEntry.SETRANGE("First Shipment", TRUE);
          IF NOT ItemLedgerEntry.ISEMPTY THEN
            MoveToNextStep := TRUE;
        END ELSE
          MoveToNextStep := TRUE;
      END;
      EXIT(MoveToNextStep);
    END;

    LOCAL PROCEDURE FinishPage@1240020005();
    VAR
      AssistedSetup@1240020000 : Record 1808;
    BEGIN
      IF SetupMgt.CheckDPSetupStatus(AssistedSetup) = AssistedSetup.Status::"Not Completed" THEN BEGIN
        IF NOT CONFIRM(NAVNotSetUpQst,FALSE) THEN
          ERROR('');
      END;
      CurrPage.CLOSE;
    END;

    BEGIN
    END.
  }
}

